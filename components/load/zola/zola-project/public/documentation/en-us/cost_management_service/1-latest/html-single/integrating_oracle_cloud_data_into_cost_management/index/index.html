<!DOCTYPE html>
<html>
    <head>
        
        <link rel="stylesheet" type="text/css" media="screen" href="/mimir/styles/mimir.min.css">
        




    <link rel="stylesheet" type="text/css" media="screen" href="/sites/dxp-docs/files/css/css_87GMcmxT1ib8ziQiU2KUAnTDFtZQV6iP-KGslA9LigM.css" />

    <link rel="stylesheet" type="text/css" media="screen" href="/sites/dxp-docs/files/css/css_Bwzy34i9pSdDlzGALvqVwG4fpgGp08KLMAkClGNY9M4.css" />



<link rel="stylesheet" type="text/css" media="screen" href="/mimir/styles/mimir-doc-toc.min.css" />



        
        <!--#include virtual="/includes/head/index.html" -->

        
        <title>
Integrating Oracle Cloud data into cost management - Red Hat Insights cost management 1-latest
</title>
        
<meta name="product" content="Red Hat Insights cost management" />
<meta name="documentation_version" content="1-latest" />
<meta name="documentKind" content="documentation" />
<meta name="portal_content_subtype" content="title" />
<meta name="lastModifiedDate" content="2024-07-26T20:04:48.000Z" />


        
            
        
        
            
                
                
                <!-- mimir_solr_yesindex -->
                <meta name="mimir_solr_yesindex" content="true" />
            
        
    </head>

    <body class="mimir-body">

        
        

        
        <div id="page-wrap" class="page-wrap">
            <div id="pers-top-page-wrap" class="top-page-wrap pers-loader-bg">
                <div id="hero-bg-top-left" class="summit-bg-shapes"></div>
                <div id="hero-bg-top-right" class="summit-bg-shapes"></div>

                <header class="masthead" id="masthead">

                    
                    <!--#include virtual="/includes/header/index.html" -->

                    
                    
                    
                        
                    
                    
                        <div class="breadcrumbs">
                            <div id="breadcrumbs" class="container">
                                
                                <a href="/">Home</a>
                                
                                <a href="/products/">Product Documentation</a>
                                
                                <a href="/documentation/en-us/cost_management_service/1-latest/">Red Hat Insights cost management</a>
                                
                                <a href="/documentation/en-us/cost_management_service/1-latest/">1-latest</a>
                                
                                
                                Integrating Oracle Cloud data into cost management
                                
                            </div>
                        </div>
                    
                </header>

                <main id="cp-main" class="portal-content-area">
                    <div id="cp-content" class="main-content">
                        
                        <main class="container mimir-docs">
                            
                            <bdo>
                                

<script type="module" src="/mimir/scripts/mimir-doc-toc.min.js"></script>






<div class="docs-grid">

    <nav id="mimir-doc-toc" class="mimir-doc-toc">
      <div class="mimir-doc-toc-inner">
          <!-- single-page -->
        
            
              <ol>
                <li>
                        
                        <a href="#">Integrating Oracle Cloud data into cost management</a>
                    </li><li>
                        <a href="#assembly-adding-oci-int">
                            1. Creating an Oracle Cloud integration
                        </a><ol>
                <li>
                        <a href="#adding-an-oci-account_adding-oci-int">
                            1.1. Adding an Oracle Cloud Infrastructure account and naming your integration
                        </a>
                    </li><li>
                        <a href="#finding-global-compartment-id-oci_adding-oci-int">
                            1.2. Collecting and storing your global compartment-id
                        </a>
                    </li><li>
                        <a href="#creating-cost-policy-oci_adding-oci-int">
                            1.3. Creating a policy to create cost and usage reports
                        </a>
                    </li><li>
                        <a href="#creating-bucket-oci_adding-oci-int">
                            1.4. Creating a bucket for accessible cost and usage reports
                        </a>
                    </li><li>
                        <a href="#create-oci-script_adding-oci-int">
                            1.5. Replicating reports to a bucket
                        </a>
                    </li><li>
                        <a href="#creating-bucket-policy-oci_adding-oci-int">
                            1.6. Creating a bucket policy to grant read access and final steps
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#assembly-cost-management-next-steps-oci">
                            2. Next steps for managing your costs
                        </a><ol>
                <li>
                        <a href="#limiting-access_next-steps-oci">
                            2.1. Limiting access to cost management resources
                        </a>
                    </li><li>
                        <a href="#configure-tagging-next-step_next-steps-oci">
                            2.2. Configuring tagging for your integrations
                        </a>
                    </li><li>
                        <a href="#configure-cost-models-next-step_next-steps-oci">
                            2.3. Configuring cost models to accurately report costs
                        </a>
                    </li><li>
                        <a href="#cost-explorer-next-step_next-steps-oci">
                            2.4. Visualizing your costs with Cost Explorer
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#proc-providing-feedback-on-redhat-documentation">
                            Providing feedback on Red Hat documentation
                        </a>
                    </li><li>
                        <a href="#idm140561181187696">
                            Legal Notice
                        </a>
                    </li>
            </ol>
            
        
      </div>
    </nav>

    
    <div class="pvof-doc__wrapper" id="doc-wrapper">
        <section class="mimir-doc-title" id="mimir-doc--integrating_oracle_cloud_data_into_cost_management">
            <h1 class="title">Integrating Oracle Cloud data into cost management</h1>
        </section>
        <body><div xml:lang="en-US" class="book" id="idm140561181089968"><div class="titlepage"><div><div class="producttitle"><span class="productname">Cost Management Service</span> <span class="productnumber">1-latest</span></div><div><h2 class="subtitle">Learn how to add and configure your Oracle Cloud integration</h2></div><div><div xml:lang="en-US" class="authorgroup"><span class="orgname">Red Hat Customer Content Services</span></div></div><div><a href="#idm140561181187696">Legal Notice</a></div><div><div class="abstract"><p class="title"><strong>Abstract</strong></p><div class="para">
				Learn how to add an Oracle Cloud integration to cost management. Cost management is part of the <a class="link mimir-link-warn" href="https://redhat.com/insights" title="Mimir does not include content from: redhat.com">Red Hat Insights</a> portfolio of services. The Red Hat Insights suite of advanced analytical tools helps you to identify and prioritize impacts on your operations, security, and business.
			</div></div></div></div><hr/></div><section class="chapter" id="assembly-adding-oci-int"><div class="titlepage"><div><div><h1 class="title">Chapter 1. Creating an Oracle Cloud integration</h1></div></div></div><p class="_abstract _abstract">
			To add an Oracle Cloud account to cost management, you must add your Oracle Cloud account as an integration from the <a class="link mimir-link-warn" href="https://console.redhat.com" title="Mimir does not include content from: console.redhat.com">Red Hat Hybrid Cloud Console</a> user interface and configure Oracle Cloud to provide metrics. After you add your Oracle Cloud account to cost management as a data integration, you must configure a function script to copy the cost and usage reports to a bucket that cost management can access.
		</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
					Red Hat account user with <a class="link mimir-link-warn" href="https://access.redhat.com/documentation/en-us/red_hat_hybrid_cloud_console/2023/html/user_access_configuration_guide_for_role-based_access_control_rbac/assembly-rbac-procedures_user-access-configuration#proc-granting-group-access_rbac-procedures" title="This content is not included in Mimir.">Cloud Administrator entitlements</a>
				</li><li class="listitem">
					Access to Oracle Cloud Console with access to the compartment you want to add to cost management
				</li><li class="listitem">
					A service on Oracle Cloud generating service usage
				</li></ul></div><p>
			As you will complete some of the following steps in Oracle Cloud, and some steps in the <a class="link mimir-link-warn" href="https://console.redhat.com" title="Mimir does not include content from: console.redhat.com">Red Hat Hybrid Cloud Console</a>, log in to both applications and keep them open in a web browser. To begin, add your Oracle Cloud integration to cost management from <a class="link mimir-link-warn" href="https://console.redhat.com/settings/integrations" title="Mimir does not include content from: console.redhat.com">the Integrations page</a> using the <span class="strong strong"><strong>Add a cloud integration</strong></span> dialog.
		</p><section class="section" id="adding-an-oci-account_adding-oci-int"><div class="titlepage"><div><div><h2 class="title">1.1. Adding an Oracle Cloud Infrastructure account and naming your integration</h2></div></div></div><p class="_abstract _abstract">
				Add your Oracle Cloud account as a integration. After adding an Oracle Cloud integration, the cost management application processes the cost and usage data from your Oracle Cloud account and makes it viewable.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						From <a class="link mimir-link-warn" href="https://console.redhat.com" title="Mimir does not include content from: console.redhat.com">Red Hat Hybrid Cloud Console</a>, click <span class="strong strong"><strong>Settings Menu</strong></span> <span class="inlinemediaobject"><img src="/webassets/avalon/d/Cost_Management_Service-1-latest-Integrating_Oracle_Cloud_data_into_cost_management-en-US/images/f8511490af3f869d160b05f003f56521/configuration-gear.png" alt="Settings icon" /></span>
						 &gt; <span class="strong strong"><strong>Integrations</strong></span>.
					</li><li class="listitem">
						On the <span class="strong strong"><strong>Settings</strong></span> page, click <span class="guibutton">Integrations</span>.
					</li><li class="listitem">
						In the <span class="strong strong"><strong>Cloud</strong></span> tab, click <span class="strong strong"><strong>Add integration</strong></span>.
					</li><li class="listitem">
						In the <span class="strong strong"><strong>Add a cloud integration</strong></span> wizard, select <span class="strong strong"><strong>Oracle Cloud Infrastructure</strong></span> as the integration type. Click <span class="guibutton">Next</span>.
					</li><li class="listitem">
						Enter a name for your integration and click <span class="guibutton">Next</span>.
					</li><li class="listitem">
						In the <span class="strong strong"><strong>Select application</strong></span> step, select <span class="strong strong"><strong>Cost management</strong></span>. Click <span class="guibutton">Next</span>.
					</li></ol></div></section><section class="section" id="finding-global-compartment-id-oci_adding-oci-int"><div class="titlepage"><div><div><h2 class="title">1.2. Collecting and storing your global compartment-id</h2></div></div></div><p class="_abstract _abstract">
				Continue in the <span class="strong strong"><strong>Add a cloud integration</strong></span> wizard by collecting your global <code class="literal">compartment-id</code>, which is also known as your <code class="literal">tenant-id</code> in Microsoft Azure, so cost management can access your Oracle Cloud compartment.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						In the <span class="strong strong"><strong>Add a cloud integration</strong></span> wizard, on the <span class="strong strong"><strong>Global compartment-id</strong></span> step, copy the command in step one <code class="literal">oci iam compartment list</code>.
					</li><li class="listitem">
						In a new tab, log in to your <a class="link mimir-link-warn" href="https://cloud.oracle.com/" title="Mimir does not include content from: cloud.oracle.com">Oracle Cloud</a> account.
					</li><li class="listitem">
						In the menu bar, click <span class="strong strong"><strong>Developer tools</strong></span> &gt; <span class="strong strong"><strong>Cloud Shell</strong></span>.
					</li><li class="listitem">
						Paste the command you copied from the <span class="strong strong"><strong>Add a cloud integration</strong></span> wizard in the <span class="strong strong"><strong>Cloud Shell</strong></span> window.
					</li><li class="listitem"><p class="simpara">
						In the response, copy the value pair for the <code class="literal">compartment-id</code> key. In the following example, the ID starts with <code class="literal">ocid1.tenancy.oc1</code>.
					</p><div class="formalpara"><p class="title"><strong>Example response</strong></p><p>
							
<pre class="programlisting language-json">{
  "data": [
    {
      "compartment-id": "ocid1.tenancy.oc1..00000000000000000000000000000000000000000000",
      "defined-tags": {
        "Oracle-Tags": {
            ...
        }
      },
      ...
    }
  ]
}</pre>

						</p></div></li><li class="listitem">
						Return to the <span class="strong strong"><strong>Global compartment-id</strong></span> step in the <span class="strong strong"><strong>Add a cloud integration</strong></span> wizard, and paste your <code class="literal">tenant-id</code> in the <span class="strong strong"><strong>Global compartment-id</strong></span> field.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Next</strong></span>.
					</li></ol></div></section><section class="section" id="creating-cost-policy-oci_adding-oci-int"><div class="titlepage"><div><div><h2 class="title">1.3. Creating a policy to create cost and usage reports</h2></div></div></div><p class="_abstract _abstract">
				Continue in the <span class="strong strong"><strong>Add a cloud integration</strong></span> wizard by creating a custom policy and compartment for Oracle Cloud to create and store cost and usage reports.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						In the <span class="strong strong"><strong>Add a cloud integration</strong></span> wizard, on the <span class="strong strong"><strong>Create new policy and compartment</strong></span> page, copy the <code class="literal">oci iam policy create</code> command.
					</li><li class="listitem">
						Paste the command that you copied into the Cloud Shell in your Oracle Cloud tab to create a cost and usage reports policy. You can also add a policy description.
					</li><li class="listitem">
						Return to the <span class="strong strong"><strong>Create new policy and compartment</strong></span> step in the <span class="strong strong"><strong>Add a cloud integration</strong></span> wizard and copy the <code class="literal">oci iam compartment create</code> command.
					</li><li class="listitem">
						Paste the command that you copied into the Cloud Shell in your Oracle Cloud tab to create a cost management compartment.
					</li><li class="listitem"><p class="simpara">
						In the response, copy the value for the <code class="literal">id</code> key. In the following example, copy the id that includes <code class="literal">ocid1.compartment.oc1</code>.
					</p><div class="formalpara"><p class="title"><strong>Example response</strong></p><p>
							
<pre class="programlisting language-json">{
  "data": [
    {
      "compartment-id": "tenant-id",
      "defined-tags": {
        "Oracle-Tags": {
            ...
        }
      },
      "description": "Cost management compartment for cost and usage data",
      "freeform-tags": {},
      "id": "ocid1.compartment.oc1..0000000000000000000000000000000000000000000",
      ...
    },
    ...
  ]
}</pre>

						</p></div></li><li class="listitem">
						Return to the <span class="strong strong"><strong>Create new policy and compartment</strong></span> step in the <span class="strong strong"><strong>Add a cloud integration</strong></span> wizard and paste the <code class="literal">id</code> value you copied from the response in the last step into the <span class="strong strong"><strong>New compartment-id</strong></span> field.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Next</strong></span>.
					</li></ol></div></section><section class="section" id="creating-bucket-oci_adding-oci-int"><div class="titlepage"><div><div><h2 class="title">1.4. Creating a bucket for accessible cost and usage reports</h2></div></div></div><p class="_abstract _abstract">
				Create a bucket to store cost and usage reports that that cost management can access.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						In the <span class="strong strong"><strong>Create bucket</strong></span> step, create a bucket to store cost and usage data so that cost management can access it.
					</li><li class="listitem"><p class="simpara">
						Copy the command from the previous step and paste into the Cloud Shell in your Oracle Cloud tab to create a bucket. Refer to the example response for the next steps.
					</p><div class="formalpara"><p class="title"><strong>Example response</strong></p><p>
							
<pre class="programlisting language-json">{
  "data": {
    ...
    "name": "cost-management",
    "namespace": "cost-management-namespace",

    ...
    }
}</pre>

						</p></div></li><li class="listitem">
						Copy the value pair for the <code class="literal">name</code> key. In the previous example, this value is <code class="literal">cost-management</code>.
					</li><li class="listitem">
						Return to the <span class="strong strong"><strong>Create bucket</strong></span> step in the <span class="strong strong"><strong>Add a cloud integration</strong></span> wizard. Paste the value you copied into <span class="strong strong"><strong>New data bucket name</strong></span>.
					</li><li class="listitem">
						Return to your Cloud Shell and copy the value for the <code class="literal">namespace</code> key. In the previous example, copy <code class="literal">cost-management-namespace</code>.
					</li><li class="listitem">
						Return to the <span class="strong strong"><strong>Create bucket</strong></span> step in the <span class="strong strong"><strong>Add a cloud integration</strong></span> wizard and check your shell prompt for your region. For example, your shell prompt might be <code class="literal">user@cloudshell:~ (uk-london-1)$</code>. In this example, <code class="literal">uk-london-1</code> is your region. Copy your region and return to the <span class="strong strong"><strong>Create bucket</strong></span> step in the <span class="strong strong"><strong>Add a cloud integration</strong></span> wizard.
					</li><li class="listitem">
						In the <span class="strong strong"><strong>Create bucket</strong></span> step in the <span class="strong strong"><strong>Add a cloud integration</strong></span> wizard, paste your region in <span class="strong strong"><strong>New bucket region</strong></span>.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Next</strong></span>.
					</li></ol></div></section><section class="section" id="create-oci-script_adding-oci-int"><div class="titlepage"><div><div><h2 class="title">1.5. Replicating reports to a bucket</h2></div></div></div><p class="_abstract _abstract">
				Schedule a task to regularly move the cost information to the bucket you created by creating a function and then a virtual machine to trigger it. In the <span class="strong strong"><strong>Populate bucket</strong></span> step, visit the link to the script you can use to create a function that must be paired with a virtual machine or CronJob to run daily. The Oracle Cloud documentation provides the following example of how to schedule a recurring job to run the <a class="link mimir-link-warn" href="https://blogs.oracle.com/cloudnative/post/scheduling-oci-cli-commands-to-run-via-a-kubernetes-cronjob" title="Mimir does not include content from: blogs.oracle.com">cost transfer script</a>.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					As non-Red Hat products and documentation can change, instructions for configuring the third-party processes provided in this guide are general and correct at the time of publishing. Contact Oracle Cloud for support.
				</p></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						In the <a class="link mimir-link-warn" href="https://cloud.oracle.com/" title="Mimir does not include content from: cloud.oracle.com">Oracle Cloud console</a>, open the Navigation menu and click <span class="strong strong"><strong>Developer Services</strong></span> &gt; <span class="strong strong"><strong>Functions</strong></span>.
					</li><li class="listitem"><p class="simpara">
						Use the following Python script to create a function application:
					</p><pre class="programlisting language-python">#
# Copyright 2022 Red Hat Inc.
# SPDX-License-Identifier: Apache-2.0
#
##########################################################################################
# Script to collect cost/usage reports from OCI and replicate them to another bucket
#
# Pre-req's you must have a service account or other for this script to gain access to oci
#
# NOTE! You must update the vars below for this script to work correctly
#
# user: ocid of user that has correct permissions for bucket objects
# key_file: Location of auth file for defind user
# fingerprint: Users fingerprint
# tenancy: Tenancy for collecting/copying cost/usage reports
# region: Home Region of your tenancy
# bucket: Name of Bucket reports will be replicated to
# namespace: Object Storage Namespace
# filename: Name of json file to store last report downloaded default hre is fine
##########################################################################################
import datetime
import io
import json
import logging

import oci
from fdk import response


def connect_oci_storage_client(config):
    # Connect to OCI SDK
    try:
        object_storage = oci.object_storage.ObjectStorageClient(config)
        return object_storage
    except (Exception, ValueError) as ex:
        logging.getLogger().info("Error connecting to OCI SDK CLIENT please check credentials: " + str(ex))


def fetch_reports_file(object_storage, namespace, bucket, filename):
    # Fetch last download report file from bucket
    last_reports_file = None
    try:
        last_reports_file = object_storage.get_object(namespace, bucket, filename)
    except (Exception, ValueError) as ex:
        logging.getLogger().info("Object file does not exist, will attempt to create it: " + str(ex))

    if last_reports_file:
        json_acceptable_string = last_reports_file.data.text.replace("'", '"')
        try:
            last_reports = json.loads(json_acceptable_string)
        except (Exception, ValueError) as ex:
            logging.getLogger().info(
                "Json string file not formatted correctly and cannont be parsed, creating fresh file. " + str(ex)
            )
            last_reports = {"cost": "", "usage": ""}
    else:
        last_reports = {"cost": "", "usage": ""}

    return last_reports


def get_report_list(object_storage, reporting_namespace, reporting_bucket, prefix, last_file):
    # Create a list of reports
    report_list = object_storage.list_objects(
        reporting_namespace, reporting_bucket, prefix=prefix, start_after=last_file, fields="timeCreated"
    )
    logging.getLogger().info("Fetching list of cost csv files")
    return report_list


def copy_reports_to_bucket(
    object_storage,
    report_type,
    report_list,
    bucket,
    namespace,
    region,
    reporting_namespace,
    reporting_bucket,
    last_reports,
):
    # Iterate through cost reports list and copy them to new bucket
    # Start from current month
    start_from = datetime.date.today().replace(day=1)

    if report_list.data.objects != []:
        for report in report_list.data.objects:
            if report.time_created.date() &gt; start_from:
                try:
                    copy_object_details = oci.object_storage.models.CopyObjectDetails(
                        destination_bucket=bucket,
                        destination_namespace=namespace,
                        destination_object_name=report.name,
                        destination_region=region,
                        source_object_name=report.name,
                    )
                    object_storage.copy_object(
                        namespace_name=reporting_namespace,
                        bucket_name=reporting_bucket,
                        copy_object_details=copy_object_details,
                    )
                except (Exception, ValueError) as ex:
                    logging.getLogger().info(f"Failed to copy {report.name} to bucket: {bucket}. " + str(ex))
        last_reports[report_type] = report.name
    else:
        logging.getLogger().info(f"No new {report_type} reports to copy to bucket: {bucket}.")
    return last_reports


def handler(ctx, data: io.BytesIO = None):
    name = "OCI-cost-mgmt-report-replication-function"
    try:
        body = json.loads(data.getvalue())
        name = body.get("name")
    except (Exception, ValueError) as ex:
        logging.getLogger().info("Error parsing json payload: " + str(ex))

    logging.getLogger().info("Inside Python OCI reporting copy function")

    # PLEASE CHANGE THIS!!!! #
    user = "ocid1.user.oc1..aaaaaa"  # CHANGEME
    key_file = "auth_files/service-account.pem"  # CHANGEME
    fingerprint = "00.00.00"  # CHANGEME
    tenancy = "ocid1.tenancy.oc1..aaaaaaa"  # CHANGEME
    region = "region"  # CHANGEME
    bucket = "cost-mgmt-bucket"  # CHANGEME
    namespace = "namespace"  # CHANGEME
    filename = "last_reports.json"

    # Get the list of reports
    # https://docs.oracle.com/en-us/iaas/Content/API/SDKDocs/clienvironmentvariables.htm!!!
    config = {
        "user": user,
        "key_file": key_file,
        "fingerprint": fingerprint,
        "tenancy": tenancy,
        "region": region,
    }
    # The Object Storage namespace used for OCI reports is bling; the bucket name is the tenancy OCID.
    reporting_namespace = "bling"
    reporting_bucket = config["tenancy"]
    region = config["region"]

    # Connect to OCI
    object_storage = connect_oci_storage_client(config)

    # Grab reports json and set previously downloaded file values
    last_reports = fetch_reports_file(object_storage, namespace, bucket, filename)
    last_cost_file = last_reports.get("cost")
    last_usage_file = last_reports.get("usage")

    # Get list of cost/usage files
    cost_report_list = get_report_list(
        object_storage, reporting_namespace, reporting_bucket, "reports/cost-csv", last_cost_file
    )
    usage_report_list = get_report_list(
        object_storage, reporting_namespace, reporting_bucket, "reports/usage-csv", last_usage_file
    )

    # Copy cost/usage files to new bucket
    last_reports = copy_reports_to_bucket(
        object_storage,
        "cost",
        cost_report_list,
        bucket,
        namespace,
        region,
        reporting_namespace,
        reporting_bucket,
        last_reports,
    )
    last_reports = copy_reports_to_bucket(
        object_storage,
        "usage",
        usage_report_list,
        bucket,
        namespace,
        region,
        reporting_namespace,
        reporting_bucket,
        last_reports,
    )

    # Save updated filenames to bucket object as string
    object_storage.put_object(namespace, bucket, filename, str(last_reports))

    return response.Response(
        ctx,
        response_data=json.dumps(
            {
                "message": "Last reports saved from {}, Cost: {}, Usage: {}".format(
                    name, last_reports["cost"], last_reports["usage"]
                )
            }
        ),
        headers={"Content-Type": "application/json"},
    )</pre></li><li class="listitem"><p class="simpara">
						Change the values marked <code class="literal"># CHANGEME</code> to the values for your environment.
					</p><pre class="programlisting language-python">user = "ocid1.user.oc1..aaaaaa"  # CHANGEME
key_file = "auth_files/service-account.pem"  # CHANGEME
fingerprint = "00.00.00"  # CHANGEME
tenancy = "ocid1.tenancy.oc1..aaaaaaa"  # CHANGEME
region = "region"  # CHANGEME
bucket = "cost-mgmt-bucket"  # CHANGEME
namespace = "namespace"  # CHANGEME
filename = "last_reports.json"</pre></li><li class="listitem">
						Create a virtual machine or a <a class="link mimir-link-warn" href="https://blogs.oracle.com/cloudnative/post/scheduling-oci-cli-commands-to-run-via-a-kubernetes-cronjob" title="Mimir does not include content from: blogs.oracle.com">Kubernetes CronJob</a> to trigger your function daily.
					</li></ol></div></section><section class="section" id="creating-bucket-policy-oci_adding-oci-int"><div class="titlepage"><div><div><h2 class="title">1.6. Creating a bucket policy to grant read access and final steps</h2></div></div></div><p class="_abstract _abstract">
				Continue in the <span class="strong strong"><strong>Add a cloud integration</strong></span> wizard by running a command that gives cost management read access to the bucket populated with your Oracle Cloud cost and usage reports.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						In the <span class="strong strong"><strong>Populate bucket</strong></span> step, copy the <code class="literal">oci iam policy create</code> command and paste into the Cloud Shell in your Oracle Cloud tab to create a read policy.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Next</strong></span>.
					</li><li class="listitem">
						Review the details of the information you provided. Click <span class="strong strong"><strong>Add</strong></span>.
					</li></ol></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					Oracle Cloud might take several hours to gather and export billing data to cost management. In the meantime, you will receive a <code class="literal">In progress</code> message, and your integration status will display as <code class="literal">Unknown</code> in the <span class="strong strong"><strong>Integrations</strong></span> page.
				</p></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Because third-party products and documentation can change, instructions for configuring the third-party integrations provided are general and correct at the time of publishing. For the most up-to-date information, see the <a class="link mimir-link-warn" href="https://docs.oracle.com/" title="Mimir does not include content from: docs.oracle.com">Oracle Cloud documentation</a>.
				</p></div></div></section></section><section class="chapter" id="assembly-cost-management-next-steps-oci"><div class="titlepage"><div><div><h1 class="title">Chapter 2. Next steps for managing your costs</h1></div></div></div><p class="_abstract _abstract">
			After adding your OpenShift Container Platform and Oracle Cloud integrations, in addition to showing cost data by integration, cost management will automatically show Oracle Cloud cost and usage related to running your OpenShift Container Platform clusters on their platform.
		</p><p>
			On the <a class="link mimir-link-warn" href="https://console.redhat.com/openshift/cost-management/" title="Mimir does not include content from: console.redhat.com">cost management</a> <span class="strong strong"><strong>Overview</strong></span> page, your cost data is sorted into <span class="strong strong"><strong>OpenShift</strong></span> and <span class="strong strong"><strong>Infrastructure</strong></span> tabs. Select <span class="strong strong"><strong>Perspective</strong></span> to toggle through different views of your cost data.
		</p><p>
			You can also use the global navigation menu to view additional details about your costs by cloud provider.
		</p><div class="itemizedlist"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
					<span class="emphasis"><em><a class="link" href="/documentation/en-us/cost_management_service/1-latest/html-single/integrating_openshift_container_platform_data_into_cost_management/index/">Integrating OpenShift Container Platform data into cost management</a></em></span>
				</li><li class="listitem">
					<span class="emphasis"><em><a class="link" href="/documentation/en-us/cost_management_service/1-latest/html-single/integrating_amazon_web_services_aws_data_into_cost_management/index/">Integrating Amazon Web Services (AWS) data into cost management</a></em></span>
				</li><li class="listitem">
					<span class="emphasis"><em><a class="link" href="/documentation/en-us/cost_management_service/1-latest/html-single/integrating_google_cloud_data_into_cost_management/index/">Integrating Google Cloud data into cost management</a></em></span>
				</li><li class="listitem">
					<span class="emphasis"><em><a class="link" href="/documentation/en-us/cost_management_service/1-latest/html-single/integrating_microsoft_azure_data_into_cost_management/index/">Integrating Microsoft Azure data into cost management</a></em></span>
				</li></ul></div><section class="section" id="limiting-access_next-steps-oci"><div class="titlepage"><div><div><h2 class="title">2.1. Limiting access to cost management resources</h2></div></div></div><p class="_abstract _abstract">
				After you add and configure integrations in cost management, you can limit access to cost data and resources.
			</p><p>
				You might not want users to have access to all of your cost data. Instead, you can grant users access only to data that is specific to their projects or organizations. With role-based access control, you can limit the visibility of resources in cost management reports. For example, you can restrict a user’s view to only AWS integrations, rather than the entire environment.
			</p><p>
				To learn how to limit access, see the more in-depth guide <span class="emphasis"><em><a class="link" href="/documentation/en-us/cost_management_service/1-latest/html-single/limiting_access_to_cost_management_resources/index/">Limiting access to cost management resources</a></em></span>.
			</p></section><section class="section" id="configure-tagging-next-step_next-steps-oci"><div class="titlepage"><div><div><h2 class="title">2.2. Configuring tagging for your integrations</h2></div></div></div><p class="_abstract _abstract">
				The cost management application tracks cloud and infrastructure costs with tags. Tags are also known as labels in OpenShift.
			</p><p>
				You can refine tags in cost management to filter and attribute resources, organize your resources by cost, and allocate costs to different parts of your cloud infrastructure.
			</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					You can only configure tags and labels directly on an integration. You can choose the tags that you activate in cost management, however, you cannot edit tags and labels in the cost management application.
				</p></div></div><p>
				To learn more about the following topics, see <span class="emphasis"><em><a class="link" href="/documentation/en-us/cost_management_service/1-latest/html-single/managing_cost_data_using_tagging/index/">Managing cost data using tagging</a></em></span>:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Planning your tagging strategy to organize your view of cost data
					</li><li class="listitem">
						Understanding how cost management associates tags
					</li><li class="listitem">
						Configuring tags and labels on your integrations
					</li></ul></div></section><section class="section" id="configure-cost-models-next-step_next-steps-oci"><div class="titlepage"><div><div><h2 class="title">2.3. Configuring cost models to accurately report costs</h2></div></div></div><p class="_abstract _abstract">
				Now that you configured your integrations to collect cost and usage data in cost management, you can configure cost models to associate prices to metrics and usage.
			</p><p>
				A cost model is a framework that uses raw costs and metrics to define calculations for the costs in cost management. You can record, categorize, and distribute the costs that the cost model generates to specific customers, business units, or projects.
			</p><p>
				In <a class="link mimir-link-warn" href="https://console.redhat.com/openshift/cost-management/cost-models" title="Mimir does not include content from: console.redhat.com">Cost Models</a>, you can complete the following tasks:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Classifying your costs as infrastructure or supplementary costs
					</li><li class="listitem">
						Capturing monthly costs for OpenShift nodes and clusters
					</li><li class="listitem">
						Applying a markup to account for additional support costs
					</li></ul></div><p>
				To learn how to configure a cost model, see <span class="emphasis"><em><a class="link" href="/documentation/en-us/cost_management_service/1-latest/html-single/using_cost_models/index/">Using cost models</a></em></span>.
			</p></section><section class="section" id="cost-explorer-next-step_next-steps-oci"><div class="titlepage"><div><div><h2 class="title">2.4. Visualizing your costs with Cost Explorer</h2></div></div></div><p class="_abstract _abstract">
				Use cost management <a class="link mimir-link-warn" href="https://console.redhat.com/openshift/cost-management/explorer" title="Mimir does not include content from: console.redhat.com">Cost Explorer</a> to create custom graphs of time-scaled cost and usage information and ultimately better visualize and interpret your costs.
			</p><p>
				To learn more about the following topics, see <span class="emphasis"><em><a class="link mimir-link-warn" href="https://access.redhat.com/documentation/en-us/cost_management_service/1-latest/html-single/visualizing_your_costs_using_cost_explorer/index" title="This content is not included in Mimir.">Visualizing your costs using Cost Explorer</a></em></span>:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Using Cost Explorer to identify abnormal events
					</li><li class="listitem">
						Understanding how your cost data changes over time
					</li><li class="listitem">
						Creating custom bar charts of your cost and usage data
					</li><li class="listitem">
						Exporting custom cost data tables
					</li></ul></div></section></section><section class="preface" id="proc-providing-feedback-on-redhat-documentation"><div class="titlepage"><div><div><h1 class="title">Providing feedback on Red Hat documentation</h1></div></div></div><p>
			We appreciate and prioritize your feedback regarding our documentation. Provide as much detail as possible, so that your request can be quickly addressed.
		</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
					You are logged in to the Red Hat Customer Portal.
				</li></ul></div><div class="formalpara"><p class="title"><strong>Procedure</strong></p><p>
				To provide feedback, perform the following steps:
			</p></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
					Click the following link: <a class="link mimir-link-warn" href="https://issues.redhat.com/secure/CreateIssueDetails!init.jspa?pid=12333524&amp;issuetype=1&amp;priority=10300&amp;description=URL%20where%20issue%20was%20found%3A%C2%A0%0A%0ADescription%20of%20issue%3A%C2%A0&amp;components=12368954" title="Mimir does not include content from: issues.redhat.com">Create Issue</a>.
				</li><li class="listitem">
					Describe the issue or enhancement in the <span class="strong strong"><strong>Summary</strong></span> text box.
				</li><li class="listitem">
					Provide details about the issue or requested enhancement in the <span class="strong strong"><strong>Description</strong></span> text box.
				</li><li class="listitem">
					Type your name in the <span class="strong strong"><strong>Reporter</strong></span> text box.
				</li><li class="listitem">
					Click the <span class="strong strong"><strong>Create</strong></span> button.
				</li></ol></div><p>
			This action creates a documentation ticket and routes it to the appropriate documentation team. Thank you for taking the time to provide feedback.
		</p></section><div><div xml:lang="en-US" class="legalnotice" id="idm140561181187696"><h1 class="legalnotice">Legal Notice</h1><div class="para">
		Copyright <span class="trademark"><!--Empty--></span>© 2024 Red Hat, Inc.
	</div><div class="para">
		The text of and illustrations in this document are licensed by Red Hat under a Creative Commons Attribution–Share Alike 3.0 Unported license ("CC-BY-SA"). An explanation of CC-BY-SA is available at <a class="uri mimir-link-warn" href="http://creativecommons.org/licenses/by-sa/3.0/" title="Mimir does not include content from: creativecommons.org">http://creativecommons.org/licenses/by-sa/3.0/</a>. In accordance with CC-BY-SA, if you distribute this document or an adaptation of it, you must provide the URL for the original version.
	</div><div class="para">
		Red Hat, as the licensor of this document, waives the right to enforce, and agrees not to assert, Section 4d of CC-BY-SA to the fullest extent permitted by applicable law.
	</div><div class="para">
		Red Hat, Red Hat Enterprise Linux, the Shadowman logo, the Red Hat logo, JBoss, OpenShift, Fedora, the Infinity logo, and RHCE are trademarks of Red Hat, Inc., registered in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Linux</span>® is the registered trademark of Linus Torvalds in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Java</span>® is a registered trademark of Oracle and/or its affiliates.
	</div><div class="para">
		<span class="trademark">XFS</span>® is a trademark of Silicon Graphics International Corp. or its subsidiaries in the United States and/or other countries.
	</div><div class="para">
		<span class="trademark">MySQL</span>® is a registered trademark of MySQL AB in the United States, the European Union and other countries.
	</div><div class="para">
		<span class="trademark">Node.js</span>® is an official trademark of Joyent. Red Hat is not formally related to or endorsed by the official Joyent Node.js open source or commercial project.
	</div><div class="para">
		The <span class="trademark">OpenStack</span>® Word Mark and OpenStack logo are either registered trademarks/service marks or trademarks/service marks of the OpenStack Foundation, in the United States and other countries and are used with the OpenStack Foundation's permission. We are not affiliated with, endorsed or sponsored by the OpenStack Foundation, or the OpenStack community.
	</div><div class="para">
		All other trademarks are the property of their respective owners.
	</div></div></div></div></body>

        
        
    </div>
    

</div> 


                            </bdo>
                        </main>
                    </div>
                </main>
            </div>
        
            <!--#include virtual="/includes/footer/index.html" -->
        </div>
    </body>
</html>
