<!DOCTYPE html>
<html>
    <head>
        
        <link rel="stylesheet" type="text/css" media="screen" href="/mimir/styles/mimir.min.css">
        




    <link rel="stylesheet" type="text/css" media="screen" href="/sites/dxp-docs/files/css/css_87GMcmxT1ib8ziQiU2KUAnTDFtZQV6iP-KGslA9LigM.css" />

    <link rel="stylesheet" type="text/css" media="screen" href="/sites/dxp-docs/files/css/css_Bwzy34i9pSdDlzGALvqVwG4fpgGp08KLMAkClGNY9M4.css" />



<link rel="stylesheet" type="text/css" media="screen" href="/mimir/styles/mimir-doc-toc.min.css" />



        
        <!--#include virtual="/includes/head/index.html" -->

        
        <title>
Managing Transactions on JBoss EAP - JBoss Enterprise Application Platform Continuous Delivery 18
</title>
        
<meta name="product" content="JBoss Enterprise Application Platform Continuous Delivery" />
<meta name="documentation_version" content="18" />
<meta name="documentKind" content="documentation" />
<meta name="portal_content_subtype" content="title" />
<meta name="lastModifiedDate" content="2019-12-06T22:33:44.000Z" />


        
            
        
        
            
                
                
                <!-- mimir_solr_yesindex -->
                <meta name="mimir_solr_yesindex" content="true" />
            
        
    </head>

    <body class="mimir-body">

        
        

        
        <div id="page-wrap" class="page-wrap">
            <div id="pers-top-page-wrap" class="top-page-wrap pers-loader-bg">
                <div id="hero-bg-top-left" class="summit-bg-shapes"></div>
                <div id="hero-bg-top-right" class="summit-bg-shapes"></div>

                <header class="masthead" id="masthead">

                    
                    <!--#include virtual="/includes/header/index.html" -->

                    
                    
                    
                        
                    
                    
                        <div class="breadcrumbs">
                            <div id="breadcrumbs" class="container">
                                
                                <a href="/">Home</a>
                                
                                <a href="/products/">Product Documentation</a>
                                
                                <a href="/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/20/">JBoss Enterprise Application Platform Continuous Delivery</a>
                                
                                <a href="/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/">18</a>
                                
                                
                                Managing Transactions on JBoss EAP
                                
                            </div>
                        </div>
                    
                </header>

                <main id="cp-main" class="portal-content-area">
                    <div id="cp-content" class="main-content">
                        
                        <main class="container mimir-docs">
                            
                            <bdo>
                                

<script type="module" src="/mimir/scripts/mimir-doc-toc.min.js"></script>






<div class="docs-grid">

    <nav id="mimir-doc-toc" class="mimir-doc-toc">
      <div class="mimir-doc-toc-inner">
          <!-- single-page -->
        
            
              <ol>
                <li>
                        
                        <a href="#">Managing Transactions on JBoss EAP</a>
                    </li><li>
                        <a href="#idm140223473628128">
                            Preface
                        </a>
                    </li><li>
                        <a href="#eap_transactions">
                            1. Transactions in JBoss EAP
                        </a><ol>
                <li>
                        <a href="#transaction_subsystem">
                            1.1. Transaction Subsystem
                        </a>
                    </li><li>
                        <a href="#properties_of_the_transaction">
                            1.2. Properties of the Transaction
                        </a>
                    </li><li>
                        <a href="#components_of_a_transaction">
                            1.3. Components of a Transaction
                        </a>
                    </li><li>
                        <a href="#principles_of_transaction_management">
                            1.4. Principles of Transaction Management
                        </a><ol>
                <li>
                        <a href="#xa_versus_non_xa_transactions">
                            1.4.1. XA Versus Non-XA Transactions
                        </a>
                    </li>
            </ol>
                    </li>
            </ol>
                    </li><li>
                        <a href="#configuring_transactions">
                            2. Configuring Transactions
                        </a><ol>
                <li>
                        <a href="#transactions_unique_node_identifier">
                            2.1. Unique Node Identifier
                        </a><ol>
                <li>
                        <a href="#importance_of_the_unique_node_identifier">
                            2.1.1. Importance of the Unique Node Identifier
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#configuring_the_transaction_manager">
                            2.2. Configuring the Transaction Manager
                        </a>
                    </li><li>
                        <a href="#configuring_transaction_manager_using_system_properties">
                            2.3. Configuring the Transaction Manager Using System Properties
                        </a>
                    </li><li>
                        <a href="#configuring_your_datasource_to_use_jta">
                            2.4. Configuring Your Datasource to Use JTA
                        </a>
                    </li><li>
                        <a href="#configure_the_orb_for_jts_transactions">
                            2.5. Configuring the ORB for JTS Transactions
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#managing_transactions">
                            3. Managing Transactions
                        </a><ol>
                <li>
                        <a href="#browse_and_manage_transactions">
                            3.1. Browsing Transactions
                        </a>
                    </li><li>
                        <a href="#manage_a_transaction">
                            3.2. Administering a Transaction
                        </a>
                    </li><li>
                        <a href="#view_transaction_statistics">
                            3.3. Viewing Transaction Statistics
                        </a>
                    </li><li>
                        <a href="#transactions_object_store">
                            3.4. Configuring the Transactions Object Store
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#monitoring_transactions">
                            4. Monitoring Transactions
                        </a><ol>
                <li>
                        <a href="#configuring_logging_for_the_transaction_subsystem">
                            4.1. Configuring Logging for the Transactions Subsystem
                        </a><ol>
                <li>
                        <a href="#enabling_trace_log_leve">
                            4.1.1. Enabling the TRACE Log Level
                        </a>
                    </li><li>
                        <a href="#enabling_transaction_bridge_logger">
                            4.1.2. Enabling the Transaction Bridge Logger
                        </a>
                    </li><li>
                        <a href="#about_transaction_log_messages">
                            4.1.3. Transaction Log Messages
                        </a>
                    </li><li>
                        <a href="#decoding_transaction_log_files">
                            4.1.4. Decoding Transaction Log Files
                        </a><ol>
                <li>
                        <a href="#locating_xid_uid_of_transaction">
                            4.1.4.1. Locating the XID/UID of a Transaction
                        </a>
                    </li><li>
                        <a href="#finding_the_transaction_status_and_resources">
                            4.1.4.2. Finding the Transaction Status and Resources
                        </a>
                    </li><li>
                        <a href="#viewing_the_transaction_history">
                            4.1.4.3. Viewing the Transaction History
                        </a>
                    </li>
            </ol>
                    </li>
            </ol>
                    </li>
            </ol>
                    </li><li>
                        <a href="#handling_transaction_manager_exceptions">
                            5. Handling Transaction Manager Exceptions
                        </a><ol>
                <li>
                        <a href="#debugging_timed_out_transaction">
                            5.1. Debugging a Timed-out Transaction
                        </a>
                    </li><li>
                        <a href="#migrating_logs_to_new_server">
                            5.2. Migrating Logs to a New JBoss EAP Server
                        </a><ol>
                <li>
                        <a href="#migrating_the_file_based_log_storage">
                            5.2.1. Migrating the File-based Log Storage
                        </a>
                    </li><li>
                        <a href="#migrating_the_jdbc_store_based_log_storage">
                            5.2.2. Migrating the JDBC Store-based Log Storage
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#enabling_xts_on_eap">
                            5.3. Enabling XTS on JBoss EAP
                        </a>
                    </li><li>
                        <a href="#clearing_expired_transactions">
                            5.4. Clearing Up Expired Transactions
                        </a>
                    </li><li>
                        <a href="#recovering_heuristic_outcomes">
                            5.5. Recovering Heuristic Outcomes
                        </a><ol>
                <li>
                        <a href="#guidelines_on_decision_making">
                            5.5.1. Guidelines on Making Decisions for Heuristic Outcomes
                        </a>
                    </li>
            </ol>
                    </li>
            </ol>
                    </li><li>
                        <a href="#idm140223478856784">
                            Legal Notice
                        </a>
                    </li>
            </ol>
            
        
      </div>
    </nav>

    
    <div class="pvof-doc__wrapper" id="doc-wrapper">
        <section class="mimir-doc-title" id="mimir-doc--managing_transactions_on_jboss_eap">
            <h1 class="title">Managing Transactions on JBoss EAP</h1>
        </section>
        <body><div xml:lang="en-US" class="book" id="idm140223478050368"><div class="titlepage"><div><div class="producttitle"><span class="productname">JBoss Enterprise Application Platform Continuous Delivery</span> <span class="productnumber">18</span></div><div><h2 class="subtitle">For Use with JBoss Enterprise Application Platform Continuous Delivery 18</h2></div><div><div xml:lang="en-US" class="authorgroup"><span class="orgname">Red Hat Customer Content Services</span></div></div><div><a href="#idm140223478856784">Legal Notice</a></div><div><div class="abstract"><p class="title"><strong>Abstract</strong></p><div class="para">
				This document provides information for administrators to troubleshoot transactions on JBoss EAP.
			</div></div></div></div><hr/></div><section class="preface" id="idm140223473628128"><div class="titlepage"><div><div><h1 class="title">Preface</h1></div></div></div><p id="preface_cd">
			This document is intended for use with the JBoss Enterprise Application Platform continuous delivery release 18, which is a Technology Preview release available in the cloud only.
		</p><p>
			Some features described in this document might not work or might not be available on Red Hat OpenShift Online and Red Hat OpenShift Container Platform. For specific details about the feature differences in the JBoss EAP CD release, see the <a class="link" href="/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/jboss_eap_continuous_delivery_18_release_notes/index/#cd_release_limitations">Release Limitations</a> section in the <span class="emphasis"><em>JBoss EAP Continuous Delivery 18 Release Notes</em></span>.
		</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
				This continuous delivery release for JBoss EAP is provided as Technology Preview only. Technology Preview features are not supported with Red Hat production service level agreements (SLAs), might not be functionally complete, and Red Hat does not recommend to use them for production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.
			</p><p>
				See <a class="link mimir-link-warn" href="https://access.redhat.com/support/offerings/techpreview" title="This content is not included in Mimir.">Technology Preview Features Support Scope</a> on the Red Hat Customer Portal for information about the support scope for Technology Preview features.
			</p></div></div></section><section class="chapter" id="eap_transactions"><div class="titlepage"><div><div><h1 class="title">Chapter 1. Transactions in JBoss EAP</h1></div></div></div><p>
			A transaction consists of two or more operations that must either all succeed or all fail. A successful outcome results in a commit, and a failed outcome results in a rollback. In a rollback, each member’s state is reverted before the transaction attempts the commit.
		</p><section class="section" id="transaction_subsystem"><div class="titlepage"><div><div><h2 class="title">1.1. Transaction Subsystem</h2></div></div></div><p>
				The <code class="literal">transactions</code> subsystem allows you to configure the Transaction Manager (TM) options, such as timeout values, transaction logging, statistics collection, and whether to use Java Transaction Service (JTS). The <code class="literal">transactions</code> subsystem consists of four main elements:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Core environment</span></dt><dd>
							The core environment includes the TM interface that allows the JBoss EAP server to control transaction boundaries on behalf of the resource being managed. A transaction coordinator manages communication with the transactional objects and resources that participate in transactions.
						</dd><dt><span class="term">Recovery environment</span></dt><dd>
							The recovery environment of the JBoss EAP transaction service ensures that the system applies the results of a transaction consistently to all the resources affected by the transaction. This operation continues even if any application process or the machine hosting them crashes or loses network connectivity.
						</dd><dt><span class="term">Coordinator environment</span></dt><dd>
							The coordinator environment defines custom properties for the transaction, such as default timeout and logging statistics.
						</dd><dt><span class="term">Object store</span></dt><dd>
							JBoss EAP transaction service uses an object store to record the outcomes of transactions in a persistent manner for failure recovery. The Recovery Manager scans the object store and other locations of information, for transactions and resources that might need recovery.
						</dd></dl></div></section><section class="section" id="properties_of_the_transaction"><div class="titlepage"><div><div><h2 class="title">1.2. Properties of the Transaction</h2></div></div></div><p>
				The typical standard for a well-designed transaction is that it is atomic, consistent, isolated, and durable (ACID):
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Atomic</span></dt><dd>
							All members of the transaction must make the same decision regarding committing or rolling back the transaction.
						</dd><dt><span class="term">Consistent</span></dt><dd>
							Transactions produce consistent results and preserve application specific invariants.
						</dd><dt><span class="term">Isolation</span></dt><dd>
							The data being operated on must be locked before modification to prevent processes outside the scope of the transaction from modifying the data.
						</dd><dt><span class="term">Durable</span></dt><dd>
							The effects of a committed transaction are not lost, except in the event of a catastrophic failure.
						</dd></dl></div></section><section class="section" id="components_of_a_transaction"><div class="titlepage"><div><div><h2 class="title">1.3. Components of a Transaction</h2></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Transaction Coordinator</span></dt><dd>
							The coordinator governs the outcome of a transaction. It is responsible for ensuring that the web services invoked by the client arrive at a consistent outcome.
						</dd><dt><span class="term">Transaction Context</span></dt><dd>
							Transaction context is the information about a transaction that is propagated, which allows the transaction to span multiple services.
						</dd><dt><span class="term">Transaction Participant</span></dt><dd>
							Participants are the services enrolled in a transaction using a participant model.
						</dd><dt><span class="term">Transaction Service</span></dt><dd>
							Transaction service captures the model of the underlying transaction protocol and coordinates with the participants affiliated with a transaction according to that model.
						</dd><dt><span class="term">Transaction API</span></dt><dd>
							Transaction API provides an interface for transaction demarcation and the registration of participants.
						</dd></dl></div></section><section class="section" id="principles_of_transaction_management"><div class="titlepage"><div><div><h2 class="title">1.4. Principles of Transaction Management</h2></div></div></div><section class="section" id="xa_versus_non_xa_transactions"><div class="titlepage"><div><div><h3 class="title">1.4.1. XA Versus Non-XA Transactions</h3></div></div></div><p>
					Non-XA transactions involve only one resource. They do not have a transaction coordinator and a single resource does all the transaction work. They are sometimes called local transactions.
				</p><p>
					XA transactions involve multiple resources. They also have a coordinating transaction manager with one or more databases, or other resources like JMS, all participating in a single transaction. They are referred to as global transactions.
				</p></section></section></section><section class="chapter" id="configuring_transactions"><div class="titlepage"><div><div><h1 class="title">Chapter 2. Configuring Transactions</h1></div></div></div><section class="section" id="transactions_unique_node_identifier"><div class="titlepage"><div><div><h2 class="title">2.1. Unique Node Identifier</h2></div></div></div><p>
				Unique node identifier allows JBoss EAP to recover transactions and transaction states that match only the specified node identifier. You can set the node identifier using the <code class="literal">com.arjuna.ats.arjuna.nodeIdentifier</code> property.
			</p><section class="section" id="importance_of_the_unique_node_identifier"><div class="titlepage"><div><div><h3 class="title">2.1.1. Importance of the Unique Node Identifier</h3></div></div></div><p>
					When running XA recovery, you must configure the <code class="literal">Xid</code> types that JBoss EAP transactions can recover. Each <code class="literal">Xid</code> has the unique node identifier encoded in it and JBoss EAP only recovers the transactions and transaction states that match the specified node identifier.
				</p><p>
					You can configure the node identifier using the <code class="literal">JTAEnvironmentBean.xaRecoveryNodes</code> property, which can include multiple values in a list.
				</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
						A value of asterisk <code class="literal">"*"</code> forces JBoss EAP to recover, and possibly rollback, all the transactions irrespective of their node identifiers. It must be used with caution.
					</p></div></div><p>
					The value of <code class="literal">com.arjuna.ats.jta.xaRecoveryNode</code> property must be alphanumeric and must match the value of the <code class="literal">com.arjuna.ats.arjuna.nodeIdentifier</code> property.
				</p></section></section><section class="section" id="configuring_the_transaction_manager"><div class="titlepage"><div><div><h2 class="title">2.2. Configuring the Transaction Manager</h2></div></div></div><p>
				You can configure the transaction manager using the web-based management console or the command line management CLI.
			</p><h4 id="configuring_the_transaction_manager_using_the_management_console">Configuring the Transaction Manager Using the Management Console</h4><p>
				The following steps explain how to configure the transaction manager using the web-based management console:
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Select the <span class="strong strong"><strong>Configuration</strong></span> tab from the top of the screen.
					</li><li class="listitem">
						If you are running JBoss EAP as a managed domain, choose the desired profile to modify.
					</li><li class="listitem">
						From the <span class="strong strong"><strong>Subsystem</strong></span> list, select <span class="strong strong"><strong>Transaction</strong></span> and click <span class="strong strong"><strong>View</strong></span>.
					</li><li class="listitem">
						Select the appropriate tab for the settings that you want to configure, such as <span class="strong strong"><strong>Recovery</strong></span> for recovery options.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Edit</strong></span>, make the necessary changes, and click <span class="strong strong"><strong>Save</strong></span> to save the changes.
					</li></ol></div><h4 id="configuring_the_transaction_manager_using_the_management_cli">Configuring the Transaction Manager Using the Management CLI</h4><p>
				Using the management CLI, you can configure the transaction manager using a series of commands. The commands all begin with <code class="literal">/subsystem=transactions</code> for a standalone server or <code class="literal">/profile=default/subsystem=transactions/</code> for the <code class="literal">default</code> profile in a managed domain.
			</p><p>
				For a detailed listing of all the transaction manager configuration options, see the <a class="link" href="/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/configuration_guide/index/">Transaction Manager Configuration Options</a> for JBoss EAP.
			</p></section><section class="section" id="configuring_transaction_manager_using_system_properties"><div class="titlepage"><div><div><h2 class="title">2.3. Configuring the Transaction Manager Using System Properties</h2></div></div></div><p>
				You can use either the management console, management CLI, or the system properties to configure many of the Transaction Manager options. However, the following options are configurable only using system properties. They are not configurable using the management CLI or management console.
			</p><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"><!--Empty--></col><col style="width: 50%; " class="col_2"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm140223474318448" scope="col">Property Name</th><th align="left" valign="top" id="idm140223474317360" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140223474318448"> <p>
								RecoveryEnvironmentBean.periodicRecoveryPeriod
							</p>
							 </td><td align="left" valign="top" headers="idm140223474317360"> <p>
								Interval between recovery attempts, in seconds.
							</p>
							 <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										Must be a positive Integer.
									</li><li class="listitem">
										Default is 120 seconds (2 minutes).
									</li></ul></div>
							 </td></tr><tr><td align="left" valign="top" headers="idm140223474318448"> <p>
								RecoveryEnvironmentBean.recoveryBackoffPeriod
							</p>
							 </td><td align="left" valign="top" headers="idm140223474317360"> <p>
								Interval between the first and second recovery passes, in seconds.
							</p>
							 <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										Must be a positive Integer.
									</li><li class="listitem">
										Default is 10 seconds.
									</li></ul></div>
							 </td></tr><tr><td align="left" valign="top" headers="idm140223474318448"> <p>
								RecoveryEnvironmentBean.periodicRecoveryInitializationOffset
							</p>
							 </td><td align="left" valign="top" headers="idm140223474317360"> <p>
								Interval before first recovery pass, in seconds.
							</p>
							 <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										Must be 0 or a positive Integer.
									</li><li class="listitem">
										Default is 0 seconds.
									</li></ul></div>
							 </td></tr><tr><td align="left" valign="top" headers="idm140223474318448"> <p>
								RecoveryEnvironmentBean.expiryScanInterval
							</p>
							 </td><td align="left" valign="top" headers="idm140223474317360"> <p>
								Interval between expiry scans, in hours.
							</p>
							 <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										Can be any Integer.
									</li><li class="listitem">
										0 disables scanning.
									</li><li class="listitem">
										Negative values postpone the first run.
									</li><li class="listitem">
										Default is 12 hours.
									</li></ul></div>
							 </td></tr></tbody></table></div><p>
				This example shows how to configure these system properties in the <code class="literal">standalone.xml</code> server configuration file.
			</p><pre class="programlisting language-xml">&lt;system-properties&gt;
    &lt;property name="RecoveryEnvironmentBean.periodicRecoveryPeriod" value="180"/&gt;
    &lt;property name="RecoveryEnvironmentBean.recoveryBackoffPeriod" value="20"/&gt;
    &lt;property name="RecoveryEnvironmentBean.periodicRecoveryInitializationOffset" value="5"/&gt;
    &lt;property name="RecoveryEnvironmentBean.expiryScanInterval" value="24"/&gt;
&lt;/system-properties&gt;</pre><p>
				For more information on how to configure system properties, see <a class="link" href="/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/configuration_guide/index/">System Properties</a> in the <span class="emphasis"><em>Configuration Guide</em></span>.
			</p></section><section class="section" id="configuring_your_datasource_to_use_jta"><div class="titlepage"><div><div><h2 class="title">2.4. Configuring Your Datasource to Use JTA</h2></div></div></div><p>
				This task shows you how to enable Java Transaction API (JTA) on your datasource.
			</p><h4 id="prerequisites">Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Your database must support JTA. For more information, see the documentation from your database vendor.
					</li></ul></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Create a <a class="link" href="/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/configuration_guide/index/">non-XA datasource</a>. For instructions, see the <span class="emphasis"><em>Configuration Guide</em></span>.
					</li></ul></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					XA datasources, described in the <a class="link" href="/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/configuration_guide/index/"><span class="emphasis"><em>Configuration Guide</em></span></a>, are JTA capable by default.
				</p></div></div><h4 id="configuring_the_datasource_to_use_jta">Configuring the Datasource to use JTA</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Use the following management CLI command to set the <code class="literal">jta</code> attribute to <code class="literal">true</code>.
					</p><pre class="screen">/subsystem=datasources/data-source=<span class="emphasis"><em>DATASOURCE_NAME</em></span>:write-attribute(name=jta,value=true)</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							In a managed domain, precede this command with <code class="literal">/profile=<span class="emphasis"><em>PROFILE_NAME</em></span></code>.
						</p></div></div></li><li class="listitem"><p class="simpara">
						Reload the server for the changes to take effect.
					</p><pre class="screen">reload</pre></li></ol></div><p>
				Your datasource is now configured to use JTA.
			</p></section><section class="section" id="configure_the_orb_for_jts_transactions"><div class="titlepage"><div><div><h2 class="title">2.5. Configuring the ORB for JTS Transactions</h2></div></div></div><p>
				In a default installation of JBoss EAP, the Object Request Broker (ORB) support for transactions is disabled. You can configure ORB settings in the <code class="literal">iiop-openjdk</code> subsystem using the management CLI or the management console.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					The <code class="literal">iiop-openjdk</code> subsystem is available when using the <span class="emphasis"><em>full</em></span> or <span class="emphasis"><em>full-ha</em></span> profile in a managed domain, or the <code class="literal">standalone-full.xml</code> or <code class="literal">standalone-full-ha.xml</code> configuration file for a standalone server.
				</p></div></div><p>
				For a listing of the available configuration options for the <code class="literal">iiop-openjdk</code> subsystem, see <a class="link" href="/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/configuration_guide/index/">IIOP Subsystem Attributes</a> in the <span class="emphasis"><em>Configuration Guide</em></span>.
			</p><h4 id="configure_the_orb_using_the_management_cli">Configure the ORB Using the Management CLI</h4><p>
				You can configure each aspect of the ORB using the management CLI. This is the minimum configuration for the ORB to be used with JTS.
			</p><p>
				You can configure the following management CLI commands for a managed domain using the <code class="literal">full</code> profile. If necessary, change the profile to suit the one you need to configure. If you are using a standalone server, omit the <code class="literal">/profile=full</code> portion of the commands.
			</p><h5 id="enable_the_security_interceptors">Enable the Security Interceptors</h5><p>
				Enable the <code class="literal">security</code> attribute by setting the value to <code class="literal">identity</code>.
			</p><pre class="screen">/profile=full/subsystem=iiop-openjdk:write-attribute(name=security,value=identity)</pre><h5 id="enable_transactions_in_the_iiop_subsystem">Enable Transactions in the IIOP Subsystem</h5><p>
				To enable the ORB for JTS, set the value of <code class="literal">transactions</code> attribute to <code class="literal">full</code>, rather than the default <code class="literal">spec</code>.
			</p><pre class="screen">/profile=full/subsystem=iiop-openjdk:write-attribute(name=transactions, value=full)</pre><h5 id="enable_jts_in_the_transactions_subsystem">Enable JTS in the Transactions Subsystem</h5><pre class="screen">/profile=full/subsystem=transactions:write-attribute(name=jts,value=true)</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					For JTS activation, the server must be restarted as reload is not enough.
				</p></div></div><h4 id="configure_the_orb_using_the_management_console">Configure the ORB Using the Management Console</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Select the <span class="strong strong"><strong>Configuration</strong></span> tab from the top of the management console. In a managed domain, you must select the appropriate profile to modify.
					</li><li class="listitem">
						Select <span class="strong strong"><strong>Subsystems</strong></span> → <span class="strong strong"><strong>IIOP (OpenJDK)</strong></span> and click <span class="strong strong"><strong>View</strong></span>.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Edit</strong></span> and modify the attributes as needed.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Save</strong></span> to save the changes.
					</li></ol></div></section></section><section class="chapter" id="managing_transactions"><div class="titlepage"><div><div><h1 class="title">Chapter 3. Managing Transactions</h1></div></div></div><section class="section" id="browse_and_manage_transactions"><div class="titlepage"><div><div><h2 class="title">3.1. Browsing Transactions</h2></div></div></div><p>
				The management CLI supports the ability to browse and manipulate transaction records. This functionality is provided by the interaction between the TM and the management API of JBoss EAP.
			</p><p>
				The Transaction Manager stores information about each pending transaction and the participants involved the transaction, in a persistent storage called the object store. The management API exposes the object store as a resource called the <code class="literal">log-store</code>. The <code class="literal">probe</code> operation reads the transaction logs and creates a node path for each record. You can call the <code class="literal">probe</code> operation manually, whenever you need to refresh the <code class="literal">log-store</code>. It is normal for transaction logs to appear and disappear quickly.
			</p><h4 id="refresh_the_log_store">Refreshing the Log Store</h4><p>
				The following command refreshes the log store for server groups which use the profile <code class="literal">default</code> in a managed domain. For a standalone server, remove the <code class="literal">profile=default</code> from the command.
			</p><pre class="screen">/profile=default/subsystem=transactions/log-store=log-store:probe</pre><h4 id="viewing_all_prepared_transactions">Viewing All Prepared Transactions</h4><p>
				To view all prepared transactions, first <a class="link" href="#refresh_the_log_store" title="Refreshing the Log Store">refresh the log store</a>, then run the following command, which functions similarly to a file system <code class="literal">ls</code> command.
			</p><pre class="screen">ls /profile=default/subsystem=transactions/log-store=log-store/transactions</pre><p>
				Or
			</p><pre class="screen">/host=master/server=server-one/subsystem=transactions/log-store=log-store:read-children-names(child-type=transactions)</pre><p>
				Each transaction is shown, along with its unique identifier. Individual operations can be run against an individual transaction. For more information, see <a class="link" href="#manage_a_transaction" title="3.2. Administering a Transaction">Administering a Transaction</a>.
			</p></section><section class="section" id="manage_a_transaction"><div class="titlepage"><div><div><h2 class="title">3.2. Administering a Transaction</h2></div></div></div><h4 id="viewing_the_attributes_of_a_transaction">Viewing the Attributes of a Transaction</h4><p>
				To view information about a transaction, such as its JNDI name, EIS product name and version, or its status, use the <code class="literal">read-resource</code> operation.
			</p><pre class="screen">/profile=default/subsystem=transactions/log-store=log-store/transactions=0\:ffff7f000001\:-b66efc2\:4f9e6f8f\:9:read-resource</pre><h4 id="viewing_the_details_of_a_transaction_participant">Viewing the Details of a Transaction Participant</h4><p>
				Each transaction log contains a child element called <code class="literal">participants</code>. Use the <code class="literal">read-resource</code> operation on this element to see the details of a participant of the transaction. Participants are identified by their JNDI names.
			</p><pre class="screen">/profile=default/subsystem=transactions/log-store=log-store/transactions=0\:ffff7f000001\:-b66efc2\:4f9e6f8f\:9/participants=java\:\/JmsXA:read-resource</pre><p>
				The result may look similar to this:
			</p><pre class="screen">{
   "outcome" =&gt; "success",
   "result" =&gt; {
       "eis-product-name" =&gt; "ActiveMQ",
       "eis-product-version" =&gt; "2.0",
       "jndi-name" =&gt; "java:/JmsXA",
       "status" =&gt; "HEURISTIC",
       "type" =&gt; "/StateManager/AbstractRecord/XAResourceRecord"
   }
}</pre><p>
				The outcome status shown here is in a <code class="literal">HEURISTIC</code> state and is eligible for recovery. See <a class="link" href="#recover_a_transaction" title="Recovering a Transaction Participant">Recover a Transaction Participant</a> for more details.
			</p><p>
				In special cases it is possible to create orphan records in the object store, that is XAResourceRecords, which do not have any corresponding transaction record in the log. For example, XA resource prepared but crashed before the TM recorded and is inaccessible for the domain management API. To access such records you need to set management option <code class="literal">expose-all-logs</code> to <code class="literal">true</code>. This option is not saved in management model and is restored to <code class="literal">false</code> when the server is restarted.
			</p><pre class="screen">/profile=default/subsystem=transactions/log-store=log-store:write-attribute(name=expose-all-logs, value=true)</pre><p>
				You can use this alternate command, which shows participant IDs of transaction in an aggregated form.
			</p><pre class="screen">/host=master/server=server-one/subsystem=transactions/log-store=log-store/transactions=0\:ffff7f000001\:-b66efc2\:4f9e6f8f\:9:read-children-names(child-type=participants)</pre><h4 id="delete_a_transaction">Deleting a Transaction Participant</h4><p>
				Each transaction log supports a <code class="literal">delete</code> operation, to delete the transaction log representing the transaction.
			</p><pre class="screen">/profile=default/subsystem=transactions/log-store=log-store/transactions=0\:ffff7f000001\:-b66efc2\:4f9e6f8f\:9:delete</pre><p>
				This deletes all participants in the transaction as well.
			</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
					Typically, you would leave participant log management to the recovery system or to the transaction log that owns it, but the <code class="literal">delete</code> operation is available for cases when you know it is safe to do so. In the case of heuristically completed XA resources, a <code class="literal">forget</code> call is triggered so that XA resource vendor logs are cleaned correctly. If this <code class="literal">forget</code> call fails, by default the <code class="literal">delete</code> operation will still succeed. You can override this behavior by setting the <code class="literal">ObjectStoreEnvironmentBean.ignoreMBeanHeuristics</code> system property to <code class="literal">false</code>.
				</p></div></div><h4 id="recover_a_transaction">Recovering a Transaction Participant</h4><p>
				Each transaction participant supports recovery by using the <code class="literal">recover</code> operation.
			</p><pre class="screen">/profile=default/subsystem=transactions/log-store=log-store/transactions=0\:ffff7f000001\:-b66efc2\:4f9e6f8f\:9/participants=2:recover</pre><p>
				If the transaction participant’s status is <code class="literal">HEURISTIC</code>, the <code class="literal">recover</code> operation switches the status to <code class="literal">PREPARE</code> and asks the periodic recovery process to replay the commit.
			</p><p>
				If the commit is successful, the participant is removed from the transaction log. You can verify this by running the <code class="literal">probe</code> operation on the <code class="literal">log-store</code> and checking that the participant is no longer listed. If this is the last participant, the transaction is also deleted.
			</p><h4 id="refreshing_the_status_of_a_transaction_participant">Refreshing the Status of a Transaction Participant</h4><p>
				If a transaction needs recovery, you can use the <code class="literal">refresh</code> operation to be sure it still requires recovery, before attempting the recovery.
			</p><pre class="screen">/profile=default/subsystem=transactions/log-store=log-store/transactions=0\:ffff7f000001\:-b66efc2\:4f9e6f8f\:9/participants=2:refresh</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					In JBoss EAP 7.0, transaction failure exceptions are simply serialized and passed over the wire to the client. The client gets a <code class="literal">ClassNotFoundException</code> exception if they do not have the exception class on their class path.
				</p><p>
					JBoss EAP 7.1 introduced the <code class="literal">org.wildfly.common.rpc.RemoteExceptionCause</code> exception, which is known to the client as it is from the <code class="literal">wildfly</code> library. The server clones the original exception to this new one, puts all field of the original exception to a string form and adds them to the exception’s message. The server then passes only exceptions of type <code class="literal">RemoteExceptionCause</code> to the client.
				</p></div></div></section><section class="section" id="view_transaction_statistics"><div class="titlepage"><div><div><h2 class="title">3.3. Viewing Transaction Statistics</h2></div></div></div><p>
				If transaction manager statistics are enabled, you can view statistics on processed transactions by the transaction manager. See the <a class="link" href="/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/configuration_guide/index/">Configuring the Transaction Manager</a> section of the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span> for information about how to enable transaction manager statistics.
			</p><p>
				You can view statistics using either the management console or the management CLI. In the management console, transaction statistics are available by navigating to the <span class="strong strong"><strong>Transaction</strong></span> subsystem from the <span class="strong strong"><strong>Runtime</strong></span> tab. From the management CLI, you can view statistics by using <code class="literal">include-runtime=true</code> to the <code class="literal">read-resource</code> operation. For example:
			</p><pre class="screen">/subsystem=transactions:read-resource(include-runtime=true)</pre><p>
				The following table shows the management console display name, management CLI attribute, and description for each transaction statistic.
			</p><div class="table" id="idm140223474755008"><p class="title"><strong>Table 3.1. Transactions Subsystem Statistics</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 25%; " class="col_1"><!--Empty--></col><col style="width: 30%; " class="col_2"><!--Empty--></col><col style="width: 45%; " class="col_3"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm140223472952560" scope="col">Display Name</th><th align="left" valign="top" id="idm140223472951472" scope="col">Attribute</th><th align="left" valign="top" id="idm140223472950384" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140223472952560"> <p>
								Aborted
							</p>
							 </td><td align="left" valign="top" headers="idm140223472951472"> <p>
								number-of-aborted-transactions
							</p>
							 </td><td align="left" valign="top" headers="idm140223472950384"> <p>
								The number of aborted transactions.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140223472952560"> <p>
								Application Failures
							</p>
							 </td><td align="left" valign="top" headers="idm140223472951472"> <p>
								number-of-application-rollbacks
							</p>
							 </td><td align="left" valign="top" headers="idm140223472950384"> <p>
								The number of failed transactions, including timeouts, whose failure origin was an application.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140223472952560"> <p>
								Average Commit Time
							</p>
							 </td><td align="left" valign="top" headers="idm140223472951472"> <p>
								average-commit-time
							</p>
							 </td><td align="left" valign="top" headers="idm140223472950384"> <p>
								The average time of transaction commit, in nanoseconds, measured from when the client calls commit until the transaction manager determines that it was successful.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140223472952560"> <p>
								Committed
							</p>
							 </td><td align="left" valign="top" headers="idm140223472951472"> <p>
								number-of-committed-transactions
							</p>
							 </td><td align="left" valign="top" headers="idm140223472950384"> <p>
								The number of committed transactions.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140223472952560"> <p>
								Heuristics
							</p>
							 </td><td align="left" valign="top" headers="idm140223472951472"> <p>
								number-of-heuristics
							</p>
							 </td><td align="left" valign="top" headers="idm140223472950384"> <p>
								The number of transactions in a heuristic state.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140223472952560"> <p>
								Inflight Transactions
							</p>
							 </td><td align="left" valign="top" headers="idm140223472951472"> <p>
								number-of-inflight-transactions
							</p>
							 </td><td align="left" valign="top" headers="idm140223472950384"> <p>
								The number of transactions which have begun but not yet terminated.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140223472952560"> <p>
								Nested Transactions
							</p>
							 </td><td align="left" valign="top" headers="idm140223472951472"> <p>
								number-of-nested-transactions
							</p>
							 </td><td align="left" valign="top" headers="idm140223472950384"> <p>
								The total number of nested transactions created.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140223472952560"> <p>
								Number of Transactions
							</p>
							 </td><td align="left" valign="top" headers="idm140223472951472"> <p>
								number-of-transactions
							</p>
							 </td><td align="left" valign="top" headers="idm140223472950384"> <p>
								The total number of transactions created, including nested.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140223472952560"> <p>
								Resource Failures
							</p>
							 </td><td align="left" valign="top" headers="idm140223472951472"> <p>
								number-of-resource-rollbacks
							</p>
							 </td><td align="left" valign="top" headers="idm140223472950384"> <p>
								The number of failed transactions whose failure origin was a resource.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140223472952560"> <p>
								System Failures
							</p>
							 </td><td align="left" valign="top" headers="idm140223472951472"> <p>
								number-of-system-rollbacks
							</p>
							 </td><td align="left" valign="top" headers="idm140223472950384"> <p>
								The number of transactions that have been rolled back due to internal system errors.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140223472952560"> <p>
								Timed Out
							</p>
							 </td><td align="left" valign="top" headers="idm140223472951472"> <p>
								number-of-timed-out-transactions
							</p>
							 </td><td align="left" valign="top" headers="idm140223472950384"> <p>
								The number of transactions that have rolled back due to timeout.
							</p>
							 </td></tr></tbody></table></div></div></section><section class="section" id="transactions_object_store"><div class="titlepage"><div><div><h2 class="title">3.4. Configuring the Transactions Object Store</h2></div></div></div><p>
				Transactions need a place to store objects. One of the options for object storage is a JDBC datasource. If performance is a particular concern, the JDBC object store can be slower than a file system or ActiveMQ journal object store.
			</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					If the <code class="literal">transactions</code> subsystem is configured to use Apache ActiveMQ Artemis journal as storage type for transaction logs, then two instances of JBoss EAP are not permitted to use the same directory for storing the journal. Application server instances can not share the same location and each has to configure a unique location for it.
				</p></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Losing a transaction object store can lead to losing data consistency. Thus, the object store needs to be placed on a <span class="emphasis"><em>safe</em></span> drive.
				</p></div></div><h4 id="using_jdbc_datasource_as_transactions_object_store">Using a JDBC Datasource as a Transactions Object Store</h4><p>
				Follow the below steps to use a JDBC datasource as a transactions object store.
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Create a datasource, for example, <code class="literal">TransDS</code>. For instructions on a non-XA datasource, see the <a class="link" href="/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/configuration_guide/index/">Create a Non-XA datasource</a> section of the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>. Note that the datasource’s JDBC driver must be <a class="link" href="/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/configuration_guide/index/">installed as a core module</a>, as described in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>, not as a JAR deployment, for the object store to work properly.
					</li></ol></div><div class="orderedlist"><ol class="orderedlist" start="2" type="1"><li class="listitem"><p class="simpara">
						Set the datasource’s <code class="literal">jta</code> attribute to <code class="literal">false</code>.
					</p><pre class="screen">/subsystem=datasources/data-source=TransDS:write-attribute(name=jta, value=false)</pre></li><li class="listitem"><p class="simpara">
						Set the <code class="literal">jdbc-store-datasource</code> attribute to the JNDI name for the datasource to use, for example, <code class="literal">java:jboss/datasources/TransDS</code>.
					</p><pre class="screen">/subsystem=transactions:write-attribute(name=jdbc-store-datasource, value=java:jboss/datasources/TransDS)</pre></li><li class="listitem"><p class="simpara">
						Set the <code class="literal">use-jdbc-store</code> attribute to <code class="literal">true</code>.
					</p><pre class="screen">/subsystem=transactions:write-attribute(name=use-jdbc-store, value=true)</pre></li><li class="listitem">
						Restart the JBoss EAP server for the changes to take effect.
					</li></ol></div><h4 id="transactions_jdbc_store_attributes">Transactions JDBC Store Attributes</h4><p>
				The following table identifies all of the available attributes related to JDBC object storage.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Attribute names in this table are listed as they appear in the management model, for example, when using the management CLI. See the schema definition file located at <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/docs/schema/wildfly-txn_4_0.xsd</code> to view the elements as they appear in the XML, as there may be differences from the management model.
				</p></div></div><div class="table" id="idm140223471902352"><p class="title"><strong>Table 3.2. JDBC Store Attributes for Transactions</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 40%; " class="col_1"><!--Empty--></col><col style="width: 60%; " class="col_2"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm140223471897552" scope="col">Property</th><th align="left" valign="top" id="idm140223471896464" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140223471897552"> <p>
								use-jdbc-store
							</p>
							 </td><td align="left" valign="top" headers="idm140223471896464"> <p>
								Set this to <code class="literal">true</code> to enable the JDBC store for transactions.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140223471897552"> <p>
								jdbc-store-datasource
							</p>
							 </td><td align="left" valign="top" headers="idm140223471896464"> <p>
								The JNDI name of the JDBC datasource used for storage.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140223471897552"> <p>
								jdbc-action-store-drop-table
							</p>
							 </td><td align="left" valign="top" headers="idm140223471896464"> <p>
								Whether to drop and recreate the action store tables at launch. The default is <code class="literal">false</code>.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140223471897552"> <p>
								jdbc-action-store-table-prefix
							</p>
							 </td><td align="left" valign="top" headers="idm140223471896464"> <p>
								The prefix for the action store table names.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140223471897552"> <p>
								jdbc-communication-store-drop-table
							</p>
							 </td><td align="left" valign="top" headers="idm140223471896464"> <p>
								Whether to drop and recreate the communication store tables at launch. The default is <code class="literal">false</code>.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140223471897552"> <p>
								jdbc-communication-store-table-prefix
							</p>
							 </td><td align="left" valign="top" headers="idm140223471896464"> <p>
								The prefix for the communication store table names.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140223471897552"> <p>
								jdbc-state-store-drop-table
							</p>
							 </td><td align="left" valign="top" headers="idm140223471896464"> <p>
								Whether to drop and recreate the state store tables at launch. The default is <code class="literal">false</code>.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140223471897552"> <p>
								jdbc-state-store-table-prefix
							</p>
							 </td><td align="left" valign="top" headers="idm140223471896464"> <p>
								The prefix for the state store table names.
							</p>
							 </td></tr></tbody></table></div></div><h4 id="using_the_activemq_journal_object_store">Using the ActiveMQ Journal Object Store</h4><p>
				Follow the below steps to use an ActiveMQ journal object store.
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Set the <code class="literal">use-journal-store</code> attribute to <code class="literal">true</code>.
					</p><pre class="screen">/subsystem=transactions:write-attribute(name=use-journal-store,value=true)</pre></li><li class="listitem">
						Restart the JBoss EAP server for the changes to take effect.
					</li></ol></div></section></section><section class="chapter" id="monitoring_transactions"><div class="titlepage"><div><div><h1 class="title">Chapter 4. Monitoring Transactions</h1></div></div></div><section class="section" id="configuring_logging_for_the_transaction_subsystem"><div class="titlepage"><div><div><h2 class="title">4.1. Configuring Logging for the Transactions Subsystem</h2></div></div></div><p>
				You can control the amount of information logged about transactions, independent of other logging settings in JBoss EAP. You can configure the logging settings using the management console or the management CLI.
			</p><h4 id="configuring_the_transaction_logger_using_the_management_console">Configuring the Transaction Logger Using the Management Console</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Navigate to the <span class="strong strong"><strong>Logging</strong></span> subsystem configuration.
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								In the management console, click the <span class="strong strong"><strong>Configuration</strong></span> tab. If you use a managed domain, you must choose the appropriate server profile.
							</li><li class="listitem">
								Select <span class="strong strong"><strong>Subsystems</strong></span> → <span class="strong strong"><strong>Logging</strong></span> → <span class="strong strong"><strong>Configuration</strong></span> and click <span class="strong strong"><strong>View</strong></span>.
							</li></ol></div></li><li class="listitem"><p class="simpara">
						Edit the <code class="literal">com.arjuna</code> attributes.
					</p><p class="simpara">
						Select the <span class="strong strong"><strong>Categories</strong></span> tab. The <code class="literal">com.arjuna</code> entry is already present. Select <code class="literal">com.arjuna</code> and click <span class="strong strong"><strong>Edit</strong></span>. You can change the log level and choose whether to use parent handlers or not.
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								Log Level:
							</p><p class="simpara">
								As transactions can produce a lot of logging output, the default logging level is set to <code class="literal">WARN</code> so that the server log is not overwhelmed by transaction output. If you need to check transaction processing details, use the <code class="literal">TRACE</code> log level so that transaction IDs are shown.
							</p></li><li class="listitem"><p class="simpara">
								Use Parent Handlers:
							</p><p class="simpara">
								Parent handler indicates whether the logger should send its output to its parent logger. The default behavior is <code class="literal">true</code>.
							</p></li></ul></div></li><li class="listitem">
						Click <span class="strong strong"><strong>Save</strong></span> to save the changes.
					</li></ol></div><h4 id="configuring_the_transaction_logger_using_the_management_cli">Configuring the Transaction Logger Using the Management CLI</h4><p>
				Use the following command to set the logging level from the management CLI. For a standalone server, remove the <code class="literal">/profile=default</code> from the command.
			</p><pre class="screen">/profile=default/subsystem=logging/logger=com.arjuna:write-attribute(name=level,value=<span class="emphasis"><em>VALUE</em></span>)</pre><section class="section" id="enabling_trace_log_leve"><div class="titlepage"><div><div><h3 class="title">4.1.1. Enabling the TRACE Log Level</h3></div></div></div><p>
					The <code class="literal">TRACE</code> level logging allows you diagnose JCA issues in JBoss EAP. You can execute the following command to enable the <code class="literal">TRACE</code> level logging for <code class="literal">com.arjuna</code> class:
				</p><pre class="screen">/profile=default/subsystem=logging/logger=com.arjuna:write-attribute(name=level,value=TRACE)</pre><p>
					For a standalone server, remove the <code class="literal">/profile=default</code> from the command.
				</p></section><section class="section" id="enabling_transaction_bridge_logger"><div class="titlepage"><div><div><h3 class="title">4.1.2. Enabling the Transaction Bridge Logger</h3></div></div></div><p>
					The transaction bridge is a layer on top of the XTS and JTA/JTS components of the Transaction Manager. It interacts with other parts of JBoss EAP server. You can enable verbose logging of these components that interact with the Transaction Manager for a detailed explanation of the system’s operations.
				</p><p>
					The transaction bridge uses the <code class="literal">logging</code> subsystem. When running the JBoss EAP server, logging is configured from the <code class="literal">logging</code> subsystem configuration in the <code class="literal">standalone-xts.xml</code> file. Logging for the transaction bridge is useful for debugging purposes.
				</p><p>
					You can use the following management CLI command to configure the <code class="literal">org.jboss.jbossts.txbridge</code> logger to enable the transaction bridge logging:
				</p><pre class="screen">/subsystem=logging/logger=org.jboss.jbossts.txbridge:add(level=ALL)</pre><p>
					This generates the following XML in the server configuration file:
				</p><pre class="programlisting language-xml">&lt;logger category="org.jboss.jbossts.txbridge"&gt;
  &lt;level name="ALL" /&gt;
&lt;/logger&gt;</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						Deployment ordering issues may result in the Transaction Manager components becoming active before the <code class="literal">logging</code> subsystem is fully configured, including the transaction bridge. In such cases a default logging level gets applied during startup, thereby resulting in detailed debug messages being missed.
					</p></div></div><p>
					You can configure the <code class="literal">com.arjuna</code> logger to enable verbose logging using the following management CLI command:
				</p><pre class="screen">/subsystem=logging/logger=com.arjuna:write-attribute(name=level,value=ALL)</pre><p>
					This generates the following XML in the server configuration file:
				</p><pre class="programlisting language-xml">&lt;logger category="com.arjuna"&gt;
  &lt;level name="ALL" /&gt;
&lt;/logger&gt;</pre></section><section class="section" id="about_transaction_log_messages"><div class="titlepage"><div><div><h3 class="title">4.1.3. Transaction Log Messages</h3></div></div></div><p>
					You can track the transaction status while keeping the log files readable by using the <code class="literal">DEBUG</code> log level for the transaction logger. For detailed debugging, use the <code class="literal">TRACE</code> log level. Refer to <a class="link" href="#configuring_logging_for_the_transaction_subsystem" title="4.1. Configuring Logging for the Transactions Subsystem">Configuring Logging for the Transactions Subsystem</a> for information on configuring the transaction logger.
				</p><p>
					Transaction Manager (TM) can generate a lot of logging information when configured to log in the <code class="literal">TRACE</code> log level. Following are some of the most commonly-seen messages. This list is not comprehensive, so you may see messages other than these.
				</p><div class="table" id="idm140223470934560"><p class="title"><strong>Table 4.1. Transaction State Change</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 30%; " class="col_1"><!--Empty--></col><col style="width: 70%; " class="col_2"><!--Empty--></col></colgroup><tbody><tr><td align="left" valign="top"> <p>
									Transaction Begin
								</p>
								 </td><td align="left" valign="top"> <p>
									When a transaction begins, a method <code class="literal">Begin</code> of class <code class="literal">com.arjuna.ats.arjuna.coordinator.BasicAction</code> is executed and presented in the log with the message <code class="literal">BasicAction::Begin() for action-id &lt;transaction uid&gt;</code>.
								</p>
								 </td></tr><tr><td align="left" valign="top"> <p>
									Transaction Commit
								</p>
								 </td><td align="left" valign="top"> <p>
									When a transaction commits, a method <code class="literal">Commit</code> of class <code class="literal">com.arjuna.ats.arjuna.coordinator.BasicAction</code> is executed and presented in the log with the message <code class="literal">BasicAction::Commit() for action-id &lt;transaction uid&gt;</code>.
								</p>
								 </td></tr><tr><td align="left" valign="top"> <p>
									Transaction Rollback
								</p>
								 </td><td align="left" valign="top"> <p>
									When a transaction rolls back, a method <code class="literal">Rollback</code> of class <code class="literal">com.arjuna.ats.arjuna.coordinator.BasicAction</code> is executed and presented in the log with the message <code class="literal">BasicAction::Rollback() for action-id &lt;transaction uid&gt;</code>.
								</p>
								 </td></tr><tr><td align="left" valign="top"> <p>
									Transaction Timeout
								</p>
								 </td><td align="left" valign="top"> <p>
									When a transaction times out, a method <code class="literal">doCancellations</code> of <code class="literal">com.arjuna.ats.arjuna.coordinator.TransactionReaper</code> is executed and presented in log as <code class="literal">Reaper Worker &lt;thread id&gt; attempting to cancel &lt;transaction uid&gt;</code>. You will then see the same thread rolling back the transaction as shown above.
								</p>
								 </td></tr></tbody></table></div></div></section><section class="section" id="decoding_transaction_log_files"><div class="titlepage"><div><div><h3 class="title">4.1.4. Decoding Transaction Log Files</h3></div></div></div><section class="section" id="locating_xid_uid_of_transaction"><div class="titlepage"><div><div><h4 class="title">4.1.4.1. Locating the XID/UID of a Transaction</h4></div></div></div><p>
						The <code class="literal">javax.transaction.TransactionManager</code> interface provides two ways to locate the transaction identifier:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								You can call the <code class="literal">toString</code> method to print complete information about the transaction, including the identifier.
							</li><li class="listitem"><p class="simpara">
								Alternatively, you can cast the <code class="literal">javax.transaction.Transaction</code> instance to a <code class="literal">com.arjuna.ats.jta.transaction.Transaction</code> and then call either the <code class="literal">get_uid</code> method, which returns the ArjunaCore Uid representation, or call the <code class="literal">getTxId</code> method, which returns the Xid for the global identifier, that is not the branch qualifier.
							</p><pre class="programlisting language-java">com.arjuna.ats.jta.transaction.Transaction arjunaTM = (com.arjuna.ats.jta.transaction.Transaction)tx.getTransaction();
System.out.println("Transaction UID" +arjunaTM.get_uid());</pre></li></ul></div></section><section class="section" id="finding_the_transaction_status_and_resources"><div class="titlepage"><div><div><h4 class="title">4.1.4.2. Finding the Transaction Status and Resources</h4></div></div></div><h6 id="transactionstatusconnectionmanager">TransactionStatusConnectionManager</h6><p>
						The <code class="literal">TransactionStatusConnectionManager</code> object is used by the recovery modules to retrieve the status of the transaction. It acts like a proxy for <code class="literal">TransactionStatusManager</code> objects by maintaining a table of <code class="literal">TransactionStatusConnector</code> objects, each of which connects to a <code class="literal">TransactionStatusManager</code> object in the application process.
					</p><p>
						You can retrieve the transaction status using the <code class="literal">getTransactionStatus</code> method that takes a transaction Uid and, if available, a transaction type as parameters.
					</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
								The process Uid field in the transactions Uid parameter is used to lookup the target <code class="literal">TransactionStatusManagerItem</code> host-port pair in the transaction object store.
							</li><li class="listitem">
								The host-port pair is used to make a TCP connection to the target <code class="literal">TransactionStatusManager</code> object by using a <code class="literal">TransactionStatusConnector</code> object.
							</li><li class="listitem">
								The <code class="literal">TransactionStatusConnector</code> passes the transaction Uid and the transaction type to the <code class="literal">TransactionStatusManager</code> in order to retrieve the status of the transactions.
							</li></ol></div><p>
						The following code example shows how to retrieve the <code class="literal">TransactionStatusConnectionManager</code> and check the transaction status:
					</p><pre class="programlisting language-java">// Transaction id
Uid tx = new Uid();
. . . .
TransactionStatusConnectionManager tscm = new TransactionStatusConnectionManager();

// Check if the transaction aborted
assertEquals(tscm.getTransactionStatus(tx), ActionStatus.ABORTED);</pre><h6 id="transactionstatusmanager">TransactionStatusManager</h6><p>
						The <code class="literal">TransactionStatusManager</code> object acts as an interface for the Recovery Manager to obtain the status of transactions from the running application processes. One <code class="literal">TransactionStatusManager</code> per application process is created by the <code class="literal">com.arjuna.ats.arjuna.coordinator.TxControl</code> class. A TCP connection is used for communication between the Recovery Manager and <code class="literal">TransactionStatusManager</code>. Any free port is used by the <code class="literal">TransactionStatusManager</code> by default. However, the port used can be fixed using the following the property:
					</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/standalone.sh -DRecoveryEnvironmentBean.transactionStatusManagerPort=<span class="emphasis"><em>NETWORK_PORT_NUMBER</em></span></pre><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
								On creation, the <code class="literal">TransactionStatusManager</code> obtains a port that is stored with the host in the object store as a <code class="literal">TransactionStatusManagerItem</code>.
							</li><li class="listitem">
								A <code class="literal">Listener</code> thread is started which waits for a connection request from the <code class="literal">TransactionStatusConnector</code>.
							</li><li class="listitem">
								When the connection is established, a <code class="literal">Connection</code> thread is created that runs the <code class="literal">AtomicActionStatusService</code> service. This service accepts a transaction Uid and a transaction type, if available, from the <code class="literal">TransactionStatusConnector</code> object.
							</li><li class="listitem">
								The transaction status is obtained from the local transaction table and returned back to the <code class="literal">TransactionStatusConnector</code> object.
							</li></ol></div></section><section class="section" id="viewing_the_transaction_history"><div class="titlepage"><div><div><h4 class="title">4.1.4.3. Viewing the Transaction History</h4></div></div></div><p>
						By default, the transaction service does not maintain any history about the transactions. However, you can set the <code class="literal">CoordinatorEnvironmentBean.enableStatistics</code> property variable to <code class="literal">true</code> for the transaction service to maintain information about the number of transactions created and their respective outcomes.
					</p><p>
						You can use the following management CLI command to enable the statistics:
					</p><pre class="screen">/subsystem=transactions:write-attribute(name=enable-statistics,value=true)</pre><p>
						You can obtain more detailed transaction statistics programmatically by using the <code class="literal">com.arjuna.ats.arjuna.coordinator.TxStats</code> class.
					</p><div class="formalpara"><p class="title"><strong>Example: <code class="literal">TxStats</code> Class</strong></p><p>
							
<pre class="programlisting language-java">public class TxStats
{
    /**
     * @return the number of transactions (top-level and nested) created so far.
     */

    public static int numberOfTransactions();

    /**
     * @return the number of nested (sub) transactions created so far.
     *

     public static int numberOfNestedTransactions();

     /**
     * @return the number of transactions which have terminated with heuristic
     *         outcomes.
     */

    public static int numberOfHeuristics();
    /**
     * @return the number of committed transactions.
     */

    public static int numberOfCommittedTransactions();

    /**
     * @return the total number of transactions which have rolled back.
     */

    public static int numberOfAbortedTransactions();

    /**
     * @return total number of inflight (active) transactions.
     */

    public static int numberOfInflightTransactions ();

    /**
     * @return total number of transactions rolled back due to timeout.
     */

    public static int numberOfTimedOutTransactions ();
    /**
     * @return the number of transactions rolled back by the application.
     */

    public static int numberOfApplicationRollbacks ();

    /**
     * @return number of transactions rolled back by participants.
     */

    public static int numberOfResourceRollbacks ();

    /**
     * Print the current information.
     */

    public static void printStatus(java.io.PrintWriter pw);
}</pre>

						</p></div><p>
						The <code class="literal">com.arjuna.ats.arjuna.coordinator.ActionManager</code> class provides further information about specific active transactions using the <code class="literal">getNumberOfInflightTransactions</code> method that returns the list of currently active transactions.
					</p></section></section></section></section><section class="chapter" id="handling_transaction_manager_exceptions"><div class="titlepage"><div><div><h1 class="title">Chapter 5. Handling Transaction Manager Exceptions</h1></div></div></div><section class="section" id="debugging_timed_out_transaction"><div class="titlepage"><div><div><h2 class="title">5.1. Debugging a Timed-out Transaction</h2></div></div></div><p>
				There can be many reasons for a transaction timeout, such as:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Slow server performance
					</li><li class="listitem">
						Thread is stuck waiting for something or hangs up
					</li><li class="listitem">
						Thread needs more than the configured transaction timeout time to complete the processing
					</li></ul></div><p>
				You can look at the logs for following error message to identify a timed-out transaction:
			</p><pre class="screen">WARN ARJUNA012117 "TransactionReaper::check timeout for TX <span class="emphasis"><em>{0}</em></span> in state <span class="emphasis"><em>{1}</em></span>"</pre><p>
				where <code class="literal"><span class="emphasis"><em>{0}</em></span></code> is the Uid of the transaction and <code class="literal"><span class="emphasis"><em>{1}</em></span></code> is the transaction manager’s view of the state {1} of the timed-out transaction.
			</p><p>
				Transaction Manager provides the following options to debug the transaction timeouts:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						You can configure timeout values for transactions to control the transaction lifetimes. The <code class="literal">transactions</code> subsystem rolls back the transaction if the timeout value elapses before a transaction terminates because of committing or rolling back.
					</li><li class="listitem"><p class="simpara">
						You can use the <code class="literal">setTransactionTimeout</code> method of the <code class="literal">XAResource</code> interface to propagate the current transaction to the resource manager. If supported, this operation overrides any default timeout associated with the resource manager. Overriding the timeout is useful in situations like the following:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								when long-running transactions have lifetimes that exceed the default
							</li><li class="listitem">
								when using the default timeout might cause the resource manager to roll back before the transaction terminates, causing the transaction to roll back as well.
							</li></ul></div></li><li class="listitem"><p class="simpara">
						If you do not specify a timeout value or use a value of <code class="literal">0</code>, transaction manager uses an implementation-specific default value. In JBoss EAP transaction manager, the <code class="literal">CoordinatorEnvironmentBean.defaultTimeout</code> property represents this implementation-specific default value. The default value is <code class="literal">300</code> seconds. A value of <code class="literal">0</code> disables the default transaction timeouts.
					</p><p class="simpara">
						You can modify the default transaction timeout using the following management CLI command:
					</p><pre class="screen">/subsystem=transactions:write-attribute(name=default-timeout,value=<span class="emphasis"><em>VALUE</em></span>)</pre><p class="simpara">
						When running in a managed domain, you must specify which profile to update by preceding the command with <code class="literal">/profile=<span class="emphasis"><em>PROFILE_NAME</em></span></code>
					</p></li><li class="listitem">
						JBoss EAP Transaction Manager supports an all-or-nothing approach to call the <code class="literal">setTransactionTimeout</code> method on the <code class="literal">XAResource</code> instances. You can set the <code class="literal">JTAEnvironmentBean.xaTransactionTimeoutEnabled</code> property to <code class="literal">true</code>, which is the default, to call the method on all the instances. Otherwise, you can use the <code class="literal">setXATransactionTimeoutEnabled</code> method of the <code class="literal">com.arjuna.ats.jta.common.JTAEnvironmentBean</code> class to disable timeout and specify them on a per-transaction basis.
					</li></ul></div></section><section class="section" id="migrating_logs_to_new_server"><div class="titlepage"><div><div><h2 class="title">5.2. Migrating Logs to a New JBoss EAP Server</h2></div></div></div><div class="formalpara"><p class="title"><strong>Prerequisites</strong></p><p>
					Ensure that the <code class="literal">transactions</code> subsystem is configured identically between the old and the new JBoss EAP. This identical configuration includes the list of JTA datasources because recovering the logs needs to contact the datasources used by any of the recovered logs.
				</p></div><section class="section" id="migrating_the_file_based_log_storage"><div class="titlepage"><div><div><h3 class="title">5.2.1. Migrating the File-based Log Storage</h3></div></div></div><p>
					To migrate the transaction manager logs to a new JBoss EAP server, you can copy the logs to the new JBoss EAP server.
				</p><p>
					You can use the following commands to copy the file-based logs:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Browse to your <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span></code> directory.
						</li><li class="listitem"><p class="simpara">
							Create an archive of the logs using the following command:
						</p><pre class="screen">$ tar -cf logs.tar ./standalone/data/tx-object-store</pre></li><li class="listitem"><p class="simpara">
							Extract the archived logs to the new <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span></code> directory using the following command:
						</p><pre class="screen">$ tar -xf logs.tar -C <span class="emphasis"><em>NEW_EAP_HOME</em></span></pre></li></ol></div></section><section class="section" id="migrating_the_jdbc_store_based_log_storage"><div class="titlepage"><div><div><h3 class="title">5.2.2. Migrating the JDBC Store-based Log Storage</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							You can configure the new JBoss EAP server to use the old database and tables as described in <a class="link" href="#using_jdbc_datasource_as_transactions_object_store" title="Using a JDBC Datasource as a Transactions Object Store">Using a JDBC Datasource as a Transactions Object Store</a>.
						</li><li class="listitem"><p class="simpara">
							Alternatively, you can determine the database and the tables used for the transaction logs. Then, you can use an SQL tool to back up the tables and restore them to the new database.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								You can find an SQL query tool in the <code class="literal">h2</code> JAR file shipped with JBoss EAP.
							</p></div></div></li></ul></div></section></section><section class="section" id="enabling_xts_on_eap"><div class="titlepage"><div><div><h2 class="title">5.3. Enabling XTS on JBoss EAP</h2></div></div></div><p>
				XML Transaction Service (XTS) component of the transaction manager supports the coordination of private and public web services in a business transaction. XTS provides WS-AT and WS-BA support for web services hosted on the JBoss EAP server. It is an optional subsystem, which can be enabled using the <code class="literal">standalone-xts.xml</code> configuration.
			</p><div class="orderedlist"><p class="title"><strong>Starting JBoss EAP Server with XTS Enabled</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Change to the JBoss EAP server directory:
					</p><pre class="screen">cd $<span class="emphasis"><em>EAP_HOME</em></span></pre></li><li class="listitem"><p class="simpara">
						Copy the example XTS configuration file into the <code class="literal">/configuration</code> directory:
					</p><pre class="screen">cp docs/examples/configs/standalone-xts.xml standalone/configuration</pre></li><li class="listitem"><p class="simpara">
						Start the JBoss EAP server, specifying the <code class="literal">xts</code> configuration:
					</p><p class="simpara">
						Linux:
					</p><pre class="screen">bin/standalone.sh --server-config=standalone-xts.xml</pre><p class="simpara">
						Windows:
					</p><pre class="screen">bin\standalone.bat --server-config=standalone-xts.xml</pre></li></ol></div></section><section class="section" id="clearing_expired_transactions"><div class="titlepage"><div><div><h2 class="title">5.4. Clearing Up Expired Transactions</h2></div></div></div><p>
				The following properties allow you to clear up the expired transactions:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">ExpiryEntryMonitor</code></span></dt><dd><p class="simpara">
							When the Recovery Manager initializes an expiry scanner thread, the <code class="literal">ExpiryEntryMonitor</code> object is created, which is used to remove dead items from the object store. A number of scanner modules are loaded dynamically, which removes the dead items for a particular type.
						</p><p class="simpara">
							You can configure the scanner modules in the properties file using the <code class="literal">RecoveryEnvironmentBean.expiryScanners</code> system property. The scanner modules are loaded at the time of initialization.
						</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/standalone.sh -DRecoveryEnvironmentBean.expiryScanners=<span class="emphasis"><em>CLASSNAME1</em></span>,<span class="emphasis"><em>CLASSNAME2</em></span></pre></dd><dt><span class="term"><code class="literal">expiryScanInterval</code></span></dt><dd><p class="simpara">
							All the scanner modules are called periodically to scan for dead items by the <code class="literal">ExpiryEntryMonitor</code> thread. You can configure this period, in hours, using the <code class="literal">expiryScanInterval</code> system property, as shown in the example below:
						</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/standalone.sh -DRecoveryEnvironmentBean.expiryScanInterval=<span class="emphasis"><em>EXPIRY_SCAN_INTERVAL</em></span></pre></dd></dl></div><p>
				All scanner modules inherit the same behavior from the <code class="literal">ExpiryScanner</code> interface. This interface provides a scan method that is implemented by all the scanner modules, including the following. The scanner thread calls this scan method.
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">ExpiredTransactionStatusManagerScanner</code></span></dt><dd><p class="simpara">
							The <code class="literal">ExpiredTransactionStatusManagerScanner</code> removes the dead <code class="literal">TransactionStatusManagerItems</code> from the object store. These items remain in the object store for a certain period before they are deleted, which is 12 hours by default. You can configure this time period, in hours, using the <code class="literal">transactionStatusManagerExpiryTime</code> system property as shown in the example below:
						</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/standalone.sh -DRecoveryEnvironmentBean.transactionStatusManagerExpiryTime=<span class="emphasis"><em>TRANSACTION_STATUS_MANAGER_EXPIRY_TIME</em></span></pre></dd><dt><span class="term"><code class="literal">AtomicActionExpiryScanner</code></span></dt><dd><p class="simpara">
							The <code class="literal">AtomicActionExpiryScanner</code> moves transaction logs for <code class="literal">AtomicActions</code> that are assumed to have completed. For example, if a failure occurs after a participant has been told to commit but before the <code class="literal">transactions</code> subsystem can update the logs, then upon recovery the JBoss EAP transaction manager attempts to replay the commit request. This replay will obviously fail, thus preventing the log from being removed. The <code class="literal">AtomicActionExpiryScanner</code> is also used when logs cannot be recovered automatically for reasons such as being corrupt or zero length. All logs are moved to a specific location based on the old location appended with <code class="literal">/Expired</code>.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								<code class="literal">AtomicActionExpiryScanner</code> is disabled by default. You can enable it by adding it to the transaction manager properties file. You need not enable it to cope with corrupt logs.
							</p></div></div></dd></dl></div></section><section class="section" id="recovering_heuristic_outcomes"><div class="titlepage"><div><div><h2 class="title">5.5. Recovering Heuristic Outcomes</h2></div></div></div><p>
				A heuristic completion occurs when a transaction resource makes a one-sided decision, during the completion stage of a distributed transaction, to commit or rollback the transaction updates. This can leave distributed data in an indeterminate state. Network failures or resource timeouts are possible causes for heuristic completion. Heuristic completion throws one of the following heuristic outcome exceptions:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">HEURISTIC_COMMIT</code></span></dt><dd>
							This exception is thrown when the transaction manager decides to rollback, but somehow all the resources had already committed on their own. In this case, you need not do anything because a consistent termination was reached.
						</dd><dt><span class="term"><code class="literal">HEURISTIC_ROLLBACK</code></span></dt><dd>
							This exception implies that the resources have all done a rollback because the commit decision from the transaction manager was delayed. Similar to <code class="literal">HEURISTIC_COMMIT</code>, in this case also you need not do anything because a consistent termination was reached.
						</dd><dt><span class="term"><code class="literal">HEURISTIC_HAZARD</code></span></dt><dd>
							This exception occurs when the disposition of some of the updates is unknown. For those that are known, they have either all been committed or all rolled back.
						</dd><dt><span class="term"><code class="literal">HEURISTIC_MIXED</code></span></dt><dd>
							This exception occurs when some parts of the transaction were rolled back while others were committed.
						</dd></dl></div><p>
				This procedure shows how to handle a heuristic outcome of a transaction using the Java Transaction API (JTA).
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						The cause of a heuristic outcome in a transaction is that a resource manager promised it could commit or rollback, and then failed to fulfill the promise. This could be due to a problem with a third-party component, the integration layer between the third-party component and JBoss EAP, or JBoss EAP itself.
					</p><p class="simpara">
						By far, the most common two causes of heuristic errors are transient failures in the environment and coding errors dealing with resource managers.
					</p></li><li class="listitem"><p class="simpara">
						Usually, if there is a transient failure in your environment, you will know about it before you find out about the heuristic error. This could be due to a network outage, hardware failure, database failure, power outage, or a host of other things.
					</p><p class="simpara">
						If you come across a heuristic outcome in a test environment during stress testing, it implies weaknesses in your test environment.
					</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
							JBoss EAP automatically recovers transactions that were in a non-heuristic state at the time of failure, but it does not attempt to recover the heuristic transactions.
						</p></div></div></li><li class="listitem"><p class="simpara">
						If you have no obvious failure in your environment, or if the heuristic outcome is easily reproducible, it is probably due to a coding error. You must contact the third-party vendors to find out if a solution is available.
					</p><p class="simpara">
						If you suspect the problem is in the transaction manager of JBoss EAP itself, you must raise a support ticket.
					</p></li><li class="listitem">
						You can attempt to recover the transaction manually using the management CLI. For instructions on manually recovering a transaction, see the <a class="link" href="#recover_a_transaction" title="Recovering a Transaction Participant">Recovering a Transaction Participant</a> section.
					</li><li class="listitem"><p class="simpara">
						The process of resolving the transaction outcome manually is dependent on the exact circumstance of the failure. Perform the following steps, as applicable to your environment:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								Identify which resource managers were involved.
							</li><li class="listitem">
								Examine the state of the transaction manager and the resource managers.
							</li><li class="listitem">
								Manually force log cleanup and data reconciliation in one or more of the involved components.
							</li></ol></div></li><li class="listitem"><p class="simpara">
						In a test environment, or if you do not care about the integrity of the data, deleting the transaction logs and restarting JBoss EAP gets rid of the heuristic outcome. By default, the transaction logs are located in the <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/standalone/data/tx-object-store/</code> directory for a standalone server, or the <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/domain/servers/<span class="emphasis"><em>SERVER_NAME</em></span>/data/tx-object-store/</code> directory in a managed domain. In the case of a managed domain, <span class="emphasis"><em>SERVER_NAME</em></span> refers to the name of the individual server participating in a server group.
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							The location of the transaction log also depends on the object store in use and the values set for the <code class="literal">object-store-relative-to</code> and <code class="literal">object-store-path</code> parameters. For file system logs, such as a standard shadow and Apache ActiveMQ Artemis logs, the default directory location is used, but when using a JDBC object store, the transaction logs are stored in a database.
						</p></div></div></li></ol></div><section class="section" id="guidelines_on_decision_making"><div class="titlepage"><div><div><h3 class="title">5.5.1. Guidelines on Making Decisions for Heuristic Outcomes</h3></div></div></div><h5 id="problem_detection">Problem Detection</h5><p>
					A heuristic decision is one of the most critical errors that can happen in a transaction system. It can lead to parts of the transaction being committed, while other parts are rolled back. Thus, it can violate the atomicity property of the transaction and can possibly lead to corruption of the data integrity.
				</p><p>
					A recoverable resource maintains all the information about the heuristic decision in stable storage until it is required by the transaction manager. The actual data saved in stable storage depends on the type of recoverable resource and is not standardized. You can parse through the data and possibly edit the resource to correct any data integrity problems.
				</p><p>
					Heuristic outcomes are stored in the server log and can be identified using the resource manager and transaction manager.
				</p><h5 id="manually_committing_or_rolling_back_a_transaction">Manually Committing or Rolling Back a Transaction</h5><p>
					Generally, you cannot manually commit or rollback a transaction. From the JBoss EAP transaction management perspective, you can move a transaction back to the pending list for automated recovery to try again or delete the record. For example:
				</p><p>
					You can use the <code class="literal">read-resource</code> operation to check the status of the participants in the transaction:
				</p><pre class="screen">/subsystem=transactions/log-store=log-store/transactions=0\:ffff7f000001\:-b66efc2\:4f9e6f8f\:9/participants=2:read-resource</pre><p>
					The result will look similar to this:
				</p><pre class="screen">{
   "outcome" =&gt; "success",
   "result" =&gt; {
       "eis-product-name" =&gt; "ArtemisMQ",
       "eis-product-version" =&gt; "2.0",
       "jndi-name" =&gt; "java:/JmsXA",
       "status" =&gt; "HEURISTIC_HAZARD",
       "type" =&gt; "/StateManager/AbstractRecord/XAResourceRecord"
   }
}</pre><p>
					The outcome status shown here is a <code class="literal">HEURISTIC_HAZARD</code> state and is eligible for recovery.
				</p><h6 id="recovering_the_heuristic_hazard_exception">Recovering the HEURISTIC_HAZARD Exception</h6><p>
					The following steps show an example of how to recover a <code class="literal">hazard</code> type heuristic outcome.
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							To begin the recovery, you must consult each resource manager and establish the outcomes of the various branches that are identifiable from the transaction manager tooling. However, you should not need to force a resource manager to commit or rollback. You must rather inspect the resource manager to know the state of the heuristic exception.
						</p><p class="simpara">
							The following are reference links for listing and resolving heuristic outcomes for various resource managers:
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								These links are for reference purpose only and are subject to change. Please consult the vendor documentation for details.
							</p></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									<a class="link mimir-link-warn" href="https://docs.oracle.com/cd/B28359_01/server.111/b28310/ds_txns004.htm#ADMIN12237java/util/logging/package-summary.html" title="Mimir does not include content from: docs.oracle.com">Manual resolution of in-doubt transactions in Oracle</a>
								</li><li class="listitem">
									<a class="link mimir-link-warn" href="https://www.ibm.com/support/knowledgecenter/en/SSEPGG_9.7.0/com.ibm.db2.luw.admin.2pc.doc/doc/t0004636.html" title="Mimir does not include content from: www.ibm.com">Manual resolution of in-doubt transactions in DB2</a>
								</li><li class="listitem">
									<a class="link mimir-link-warn" href="https://www.postgresql.org/docs/9.3/view-pg-prepared-xacts.html" title="Mimir does not include content from: www.postgresql.org">View prepared transactions</a> for two-phase commit in PostGreSQL and <a class="link mimir-link-warn" href="https://www.postgresql.org/docs/9.3/sql-commit-prepared.html" title="Mimir does not include content from: www.postgresql.org">commit</a> or <a class="link mimir-link-warn" href="https://www.postgresql.org/docs/9.3/sql-rollback-prepared.html" title="Mimir does not include content from: www.postgresql.org">rollback</a>
								</li><li class="listitem">
									<a class="link mimir-link-warn" href="https://dev.mysql.com/doc/refman/8.0/en/xa-statements.html" title="Mimir does not include content from: dev.mysql.com">XA transaction syntax in MySQL</a>
								</li><li class="listitem">
									<a class="link mimir-link-warn" href="https://mariadb.com/kb/en/library/xa-transactions/" title="Mimir does not include content from: mariadb.com">XA transaction implementation in MariaDB</a>
								</li></ul></div></li><li class="listitem"><p class="simpara">
							You must execute the recover operation, as shown in the following example:
						</p><pre class="screen">/subsystem=transactions/log-store=log-store/transactions=0\:ffff7f000001\:-b66efc2\:4f9e6f8f\:9/participants=2:recover</pre><p class="simpara">
							Running the <code class="literal">recover</code> operation changes the state of the transaction to <code class="literal">PREPARE</code> and triggers a recovery attempt by replaying the <code class="literal">commit</code> operation. If the recovery attempt is successful, the participant is removed from the transaction log.
						</p><p class="simpara">
							You can verify this by running the <code class="literal">probe</code> operation on the <code class="literal">log-store</code> element again. The participant should no longer be listed. If this is the last participant, the transaction is also deleted.
						</p></li></ol></div><h6 id="recovering_the_heuristic_rollback_and_heuristic_commit_exceptions">Recovering the HEURISTIC_ROLLBACK and HEURISTIC_COMMIT Exceptions</h6><p>
					If the heuristic outcome is a <code class="literal">rollback</code> type, then:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							The resource should not be able to commit the transaction, provided the resource manager is well implemented.
						</li><li class="listitem">
							You must decide whether you should delete the branch from the resource manager, using a forget call, so that the rest of the transaction can commit normally and be cleaned from the transaction store.
						</li><li class="listitem">
							If you do not delete the branch from the resource manager, then the transaction will remain in the transaction store forever.
						</li></ul></div><p>
					On the other hand, if the heuristic outcome was a <code class="literal">commit</code> type, then you must use the business semantics to deal with the inconsistent outcome.
				</p><h5 id="further_actions_when_manual_reconciliation_fails">Further Actions When Manual Reconciliation Fails</h5><p>
					You can check the database transaction table, which is the <code class="literal">DBA_2PC_PENDING</code> table for Oracle. However, these will depend upon the specific resource managers. Transaction Manager can provide you with the branches to inspect in each resource manager.
				</p><p>
					You should consult the vendor’s documentation on this resource manager for details. If you suspect that the problem is caused by the third party resource manager, you must consider raising a support ticket with your supplier.
				</p><p>
					<br/><br/><br/><br/>
				</p><p>
					<span class="emphasis"><em><span class="right right">Revised on 2019-12-05 13:43:17 UTC</span></em></span>
				</p></section></section></section><div><div xml:lang="en-US" class="legalnotice" id="idm140223478856784"><h1 class="legalnotice">Legal Notice</h1><div class="para">
		Copyright <span class="trademark"><!--Empty--></span>© 2019 Red Hat, Inc.
	</div><div class="para">
		The text of and illustrations in this document are licensed by Red Hat under a Creative Commons Attribution–Share Alike 3.0 Unported license ("CC-BY-SA"). An explanation of CC-BY-SA is available at <a class="uri mimir-link-warn" href="http://creativecommons.org/licenses/by-sa/3.0/" title="Mimir does not include content from: creativecommons.org">http://creativecommons.org/licenses/by-sa/3.0/</a>. In accordance with CC-BY-SA, if you distribute this document or an adaptation of it, you must provide the URL for the original version.
	</div><div class="para">
		Red Hat, as the licensor of this document, waives the right to enforce, and agrees not to assert, Section 4d of CC-BY-SA to the fullest extent permitted by applicable law.
	</div><div class="para">
		Red Hat, Red Hat Enterprise Linux, the Shadowman logo, the Red Hat logo, JBoss, OpenShift, Fedora, the Infinity logo, and RHCE are trademarks of Red Hat, Inc., registered in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Linux</span>® is the registered trademark of Linus Torvalds in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Java</span>® is a registered trademark of Oracle and/or its affiliates.
	</div><div class="para">
		<span class="trademark">XFS</span>® is a trademark of Silicon Graphics International Corp. or its subsidiaries in the United States and/or other countries.
	</div><div class="para">
		<span class="trademark">MySQL</span>® is a registered trademark of MySQL AB in the United States, the European Union and other countries.
	</div><div class="para">
		<span class="trademark">Node.js</span>® is an official trademark of Joyent. Red Hat is not formally related to or endorsed by the official Joyent Node.js open source or commercial project.
	</div><div class="para">
		The <span class="trademark">OpenStack</span>® Word Mark and OpenStack logo are either registered trademarks/service marks or trademarks/service marks of the OpenStack Foundation, in the United States and other countries and are used with the OpenStack Foundation's permission. We are not affiliated with, endorsed or sponsored by the OpenStack Foundation, or the OpenStack community.
	</div><div class="para">
		All other trademarks are the property of their respective owners.
	</div></div></div></div></body>

        
        
    </div>
    

</div> 


                            </bdo>
                        </main>
                    </div>
                </main>
            </div>
        
            <!--#include virtual="/includes/footer/index.html" -->
        </div>
    </body>
</html>
