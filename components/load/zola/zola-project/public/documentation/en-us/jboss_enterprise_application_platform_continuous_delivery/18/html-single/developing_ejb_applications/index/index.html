<!DOCTYPE html>
<html>
    <head>
        
        <link rel="stylesheet" type="text/css" media="screen" href="/mimir/styles/mimir.min.css">
        




    <link rel="stylesheet" type="text/css" media="screen" href="/sites/dxp-docs/files/css/css_87GMcmxT1ib8ziQiU2KUAnTDFtZQV6iP-KGslA9LigM.css" />

    <link rel="stylesheet" type="text/css" media="screen" href="/sites/dxp-docs/files/css/css_Bwzy34i9pSdDlzGALvqVwG4fpgGp08KLMAkClGNY9M4.css" />



<link rel="stylesheet" type="text/css" media="screen" href="/mimir/styles/mimir-doc-toc.min.css" />



        
        <!--#include virtual="/includes/head/index.html" -->

        
        <title>
Developing EJB Applications - JBoss Enterprise Application Platform Continuous Delivery 18
</title>
        
<meta name="product" content="JBoss Enterprise Application Platform Continuous Delivery" />
<meta name="documentation_version" content="18" />
<meta name="documentKind" content="documentation" />
<meta name="portal_content_subtype" content="title" />
<meta name="lastModifiedDate" content="2019-12-06T22:33:05.000Z" />


        
            
        
        
            
                
                
                <!-- mimir_solr_yesindex -->
                <meta name="mimir_solr_yesindex" content="true" />
            
        
    </head>

    <body class="mimir-body">

        
        

        
        <div id="page-wrap" class="page-wrap">
            <div id="pers-top-page-wrap" class="top-page-wrap pers-loader-bg">
                <div id="hero-bg-top-left" class="summit-bg-shapes"></div>
                <div id="hero-bg-top-right" class="summit-bg-shapes"></div>

                <header class="masthead" id="masthead">

                    
                    <!--#include virtual="/includes/header/index.html" -->

                    
                    
                    
                        
                    
                    
                        <div class="breadcrumbs">
                            <div id="breadcrumbs" class="container">
                                
                                <a href="/">Home</a>
                                
                                <a href="/products/">Product Documentation</a>
                                
                                <a href="/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/20/">JBoss Enterprise Application Platform Continuous Delivery</a>
                                
                                <a href="/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/">18</a>
                                
                                
                                Developing EJB Applications
                                
                            </div>
                        </div>
                    
                </header>

                <main id="cp-main" class="portal-content-area">
                    <div id="cp-content" class="main-content">
                        
                        <main class="container mimir-docs">
                            
                            <bdo>
                                

<script type="module" src="/mimir/scripts/mimir-doc-toc.min.js"></script>






<div class="docs-grid">

    <nav id="mimir-doc-toc" class="mimir-doc-toc">
      <div class="mimir-doc-toc-inner">
          <!-- single-page -->
        
            
              <ol>
                <li>
                        
                        <a href="#">Developing EJB Applications</a>
                    </li><li>
                        <a href="#idm140640821561712">
                            Preface
                        </a>
                    </li><li>
                        <a href="#introduction">
                            1. Introduction
                        </a><ol>
                <li>
                        <a href="#overview_of_enterprise_javabeans">
                            1.1. Overview of Enterprise JavaBeans
                        </a>
                    </li><li>
                        <a href="#ejb_3_2_feature_set">
                            1.2. EJB 3.2 Feature Set
                        </a>
                    </li><li>
                        <a href="#enterprise_beans">
                            1.3. Enterprise Beans
                        </a><ol>
                <li>
                        <a href="#writing_enterprise_beans">
                            1.3.1. Writing Enterprise Beans
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#enterprise_bean_business_interfaces">
                            1.4. Enterprise Bean Business Interfaces
                        </a>
                    </li><li>
                        <a href="#legacy_ejb_client_compatibility">
                            1.5. Legacy EJB Client Compatibility
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#creating_enterprise_bean_projects">
                            2. Creating Enterprise Bean Projects
                        </a><ol>
                <li>
                        <a href="#create_an_ejb_archive_project_using_red_hat_jboss_developer_studio">
                            2.1. Create an EJB Archive Project Using Red Hat CodeReady Studio
                        </a>
                    </li><li>
                        <a href="#create_an_ejb_archive_project_in_maven">
                            2.2. Create an EJB Archive Project in Maven
                        </a>
                    </li><li>
                        <a href="#create_an_ear_project_containing_an_ejb_project">
                            2.3. Create an EAR Project Containing an EJB Project
                        </a>
                    </li><li>
                        <a href="#add_a_deployment_descriptor_to_an_EJB_project">
                            2.4. Add a Deployment Descriptor to an EJB Project
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#session_beans-1">
                            3. Session Beans
                        </a><ol>
                <li>
                        <a href="#session_beans">
                            3.1. Session Beans
                        </a>
                    </li><li>
                        <a href="#stateless_session_beans">
                            3.2. Stateless Session Beans
                        </a>
                    </li><li>
                        <a href="#stateful_session_beans">
                            3.3. Stateful Session Beans
                        </a>
                    </li><li>
                        <a href="#singleton_session_beans">
                            3.4. Singleton Session Beans
                        </a>
                    </li><li>
                        <a href="#add_session_beans_to_a_project_in_red_hat_jboss_developer_studio">
                            3.5. Add Session Beans to a Project in Red Hat CodeReady Studio
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#message_driven_beans-1">
                            4. Message-Driven Beans
                        </a><ol>
                <li>
                        <a href="#message_driven_beans">
                            4.1. Message-Driven Beans
                        </a>
                    </li><li>
                        <a href="#mdbs_controlled_delivery">
                            4.2. Message-Driven Beans Controlled Delivery
                        </a><ol>
                <li>
                        <a href="#configure_delivery_active">
                            4.2.1. Delivery Active
                        </a>
                    </li><li>
                        <a href="#delivery_groups">
                            4.2.2. Delivery Groups
                        </a>
                    </li><li>
                        <a href="#clustered_singleton_mdbs">
                            4.2.3. Clustered Singleton MDBs
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#create_a_jms_based_message_driven_bean_in_red_hat_jboss_developer_studio">
                            4.3. Create a JMS-based Message-Driven Bean in Red Hat CodeReady Studio
                        </a>
                    </li><li>
                        <a href="#specifying_a_resource_adapter_in_jboss_ejb3_xml_for_an_mdb">
                            4.4. Specifying a Resource Adapter in jboss-ejb3.xml for an MDB
                        </a>
                    </li><li>
                        <a href="#using_resource_definition_annotations_in_mdbs">
                            4.5. Using Resource Definition Annotations in MDBs Deployed to a Cluster
                        </a>
                    </li><li>
                        <a href="#enable_ejb_and_mdb_property_substitution_in_an_application">
                            4.6. Enable EJB and MDB Property Substitution in an Application
                        </a><ol>
                <li>
                        <a href="#configure_the_server_to_enable_property_substitution">
                            4.6.1. Configure the Server to Enable Property Substitution
                        </a>
                    </li><li>
                        <a href="#define_the_system_properties_for_the_mdb">
                            4.6.2. Define the System Properties
                        </a><ol>
                <li>
                        <a href="#define_the_system_properties_in_the_server_configuration">
                            4.6.2.1. Define the System Properties in the Server Configuration
                        </a>
                    </li><li>
                        <a href="#pass_the_system_properties_as_arguments_on_server_start">
                            4.6.2.2. Pass the System Properties as Arguments on Server Start
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#modify_the_application_code_to_use_the_system_property_substitutions">
                            4.6.3. Modify the Application Code to Use the System Property Substitutions
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#activation_configuration_properties">
                            4.7. Activation Configuration Properties
                        </a><ol>
                <li>
                        <a href="#configuring_mdbs_using_annotations">
                            4.7.1. Configuring MDBs Using Annotations
                        </a>
                    </li><li>
                        <a href="#configuring_mdbs_using_deployment_descriptor">
                            4.7.2. Configuring MDBs Using a Deployment Descriptor
                        </a>
                    </li><li>
                        <a href="#some_example_use_cases_for_MDB">
                            4.7.3. Some Example Use Cases for Configuring MDBs
                        </a>
                    </li>
            </ol>
                    </li>
            </ol>
                    </li><li>
                        <a href="#invoking_session_beans">
                            5. Invoking Session Beans
                        </a><ol>
                <li>
                        <a href="#about_ejb_client_contexts">
                            5.1. About EJB Client Contexts
                        </a>
                    </li><li>
                        <a href="#using_ejb_client">
                            5.2. Using Remote EJB Clients
                        </a><ol>
                <li>
                        <a href="#initial_context_lookup">
                            5.2.1. Initial Context Lookup
                        </a>
                    </li><li>
                        <a href="#remote_ejb_configuration_file">
                            5.2.2. Remote EJB Configuration File
                        </a>
                    </li><li>
                        <a href="#client_transaction_annotation">
                            5.2.3. The ClientTransaction Annotation
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#remote_ejb_data_compression">
                            5.3. Remote EJB Data Compression
                        </a>
                    </li><li>
                        <a href="#ejb_client_remoting_interoperability">
                            5.4. EJB Client Remoting Interoperability
                        </a>
                    </li><li>
                        <a href="#configure_iiop_for_remote_ejb_calls">
                            5.5. Configure IIOP for Remote EJB Calls
                        </a>
                    </li><li>
                        <a href="#configure_ejb_client_address">
                            5.6. Configure the EJB Client Address
                        </a>
                    </li><li>
                        <a href="#ejb_invocation_over_http">
                            5.7. EJB Invocation Over HTTP
                        </a><ol>
                <li>
                        <a href="#client_side_implementation">
                            5.7.1. Client-side Implementation
                        </a>
                    </li><li>
                        <a href="#server_side_implementation">
                            5.7.2. Server-side Implementation
                        </a>
                    </li>
            </ol>
                    </li>
            </ol>
                    </li><li>
                        <a href="#ejb_application_security">
                            6. EJB Application Security
                        </a><ol>
                <li>
                        <a href="#security_identity">
                            6.1. Security Identity
                        </a><ol>
                <li>
                        <a href="#about_ejb_security_identity">
                            6.1.1. About EJB Security Identity
                        </a>
                    </li><li>
                        <a href="#set_the_security_identity_of_an_ejb">
                            6.1.2. Set the Security Identity of an EJB
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#ejb_method_permissions">
                            6.2. EJB Method Permissions
                        </a><ol>
                <li>
                        <a href="#about_ejb_method_permissions">
                            6.2.1. About EJB Method Permissions
                        </a>
                    </li><li>
                        <a href="#use_ejb_method_permissions">
                            6.2.2. Use EJB Method Permissions
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#ejb_security_annotations">
                            6.3. EJB Security Annotations
                        </a><ol>
                <li>
                        <a href="#about_ejb_security_annotations">
                            6.3.1. About EJB Security Annotations
                        </a>
                    </li><li>
                        <a href="#use_ejb_security_annotations">
                            6.3.2. Use EJB Security Annotations
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#remote_access_to_ejbs">
                            6.4. Remote Access to EJBs
                        </a><ol>
                <li>
                        <a href="#use_security_realms_with_remote_ejb_clients">
                            6.4.1. Use Security Realms with Remote EJB Clients
                        </a>
                    </li><li>
                        <a href="#add_a_new_security_realm">
                            6.4.2. Add a New Security Realm
                        </a>
                    </li><li>
                        <a href="#add_a_user_to_a_security_realm">
                            6.4.3. Add a User to a Security Realm
                        </a>
                    </li><li>
                        <a href="#assigning_security_realm_to_ejb">
                            6.4.4. Relationship Between Security Domains and Security Realms
                        </a>
                    </li><li>
                        <a href="#about_remote_ejb_access_using_ssl_encryption">
                            6.4.5. About Remote EJB Access Using SSL Encryption
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#elytron_integration_ejb_subsystem">
                            6.5. Elytron Integration with the EJB Subsystem
                        </a><ol>
                <li>
                        <a href="#configure_the_application_security_domain_using_the_management_console">
                            6.5.1. Configure the Application Security Domain Using the Management Console
                        </a>
                    </li><li>
                        <a href="#configure_the_application_security_domain_using_the_management_cli">
                            6.5.2. Configure the Application Security Domain Using the Management CLI
                        </a>
                    </li>
            </ol>
                    </li>
            </ol>
                    </li><li>
                        <a href="#container_and_client_interceptors">
                            7. Container and Client Interceptors
                        </a><ol>
                <li>
                        <a href="#about_container_interceptors">
                            7.1. About Container Interceptors
                        </a>
                    </li><li>
                        <a href="#create_a_container_interceptor_class">
                            7.2. Create a Container Interceptor Class
                        </a>
                    </li><li>
                        <a href="#configure_a_container_interceptor">
                            7.3. Configure a Container Interceptor
                        </a>
                    </li><li>
                        <a href="#change_the_security_context_identity">
                            7.4. Change the Security Context Identity
                        </a>
                    </li><li>
                        <a href="#use_a_client_interceptor_in_an_application">
                            7.5. Use a Client Interceptor in an Application
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#clustered_enterprise_javabeans">
                            8. Clustered Enterprise JavaBeans
                        </a><ol>
                <li>
                        <a href="#about_clustered_enterprise_javabeans_ejbs">
                            8.1. About Clustered Enterprise JavaBeans (EJBs)
                        </a>
                    </li><li>
                        <a href="#ejb_client_code_simplification">
                            8.2. EJB Client Code Simplification
                        </a>
                    </li><li>
                        <a href="#deploying_clustered_ejbs">
                            8.3. Deploying Clustered EJBs
                        </a>
                    </li><li>
                        <a href="#failover_for_clustered_ejbs">
                            8.4. Failover for Clustered EJBs
                        </a>
                    </li><li>
                        <a href="#remote_standalone_clients">
                            8.5. Remote Standalone Clients
                        </a>
                    </li><li>
                        <a href="#cluster_topology_communication">
                            8.6. Cluster Topology Communication
                        </a>
                    </li><li>
                        <a href="#automatic_transaction_stickiness_for_ejbs">
                            8.7. Automatic Transaction Stickiness for EJBs
                        </a>
                    </li><li>
                        <a href="#remote_clients_on_another_instance">
                            8.8. Remote Clients on Another Instance
                        </a>
                    </li><li>
                        <a href="#standalone_and_in_server_client_configuration">
                            8.9. Standalone and In-server Client Configuration
                        </a>
                    </li><li>
                        <a href="#implementing_a_custom_load_balancing_policy_for_ejb_calls">
                            8.10. Implementing a Custom Load Balancing Policy for EJB Calls
                        </a>
                    </li><li>
                        <a href="#ejb_transactions_in_a_clustered_environment">
                            8.11. EJB Transactions in a Clustered Environment
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#tuning_ejb_subsystem">
                            9. Tuning the EJB 3 Subsystem
                        </a>
                    </li><li>
                        <a href="#reference_material">
                            A. Reference Material
                        </a><ol>
                <li>
                        <a href="#ejb_jndi_naming_reference">
                            A.1. EJB JNDI Naming Reference
                        </a>
                    </li><li>
                        <a href="#ejb_reference_resolution">
                            A.2. EJB Reference Resolution
                        </a>
                    </li><li>
                        <a href="#project_dependencies_for_remote_ejb_clients">
                            A.3. Project Dependencies for Remote EJB Clients
                        </a>
                    </li><li>
                        <a href="#jboss_ejb3_xml_deployment_descriptor_reference">
                            A.4. jboss-ejb3.xml Deployment Descriptor Reference
                        </a>
                    </li><li>
                        <a href="#assembly_configure_ejb_thread_pool_default">
                            A.5. Configure an EJB Thread Pool
                        </a><ol>
                <li>
                        <a href="#proc_configuring_ejb_thread_pool_management_console_default">
                            A.5.1. Configuring an EJB Thread Pool Using the Management Console
                        </a>
                    </li><li>
                        <a href="#configuring_ejb_thread_pool_cli_default">
                            A.5.2. Configure an EJB Thread Pool Using the Management CLI
                        </a>
                    </li><li>
                        <a href="#con_ejb_thread_pool_attributes_default">
                            A.5.3. EJB Thread Pool Attributes
                        </a>
                    </li>
            </ol>
                    </li>
            </ol>
                    </li><li>
                        <a href="#idm140640818318048">
                            Legal Notice
                        </a>
                    </li>
            </ol>
            
        
      </div>
    </nav>

    
    <div class="pvof-doc__wrapper" id="doc-wrapper">
        <section class="mimir-doc-title" id="mimir-doc--developing_ejb_applications">
            <h1 class="title">Developing EJB Applications</h1>
        </section>
        <body><div xml:lang="en-US" class="book" id="idm140640813169888"><div class="titlepage"><div><div class="producttitle"><span class="productname">JBoss Enterprise Application Platform Continuous Delivery</span> <span class="productnumber">18</span></div><div><h2 class="subtitle">For Use with JBoss Enterprise Application Platform Continuous Delivery 18</h2></div><div><div xml:lang="en-US" class="authorgroup"><span class="orgname">Red Hat Customer Content Services</span></div></div><div><a href="#idm140640818318048">Legal Notice</a></div><div><div class="abstract"><p class="title"><strong>Abstract</strong></p><div class="para">
				This document provides information for developers and administrators who want to develop and deploy EJB applications with JBoss Enterprise Application Platform Continuous Delivery.
			</div></div></div></div><hr/></div><section class="preface" id="idm140640821561712"><div class="titlepage"><div><div><h1 class="title">Preface</h1></div></div></div><p id="preface_cd">
			This document is intended for use with the JBoss Enterprise Application Platform continuous delivery release 18, which is a Technology Preview release available in the cloud only.
		</p><p>
			Some features described in this document might not work or might not be available on Red Hat OpenShift Online and Red Hat OpenShift Container Platform. For specific details about the feature differences in the JBoss EAP CD release, see the <a class="link" href="/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/jboss_eap_continuous_delivery_18_release_notes/index/#cd_release_limitations">Release Limitations</a> section in the <span class="emphasis"><em>JBoss EAP Continuous Delivery 18 Release Notes</em></span>.
		</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
				This continuous delivery release for JBoss EAP is provided as Technology Preview only. Technology Preview features are not supported with Red Hat production service level agreements (SLAs), might not be functionally complete, and Red Hat does not recommend to use them for production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.
			</p><p>
				See <a class="link mimir-link-warn" href="https://access.redhat.com/support/offerings/techpreview" title="This content is not included in Mimir.">Technology Preview Features Support Scope</a> on the Red Hat Customer Portal for information about the support scope for Technology Preview features.
			</p></div></div></section><section class="chapter" id="introduction"><div class="titlepage"><div><div><h1 class="title">Chapter 1. Introduction</h1></div></div></div><section class="section" id="overview_of_enterprise_javabeans"><div class="titlepage"><div><div><h2 class="title">1.1. Overview of Enterprise JavaBeans</h2></div></div></div><p>
				Enterprise JavaBeans (EJB) 3.2 is an API for developing distributed, transactional, secure and portable Java EE applications through the use of server-side components called Enterprise Beans. Enterprise Beans implement the business logic of an application in a decoupled manner that encourages reuse. Enterprise JavaBeans 3.2 is documented as the Java EE specification <a class="link mimir-link-warn" href="https://jcp.org/en/jsr/detail?id=345" title="Mimir does not include content from: jcp.org">JSR-345</a>.
			</p><p>
				EJB 3.2 provides two profiles: full and lite. JBoss EAP 7 implements the full profile for applications built using the EJB 3.2 specifications.
			</p></section><section class="section" id="ejb_3_2_feature_set"><div class="titlepage"><div><div><h2 class="title">1.2. EJB 3.2 Feature Set</h2></div></div></div><p>
				The following EJB 3.2 features are supported by JBoss EAP 7:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Session beans
					</li><li class="listitem">
						Message-driven beans
					</li><li class="listitem">
						EJB API groups
					</li><li class="listitem">
						No-interface views
					</li><li class="listitem">
						Local interfaces
					</li><li class="listitem">
						Remote interfaces
					</li><li class="listitem">
						AutoClosable interface
					</li><li class="listitem">
						Timer service
					</li><li class="listitem">
						Asynchronous calls
					</li><li class="listitem">
						Interceptors
					</li><li class="listitem">
						RMI/IIOP interoperability
					</li><li class="listitem">
						Transaction support
					</li><li class="listitem">
						Security
					</li><li class="listitem">
						Embeddable API
					</li></ul></div><p>
				The following features are no longer supported by JBoss EAP 7:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						EJB 2.1 entity bean client views
					</li><li class="listitem">
						Entity beans with bean-managed persistence
					</li><li class="listitem">
						Entity beans with container-managed persistence
					</li><li class="listitem">
						EJB Query Language (EJB QL)
					</li><li class="listitem">
						JAX-RPC based web services: endpoints and client views
					</li></ul></div></section><section class="section" id="enterprise_beans"><div class="titlepage"><div><div><h2 class="title">1.3. Enterprise Beans</h2></div></div></div><p>
				Enterprise beans are written as Java classes and annotated with the appropriate EJB annotations. They can be deployed to the application server in their own archive (a JAR file) or be deployed as part of a Java EE application. The application server manages the lifecycle of each enterprise bean and provides services to them such as security, transactions and concurrency management.
			</p><p>
				An enterprise bean can also define any number of business interfaces. Business interfaces provide greater control over which of the bean’s methods are available to clients and can also allow access to clients running in remote JVMs.
			</p><p>
				There are three types of enterprise beans: <a class="link" href="#session_beans" title="3.1. Session Beans">session beans</a>, <a class="link" href="#message_driven_beans" title="4.1. Message-Driven Beans">message-driven beans</a> and entity beans.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					JBoss EAP does not support entity beans.
				</p></div></div><section class="section" id="writing_enterprise_beans"><div class="titlepage"><div><div><h3 class="title">1.3.1. Writing Enterprise Beans</h3></div></div></div><p>
					Enterprise beans are packaged and deployed in Java archive (JAR) files. You can deploy an enterprise bean JAR file to your application server, or include it in an enterprise archive (EAR) file and deploy it with that application. You can also deploy enterprise beans in a web archive (WAR) file alongside a web application.
				</p></section></section><section class="section" id="enterprise_bean_business_interfaces"><div class="titlepage"><div><div><h2 class="title">1.4. Enterprise Bean Business Interfaces</h2></div></div></div><p>
				An EJB business interface is a Java interface written by the bean developer which provides declarations of the public methods of a session bean that are available for clients. Session beans can implement any number of interfaces, including none (a <span class="emphasis"><em>no-interface</em></span> bean).
			</p><p>
				Business interfaces can be declared as local or remote interfaces, but not both.
			</p><h4 id="ejb_local_business_interfaces">EJB Local Business Interfaces</h4><p>
				An EJB local business interface declares the methods which are available when the bean and the client are in the same JVM. When a session bean implements a local business interface only the methods declared in that interface will be available to clients.
			</p><h4 id="ejb_remote_business_interfaces">EJB Remote Business Interfaces</h4><p>
				An EJB remote business interface declares the methods which are available to remote clients. Remote access to a session bean that implements a remote interface is automatically provided by the EJB container.
			</p><p>
				A remote client is any client running in a different JVM and can include desktop applications as well as web applications, services, and enterprise beans deployed to a different application server.
			</p><p>
				Local clients can access the methods exposed by a remote business interface.
			</p><h4 id="ejb_no_interface_beans">EJB No-interface Beans</h4><p>
				A session bean that does not implement any business interfaces is called a no-interface bean. All of the public methods of no-interface beans are accessible to local clients.
			</p><p>
				A session bean that implements a business interface can also be written to expose a <span class="emphasis"><em>no-interface</em></span> view.
			</p></section><section class="section" id="legacy_ejb_client_compatibility"><div class="titlepage"><div><div><h2 class="title">1.5. Legacy EJB Client Compatibility</h2></div></div></div><p>
				JBoss EAP provides the EJB client library as the primary API to invoke remote EJB components.
			</p><p>
				Starting with JBoss EAP 7.1, two EJB clients are shipped:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						EJB client: The regular EJB client is not fully backward compatible.
					</li><li class="listitem">
						Legacy EJB client: The legacy EJB client provides binary backward compatibility. This legacy EJB client can run with the client applications that were initially compiled using the EJB client from JBoss EAP 7.0. All the APIs that were present in the EJB client for JBoss EAP 7.0 are present in the legacy EJB client for JBoss EAP 7.3.
					</li></ul></div><p>
				You can use the legacy EJB client compatibility by including the following Maven dependency in your configuration.
			</p><pre class="programlisting language-xml">&lt;dependencyManagement&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.jboss.eap&lt;/groupId&gt;
            &lt;artifactId&gt;wildfly-ejb-client-legacy-bom&lt;/artifactId&gt;
            &lt;version&gt;<span class="emphasis"><em>EAP_BOM_VERSION</em></span>&lt;/version&gt;
            &lt;type&gt;pom&lt;/type&gt;
            &lt;scope&gt;import&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;
&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.jboss&lt;/groupId&gt;
        &lt;artifactId&gt;jboss-ejb-client-legacy&lt;/artifactId&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</pre><p>
				You must use the <span class="emphasis"><em>EAP_BOM_VERSION</em></span> that is available in the JBoss EAP Maven repository.
			</p></section></section><section class="chapter" id="creating_enterprise_bean_projects"><div class="titlepage"><div><div><h1 class="title">Chapter 2. Creating Enterprise Bean Projects</h1></div></div></div><section class="section" id="create_an_ejb_archive_project_using_red_hat_jboss_developer_studio"><div class="titlepage"><div><div><h2 class="title">2.1. Create an EJB Archive Project Using Red Hat CodeReady Studio</h2></div></div></div><p>
				This task describes how to create an Enterprise JavaBeans (EJB) project in Red Hat CodeReady Studio.
			</p><h4 id="prerequisites">Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						A server and server runtime for JBoss EAP have been configured in Red Hat CodeReady Studio.
					</li></ul></div><h4 id="create_an_ejb_project_in_jbds">Create an EJB Project in Red Hat CodeReady Studio</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Open the <span class="strong strong"><strong>New EJB Project</strong></span> wizard.
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								Navigate to the <span class="strong strong"><strong>File</strong></span> menu, select <span class="strong strong"><strong>New</strong></span>, then select <span class="strong strong"><strong>Project</strong></span>.
							</li><li class="listitem"><p class="simpara">
								When the <span class="strong strong"><strong>New Project</strong></span> wizard appears, select <span class="strong strong"><strong>EJB/EJB Project</strong></span> and click <span class="strong strong"><strong>Next</strong></span>.
							</p><div class="figure" id="idm140640823131376"><p class="title"><strong>Figure 2.1. New EJB Project Wizard</strong></p><div class="figure-contents"><div class="mediaobject"><img src="/webassets/avalon/d/JBoss_Enterprise_Application_Platform_Continuous_Delivery-18-Developing_EJB_Applications-en-US/images/f9d324af49f92a0c4b89a5166dde5d34/6585.png" alt="New EJB Project Wizard" /></div></div></div></li></ol></div></li><li class="listitem"><p class="simpara">
						Enter the following details:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<span class="strong strong"><strong>Project name:</strong></span> The name of the project that appears in Red Hat CodeReady Studio, and also the default file name for the deployed JAR file.
							</li><li class="listitem">
								<span class="strong strong"><strong>Project location:</strong></span> The directory where the project files will be saved. The default is a directory in the current workspace.
							</li><li class="listitem">
								<span class="strong strong"><strong>Target runtime:</strong></span> This is the server runtime used for the project. This will need to be set to the same <span class="strong strong"><strong>JBoss EAP</strong></span> runtime used by the server that you will be deploying to.
							</li><li class="listitem">
								<span class="strong strong"><strong>EJB module version:</strong></span> This is the version of the EJB specification that your enterprise beans will comply with. Red Hat recommends using <span class="strong strong"><strong>3.2</strong></span>.
							</li><li class="listitem"><p class="simpara">
								<span class="strong strong"><strong>Configuration:</strong></span> This allows you to adjust the supported features in your project. Use the default configuration for your selected runtime.
							</p><p class="simpara">
								Click <span class="strong strong"><strong>Next</strong></span> to continue.
							</p></li></ul></div></li><li class="listitem"><p class="simpara">
						The <span class="strong strong"><strong>Java</strong></span> project configuration screen allows you to add directories containing Java source files and specify the directory for the output of the build.
					</p><p class="simpara">
						Leave this configuration unchanged and click <span class="strong strong"><strong>Next</strong></span>.
					</p></li><li class="listitem"><p class="simpara">
						In the <span class="strong strong"><strong>EJB Module</strong></span> settings screen, check <span class="strong strong"><strong>Generate ejb-jar.xml deployment descriptor</strong></span> if a deployment descriptor is required. The deployment descriptor is optional in EJB 3.2 and can be added later if required.
					</p><p class="simpara">
						Click <span class="strong strong"><strong>Finish</strong></span> and the project is created and will be displayed in the Project Explorer.
					</p><div class="figure" id="idm140640821903984"><p class="title"><strong>Figure 2.2. Newly Created EJB Project in the Project Explorer</strong></p><div class="figure-contents"><div class="mediaobject"><img src="/webassets/avalon/d/JBoss_Enterprise_Application_Platform_Continuous_Delivery-18-Developing_EJB_Applications-en-US/images/8f7d0d6cfa45dab3fa77183eb1201de7/47.png" alt="Newly created EJB Project in the Project Explorer" /></div></div></div></li><li class="listitem"><p class="simpara">
						To add the project to the server for deployment, right-click on the target server in the <span class="strong strong"><strong>Servers</strong></span> tab and choose <span class="strong strong"><strong>Add and Remove</strong></span>.
					</p><p class="simpara">
						In the <span class="strong strong"><strong>Add and Remove</strong></span> dialog, select the resource to deploy from the <span class="strong strong"><strong>Available</strong></span> column and click the <span class="strong strong"><strong>Add</strong></span> button. The resource will be moved to the <span class="strong strong"><strong>Configured</strong></span> column. Click <span class="strong strong"><strong>Finish</strong></span> to close the dialog.
					</p><div class="figure" id="idm140640822841776"><p class="title"><strong>Figure 2.3. Add and Remove Dialog</strong></p><div class="figure-contents"><div class="mediaobject"><img src="/webassets/avalon/d/JBoss_Enterprise_Application_Platform_Continuous_Delivery-18-Developing_EJB_Applications-en-US/images/95c9becc8db0bcb56685c0485215d1f2/48.png" alt="Add and Remove Dialog" /></div></div></div></li></ol></div><p>
				You now have an EJB project in Red Hat CodeReady Studio that can build and deploy to the specified server.
			</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
					If no enterprise beans are added to the project then Red Hat CodeReady Studio will display the warning stating <span class="strong strong"><strong><span class="emphasis"><em>An EJB module must contain one or more enterprise beans.</em></span></strong></span> This warning will disappear once one or more enterprise beans have been added to the project.
				</p></div></div></section><section class="section" id="create_an_ejb_archive_project_in_maven"><div class="titlepage"><div><div><h2 class="title">2.2. Create an EJB Archive Project in Maven</h2></div></div></div><p>
				This task demonstrates how to create a project using Maven that contains one or more enterprise beans packaged in a JAR file.
			</p><h4 id="prerequisites_2">Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Maven is already installed.
					</li><li class="listitem">
						You understand the basic usage of Maven.
					</li></ul></div><h4 id="create_an_ejb_archive_project_in_maven-1">Create an EJB Archive Project in Maven</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						<span class="strong strong"><strong>Create the Maven project:</strong></span> An EJB project can be created using Maven’s archetype system and the <code class="literal">ejb-javaee7</code> archetype. To do this run the <code class="literal">mvn</code> command with parameters as shown:
					</p><pre class="screen">$ mvn archetype:generate -DarchetypeGroupId=org.codehaus.mojo.archetypes -DarchetypeArtifactId=ejb-javaee7</pre><p class="simpara">
						Maven will prompt you for the <code class="literal">groupId</code>, <code class="literal">artifactId</code>, <code class="literal">version</code> and <code class="literal">package</code> for your project.
					</p><pre class="screen">$ mvn archetype:generate -DarchetypeGroupId=org.codehaus.mojo.archetypes -DarchetypeArtifactId=ejb-javaee7
[INFO] Scanning for projects...
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] Building Maven Stub Project (No POM) 1
[INFO] ------------------------------------------------------------------------
[INFO]
[INFO] &gt;&gt;&gt; maven-archetype-plugin:2.0:generate (default-cli) @ standalone-pom &gt;&gt;&gt;
[INFO]
[INFO] &lt;&lt;&lt; maven-archetype-plugin:2.0:generate (default-cli) @ standalone-pom &lt;&lt;&lt;
[INFO]
[INFO] --- maven-archetype-plugin:2.0:generate (default-cli) @ standalone-pom ---
[INFO] Generating project in Interactive mode
[INFO] Archetype [org.codehaus.mojo.archetypes:ejb-javaee7:1.5] found in catalog remote
Define value for property 'groupId': : com.shinysparkly
Define value for property 'artifactId': : payment-arrangements
Define value for property 'version':  1.0-SNAPSHOT: :
Define value for property 'package':  com.shinysparkly: :
Confirm properties configuration:
groupId: com.company
artifactId: payment-arrangements
version: 1.0-SNAPSHOT
package: com.company.collections
Y: :
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 32.440s
[INFO] Finished at: Mon Oct 31 10:11:12 EST 2011
[INFO] Final Memory: 7M/81M
[INFO] ------------------------------------------------------------------------
[localhost]$</pre></li><li class="listitem">
						<span class="strong strong"><strong>Add your enterprise beans:</strong></span> Write your enterprise beans and add them to the project under the <code class="literal">src/main/java</code> directory in the appropriate sub-directory for the bean’s package.
					</li><li class="listitem">
						<span class="strong strong"><strong>Build the project:</strong></span> To build the project, run the <code class="literal">mvn package</code> command in the same directory as the <code class="literal">pom.xml</code> file. This will compile the Java classes and package the JAR file. The built JAR file is named <code class="literal">-.jar</code> and is placed in the <code class="literal">target/</code> directory.
					</li></ol></div><p>
				You now have a Maven project that builds and packages a JAR file. This project can contain enterprise beans and the JAR file can be deployed to an application server.
			</p></section><section class="section" id="create_an_ear_project_containing_an_ejb_project"><div class="titlepage"><div><div><h2 class="title">2.3. Create an EAR Project Containing an EJB Project</h2></div></div></div><p>
				This task describes how to create a new enterprise archive (EAR) project in Red Hat CodeReady Studio that contains an EJB project.
			</p><h4 id="prerequisites_3">Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						A server and server runtime for JBoss EAP have been set up.
					</li></ul></div><h4 id="create_an_ear_project_containing_an_ejb_project-1">Create an EAR Project Containing an EJB Project</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Open the <span class="strong strong"><strong>New Java EE EAR Project</strong></span> Wizard.
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								Navigate to the <span class="strong strong"><strong>File</strong></span> menu, select <span class="strong strong"><strong>New</strong></span>, then select <span class="strong strong"><strong>Project</strong></span>.
							</li><li class="listitem">
								When the <span class="strong strong"><strong>New Project</strong></span> wizard appears, select <span class="strong strong"><strong>Java EE/Enterprise Application Project</strong></span> and click <span class="strong strong"><strong>Next</strong></span>.
							</li></ol></div><div class="figure" id="idm140640812969184"><p class="title"><strong>Figure 2.4. New EAR Application Project Wizard</strong></p><div class="figure-contents"><div class="mediaobject"><img src="/webassets/avalon/d/JBoss_Enterprise_Application_Platform_Continuous_Delivery-18-Developing_EJB_Applications-en-US/images/e0688cb246d782b9f21430ed64b348e1/6584.png" alt="New EAR Application Project Wizard" /></div></div></div></li><li class="listitem"><p class="simpara">
						Enter the following details:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<span class="strong strong"><strong>Project name:</strong></span> The name of the project that appears in Red Hat CodeReady Studio, and also the default file name for the deployed EAR file.
							</li><li class="listitem">
								<span class="strong strong"><strong>Project location:</strong></span> The directory where the project files will be saved. The default is a directory in the current workspace.
							</li><li class="listitem">
								<span class="strong strong"><strong>Target runtime:</strong></span> This is the server runtime used for the project. This will need to be set to the same JBoss EAP runtime used by the server that you will be deploying to.
							</li><li class="listitem">
								<span class="strong strong"><strong>EAR version:</strong></span> This is the version of the Java Enterprise Edition specification that your project will comply with. Red Hat recommends using Java EE 8.
							</li><li class="listitem"><p class="simpara">
								<span class="strong strong"><strong>Configuration:</strong></span> This allows you to adjust the supported features in your project. Use the default configuration for your selected runtime.
							</p><p class="simpara">
								Click <span class="strong strong"><strong>Next</strong></span> to continue.
							</p></li></ul></div></li><li class="listitem"><p class="simpara">
						Add a new EJB module.
					</p><p class="simpara">
						New modules can be added from the <span class="strong strong"><strong>Enterprise Application</strong></span> page of the wizard. To add a new EJB Project as a module follow the steps below:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								Click <span class="strong strong"><strong>New Module</strong></span>, uncheck <span class="strong strong"><strong>Create Default Modules</strong></span> checkbox, select the <span class="strong strong"><strong>Enterprise Java Bean</strong></span> and click <span class="strong strong"><strong>Next</strong></span>. The <span class="strong strong"><strong>New EJB Project wizard</strong></span> appears.
							</li><li class="listitem"><p class="simpara">
								The <span class="strong strong"><strong>New EJB Project wizard</strong></span> is the same as the wizard used to create new standalone EJB Projects and is described in <a class="link" href="#create_an_ejb_archive_project_using_red_hat_jboss_developer_studio" title="2.1. Create an EJB Archive Project Using Red Hat CodeReady Studio">Create an EJB Archive Project Using Red Hat CodeReady Studio</a>.
							</p><p class="simpara">
								The minimum details required to create the project are:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										Project name
									</li><li class="listitem">
										Target runtime
									</li><li class="listitem">
										EJB module version
									</li><li class="listitem"><p class="simpara">
										Configuration
									</p><p class="simpara">
										All the other steps of the wizard are optional. Click <span class="strong strong"><strong>Finish</strong></span> to complete creating the EJB Project.
									</p><p class="simpara">
										The newly created EJB project is listed in the Java EE module dependencies and the checkbox is checked.
									</p></li></ul></div></li></ol></div></li><li class="listitem"><p class="simpara">
						Optionally, add an <code class="literal">application.xml</code> deployment descriptor.
					</p><p class="simpara">
						Check the <span class="strong strong"><strong>Generate application.xml deployment descriptor</strong></span> checkbox if one is required.
					</p></li><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>Finish</strong></span>.
					</p><p class="simpara">
						Two new projects will appear: the EJB project and the EAR project.
					</p></li><li class="listitem"><p class="simpara">
						Add the build artifact to the server for deployment.
					</p><p class="simpara">
						Open the <span class="strong strong"><strong>Add and Remove</strong></span> dialog by right-clicking in the <span class="strong strong"><strong>Servers</strong></span> tab on the server you want to deploy the built artifact to in the server tab and then select <span class="strong strong"><strong>Add and Remove</strong></span>.
					</p><p class="simpara">
						Select the EAR resource to deploy from the <span class="strong strong"><strong>Available</strong></span> column and click the <span class="strong strong"><strong>Add</strong></span> button. The resource will be moved to the Configured column. Click <span class="strong strong"><strong>Finish</strong></span> to close the dialog.
					</p></li></ol></div><div class="figure" id="idm140640822273680"><p class="title"><strong>Figure 2.5. Add and Remove Dialog</strong></p><div class="figure-contents"><div class="mediaobject"><img src="/webassets/avalon/d/JBoss_Enterprise_Application_Platform_Continuous_Delivery-18-Developing_EJB_Applications-en-US/images/517421f1574d051580ce88e0b43f1d36/51.png" alt="Add and Remove Dialog" /></div></div></div><p>
				You now have an Enterprise Application Project with a member EJB Project. This will build and deploy to the specified server as a single EAR deployment containing an EJB subdeployment.
			</p></section><section class="section" id="add_a_deployment_descriptor_to_an_EJB_project"><div class="titlepage"><div><div><h2 class="title">2.4. Add a Deployment Descriptor to an EJB Project</h2></div></div></div><p>
				An EJB deployment descriptor can be added to an EJB project that was created without one. To do this, follow the procedure below.
			</p><h4 id="prerequisites_4">Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						You have a EJB project in Red Hat CodeReady Studio to which you want to add an EJB deployment descriptor.
					</li></ul></div><h4 id="add_a_deployment_descriptor_to_an_ejb_project">Add a Deployment Descriptor to an EJB Project</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Open the project in Red Hat CodeReady Studio.
					</li><li class="listitem"><p class="simpara">
						Add a deployment descriptor.
					</p><p class="simpara">
						Right-click on the <span class="strong strong"><strong>Deployment Descriptor</strong></span> folder in the project view and select <span class="strong strong"><strong>Generate Deployment Descriptor</strong></span> tab.
					</p><div class="figure" id="idm140640824290192"><p class="title"><strong>Figure 2.6. Adding a Deployment Descriptor</strong></p><div class="figure-contents"><div class="mediaobject"><img src="/webassets/avalon/d/JBoss_Enterprise_Application_Platform_Continuous_Delivery-18-Developing_EJB_Applications-en-US/images/a4a14396b9e3404a721ce29d20a61459/49.png" alt="Adding a Deployment Descriptor" /></div></div></div><p class="simpara">
						The new file, <code class="literal">ejb-jar.xml</code>, is created in <code class="literal">ejbModule/META-INF/</code>. Double-click on the <span class="strong strong"><strong>Deployment Descriptor</strong></span> folder in the project view to open this file.
					</p></li></ol></div></section></section><section class="chapter" id="session_beans-1"><div class="titlepage"><div><div><h1 class="title">Chapter 3. Session Beans</h1></div></div></div><section class="section" id="session_beans"><div class="titlepage"><div><div><h2 class="title">3.1. Session Beans</h2></div></div></div><p>
				Session beans are enterprise beans that encapsulate a set of related business processes or tasks and are injected into the classes that request them. There are three types of session bean: stateless, stateful, and singleton.
			</p></section><section class="section" id="stateless_session_beans"><div class="titlepage"><div><div><h2 class="title">3.2. Stateless Session Beans</h2></div></div></div><p>
				Stateless session beans are the simplest yet most widely used type of session bean. They provide business methods to client applications but do not maintain any state between method calls. Each method is a complete task that does not rely on any shared state within that session bean. Because there is no state, the application server is not required to ensure that each method call is performed on the same instance. This makes stateless session beans very efficient and scalable.
			</p></section><section class="section" id="stateful_session_beans"><div class="titlepage"><div><div><h2 class="title">3.3. Stateful Session Beans</h2></div></div></div><p>
				Stateful session beans are enterprise beans that provide business methods to client applications and maintain conversational state with the client. They should be used for tasks that must be done in several steps, or method calls, each of which relies on the state of the previous step being maintained. The application server ensures that each client receives the same instance of a stateful session bean for each method call.
			</p></section><section class="section" id="singleton_session_beans"><div class="titlepage"><div><div><h2 class="title">3.4. Singleton Session Beans</h2></div></div></div><p>
				Singleton session beans are session beans that are instantiated once per application and every client request for a singleton bean goes to the same instance. Singleton beans are an implementation of the Singleton Design Pattern as described in the book <span class="emphasis"><em>Design Patterns: Elements of Reusable Object-Oriented Software</em></span> by Erich Gamma, Richard Helm, Ralph Johnson and John Vlissides; published by Addison-Wesley in 1994.
			</p><p>
				Singleton beans provide the smallest memory footprint of all the session bean types but must be designed as thread-safe. EJB 3.2 provides container-managed concurrency (CMC) to allow developers to implement thread safe singleton beans easily. However singleton beans can also be written using traditional multi-threaded code (bean-managed concurrency or BMC) if CMC does not provide enough flexibility.
			</p></section><section class="section" id="add_session_beans_to_a_project_in_red_hat_jboss_developer_studio"><div class="titlepage"><div><div><h2 class="title">3.5. Add Session Beans to a Project in Red Hat CodeReady Studio</h2></div></div></div><p>
				Red Hat CodeReady Studio has several wizards that can be used to quickly create enterprise bean classes. The following procedure shows how to use the Red Hat CodeReady Studio wizards to add a session bean to a project.
			</p><h4 id="prerequisites_5">Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						You have a EJB or Dynamic Web Project in Red Hat CodeReady Studio to which you want to add one or more session beans.
					</li></ul></div><h4 id="add_session_beans_to_a_project_in_red_hat_codeready_studio">Add Session Beans to a Project in Red Hat CodeReady Studio</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Open the project in Red Hat CodeReady Studio.
					</li><li class="listitem"><p class="simpara">
						Open the Create EJB 3.x Session Bean wizard.
					</p><p class="simpara">
						To open the <span class="strong strong"><strong>Create EJB 3.x Session Bean wizard</strong></span>, navigate to the <span class="strong strong"><strong>File</strong></span> menu, select <span class="strong strong"><strong>New</strong></span> and then select <span class="strong strong"><strong>Session Bean (EJB 3.x)</strong></span>.
					</p><div class="figure" id="idm140640823651504"><p class="title"><strong>Figure 3.1. Create EJB 3.x Session Bean wizard</strong></p><div class="figure-contents"><div class="mediaobject"><img src="/webassets/avalon/d/JBoss_Enterprise_Application_Platform_Continuous_Delivery-18-Developing_EJB_Applications-en-US/images/628ed98cfb3bfee320b493f8e7983558/44.png" alt="Create EJB 3.x Session Bean wizard" /></div></div></div></li><li class="listitem"><p class="simpara">
						Specify following details:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<span class="strong strong"><strong>Project:</strong></span> Verify the correct project is selected.
							</li><li class="listitem">
								<span class="strong strong"><strong>Source folder:</strong></span> This is the folder that the Java source files will be created in. This should not usually need to be changed.
							</li><li class="listitem">
								<span class="strong strong"><strong>Package:</strong></span> Specify the package that the class belongs to.
							</li><li class="listitem">
								<span class="strong strong"><strong>Class name:</strong></span> Specify the name of the class that will be the session bean.
							</li><li class="listitem">
								<span class="strong strong"><strong>Superclass:</strong></span> The session bean class can inherit from a superclass. Specify that here if your session has a superclass.
							</li><li class="listitem">
								<span class="strong strong"><strong>State type:</strong></span> Specify the state type of the session bean: stateless, stateful or singleton.
							</li><li class="listitem"><p class="simpara">
								<span class="strong strong"><strong>Business interfaces:</strong></span> By default the <span class="strong strong"><strong>No-interface</strong></span> box is checked so no interfaces will be created. Check the boxes for the interfaces you wish to define and adjust the names if necessary.
							</p><p class="simpara">
								Remember that enterprise beans in a web archive (WAR) only support EJB 3.2 Lite and this does not include remote business interfaces.
							</p><p class="simpara">
								Click <span class="strong strong"><strong>Next</strong></span>.
							</p></li></ul></div></li><li class="listitem"><p class="simpara">
						You can enter in additional information here to further customize the session bean. It is not required to change any of the information here.
					</p><p class="simpara">
						Items that you can change are:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Bean name
							</li><li class="listitem">
								Mapped name
							</li><li class="listitem">
								Transaction type (container managed or bean managed)
							</li><li class="listitem">
								Additional interfaces can be supplied that the bean must implement
							</li><li class="listitem">
								You can also specify EJB 2.x Home and Component interfaces if required
							</li></ul></div></li><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>Finish</strong></span> and the new session bean will be created and added to the project. The files for any new business interfaces will also be created if they were specified.
					</p><div class="figure" id="idm140640813935440"><p class="title"><strong>Figure 3.2. New Session Bean in Red Hat CodeReady Studio</strong></p><div class="figure-contents"><div class="mediaobject"><img src="/webassets/avalon/d/JBoss_Enterprise_Application_Platform_Continuous_Delivery-18-Developing_EJB_Applications-en-US/images/7f1e6ef695f71edba01fbcce40d522ba/45.png" alt="New Session Bean in Red Hat CodeReady Studio" /></div></div></div></li></ol></div></section></section><section class="chapter" id="message_driven_beans-1"><div class="titlepage"><div><div><h1 class="title">Chapter 4. Message-Driven Beans</h1></div></div></div><section class="section" id="message_driven_beans"><div class="titlepage"><div><div><h2 class="title">4.1. Message-Driven Beans</h2></div></div></div><p>
				Message-driven Beans (MDBs) provide an event driven model for application development. The methods of MDBs are not injected into or invoked from client code but are triggered by the receipt of messages from a messaging service such as a Java Messaging Service (JMS) server. The Java EE specification requires that JMS is supported but other messaging systems can be supported as well.
			</p><p>
				MDBs are a special kind of stateless session beans. They implement a method called <code class="literal">onMessage(Message message)</code>. This method is triggered when a JMS destination on which the MDB is listening receives a message. That is, MDBs are triggered by the receipt of messages from a JMS provider, unlike the stateless session beans where methods are usually called by EJB clients.
			</p><p>
				MDB processes messages asynchronously. By default each MDB can have up to 16 sessions, where each session processes a message. There are no message order guarantees. In order to achieve message ordering, it is necessary to limit the session pool for the MDB to <code class="literal">1</code>.
			</p><div class="formalpara"><p class="title"><strong>Example: Management CLI Commands to Set Session Pool to <code class="literal">1</code>:</strong></p><p>
					
<pre class="screen">/subsystem=ejb3/strict-max-bean-instance-pool=mdb-strict-max-pool:write-attribute(name=derive-size,value=undefined)

/subsystem=ejb3/strict-max-bean-instance-pool=mdb-strict-max-pool:write-attribute(name=max-pool-size,value=1)

reload</pre>

				</p></div></section><section class="section" id="mdbs_controlled_delivery"><div class="titlepage"><div><div><h2 class="title">4.2. Message-Driven Beans Controlled Delivery</h2></div></div></div><p>
				JBoss EAP provides three attributes that control active reception of messages on a specific MDB:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<a class="link" href="#configure_delivery_active" title="4.2.1. Delivery Active">Delivery Active</a>
					</li><li class="listitem">
						<a class="link" href="#delivery_groups" title="4.2.2. Delivery Groups">Delivery Groups</a>
					</li><li class="listitem">
						<a class="link" href="#clustered_singleton_mdbs" title="4.2.3. Clustered Singleton MDBs">Clustered Singleton MDBs</a>
					</li></ul></div><section class="section" id="configure_delivery_active"><div class="titlepage"><div><div><h3 class="title">4.2.1. Delivery Active</h3></div></div></div><p>
					The delivery active configuration of the message-driven beans (MDB) indicates whether the MDB is receiving messages or not. If an MDB is not receiving messages, then the messages will be saved in the queue or topic according to the topic or queue rules.
				</p><p>
					You can configure the <code class="literal">active</code> attribute of the <code class="literal">delivery-group</code> using XML or annotations, and you can change its value after deployment using the management CLI. By default, the <code class="literal">active</code> attribute is activated and delivery of messages occurs as soon as the MDB is deployed.
				</p><h5 id="configuring_delivery_active_in_the_jboss_ejb3_xml_file">Configuring Delivery Active in the jboss-ejb3.xml File</h5><p>
					In the <code class="literal">jboss-ejb3.xml</code> file, set the value of <code class="literal">active</code> to <code class="literal">false</code> to indicate that the MDB will not be receiving messages as soon as it is deployed:
				</p><pre class="programlisting language-xml">&lt;?xml version="1.1" encoding="UTF-8"?&gt;
&lt;jboss:ejb-jar xmlns:jboss="http://www.jboss.com/xml/ns/javaee"
    xmlns="http://java.sun.com/xml/ns/javaee"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:d="urn:delivery-active:1.1"
    xsi:schemaLocation="http://www.jboss.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-2_0.xsd http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/ejb-jar_3_1.xsd"
    version="3.1"
    impl-version="2.0"&gt;
    &lt;assembly-descriptor&gt;
        &lt;d:delivery&gt;
            &lt;ejb-name&gt;HelloWorldQueueMDB&lt;/ejb-name&gt;
            &lt;d:active&gt;false&lt;/d:active&gt;
        &lt;/d:delivery&gt;
    &lt;/assembly-descriptor&gt;
&lt;/jboss:ejb-jar&gt;</pre><p>
					If you want to apply the active value to all MDBs in your application, you can use a wildcard <code class="literal">*</code> in place of the <code class="literal">ejb-name</code>.
				</p><h5 id="configuring_delivery_active_using_annotations">Configuring Delivery Active Using Annotations</h5><p>
					You can also use the <code class="literal">org.jboss.ejb3.annotation.DeliveryActive</code> annotation. For example:
				</p><pre class="programlisting language-java">@MessageDriven(name = "HelloWorldMDB", activationConfig = {
 @ActivationConfigProperty(propertyName = "destinationType", propertyValue = "javax.jms.Queue"),
 @ActivationConfigProperty(propertyName = "destination", propertyValue = "queue/HELLOWORLDMDBQueue"),
 @ActivationConfigProperty(propertyName = "acknowledgeMode", propertyValue = "Auto-acknowledge") })
@DeliveryActive(false)

public class HelloWorldMDB implements MessageListener {
    public void onMessage(Message rcvMessage) {
      // ...
    }
}</pre><p>
					If you use Maven to build your project, make sure you add the following dependency to the <code class="literal">pom.xml</code> file of your project:
				</p><pre class="programlisting language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.jboss.ejb3&lt;/groupId&gt;
    &lt;artifactId&gt;jboss-ejb3-ext-api&lt;/artifactId&gt;
    &lt;version&gt;2.2.0.Final&lt;/version&gt;
&lt;/dependency&gt;</pre><h5 id="configuring_delivery_active_using_the_management_cli">Configuring Delivery Active Using the Management CLI</h5><p>
					You can configure the <code class="literal">active</code> attribute of the <code class="literal">delivery-group</code> after deployment using the management CLI. These management operations dynamically change the value of the <code class="literal">active</code> attribute, enabling or disabling delivery for the MDB. This method of changing the delivery active value does not persist if you restart the server. At runtime, connect to the instance you want to manage, then enter the path of the MDB for which you want to manage the delivery. For example:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							Navigate to the instance you want to manage:
						</p><pre class="screen">cd deployment=helloworld-mdb.war/subsystem=ejb3/message-driven-bean=HelloWorldQueueMDB</pre></li><li class="listitem"><p class="simpara">
							To stop the delivery to the MDB:
						</p><pre class="screen">:stop-delivery</pre></li><li class="listitem"><p class="simpara">
							To start the delivery to the MDB:
						</p><pre class="screen">:start-delivery</pre></li></ul></div><h5 id="view_the_mdb_delivery_active_status">View the MDB Delivery Active Status</h5><p>
					You can view the current delivery active status of any MDB using the management console:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Select the <span class="strong strong"><strong>Runtime</strong></span> tab and select the appropriate server.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>EJB</strong></span> and select the child resource, for example <code class="literal">HelloWorldQueueMDB</code>.
						</li></ol></div><div class="formalpara"><p class="title"><strong>Result</strong></p><p>
						You see the status as <code class="literal">Delivery Active: true</code> or <code class="literal">Delivery Active: false</code>.
					</p></div></section><section class="section" id="delivery_groups"><div class="titlepage"><div><div><h3 class="title">4.2.2. Delivery Groups</h3></div></div></div><p>
					Delivery groups provide a way to manage the <code class="literal">delivery-active</code> state for a group of MDBs. An MDB can belong to one or more delivery groups. Message delivery is enabled only when all the delivery groups that an MDB belongs to are active. For a clustered singleton MDB, message delivery is active only in the singleton node of the cluster and only if all the delivery groups associated with the MDB are active.
				</p><p>
					You can add a delivery group to the <code class="literal">ejb3</code> subsystem using either the XML configuration or the management CLI.
				</p><h5 id="configuring_delivery_group_in_the_jboss_ejb3_xml_file">Configuring Delivery Group in the jboss-ejb3.xml File</h5><pre class="programlisting language-xml">&lt;delivery&gt;
  &lt;ejb-name&gt;MdbName&lt;ejb-name&gt;
  &lt;delivery-group&gt;passive&lt;/delivery-group&gt;
&lt;/delivery&gt;</pre><p>
					On the server side, <code class="literal">delivery-groups</code> can be enabled by having their <code class="literal">active</code> attribute set to <code class="literal">true</code>, or disabled by having their <code class="literal">active</code> attribute set to <code class="literal">false</code>, as shown in the example below:
				</p><pre class="programlisting language-xml">&lt;delivery-groups&gt;
  &lt;delivery-group name="group" active="true"/&gt;
&lt;/delivery-groups&gt;</pre><h5 id="configuring_delivery_group_using_the_management_cli">Configuring Delivery Group Using the Management CLI</h5><p>
					The state of <code class="literal">delivery-groups</code> can be updated using the management CLI. For example:
				</p><pre class="screen">/subsystem=ejb3/mdb-delivery-group=group:add
/subsystem=ejb3/mdb-delivery-group=group:remove
/subsystem=ejb3/mdb-delivery-group=group:write-attribute(name=active,value=true)</pre><p>
					When you set the delivery active in the <code class="literal">jboss-ejb3.xml</code> file or using the annotation, it persists on server restart. However, when you use the management CLI to stop or start the delivery, it does not persist on server restart.
				</p><h5 id="configuring_multiple_delivery_groups_using_annotations">Configuring Multiple Delivery Groups Using Annotations</h5><p>
					You can use the <code class="literal">org.jboss.ejb3.annotation.DeliveryGroup</code> annotation on each MDB class belonging to a group:
				</p><pre class="programlisting language-java">@MessageDriven(name = "HelloWorldQueueMDB", activationConfig = {
        @ActivationConfigProperty(propertyName = "destinationType", propertyValue = "javax.jms.Queue"),
        @ActivationConfigProperty(propertyName = "destination", propertyValue = "queue/HELLOWORLDMDBQueue"),
        @ActivationConfigProperty(propertyName = "acknowledgeMode", propertyValue = "Auto-acknowledge") })
@DeliveryGroup("delivery-group-1")
@DeliveryGroup("delivery-group-2")
public class HelloWorldQueueMDB implements MessageListener {
...
}</pre></section><section class="section" id="clustered_singleton_mdbs"><div class="titlepage"><div><div><h3 class="title">4.2.3. Clustered Singleton MDBs</h3></div></div></div><p>
					When an MDB is identified as a clustered singleton and is deployed in a cluster, only one node is active. This node can consume messages serially. When the server node fails, the active node from the clustered singleton MDBs starts consuming the messages.
				</p><h4 id="identify_an_mdb_as_a_clustered_singleton">Identify an MDB as a Clustered Singleton</h4><p>
					You can use one of the following procedures to identify an MDB as a clustered singleton.
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							Use the clustered-singleton XML element as shown in the example below:
						</p><pre class="programlisting language-xml">&lt;?xml version="1.1" encoding="UTF-8"?&gt;
&lt;jboss:ejb-jar xmlns:jboss="http://www.jboss.com/xml/ns/javaee"
               xmlns="http://java.sun.com/xml/ns/javaee"
               xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
               xmlns:c="urn:clustering:1.1"
               xmlns:d="urn:delivery-active:1.2"
               xsi:schemaLocation="http://www.jboss.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-2_0.xsd http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/ejb-jar_3_1.xsd"
               version="3.1"
               impl-version="2.0"&gt;
    &lt;assembly-descriptor&gt;
        &lt;c:clustering&gt;
            &lt;ejb-name&gt;HelloWorldQueueMDB&lt;/ejb-name&gt;
            &lt;c:clustered-singleton&gt;true&lt;/c:clustered-singleton&gt;
        &lt;/c:clustering&gt;
         &lt;d:delivery&gt;
                &lt;ejb-name&gt;*&lt;/ejb-name&gt;
                &lt;d:group&gt;delivery-group-1&lt;/d:group&gt;
                &lt;d:group&gt;delivery-group-2&lt;/d:group&gt;
        &lt;/d:delivery&gt;
    &lt;/assembly-descriptor&gt;
&lt;/jboss:ejb-jar&gt;</pre></li><li class="listitem">
							In your MDB class, use the <code class="literal">@org.jboss.ejb3.annotation.ClusteredSingleton</code>. This procedure requires no extra configuration at the server. You need to run the service in a clustered environment.
						</li></ul></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						You have to activate the <code class="literal">delivery-group</code> in the entire cluster, specifically, in all nodes of the cluster, because you do not know which node of the cluster is chosen to be the <code class="literal">singleton master</code>. If the server chooses a node to be <code class="literal">singleton master</code>, and that node does not have the required <code class="literal">delivery-group</code> activated, no node in the cluster receives the messages.
					</p></div></div><p>
					The <code class="literal">messaging-clustering-singleton</code> quickstart, which ships with JBoss EAP, demonstrates the use of clustering with integrated Apache ActiveMQ Artemis. It uses the same source code as the <code class="literal">helloworld-mdb</code> quickstart, with a difference only in the configuration to run it as a clustered singleton. There are two JMS resources contained in this quickstart:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							A queue named <code class="literal">HELLOWORLDMDBQueue</code> bound in the JNDI as <code class="literal">java:/queue/HELLOWORLDMDBQueue</code>
						</li><li class="listitem">
							A topic named <code class="literal">HELLOWORLDMDBTopic</code> bound in the JNDI as <code class="literal">java:/topic/HELLOWORLDMDBTopic</code>
						</li></ul></div><p>
					Both contain a singleton configuration as specified in the <code class="literal">jboss-ejb3.xml</code> file:
				</p><pre class="programlisting language-xml">&lt;c:clustering&gt;
    &lt;ejb-name&gt;*&lt;/ejb-name&gt;
    &lt;c:clustered-singleton&gt;true&lt;/c:clustered-singleton&gt;
&lt;/c:clustering&gt;</pre><p>
					The wildcard asterisk <code class="literal">*</code> in the <code class="literal">&lt;ejb-name&gt;</code> element indicates that all the MDBs contained in the application will be clustered singleton. As a result, only one node in the cluster will have those MDBs active at a specific time. If this active node shuts down, another node in the cluster will become the active node with the MDBs, which then becomes the singleton provider.
				</p><p>
					You can also find a configuration for the delivery group in the <code class="literal">jboss-ejb3.xml</code> file:
				</p><pre class="programlisting language-xml">&lt;d:delivery&gt;
    &lt;ejb-name&gt;HelloWorldTopicMDB&lt;/ejb-name&gt;
    &lt;d:group&gt;my-mdb-delivery-group&lt;/d:group&gt;
&lt;/d:delivery&gt;</pre><p>
					In this case, only one of the MDBs, <code class="literal">HelloWorldTopicMDB</code>, is associated with a delivery group. All the delivery groups used by an MDB must be configured in the <code class="literal">ejb3</code> subsystem configuration. The delivery group can be enabled or disabled. If the delivery group is disabled in a cluster node, all the MDBs belonging to that delivery group become inactive in the respective cluster node. When using the delivery groups in a non-clustered environment, the MDB is active whenever the delivery group is enabled.
				</p><p>
					If a delivery group is used in conjunction with the singleton provider, the MDB can be active in the singleton provider node only if that node has the delivery group enabled. Otherwise, the MDB will be inactive in that node, and all the other nodes of the cluster.
				</p><p>
					See the <code class="literal">README.html</code> file included with this quickstart for detailed instructions about how to configure the server for messaging clustering and to review the code examples.
				</p><p>
					For information on how to download and use the JBoss EAP quickstarts, see the <a class="link mimir-link-warn" href="https://access.redhat.com/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/getting_started_guide/#using_the_quickstart_examples" title="This content is not included in Mimir.">Using the Quickstart Examples</a> section in the JBoss EAP <span class="emphasis"><em>Getting Started Guide</em></span>.
				</p></section></section><section class="section" id="create_a_jms_based_message_driven_bean_in_red_hat_jboss_developer_studio"><div class="titlepage"><div><div><h2 class="title">4.3. Create a JMS-based Message-Driven Bean in Red Hat CodeReady Studio</h2></div></div></div><p>
				This procedure shows how to add a JMS-based message-driven bean to a project in Red Hat CodeReady Studio. This procedure creates an EJB 3.x message-driven bean that uses annotations.
			</p><h4 id="prerequisites_6">Prerequisites</h4><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						You must have an existing project open in Red Hat CodeReady Studio.
					</li><li class="listitem">
						You must know the name and type of the JMS destination that the bean will be listening to.
					</li><li class="listitem">
						Support for Java Messaging Service (JMS) must be enabled in the JBoss EAP configuration to which this bean will be deployed.
					</li></ul></div><h4 id="add_a_jms_based_message_driven_bean_in_red_hat_codeready_studio">Add a JMS-based Message-driven Bean in Red Hat CodeReady Studio</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Open the <span class="strong strong"><strong>Create EJB 3.x Message-Driven Bean</strong></span> wizard.
					</p><p class="simpara">
						Go to <span class="strong strong"><strong>File → New → Other</strong></span>. Select <span class="strong strong"><strong>EJB/Message-Driven Bean (EJB 3.x)</strong></span> and click the <span class="strong strong"><strong>Next</strong></span> button.
					</p><div class="figure" id="idm140640821732432"><p class="title"><strong>Figure 4.1. Create EJB 3.x Message-Driven Bean Wizard</strong></p><div class="figure-contents"><div class="mediaobject"><img src="/webassets/avalon/d/JBoss_Enterprise_Application_Platform_Continuous_Delivery-18-Developing_EJB_Applications-en-US/images/15177f7c7ce18b754246443a93334f07/111.png" alt="Create EJB 3.x Message-Driven Bean Wizard" /></div></div></div></li><li class="listitem"><p class="simpara">
						Specify class file destination details.
					</p><p class="simpara">
						There are three sets of details to specify for the bean class here: project, Java class, and message destination.
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								<span class="strong strong"><strong>Project:</strong></span>
							</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
										If multiple projects exist in the workspace, ensure that the correct one is selected in the <span class="strong strong"><strong>Project</strong></span> menu.
									</li><li class="listitem">
										The folder where the source file for the new bean will be created is <code class="literal">ejbModule</code> under the selected project’s directory. Only change this if you have a specific requirement.
									</li></ul></div></li><li class="listitem"><p class="simpara">
								<span class="strong strong"><strong>Java Class:</strong></span>
							</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
										The required fields are: <span class="strong strong"><strong>Java package</strong></span> and <span class="strong strong"><strong>Class name</strong></span>.
									</li><li class="listitem">
										It is not necessary to supply a superclass unless the business logic of your application requires it.
									</li></ul></div></li><li class="listitem"><p class="simpara">
								<span class="strong strong"><strong>Message Destination:</strong></span>
							</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p class="simpara">
										These are the details you must supply for a JMS-based message-driven bean:
									</p><div class="itemizedlist"><ul class="itemizedlist" type="square"><li class="listitem">
												<span class="strong strong"><strong>Destination name</strong></span>, which is the queue or topic name that contains the messages that the bean will respond to.
											</li><li class="listitem">
												By default the <span class="strong strong"><strong>JMS</strong></span> checkbox is selected. Do not change this.
											</li><li class="listitem"><p class="simpara">
												Set <span class="strong strong"><strong>Destination type</strong></span> to <span class="strong strong"><strong>Queue</strong></span> or <span class="strong strong"><strong>Topic</strong></span> as required.
											</p><p class="simpara">
												Click the <span class="strong strong"><strong>Next</strong></span> button.
											</p></li></ul></div></li></ul></div></li></ul></div></li><li class="listitem"><p class="simpara">
						Enter message-driven bean specific information.
					</p><p class="simpara">
						The default values here are suitable for a JMS-based message-driven bean using container-managed transactions.
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Change the <span class="strong strong"><strong>Transaction type</strong></span> to Bean if the Bean will use Bean-managed transactions.
							</li><li class="listitem">
								Change the <span class="strong strong"><strong>Bean name</strong></span> if a different bean name than the class name is required.
							</li><li class="listitem">
								The <span class="strong strong"><strong>JMS Message Listener</strong></span> interface will already be listed. You do not need to add or remove any interfaces unless they are specific to your application’s business logic.
							</li><li class="listitem"><p class="simpara">
								Leave the checkboxes for creating method stubs selected.
							</p><p class="simpara">
								Click the <span class="strong strong"><strong>Finish</strong></span> button.
							</p></li></ul></div></li></ol></div><div class="formalpara"><p class="title"><strong>Result</strong></p><p>
					The message-driven bean is created with stub methods for the default constructor and the <code class="literal">onMessage()</code> method. A Red Hat CodeReady Studio editor window opens with the corresponding file.
				</p></div></section><section class="section" id="specifying_a_resource_adapter_in_jboss_ejb3_xml_for_an_mdb"><div class="titlepage"><div><div><h2 class="title">4.4. Specifying a Resource Adapter in <code class="literal">jboss-ejb3.xml</code> for an MDB</h2></div></div></div><p>
				In the <code class="literal">jboss-ejb3.xml</code> deployment descriptor you can specify a resource adapter for an MDB to use.
			</p><p>
				To specify a resource adapter in <code class="literal">jboss-ejb3.xml</code> for an MDB, use the following example.
			</p><div class="formalpara"><p class="title"><strong>Example: jboss-ejb3.xml Configuration for an MDB Resource Adapter</strong></p><p>
					
<pre class="programlisting language-xml">&lt;jboss xmlns="http://www.jboss.com/xml/ns/javaee"
  xmlns:jee="http://java.sun.com/xml/ns/javaee"
  xmlns:mdb="urn:resource-adapter-binding"&gt;
  &lt;jee:assembly-descriptor&gt;
    &lt;mdb:resource-adapter-binding&gt;
      &lt;jee:ejb-name&gt;MyMDB&lt;/jee:ejb-name&gt;
      &lt;mdb:resource-adapter-name&gt;MyResourceAdapter.rar&lt;/mdb:resource-adapter-name&gt;
    &lt;/mdb:resource-adapter-binding&gt;
  &lt;/jee:assembly-descriptor&gt;
&lt;/jboss&gt;</pre>

				</p></div><p>
				For a resource adapter located in an EAR, you must use the following syntax for <code class="literal">&lt;mdb:resource-adapter-name&gt;</code>:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						For a resource adapter that is in another EAR:
					</p><pre class="programlisting language-xml">&lt;mdb:resource-adapter-name&gt;OtherDeployment.ear#MyResourceAdapter.rar&lt;/mdb:resource-adapter-name&gt;</pre></li><li class="listitem"><p class="simpara">
						For a resource adapter that is in the same EAR as the MDB, you can omit the EAR name:
					</p><pre class="programlisting language-xml">&lt;mdb:resource-adapter-name&gt;#MyResourceAdapter.rar&lt;/mdb:resource-adapter-name&gt;</pre></li></ul></div></section><section class="section" id="using_resource_definition_annotations_in_mdbs"><div class="titlepage"><div><div><h2 class="title">4.5. Using Resource Definition Annotations in MDBs Deployed to a Cluster</h2></div></div></div><p>
				If you use the <code class="literal">@JMSConnectionFactoryDefinition</code> and <code class="literal">@JMSDestinationDefinition</code> annotations to create a connection factory and destination for message-driven beans, be aware that the objects are only created on the server where the MDB is deployed. They are not created on all nodes in a cluster unless the MDB is also deployed to all nodes in the cluster. Because objects configured by these annotations are only created on the server where the MDB is deployed, this affects remote JCA topologies where an MDB reads messages from a remote server and then sends them to a remote server.
			</p></section><section class="section" id="enable_ejb_and_mdb_property_substitution_in_an_application"><div class="titlepage"><div><div><h2 class="title">4.6. Enable EJB and MDB Property Substitution in an Application</h2></div></div></div><p>
				Red Hat JBoss Enterprise Application Platform allows you to enable property substitution in EJBs and MDBs using the <code class="literal">@ActivationConfigProperty</code> and <code class="literal">@Resource</code> annotations. Property substitution requires the following configuration and code changes.
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						You must <a class="link" href="#configure_the_server_to_enable_property_substitution" title="4.6.1. Configure the Server to Enable Property Substitution">enable property substitution</a> in the JBoss EAP server configuration file.
					</li><li class="listitem">
						You must <a class="link" href="#define_the_system_properties_for_the_mdb" title="4.6.2. Define the System Properties">define the system properties</a> in the server configuration file or pass them as arguments when you start the JBoss EAP server.
					</li><li class="listitem">
						You must <a class="link" href="#modify_the_application_code_to_use_the_system_property_substitutions" title="4.6.3. Modify the Application Code to Use the System Property Substitutions">modify the application code</a> to use the substitution variables.
					</li></ul></div><p>
				The following examples demonstrate how to modify the <code class="literal">helloworld-mdb</code> quickstart that ships with JBoss EAP to use property substitution. See the <code class="literal">helloworld-mdb-propertysubstitution</code> quickstart for the completed working example.
			</p><section class="section" id="configure_the_server_to_enable_property_substitution"><div class="titlepage"><div><div><h3 class="title">4.6.1. Configure the Server to Enable Property Substitution</h3></div></div></div><p>
					To enable property substitution in the JBoss EAP server, you must set the <code class="literal">annotation-property-replacement</code> attribute in the <code class="literal">ee</code> subsystem of the server configuration to <code class="literal">true</code>.
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Back up the server configuration file.
						</p><p class="simpara">
							The <code class="literal">helloworld-mdb-propertysubstitution</code> quickstart example requires the full profile for a standalone server, so this is the <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/standalone/configuration/standalone-full.xml</code> file. If you are running your server in a managed domain, this is the <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/domain/configuration/domain.xml</code> file.
						</p></li><li class="listitem"><p class="simpara">
							Navigate to the JBoss EAP install directory and start the server with the full profile.
						</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/standalone.sh -c standalone-full.xml</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								For Windows Server, use the <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>\bin\standalone.bat</code> script.
							</p></div></div></li><li class="listitem"><p class="simpara">
							Launch the management CLI.
						</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/jboss-cli.sh --connect</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								For Windows Server, use the <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>\bin\jboss-cli.bat</code> script.
							</p></div></div></li><li class="listitem"><p class="simpara">
							Type the following command to enable annotation property substitution.
						</p><pre class="screen">/subsystem=ee:write-attribute(name=annotation-property-replacement,value=true)</pre><p class="simpara">
							You should see the following result.
						</p><pre class="screen">{"outcome" =&gt; "success"}</pre></li><li class="listitem"><p class="simpara">
							Review the changes to the JBoss EAP server configuration file. The <code class="literal">ee</code> subsystem should now contain the following XML.
						</p><div class="formalpara"><p class="title"><strong>Example <code class="literal">ee</code> Subsystem Configuration</strong></p><p>
								
<pre class="programlisting language-xml">&lt;subsystem xmlns="urn:jboss:domain:ee:4.0"&gt;
  ...
  &lt;annotation-property-replacement&gt;true&lt;/annotation-property-replacement&gt;
  ...
&lt;/subsystem&gt;</pre>

							</p></div></li></ol></div></section><section class="section" id="define_the_system_properties_for_the_mdb"><div class="titlepage"><div><div><h3 class="title">4.6.2. Define the System Properties</h3></div></div></div><p>
					You can specify the system properties in the server configuration file or you can pass them as command line arguments when you start the JBoss EAP server. System properties defined in the server configuration file take precedence over those passed on the command line when you start the server.
				</p><section class="section" id="define_the_system_properties_in_the_server_configuration"><div class="titlepage"><div><div><h4 class="title">4.6.2.1. Define the System Properties in the Server Configuration</h4></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
								Launch the management CLI.
							</li><li class="listitem"><p class="simpara">
								Use the following command syntax to configure a system property in the JBoss EAP server.
							</p><div class="formalpara"><p class="title"><strong>Syntax to Add a System Property</strong></p><p>
									
<pre class="screen">/system-property=<span class="emphasis"><em>PROPERTY_NAME</em></span>:add(value=<span class="emphasis"><em>PROPERTY_VALUE</em></span>)</pre>

								</p></div><p class="simpara">
								The following system properties are configured for the <code class="literal">helloworld-mdb-propertysubstitution</code> quickstart.
							</p><div class="formalpara"><p class="title"><strong>Example Commands to Add System Properties</strong></p><p>
									
<pre class="screen">/system-property=property.helloworldmdb.queue:add(value=java:/queue/HELLOWORLDMDBPropQueue)
/system-property=property.helloworldmdb.topic:add(value=java:/topic/HELLOWORLDMDBPropTopic)
/system-property=property.connection.factory:add(value=java:/ConnectionFactory)</pre>

								</p></div></li><li class="listitem"><p class="simpara">
								Review the changes to the JBoss EAP server configuration file. The following system properties should now appear in the after the <code class="literal">&lt;extensions&gt;</code>.
							</p><div class="formalpara"><p class="title"><strong>Example System Properties Configuration</strong></p><p>
									
<pre class="programlisting language-xml">&lt;system-properties&gt;
    &lt;property name="property.helloworldmdb.queue" value="java:/queue/HELLOWORLDMDBPropQueue"/&gt;
    &lt;property name="property.helloworldmdb.topic" value="java:/topic/HELLOWORLDMDBPropTopic"/&gt;
    &lt;property name="property.connection.factory" value="java:/ConnectionFactory"/&gt;
&lt;/system-properties&gt;</pre>

								</p></div></li></ol></div></section><section class="section" id="pass_the_system_properties_as_arguments_on_server_start"><div class="titlepage"><div><div><h4 class="title">4.6.2.2. Pass the System Properties as Arguments on Server Start</h4></div></div></div><p>
						If you prefer, you can instead pass the arguments on the command line when you start the JBoss EAP server in the form of <code class="literal">-D<span class="emphasis"><em>PROPERTY_NAME</em></span>=<span class="emphasis"><em>PROPERTY_VALUE</em></span></code>. The following is an example of how to pass the arguments for the system properties defined in the previous section.
					</p><div class="formalpara"><p class="title"><strong>Example Server Start Command Passing System Properties</strong></p><p>
							
<pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/standalone.sh -c standalone-full.xml  -Dproperty.helloworldmdb.queue=java:/queue/HELLOWORLDMDBPropQueue  -Dproperty.helloworldmdb.topic=java:/topic/HELLOWORLDMDBPropTopic  -Dproperty.connection.factory=java:/ConnectionFactory</pre>

						</p></div></section></section><section class="section" id="modify_the_application_code_to_use_the_system_property_substitutions"><div class="titlepage"><div><div><h3 class="title">4.6.3. Modify the Application Code to Use the System Property Substitutions</h3></div></div></div><p>
					Replace the hard-coded <code class="literal">@ActivationConfigProperty</code> and <code class="literal">@Resource</code> annotation values with substitutions for the newly defined system properties. The following are examples of how to change the <code class="literal">helloworld-mdb</code> quickstart to use the newly defined system property substitutions.
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Change the <code class="literal">@ActivationConfigProperty</code> <code class="literal">destination</code> property value in the <code class="literal">HelloWorldQueueMDB</code> class to use the substitution for the system property. The <code class="literal">@MessageDriven</code> annotation should now look like this:
						</p><div class="formalpara"><p class="title"><strong>HelloWorldQueueMDB Code Example</strong></p><p>
								
<pre class="programlisting language-java">@MessageDriven(name = "HelloWorldQueueMDB", activationConfig = {
    @ActivationConfigProperty(propertyName = "destinationLookup", propertyValue = "${property.helloworldmdb.queue}"),
    @ActivationConfigProperty(propertyName = "destinationType", propertyValue = "javax.jms.Queue"),
    @ActivationConfigProperty(propertyName = "acknowledgeMode", propertyValue = "Auto-acknowledge") })</pre>

							</p></div></li><li class="listitem"><p class="simpara">
							Change the <code class="literal">@ActivationConfigProperty</code> <code class="literal">destination</code> property value in the <code class="literal">HelloWorldTopicMDB</code> class to use the substitution for the system property. The <code class="literal">@MessageDriven</code> annotation should now look like this:
						</p><div class="formalpara"><p class="title"><strong>HelloWorldTopicMDB Code Example</strong></p><p>
								
<pre class="programlisting language-java">@MessageDriven(name = "HelloWorldQTopicMDB", activationConfig = {
    @ActivationConfigProperty(propertyName = "destinationLookup", propertyValue = "${property.helloworldmdb.topic}"),
    @ActivationConfigProperty(propertyName = "destinationType", propertyValue = "javax.jms.Topic"),
    @ActivationConfigProperty(propertyName = "acknowledgeMode", propertyValue = "Auto-acknowledge") })</pre>

							</p></div></li><li class="listitem"><p class="simpara">
							Change the <code class="literal">@Resource</code> annotations in the <code class="literal">HelloWorldMDBServletClient</code> class to use the system property substitutions. The code should now look like this:
						</p><div class="formalpara"><p class="title"><strong>HelloWorldMDBServletClient Code Example</strong></p><p>
								
<pre class="programlisting language-java">/**
 * Definition of the two JMS destinations used by the quickstart
 * (one queue and one topic).
 */
 @JMSDestinationDefinitions(
     value = {
         @JMSDestinationDefinition(
             name = "java:/${property.helloworldmdb.queue}",
             interfaceName = "javax.jms.Queue",
             destinationName = "HelloWorldMDBQueue"
         ),
         @JMSDestinationDefinition(
             name = "java:/${property.helloworldmdb.topic}",
             interfaceName = "javax.jms.Topic",
             destinationName = "HelloWorldMDBTopic"
         )
     })
/**
 * &lt;p&gt;
 * A simple servlet 3 as client that sends several messages to a queue or a topic.
 * &lt;/p&gt;
 *
 * &lt;p&gt;
 * The servlet is registered and mapped to /HelloWorldMDBServletClient using the {@linkplain WebServlet
 * @HttpServlet}.
 * &lt;/p&gt;
 *
 * @author Serge Pagop (spagop@redhat.com)
 *
 */
@WebServlet("/HelloWorldMDBServletClient")
public class HelloWorldMDBServletClient extends HttpServlet {

    private static final long serialVersionUID = -8314035702649252239L;

    private static final int MSG_COUNT = 5;

    @Inject
    private JMSContext context;

    @Resource(lookup = "${property.helloworldmdb.queue}")
    private Queue queue;

    @Resource(lookup = "${property.helloworldmdb.topic}")
    private Topic topic;

  &lt;!-- Remainder of code can be found in the `helloworld-mdb-propertysubstitution` quickstart. --&gt;</pre>

							</p></div></li><li class="listitem"><p class="simpara">
							Modify the <code class="literal">activemq-jms.xml</code> file to use the system property substitution values.
						</p><div class="formalpara"><p class="title"><strong>Example .activemq-jms.xml File</strong></p><p>
								
<pre class="programlisting language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;messaging-deployment xmlns="urn:jboss:messaging-activemq-deployment:1.0"&gt;
    &lt;server&gt;
         &lt;jms-destinations&gt;
            &lt;jms-queue name="HELLOWORLDMDBQueue"&gt;
                &lt;entry name="${property.helloworldmdb.queue}"/&gt;
            &lt;/jms-queue&gt;
            &lt;jms-topic name="HELLOWORLDMDBTopic"&gt;
                &lt;entry name="${property.helloworldmdb.topic}"/&gt;
            &lt;/jms-topic&gt;
        &lt;/jms-destinations&gt;
    &lt;/server&gt;
&lt;/messaging-deployment&gt;</pre>

							</p></div></li><li class="listitem">
							Deploy the application. The application now uses the values specified by the system properties for the <code class="literal">@Resource</code> and <code class="literal">@ActivationConfigProperty</code> property values.
						</li></ol></div></section></section><section class="section" id="activation_configuration_properties"><div class="titlepage"><div><div><h2 class="title">4.7. Activation Configuration Properties</h2></div></div></div><section class="section" id="configuring_mdbs_using_annotations"><div class="titlepage"><div><div><h3 class="title">4.7.1. Configuring MDBs Using Annotations</h3></div></div></div><p>
					You can configure activation properties by using the <code class="literal">@MessageDriven</code> element and sub-elements which correspond to the <code class="literal">@ActivationConfigProperty</code> annotation. <code class="literal">@ActivationConfigProperty</code> is an array of activation configuration properties for MDBs. The <code class="literal">@ActivationConfigProperty</code> annotation specification is as follows:
				</p><pre class="programlisting language-java">@Target(value={})
@Retention(value=RUNTIME)
public @interface ActivationConfigProperty
{
	String propertyName();
	String propertyValue();
}</pre><div class="formalpara"><p class="title"><strong>Example showing <code class="literal">@ActivationConfigProperty</code></strong></p><p>
						
<pre class="programlisting language-java">@MessageDriven(name="MyMDBName",
activationConfig =
{
    @ActivationConfigProperty(propertyName="destinationLookup",propertyValue="queueA"),
    @ActivationConfigProperty(propertyName = "destinationType",propertyValue = "javax.jms.Queue"),
    @ActivationConfigProperty(propertyName = "acknowledgeMode", propertyValue = "Auto-acknowledge"),
})</pre>

					</p></div></section><section class="section" id="configuring_mdbs_using_deployment_descriptor"><div class="titlepage"><div><div><h3 class="title">4.7.2. Configuring MDBs Using a Deployment Descriptor</h3></div></div></div><p>
					The <code class="literal">&lt;message-driven&gt;</code> element in the <code class="literal">ejb-jar.xml</code> defines the bean as an MDB. The <code class="literal">&lt;activation-config&gt;</code> and elements contain the MDB configuration via the <code class="literal">activation-config-property</code> elements.
				</p><div class="formalpara"><p class="title"><strong>Example <code class="literal">ejb-jar.xml</code></strong></p><p>
						
<pre class="programlisting language-xml">&lt;?xml version="1.1" encoding="UTF-8"?&gt;
&lt;jboss:ejb-jar xmlns:jboss="http://www.jboss.com/xml/ns/javaee"
               xmlns="http://java.sun.com/xml/ns/javaee"
               xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
               xsi:schemaLocation="http://www.jboss.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-2_0.xsd http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/ejb-jar_3_1.xsd"
               version="3.1"&gt;
    &lt;enterprise-beans&gt;
        &lt;message-driven&gt;
            &lt;ejb-name&gt;MyMDBName&lt;/ejb-name&gt;
            &lt;ejb-class&gt;org.jboss.tutorial.mdb_deployment_descriptor.bean.MyMDBName&lt;/ejb-class&gt;
            &lt;activation-config&gt;
                &lt;activation-config-property&gt;
                    &lt;activation-config-property-name&gt;destinationLookup&lt;/activation-config-property-name&gt;
                    &lt;activation-config-property-value&gt;queueA&lt;/activation-config-property-value&gt;
                &lt;/activation-config-property&gt;
                &lt;activation-config-property&gt;
                    &lt;activation-config-property-name&gt;destinationType&lt;/activation-config-property-name&gt;
                    &lt;activation-config-property-value&gt;javax.jms.Queue&lt;/activation-config-property-value&gt;
                &lt;/activation-config-property&gt;
                &lt;activation-config-property&gt;
                    &lt;activation-config-property-name&gt;acknowledgeMode&lt;/activation-config-property-name&gt;
                    &lt;activation-config-property-value&gt;Auto-acknowledge&lt;/activation-config-property-value&gt;
                &lt;/activation-config-property&gt;
            &lt;/activation-config&gt;
        &lt;/message-driven&gt;
    &lt;enterprise-beans&gt;
&lt;/jboss:ejb-jar&gt;</pre>

					</p></div><div class="table" id="idm140640817897504"><p class="title"><strong>Table 4.1. Activation Configuration Properties Defined by JMS Specifications</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 30%; " class="col_1"><!--Empty--></col><col style="width: 70%; " class="col_2"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm140640817892656" scope="col">Name</th><th align="left" valign="top" id="idm140640817891568" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140640817892656"> <p>
									<code class="literal">destinationLookup</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140640817891568"> <p>
									The JNDI name of the queue or topic. This is a mandatory value.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140640817892656"> <p>
									<code class="literal">connectionFactoryLookup</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140640817891568"> <p>
									The lookup name of an administratively defined <code class="literal">javax.jms.ConnectionFactory</code>, <code class="literal">javax.jms.QueueConnectionFactory</code> or <code class="literal">javax.jms.TopicConnectionFactory</code> object that will be used to connect to the JMS provider from which the endpoint would receive messages.
								</p>
								 <p>
									If not defined explicitly, pooled connection factory with name <code class="literal">activemq-ra</code> is used.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140640817892656"> <p>
									<code class="literal">destinationType</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140640817891568"> <p>
									The type of destination valid values are <code class="literal">javax.jms.Queue</code> or <code class="literal">javax.jms.Topic</code>. This is a mandatory value.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140640817892656"> <p>
									<code class="literal">messageSelector</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140640817891568"> <p>
									The value for a <code class="literal">messageSelector</code> property is a string which is used to select a subset of the available messages. Its syntax is based on a subset of the SQL 92 conditional expression syntax and is described in detail in JMS specification. Specifying a value for the <code class="literal">messageSelector</code> property on the <code class="literal">ActivationSpec</code> JavaBean is optional.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140640817892656"> <p>
									<code class="literal">acknowledgeMode</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140640817891568"> <p>
									The type of acknowledgement when not using transacted JMS. Valid values are <code class="literal">Auto-acknowledge</code> or <code class="literal">Dups-ok-acknowledge</code>. This is not a mandatory value.
								</p>
								 <p>
									The default value is <code class="literal">Auto-acknowledge</code>.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140640817892656"> <p>
									<code class="literal">clientID</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140640817891568"> <p>
									The client ID of the connection. This is not a mandatory value.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140640817892656"> <p>
									<code class="literal">subscriptionDurability</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140640817891568"> <p>
									Whether topic subscriptions are durable. Valid values are <code class="literal">Durable</code> or <code class="literal">NonDurable</code>. This is not a mandatory value.
								</p>
								 <p>
									The default value is <code class="literal">NonDurable</code>.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140640817892656"> <p>
									<code class="literal">subscriptionName</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140640817891568"> <p>
									The subscription name of the topic subscription. This is not a mandatory value.
								</p>
								 </td></tr></tbody></table></div></div><div class="table" id="idm140640813220816"><p class="title"><strong>Table 4.2. Activation Configuration Properties Defined by JBoss EAP</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 30%; " class="col_1"><!--Empty--></col><col style="width: 70%; " class="col_2"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm140640813212848" scope="col">Name</th><th align="left" valign="top" id="idm140640813211760" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140640813212848"> <p>
									<code class="literal">destination</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140640813211760"> <p>
									Using this property with <code class="literal">useJNDI=true</code> has the same meaning as <code class="literal">destinationLookup</code>. Using it with <code class="literal">useJNDI=false</code>, the destination is not looked up, but it is instantiated. You can use this property instead of <code class="literal">destinationLookup</code>. This is not a mandatory value.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140640813212848"> <p>
									<code class="literal">shareSubscriptions</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140640813211760"> <p>
									Whether the connection is configured to share subscriptions.
								</p>
								 <p>
									The default value is <code class="literal">False</code>.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140640813212848"> <p>
									<code class="literal">user</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140640813211760"> <p>
									The user for the JMS connection. This is not a mandatory value.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140640813212848"> <p>
									<code class="literal">password</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140640813211760"> <p>
									The password for the JMS connection. This is not a mandatory value.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140640813212848"> <p>
									<code class="literal">maxSession</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140640813211760"> <p>
									The maximum number of concurrent sessions to use. This is not a mandatory value.
								</p>
								 <p>
									The default value is <code class="literal">15</code>.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140640813212848"> <p>
									<code class="literal">transactionTimeout</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140640813211760"> <p>
									The transaction timeout for the session in milliseconds. This is not a mandatory value.
								</p>
								 <p>
									If not specified or 0, the property is ignored and the <code class="literal">transactionTimeout</code> is not overridden and the default <code class="literal">transactionTimeout</code> defined in the Transaction Manager is used.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140640813212848"> <p>
									<code class="literal">useJNDI</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140640813211760"> <p>
									Whether or not use JNDI to look up the destination.
								</p>
								 <p>
									The default value is <code class="literal">True</code>.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140640813212848"> <p>
									<code class="literal">jndiParams</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140640813211760"> <p>
									The JNDI parameters to use in the connection. Parameters are defined as <code class="literal">name=value</code> pairs separated by <code class="literal">;</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140640813212848"> <p>
									<code class="literal">localTx</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140640813211760"> <p>
									Use local transaction instead of XA.
								</p>
								 <p>
									The default value is <code class="literal">False</code>.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140640813212848"> <p>
									<code class="literal">setupAttempts</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140640813211760"> <p>
									Number of attempts to setup a JMS connection. It is possible that the MDB is deployed before the JMS resources are available. In that case, the resource adapter will try to set up several times until the resources are available. This applies only to inbound connections.
								</p>
								 <p>
									The default value is <code class="literal">-1</code>.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140640813212848"> <p>
									<code class="literal">setupInterval</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140640813211760"> <p>
									Interval in milliseconds between consecutive attempts to setup a JMS connection. This applies only to inbound connections.
								</p>
								 <p>
									The default value is <code class="literal">2000</code>.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140640813212848"> <p>
									<code class="literal">rebalanceConnections</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140640813211760"> <p>
									Whether rebalancing of inbound connections is enabled or not. This parameter allows for rebalancing of all inbound connections when the underlying cluster topology changes.
								</p>
								 <p>
									There is no rebalancing for outbound connections.
								</p>
								 <p>
									The default value is <code class="literal">False</code>.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140640813212848"> <p>
									<code class="literal">deserializationWhiteList</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140640813211760"> <p>
									A comma-separated list of entries for the white list, which is the list of trusted classes and packages. This property is used by the JMS resource adapter to allow objects in the list to be deserialized.
								</p>
								 <p>
									For more information, see <a class="link mimir-link-warn" href="https://access.redhat.com/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/configuring_messaging/#controlling_jms_objectmessage_deserialization" title="This content is not included in Mimir.">Controlling JMS ObjectMessage Deserialization</a> in <span class="emphasis"><em>Configuring Messaging</em></span> for JBoss EAP.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm140640813212848"> <p>
									<code class="literal">deserializationBlackList</code>
								</p>
								 </td><td align="left" valign="top" headers="idm140640813211760"> <p>
									A comma-separated list of entries for the black list, which is the list of untrusted classes and packages. This property is used by the JMS resource adapter to prevent objects in the list from being deserialized.
								</p>
								 <p>
									For more information, see <a class="link mimir-link-warn" href="https://access.redhat.com/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/configuring_messaging/#controlling_jms_objectmessage_deserialization" title="This content is not included in Mimir.">Controlling JMS ObjectMessage Deserialization</a> in <span class="emphasis"><em>Configuring Messaging</em></span> for JBoss EAP.
								</p>
								 </td></tr></tbody></table></div></div></section><section class="section" id="some_example_use_cases_for_MDB"><div class="titlepage"><div><div><h3 class="title">4.7.3. Some Example Use Cases for Configuring MDBs</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							Use case for an MDB receiving a message
						</p><p class="simpara">
							For a basic scenario when MDB receives a message, see the <code class="literal">helloworld-mdb</code> quickstart that is shipped with JBoss EAP.
						</p></li><li class="listitem"><p class="simpara">
							Use case for an MDB sending a message
						</p><p class="simpara">
							After processing the message you may need to inform other business systems or reply to the message. In this case, you can send the message from MDB as shown in the snippet below:
						</p><pre class="programlisting language-java">package org.jboss.as.quickstarts.mdb;

import javax.annotation.Resource;
import javax.ejb.ActivationConfigProperty;
import javax.ejb.MessageDriven;
import javax.inject.Inject;
import javax.jms.JMSContext;
import javax.jms.JMSException;
import javax.jms.Message;
import javax.jms.MessageListener;
import javax.jms.Queue;

@MessageDriven(name = "MyMDB", activationConfig = {
    @ActivationConfigProperty(propertyName = "destinationLookup", propertyValue = "queue/MyMDBRequest"),
    @ActivationConfigProperty(propertyName = "destinationType", propertyValue = "javax.jms.Queue"),
    @ActivationConfigProperty(propertyName = "acknowledgeMode", propertyValue = "Auto-acknowledge") })
public class MyMDB implements MessageListener {

    @Inject
    private JMSContext jmsContext;

    @Resource(lookup = "java:/queue/ResponseDefault")
    private Queue defaultDestination;

    /**
     * @see MessageListener#onMessage(Message)
     */
    public void onMessage(Message rcvMessage) {
        try {
            Message response = jmsContext.createTextMessage("Response for message " + rcvMessage.getJMSMessageID());
            if (rcvMessage.getJMSReplyTo() != null) {
                jmsContext.createProducer().send(rcvMessage.getJMSReplyTo(), response);
            } else {
                jmsContext.createProducer().send(defaultDestination, response);
            }
        } catch (JMSException e) {
            throw new RuntimeException(e);
        }
    }
}</pre><p class="simpara">
							In the example above, after the MDB receives the message, it replies to either the destination specified in <code class="literal">JMSReplyTo</code> or the destination which is bound to the JNDI name <code class="literal">java:/queue/ResponseDefault</code>.
						</p></li><li class="listitem"><p class="simpara">
							Use case for an MDB configuring rebalancing of inbound connection
						</p><pre class="programlisting language-java">@MessageDriven(name="MyMDBName",
    activationConfig =
    {
        @ActivationConfigProperty(propertyName = "destinationType",propertyValue = "javax.jms.Queue"),
        @ActivationConfigProperty(propertyName = "destinationLookup", propertyValue = "queueA"),
        @ActivationConfigProperty(propertyName = "rebalanceConnections", propertyValue = "true")
    }
)</pre></li></ul></div></section></section></section><section class="chapter" id="invoking_session_beans"><div class="titlepage"><div><div><h1 class="title">Chapter 5. Invoking Session Beans</h1></div></div></div><section class="section" id="about_ejb_client_contexts"><div class="titlepage"><div><div><h2 class="title">5.1. About EJB Client Contexts</h2></div></div></div><p>
				JBoss EAP introduced the EJB client API for managing remote EJB invocations. The JBoss EJB client API uses the EJBClientContext, which may be associated with and be used by one or more threads concurrently. This means an EJBClientContext can potentially contain any number of EJB receivers. An EJB receiver is a component that knows how to communicate with a server that is capable of handling the EJB invocation. Typically, EJB remote applications can be classified into the following:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						A remote client, which runs as a standalone Java application.
					</li><li class="listitem">
						A remote client, which runs within another JBoss EAP instance.
					</li></ul></div><p>
				Depending on the type of remote client, from an EJB client API point of view, there can potentially be more than one EJBClientContext within a JVM.
			</p><p>
				While standalone applications typically have a single EJBClientContext that may be backed by any number of EJB receivers, this isn’t mandatory. If a standalone application has more than one EJBClientContext, an EJB client context selector is responsible for returning the appropriate context.
			</p><p>
				In case of remote clients that run within another JBoss EAP instance, each deployed application will have a corresponding EJB client context. Whenever that application invokes another EJB, the corresponding EJB client context is used to find the correct EJB receiver, which then handles the invocation.
			</p></section><section class="section" id="using_ejb_client"><div class="titlepage"><div><div><h2 class="title">5.2. Using Remote EJB Clients</h2></div></div></div><section class="section" id="initial_context_lookup"><div class="titlepage"><div><div><h3 class="title">5.2.1. Initial Context Lookup</h3></div></div></div><p>
					You can pass the remote server’s address using the <code class="literal">PROVIDER_URL</code> property when creating an initial context:
				</p><pre class="programlisting language-java">public class Client {
    public static void main(String[] args)
            throws NamingException, PrivilegedActionException, InterruptedException {
        InitialContext ctx = new InitialContext(getCtxProperties());
        String lookupName = "ejb:/server/HelloBean!ejb.HelloBeanRemote";
        HelloBeanRemote bean = (HelloBeanRemote)ctx.lookup(lookupName);
        System.out.println(bean.hello());
        ctx.close();
    }
    public static Properties getCtxProperties() {
        Properties props = new Properties();
        props.put(Context.INITIAL_CONTEXT_FACTORY, WildFlyInitialContextFactory.class.getName());
        props.put(Context.PROVIDER_URL, "remote+http://127.0.0.1:8080");
        props.put(Context.SECURITY_PRINCIPAL, "joe");
        props.put(Context.SECURITY_CREDENTIALS, "joeIsAwesome2013!");
        return props;
    }
}</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						The Initial context factory to be used for the lookup is <code class="literal">org.wildfly.naming.client.WildFlyInitialContextFactory</code>.
					</p></div></div></section><section class="section" id="remote_ejb_configuration_file"><div class="titlepage"><div><div><h3 class="title">5.2.2. Remote EJB Configuration File</h3></div></div></div><p>
					JBoss EAP features the Elytron security framework. The <code class="literal">wildfly-config.xml</code> file, which is present in the <code class="literal">META-INF/</code> directory of the client application’s class path, allows a wide range of authentication and authorization options for the Elytron security framework and EJB client configuration.
				</p><pre class="programlisting language-xml">&lt;configuration&gt;
   &lt;authentication-client xmlns="urn:elytron:client:1.2"&gt;
      &lt;authentication-rules&gt;
         &lt;rule use-configuration="default" /&gt;
      &lt;/authentication-rules&gt;
      &lt;authentication-configurations&gt;
         &lt;configuration name="default"&gt;
            &lt;sasl-mechanism-selector selector="DIGEST-MD5" /&gt;
            &lt;set-user-name name="admin" /&gt;
            &lt;credentials&gt;
               &lt;clear-password password="password123!" /&gt;
            &lt;/credentials&gt;
         &lt;/configuration&gt;
      &lt;/authentication-configurations&gt;
   &lt;/authentication-client&gt;
   &lt;jboss-ejb-client xmlns="urn:jboss:wildfly-client-ejb:3.0"&gt;
      &lt;connections&gt;
         &lt;connection uri="remote+http://127.0.0.1:8080" /&gt;
      &lt;/connections&gt;
   &lt;/jboss-ejb-client&gt;
&lt;/configuration&gt;</pre><p>
					As an alternative to embedding the <code class="literal">PROVIDER_URL</code>, <code class="literal">SECURITY_PRINCIPAL</code> and <code class="literal">SECURITY_CREDENTIALS</code> parameters in the initial context, you can use the <code class="literal">&lt;connection-uri&gt;</code> and <code class="literal">&lt;authentication-client&gt;</code> elements in the <code class="literal">wildfly-config.xml</code> file to configure the connection URI and the security settings, respectively.
				</p></section><section class="section" id="client_transaction_annotation"><div class="titlepage"><div><div><h3 class="title">5.2.3. The ClientTransaction Annotation</h3></div></div></div><p>
					The <code class="literal">@org.jboss.ejb.client.annotation.ClientTransaction</code> annotation handles transaction propagation from an EJB client. You can mandate the propagation to fail if the client has no transaction, or prevent the transaction propagation even if the client has one active. You can use the constants of the <code class="literal">org.jboss.ejb.client.annotation.ClientTransactionPolicy</code> interface to control the policy of the <code class="literal">ClientTransaction</code> annotation. The following are the constants of the <code class="literal">org.jboss.ejb.client.annotation.ClientTransactionPolicy</code> interface:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							MANDATORY: Fail with exception when there is no client-side transaction context; propagate the client-side transaction context when it is present.
						</li><li class="listitem">
							NEVER: Invoke without propagating any transaction context; if a client-side transaction context is present, an exception is thrown.
						</li><li class="listitem">
							NOT_SUPPORTED: Invoke without propagating any transaction context whether or not a client-side transaction context is present.
						</li><li class="listitem">
							SUPPORTS: Invoke without a transaction if there is no client-side transaction context; propagate the client-side transaction context if it is present.
						</li></ul></div><p>
					If no annotation is present, the default policy is <code class="literal">org.jboss.ejb.client.annotation.ClientTransactionPolicy#SUPPORTS</code>, which means that the transaction is propagated if it is present, but the propagation does not fail, regardless of whether a transaction is present or not.
				</p><pre class="programlisting language-java">@ClientTransaction(ClientTransactionPolicy.MANDATORY)
@Remote
public interface RemoteCalculator  {
   public void callRemoteEjb() { }
}
@Stateless
@Remote(RemoteCalculator.class)
public class CalculatorBean implements RemoteCalculator {

   @Override
   public void callRemoteEjb()  {   }
}</pre><p>
					The annotation allows the remote interface provider to tell the remote interface consumer whether transactions are needed for a method.
				</p></section></section><section class="section" id="remote_ejb_data_compression"><div class="titlepage"><div><div><h2 class="title">5.3. Remote EJB Data Compression</h2></div></div></div><p>
				Previous versions of JBoss EAP included a feature where the message stream that contained the EJB protocol message could be compressed. This feature has been included in JBoss EAP 6.3 and later.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Compression currently can only be specified by annotations on the EJB interface which should be on the client and server side. There is not currently an XML equivalent to specify compression hints.
				</p></div></div><p>
				Data compression hints can be specified via the JBoss annotation <code class="literal">org.jboss.ejb.client.annotation.CompressionHint</code>. The hint values specify whether to compress the request, response or request and response. Adding <code class="literal">@CompressionHint</code> defaults to <code class="literal">compressResponse=true</code> and <code class="literal">compressRequest=true</code>.
			</p><p>
				The annotation can be specified at the interface level to apply to all methods in the EJB’s interface such as:
			</p><pre class="programlisting language-java">import org.jboss.ejb.client.annotation.CompressionHint;

@CompressionHint(compressResponse = false)
public interface ClassLevelRequestCompressionRemoteView {
    String echo(String msg);
}</pre><p>
				Or the annotation can be applied to specific methods in the EJB’s interface such as:
			</p><pre class="programlisting language-java">import org.jboss.ejb.client.annotation.CompressionHint;

public interface CompressableDataRemoteView {

    @CompressionHint(compressResponse = false, compressionLevel = Deflater.BEST_COMPRESSION)
    String echoWithRequestCompress(String msg);

    @CompressionHint(compressRequest = false)
    String echoWithResponseCompress(String msg);

    @CompressionHint
    String echoWithRequestAndResponseCompress(String msg);

    String echoWithNoCompress(String msg);
}</pre><p>
				The <code class="literal">compressionLevel</code> setting shown above can have the following values:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						BEST_COMPRESSION
					</li><li class="listitem">
						BEST_SPEED
					</li><li class="listitem">
						DEFAULT_COMPRESSION
					</li><li class="listitem">
						NO_COMPRESSION
					</li></ul></div><p>
				The <code class="literal">compressionLevel</code> setting defaults to <code class="literal">Deflater.DEFAULT_COMPRESSION</code>.
			</p><p>
				Class level annotation with method level overrides:
			</p><pre class="programlisting language-java">@CompressionHint
public interface MethodOverrideDataCompressionRemoteView {

    @CompressionHint(compressRequest = false)
    String echoWithResponseCompress(final String msg);

    @CompressionHint(compressResponse = false)
    String echoWithRequestCompress(final String msg);

    String echoWithNoExplicitDataCompressionHintOnMethod(String msg);
}</pre><p>
				On the client side ensure the <code class="literal">org.jboss.ejb.client.view.annotation.scan.enabled</code> system property is set to <code class="literal">true</code>. This property tells JBoss EJB Client to scan for annotations.
			</p></section><section class="section" id="ejb_client_remoting_interoperability"><div class="titlepage"><div><div><h2 class="title">5.4. EJB Client Remoting Interoperability</h2></div></div></div><p>
				The default remote connection port is <code class="literal">8080</code>. The <code class="literal">jboss-ejb-client</code> properties file looks like this:
			</p><pre class="screen">remote.connectionprovider.create.options.org.xnio.Options.SSL_ENABLED=false
remote.connections=default
remote.connection.default.host=localhost
remote.connection.default.port=8080
remote.connection.default.connect.options.org.xnio.Options.SASL_POLICY_NOANONYMOUS=false</pre><h4 id="default_connector">Default Connector</h4><p>
				The default connector is <code class="literal">http-remoting</code>.
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						If a client application uses the EJB client library from JBoss EAP 6 and wants to connect to a JBoss EAP 7 server, the server must be configured to expose a remoting connector on a port other than <code class="literal">8080</code>. The client must then connect using that newly configured connector.
					</li><li class="listitem"><p class="simpara">
						A client application that uses the EJB client library from JBoss EAP 7 and wants to connect to a JBoss EAP 6 server must be aware that the server instance does not use the <code class="literal">http-remoting</code> connector and instead uses a <code class="literal">remoting</code> connector. This is achieved by defining a new client-side connection property.
					</p><pre class="screen">remote.connection.default.protocol=remote</pre></li></ul></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					EJB remote calls are supported for JBoss EAP 7 with JBoss EAP 6 only.
				</p></div></div><p>
				Besides EJB client remoting interoperability, you can connect to legacy clients using the following options:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<a class="link" href="/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/configuration_guide/index/">Configure the ORB for JTS Transactions</a> in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
					</li></ul></div></section><section class="section" id="configure_iiop_for_remote_ejb_calls"><div class="titlepage"><div><div><h2 class="title">5.5. Configure IIOP for Remote EJB Calls</h2></div></div></div><p>
				JBoss EAP supports CORBA/IIOP-based access to EJBs deployed on JBoss EAP.
			</p><p>
				The <code class="literal">&lt;iiop&gt;</code> element is used to enable IIOP, CORBA, invocation of EJBs. The presence of this element means that the <code class="literal">iiop-openjdk</code> subsystem is installed. The <code class="literal">&lt;iiop&gt;</code> element includes the following two attributes:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">enable-by-default</code>: If this is <code class="literal">true</code>, then all the EJBs with EJB 2.x home interfaces are exposed through IIOP. Otherwise they must be explicitly enabled through <code class="literal">jboss-ejb3.xml</code>.
					</li><li class="listitem">
						<code class="literal">use-qualified-name</code>: If this is <code class="literal">true</code>, then the EJBs are bound to the CORBA naming context with a binding name that contains the application and modules name of the deployment, such as <code class="literal">myear/myejbjar/MyBean</code>. If this is <code class="literal">false</code>, then the default binding name is simply the bean name.
					</li></ul></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Even though a <code class="literal">RemoteHome</code> interface is not normally required for EJB 3 remote calls, it is required for any EJB 3 bean that is exposed using IIOP. You must then enable IIOP using the <code class="literal">jboss-ejb3.xml</code> file, or by enabling IIOP for all EJBs in the <code class="literal">standalone-full.xml</code> configuration file.
				</p></div></div><h4 id="enabling_iiop">Enabling IIOP</h4><p>
				To enable IIOP you must have the IIOP OpenJDK ORB subsystem installed, and the <code class="literal">&lt;iiop/&gt;</code> element present in the <code class="literal">ejb3</code> subsystem configuration. The <code class="literal">standalone-full.xml</code> configuration that comes with the distribution has both of these enabled.
			</p><p>
				IIOP is configured in the <code class="literal">iiop-openjdk</code> subsystem of the server configuration file.
			</p><pre class="programlisting language-xml">&lt;subsystem xmlns="urn:jboss:domain:iiop-openjdk:2.1"&gt;</pre><p>
				Use the following management CLI command to access and update the <code class="literal">iiop-openjdk</code> subsystem.
			</p><pre class="screen">/subsystem=iiop-openjdk</pre><p>
				The IIOP element takes two attributes that control the default behavior of the server.
			</p><pre class="programlisting language-xml">&lt;subsystem xmlns="urn:jboss:domain:ejb3:5.0"&gt;
  ...
  &lt;iiop enable-by-default="false" use-qualified-name="false"/&gt;
  ...
&lt;/subsystem&gt;</pre><p>
				The following management CLI command adds the <code class="literal">&lt;iiop&gt;</code> element under the <code class="literal">ejb3</code> subsystem:
			</p><pre class="screen">/subsystem=ejb3/service=iiop:add(enable-by-default=false, use-qualified-name=false)</pre><h4 id="create_an_ejb_that_communicates_using_iiop">Create an EJB That Communicates Using IIOP</h4><p>
				The following example demonstrates how to make a remote IIOP call from the client:
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Create an EJB 2 bean on the server:
					</p><pre class="programlisting language-java">@Remote(IIOPRemote.class)
@RemoteHome(IIOPBeanHome.class)
@Stateless
public class IIOPBean {
    public String sayHello() throws RemoteException {
         return "hello";
    }
}</pre></li><li class="listitem"><p class="simpara">
						Create a home implementation, which has a mandatory method <code class="literal">create()</code>. This method is called by the client to obtain proxy of remote interface to invoke business methods:
					</p><pre class="programlisting language-java">public interface IIOPBeanHome extends EJBHome {
    public IIOPRemote create() throws RemoteException;
}</pre></li><li class="listitem"><p class="simpara">
						Create a remote interface for remote connection to the EJB:
					</p><pre class="programlisting language-java">public interface IIOPRemote extends EJBObject {
    String sayHello() throws RemoteException;
}</pre></li><li class="listitem"><p class="simpara">
						Introduce the bean for remote call by creating a descriptor file <code class="literal">jboss-ejb3.xml</code> in <code class="literal">META-INF</code>:
					</p><pre class="programlisting language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;jboss:ejb-jar xmlns:jboss="http://www.jboss.com/xml/ns/javaee"
               xmlns="http://java.sun.com/xml/ns/javaee"
               xmlns:iiop="urn:iiop"
               xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
               xsi:schemaLocation="http://www.jboss.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-2_0.xsd
                  http://java.sun.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-spec-2_0.xsd
                  urn:iiop jboss-ejb-iiop_1_0.xsd"
               version="3.1"
               impl-version="2.0"&gt;
    &lt;assembly-descriptor&gt;
        &lt;iiop:iiop&gt;
            &lt;ejb-name&gt;*&lt;/ejb-name&gt;
        &lt;/iiop:iiop&gt;
    &lt;/assembly-descriptor&gt;
&lt;/jboss:ejb-jar&gt;</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							The packed beans along with the descriptor in the JAR file is now ready to be deployed to the JBoss EAP container.
						</p></div></div></li><li class="listitem"><p class="simpara">
						Create a context at the client side:
					</p><pre class="programlisting language-java">System.setProperty("com.sun.CORBA.ORBUseDynamicStub", "true");
final Properties props = new Properties();
props.put(Context.PROVIDER_URL, "corbaloc::localhost:3528/JBoss/Naming/root");
props.setProperty(Context.URL_PKG_PREFIXES, "org.jboss.iiop.naming:org.jboss.naming.client");
props.put(Context.INITIAL_CONTEXT_FACTORY, "com.sun.jndi.cosnaming.CNCtxFactory");
props.put(Context.OBJECT_FACTORIES, "org.jboss.tm.iiop.client.IIOPClientUserTransactionObjectFactory");</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							The client will need to have the <code class="literal">wildfly iiop openjdk</code> library added to its class path. The client might also need to add the <code class="literal">org.wildfly:wildfly-iiop-openjdk</code> artifact as Maven dependency.
						</p></div></div></li><li class="listitem"><p class="simpara">
						Use the context lookup to narrow the reference to the <code class="literal">IIOPBeanHome</code> home interface. Then call the home interface <code class="literal">create()</code> method to access the remote interface, which allows you to call its methods:
					</p><pre class="programlisting language-java">try {
    Context context = new InitialContext(props);

    final Object iiopObj = context.lookup(IIOPBean.class.getSimpleName());
    final IIOPBeanHome beanHome = (IIOPBeanHome) PortableRemoteObject.narrow(iiopObj, IIOPBeanHome.class);
    final IIOPRemote bean = beanHome.create();

    System.out.println("Bean saying: " + bean.sayHello());
} catch (Exception e) {
    e.printStackTrace();
}</pre></li></ol></div></section><section class="section" id="configure_ejb_client_address"><div class="titlepage"><div><div><h2 class="title">5.6. Configure the EJB Client Address</h2></div></div></div><p>
				You can determine the EJB client address using the <code class="literal">SessionContext</code> interface, as shown in the example below.
			</p><pre class="programlisting language-java">public class HelloBean implements HelloBeanRemote {
    @Resource
    SessionContext ctx;
    private Long counter;
    public HelloBean() {
    }
    @PostConstruct
    public void init() {
        counter = 0L;
    }
    @Override
    @RolesAllowed("users")
    public String hello() {
        final String message = "method hello() invoked by user " + ctx.getCallerPrincipal().getName()
                + ", source addr = " +  ctx.getContextData().get("jboss.source-address").toString();
        System.out.println(message);
        return message;
    }
}</pre><h4 id="standalone_client_configuration">Standalone Client Configuration</h4><p>
				You can configure the <code class="literal">outbound-bind-addresses</code> element within the <code class="literal">worker</code> element having namespace <code class="literal">urn:xnio:3.5</code> in the <code class="literal">wildfly-client.xml</code> file. The <code class="literal">bind-address</code> sub-element takes the attributes <code class="literal">match</code>, <code class="literal">bind-address</code>, <code class="literal">bind-port</code>, as defined below.
			</p><p>
				The following is an example of the standalone client configuration using the <code class="literal">wildfly-client.xml</code> file.
			</p><pre class="programlisting language-xml">&lt;configuration&gt;
    &lt;worker xmlns="urn:xnio:3.5"&gt;
        &lt;worker-name value="default"/&gt;
        &lt;outbound-bind-addresses&gt;
            &lt;bind-address bind-address=<span class="emphasis"><em>IP_ADDRESS_TO_BIND_TO</em></span> bind-port=<span class="emphasis"><em>OPTIONAL_SOURCE_PORT_NUMBER</em></span> match=<span class="emphasis"><em>CIDR_BLOCK</em></span> /&gt;
        &lt;/outbound-bind-addresses&gt;
    &lt;/worker&gt;
&lt;/configuration&gt;</pre><p>
				The <code class="literal">outbound-bind-address</code> requires the following attributes:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">match</code> is a Classless Inter-Domain Routing (CIDR) block, such as <code class="literal">10.0.0.0/8</code>, <code class="literal">ff00::\8</code>, <code class="literal">0.0.0.0/0</code>, <code class="literal">::/0</code>.
					</li><li class="listitem">
						<code class="literal">bind-address</code> specifies the IP address to bind to when the destination address matches the CIDR block specified in the <code class="literal">match</code> parameter. It should be the same address family as the CIDR block.
					</li><li class="listitem"><p class="simpara">
						<code class="literal">bind-port</code> is an optional source port number that defaults to <code class="literal">0</code>.
					</p><p class="simpara">
						If no matching expression exists, then the outbound socket is not explicitly bound.
					</p></li></ul></div><h4 id="container_based_configuration">Container-based Configuration</h4><p>
				Container-based configuration of the EJB client address is similar to the standalone client configuration defined in the <code class="literal">wildfly-client.xml</code> file.
			</p><p>
				The example below configures the <code class="literal">outbound-bind-address</code> on the default <code class="literal">worker</code> element of the <code class="literal">io</code> subsystem, which the <code class="literal">ejb3</code> subsystem uses by default.
			</p><pre class="screen">/subsystem=io/worker=default/outbound-bind-address=<span class="emphasis"><em>SPECIFY_OUTBOUND_BIND_ADDRESS</em></span>:add(bind-address=<span class="emphasis"><em>IP_ADDRESS_TO_BIND_TO</em></span>, bind-port=<span class="emphasis"><em>OPTIONAL_SOURCE_PORT_NUMBER</em></span>, match=<span class="emphasis"><em>CIDR_BLOCK</em></span>)</pre></section><section class="section" id="ejb_invocation_over_http"><div class="titlepage"><div><div><h2 class="title">5.7. EJB Invocation Over HTTP</h2></div></div></div><p>
				EJB invocation over HTTP includes two distinct parts: the client-side and the server-side implementations.
			</p><section class="section" id="client_side_implementation"><div class="titlepage"><div><div><h3 class="title">5.7.1. Client-side Implementation</h3></div></div></div><p>
					The client-side implementation consists of an <code class="literal">EJBReceiver</code> that uses the Undertow HTTP client to invoke the server. Connection management is handled automatically using a connection pool.
				</p><p>
					In order to configure an EJB client application to use HTTP transport, you must add the following dependency on the HTTP transport implementation:
				</p><pre class="programlisting language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.wildfly.wildfly-http-client&lt;/groupId&gt;
    &lt;artifactId&gt;wildfly-http-ejb-client&lt;/artifactId&gt;
&lt;/dependency&gt;</pre><p>
					To perform the HTTP invocation, you must use the <code class="literal">http</code> URL scheme and include the context name of the HTTP invoker, <code class="literal">wildfly-services</code>. For example, if you are using <code class="literal">remote+http://localhost:8080</code> as the target URL, in order to use the HTTP transport, you must update this to <code class="literal">http://localhost:8080/wildfly-services</code>.
				</p></section><section class="section" id="server_side_implementation"><div class="titlepage"><div><div><h3 class="title">5.7.2. Server-side Implementation</h3></div></div></div><p>
					The server-side implementation consists of a service that handles the incoming HTTP requests, unmarshals them and passes the result to the internal EJB invocation code.
				</p><p>
					In order to configure the server, the <code class="literal">http-invoker</code> must be enabled on each of the virtual hosts that you wish to use in the <code class="literal">undertow</code> subsystem. This is enabled by default in the standard configurations. If it is disabled, it can be re-enabled using the following management CLI command:
				</p><pre class="screen">/subsystem=undertow/server=default-server/host=default-host/setting=http-invoker:add(http-authentication-factory=myfactory, path="wildfly-services")</pre><p>
					<code class="literal">http-invoker</code> has two attributes: a <code class="literal">path</code> that defaults to <code class="literal">wildfly-services</code>, and one of the following:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							An <code class="literal">http-authentication-factory</code> that must be a reference to an Elytron <code class="literal">http-authentication-factory</code>, as shown in the above command.
						</li><li class="listitem">
							A legacy <code class="literal">security-realm</code>.
						</li></ul></div><p>
					Note that the above two attributes are mutually exclusive: you cannot specify both an <code class="literal">http-authentication-factory</code> and a <code class="literal">security-realm</code> at the same time.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						Any deployment that aims to use the <code class="literal">http-authentication-factory</code> must use Elytron security with the same security domain corresponding to the specified HTTP authentication factory.
					</p></div></div></section></section></section><section class="chapter" id="ejb_application_security"><div class="titlepage"><div><div><h1 class="title">Chapter 6. EJB Application Security</h1></div></div></div><section class="section" id="security_identity"><div class="titlepage"><div><div><h2 class="title">6.1. Security Identity</h2></div></div></div><section class="section" id="about_ejb_security_identity"><div class="titlepage"><div><div><h3 class="title">6.1.1. About EJB Security Identity</h3></div></div></div><p>
					An EJB can specify an identity to use when invoking methods on other components. This is the EJB security identity, also known as invocation identity.
				</p><p>
					By default, the EJB uses its own caller identity. The identity can alternatively be set to a specific security role. Using specific security roles is useful when you want to construct a segmented security model, for example, restricting access to a set of components to internal EJBs only.
				</p></section><section class="section" id="set_the_security_identity_of_an_ejb"><div class="titlepage"><div><div><h3 class="title">6.1.2. Set the Security Identity of an EJB</h3></div></div></div><p>
					The security identity of the EJB is specified through the <code class="literal">&lt;security-identity&gt;</code> tag in the security configuration. If no <code class="literal">&lt;security-identity&gt;</code> tag is present, the caller identity of the EJB is used by default.
				</p><div class="formalpara"><p class="title"><strong>Example: Set the Security Identity of an EJB to Be the Same as Its Caller</strong></p><p>
						This example sets the security identity for method invocations made by an EJB to be the same as the current caller’s identity. This behavior is the default if you do not specify a <code class="literal">&lt;security-identity&gt;</code> element declaration.
					</p></div><pre class="programlisting language-xml">&lt;ejb-jar&gt;
  &lt;enterprise-beans&gt;
     &lt;session&gt;
        &lt;ejb-name&gt;ASessionBean&lt;/ejb-name&gt;
        ...
        &lt;security-identity&gt;
          &lt;use-caller-identity/&gt;
        &lt;/security-identity&gt;
     &lt;/session&gt;
     ...
  &lt;/enterprise-beans&gt;
&lt;/ejb-jar&gt;</pre><div class="formalpara"><p class="title"><strong>Example: Set the Security Identity of an EJB to a Specific Role</strong></p><p>
						To set the security identity to a specific role, use the <code class="literal">&lt;run-as&gt;</code> and <code class="literal">&lt;role-name&gt;</code> tags inside the <code class="literal">&lt;security-identity&gt;</code> tag.
					</p></div><pre class="programlisting language-xml">&lt;ejb-jar&gt;
  &lt;enterprise-beans&gt;
     &lt;session&gt;
        &lt;ejb-name&gt;RunAsBean&lt;/ejb-name&gt;
        ...
        &lt;security-identity&gt;
          &lt;run-as&gt;
             &lt;description&gt;A private internal role&lt;/description&gt;
             &lt;role-name&gt;InternalRole&lt;/role-name&gt;
          &lt;/run-as&gt;
        &lt;/security-identity&gt;
     &lt;/session&gt;
  &lt;/enterprise-beans&gt;
  ...
&lt;/ejb-jar&gt;</pre><p>
					By default, when you use <code class="literal">&lt;run-as&gt;</code>, a principal named <code class="literal">anonymous</code> is assigned to outgoing calls. To assign a different principal, uses the <code class="literal">&lt;run-as-principal&gt;</code>.
				</p><pre class="programlisting language-xml">&lt;session&gt;
    &lt;ejb-name&gt;RunAsBean&lt;/ejb-name&gt;
    &lt;security-identity&gt;
        &lt;run-as-principal&gt;internal&lt;/run-as-principal&gt;
    &lt;/security-identity&gt;
&lt;/session&gt;</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						You can also use the <code class="literal">&lt;run-as&gt;</code> and <code class="literal">&lt;run-as-principal&gt;</code> elements inside a servlet element.
					</p></div></div></section></section><section class="section" id="ejb_method_permissions"><div class="titlepage"><div><div><h2 class="title">6.2. EJB Method Permissions</h2></div></div></div><section class="section" id="about_ejb_method_permissions"><div class="titlepage"><div><div><h3 class="title">6.2.1. About EJB Method Permissions</h3></div></div></div><p>
					EJBs can restrict access to their methods to specific security roles.
				</p><p>
					The EJB <code class="literal">&lt;method-permission&gt;</code> element declaration specifies the roles that can invoke the interface methods of the EJB. You can specify permissions for the following combinations:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							All home and component interface methods of the named EJB
						</li><li class="listitem">
							A specified method of the home or component interface of the named EJB
						</li><li class="listitem">
							A specified method within a set of methods with an overloaded name
						</li></ul></div></section><section class="section" id="use_ejb_method_permissions"><div class="titlepage"><div><div><h3 class="title">6.2.2. Use EJB Method Permissions</h3></div></div></div><p>
					The <code class="literal">&lt;method-permission&gt;</code> element defines the logical roles that are allowed to access the EJB methods defined by <code class="literal">&lt;method&gt;</code> elements. Several examples demonstrate the syntax of the xml. Multiple method permission statements may be present, and they have a cumulative effect. The <code class="literal">&lt;method-permission&gt;</code> element is a child of the <code class="literal">&lt;assembly-descriptor&gt;</code> element of the <code class="literal">&lt;ejb-jar&gt;</code> descriptor.
				</p><p>
					The XML syntax is an alternative to using annotations for EJB method permissions.
				</p><div class="formalpara"><p class="title"><strong>Example: Allow Roles to Access All Methods of an EJB</strong></p><p>
						
<pre class="programlisting language-xml">&lt;method-permission&gt;
  &lt;description&gt;The employee and temp-employee roles may access any method
  of the EmployeeService bean &lt;/description&gt;
  &lt;role-name&gt;employee&lt;/role-name&gt;
  &lt;role-name&gt;temp-employee&lt;/role-name&gt;
  &lt;method&gt;
    &lt;ejb-name&gt;EmployeeService&lt;/ejb-name&gt;
    &lt;method-name&gt;*&lt;/method-name&gt;
  &lt;/method&gt;
&lt;/method-permission&gt;</pre>

					</p></div><div class="formalpara"><p class="title"><strong>Example: Allow Roles to Access Certain Methods of an EJB and Limit Method Parameters</strong></p><p>
						
<pre class="programlisting language-xml">&lt;method-permission&gt;
  &lt;description&gt;The employee role may access the findByPrimaryKey,
  getEmployeeInfo, and the updateEmployeeInfo(String) method of
  the AcmePayroll bean &lt;/description&gt;
  &lt;role-name&gt;employee&lt;/role-name&gt;
  &lt;method&gt;
    &lt;ejb-name&gt;AcmePayroll&lt;/ejb-name&gt;
    &lt;method-name&gt;findByPrimaryKey&lt;/method-name&gt;
  &lt;/method&gt;
  &lt;method&gt;
    &lt;ejb-name&gt;AcmePayroll&lt;/ejb-name&gt;
    &lt;method-name&gt;getEmployeeInfo&lt;/method-name&gt;
  &lt;/method&gt;
  &lt;method&gt;
    &lt;ejb-name&gt;AcmePayroll&lt;/ejb-name&gt;
    &lt;method-name&gt;updateEmployeeInfo&lt;/method-name&gt;
    &lt;method-params&gt;
      &lt;method-param&gt;java.lang.String&lt;/method-param&gt;
    &lt;/method-params&gt;
  &lt;/method&gt;
&lt;/method-permission&gt;</pre>

					</p></div><div class="formalpara"><p class="title"><strong>Example: Allow Any Authenticated User to Access Methods of EJBs</strong></p><p>
						Using the <code class="literal">&lt;unchecked/&gt;</code> element allows any authenticated user to use the specified methods.
					</p></div><pre class="programlisting language-xml">&lt;method-permission&gt;
  &lt;description&gt;Any authenticated user may access any method of the
  EmployeeServiceHelp bean&lt;/description&gt;
  &lt;unchecked/&gt;
  &lt;method&gt;
    &lt;ejb-name&gt;EmployeeServiceHelp&lt;/ejb-name&gt;
    &lt;method-name&gt;*&lt;/method-name&gt;
  &lt;/method&gt;
&lt;/method-permission&gt;</pre><div class="formalpara"><p class="title"><strong>Example: Completely Exclude Specific EJB Methods</strong></p><p>
						
<pre class="programlisting language-xml">&lt;exclude-list&gt;
  &lt;description&gt;No fireTheCTO methods of the EmployeeFiring bean may be
  used in this deployment&lt;/description&gt;
  &lt;method&gt;
    &lt;ejb-name&gt;EmployeeFiring&lt;/ejb-name&gt;
    &lt;method-name&gt;fireTheCTO&lt;/method-name&gt;
  &lt;/method&gt;
&lt;/exclude-list&gt;</pre>

					</p></div><div class="formalpara"><p class="title"><strong>Example: A Complete <code class="literal">&lt;assembly-descriptor&gt;</code> Containing Several <code class="literal">&lt;method-permission&gt;</code> Blocks</strong></p><p>
						
<pre class="programlisting language-xml">&lt;ejb-jar&gt;
    &lt;assembly-descriptor&gt;
        &lt;method-permission&gt;
            &lt;description&gt;The employee and temp-employee roles may access any method of the EmployeeService bean &lt;/description&gt;
            &lt;role-name&gt;employee&lt;/role-name&gt;
            &lt;role-name&gt;temp-employee&lt;/role-name&gt;
            &lt;method&gt;
                &lt;ejb-name&gt;EmployeeService&lt;/ejb-name&gt;
                &lt;method-name&gt;*&lt;/method-name&gt;
            &lt;/method&gt;
        &lt;/method-permission&gt;
        &lt;method-permission&gt;
            &lt;description&gt;The employee role may access the findByPrimaryKey, getEmployeeInfo, and the updateEmployeeInfo(String) method of the AcmePayroll bean &lt;/description&gt;
            &lt;role-name&gt;employee&lt;/role-name&gt;
            &lt;method&gt;
                &lt;ejb-name&gt;AcmePayroll&lt;/ejb-name&gt;
                &lt;method-name&gt;findByPrimaryKey&lt;/method-name&gt;
            &lt;/method&gt;
            &lt;method&gt;
                &lt;ejb-name&gt;AcmePayroll&lt;/ejb-name&gt;
                &lt;method-name&gt;getEmployeeInfo&lt;/method-name&gt;
            &lt;/method&gt;
            &lt;method&gt;
                &lt;ejb-name&gt;AcmePayroll&lt;/ejb-name&gt;
                &lt;method-name&gt;updateEmployeeInfo&lt;/method-name&gt;
                &lt;method-params&gt;
                    &lt;method-param&gt;java.lang.String&lt;/method-param&gt;
                &lt;/method-params&gt;
            &lt;/method&gt;
        &lt;/method-permission&gt;
        &lt;method-permission&gt;
            &lt;description&gt;The admin role may access any method of the EmployeeServiceAdmin bean &lt;/description&gt;
            &lt;role-name&gt;admin&lt;/role-name&gt;
            &lt;method&gt;
                &lt;ejb-name&gt;EmployeeServiceAdmin&lt;/ejb-name&gt;
                &lt;method-name&gt;*&lt;/method-name&gt;
            &lt;/method&gt;
        &lt;/method-permission&gt;
        &lt;method-permission&gt;
            &lt;description&gt;Any authenticated user may access any method of the EmployeeServiceHelp bean&lt;/description&gt;
            &lt;unchecked/&gt;
            &lt;method&gt;
                &lt;ejb-name&gt;EmployeeServiceHelp&lt;/ejb-name&gt;
                &lt;method-name&gt;*&lt;/method-name&gt;
            &lt;/method&gt;
        &lt;/method-permission&gt;
        &lt;exclude-list&gt;
            &lt;description&gt;No fireTheCTO methods of the EmployeeFiring bean may be used in this deployment&lt;/description&gt;
            &lt;method&gt;
                &lt;ejb-name&gt;EmployeeFiring&lt;/ejb-name&gt;
                &lt;method-name&gt;fireTheCTO&lt;/method-name&gt;
            &lt;/method&gt;
        &lt;/exclude-list&gt;
    &lt;/assembly-descriptor&gt;
&lt;/ejb-jar&gt;</pre>

					</p></div></section></section><section class="section" id="ejb_security_annotations"><div class="titlepage"><div><div><h2 class="title">6.3. EJB Security Annotations</h2></div></div></div><section class="section" id="about_ejb_security_annotations"><div class="titlepage"><div><div><h3 class="title">6.3.1. About EJB Security Annotations</h3></div></div></div><p>
					EJB <code class="literal">javax.annotation.security</code> annotations are defined in <a class="link mimir-link-warn" href="https://jcp.org/en/jsr/detail?id=250" title="Mimir does not include content from: jcp.org">JSR-250</a>.
				</p><p>
					EJBs use security annotations to pass information about security to the deployer. These include:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">@DeclareRoles</span></dt><dd>
								Declares which roles are available.
							</dd><dt><span class="term">@RunAs</span></dt><dd>
								Configures the propagated security identity of a component.
							</dd></dl></div></section><section class="section" id="use_ejb_security_annotations"><div class="titlepage"><div><div><h3 class="title">6.3.2. Use EJB Security Annotations</h3></div></div></div><p>
					You can use either XML descriptors or annotations to control which security roles are able to call methods in your Enterprise JavaBeans (EJBs). For information on using XML descriptors, see <a class="link" href="#use_ejb_method_permissions" title="6.2.2. Use EJB Method Permissions">Use EJB Method Permissions</a>.
				</p><p>
					Any method values explicitly specified in the deployment descriptor override annotation values. If a method value is not specified in the deployment descriptor, those values set using annotations are used. The overriding granularity is on a per-method basis.
				</p><div class="variablelist"><p class="title"><strong>Annotations for Controlling Security Permissions of EJBs</strong></p><dl class="variablelist"><dt><span class="term">@DeclareRoles</span></dt><dd>
								Use <code class="literal">@DeclareRoles</code> to define which security roles to check permissions against. If no <code class="literal">@DeclareRoles</code> is present, the list is built automatically from the <code class="literal">@RolesAllowed</code> annotation. For information about configuring roles, see the Java EE tutorial <a class="link mimir-link-warn" href="https://javaee.github.io/tutorial/security-javaee002.html#specifying-authorized-users-by-declaring-security-roles" title="Mimir does not include content from: javaee.github.io">Specifying Authorized Users by Declaring Security Roles</a>.
							</dd><dt><span class="term">@RolesAllowed, @PermitAll, @DenyAll</span></dt><dd>
								Use <code class="literal">@RolesAllowed</code> to list which roles are allowed to access a method or methods. Use <code class="literal">@PermitAll</code> or <code class="literal">@DenyAll</code> to either permit or deny all roles from using a method or methods. For information about configuring annotation method permissions, see the Java EE tutorial <a class="link mimir-link-warn" href="https://javaee.github.io/tutorial/security-javaee002.html#specifying-authorized-users-by-declaring-security-roles" title="Mimir does not include content from: javaee.github.io">Specifying Authorized Users by Declaring Security Roles</a>.
							</dd><dt><span class="term">@RunAs</span></dt><dd>
								Use <code class="literal">@RunAs</code> to specify a role a method uses when making calls from the annotated method. For information about configuring propagated security identities using annotations, see the Java EE tutorial <a class="link mimir-link-warn" href="https://javaee.github.io/tutorial/security-javaee002.html#propagating-a-security-identity-run-as" title="Mimir does not include content from: javaee.github.io">Propagating a Security Identity (Run-As)</a>.
							</dd></dl></div><div class="formalpara"><p class="title"><strong>Example: Security Annotations Example</strong></p><p>
						
<pre class="programlisting language-java">@Stateless
@RolesAllowed({"admin"})
@SecurityDomain("other")
public class WelcomeEJB implements Welcome {
    @PermitAll
    public String WelcomeEveryone(String msg) {
        return "Welcome to " + msg;
    }
    @RunAs("tempemployee")
    public String GoodBye(String msg) {
        return "Goodbye, " + msg;
    }
    public String GoodbyeAdmin(String msg) {
        return "See you later, " + msg;
    }
}</pre>

					</p></div><p>
					In this code, all roles can access method <code class="literal">WelcomeEveryone</code>. The <code class="literal">GoodBye</code> method uses the <code class="literal">tempemployee</code> role when making calls. Only the <code class="literal">admin</code> role can access method <code class="literal">GoodbyeAdmin</code>, and any other methods with no security annotation.
				</p></section></section><section class="section" id="remote_access_to_ejbs"><div class="titlepage"><div><div><h2 class="title">6.4. Remote Access to EJBs</h2></div></div></div><section class="section" id="use_security_realms_with_remote_ejb_clients"><div class="titlepage"><div><div><h3 class="title">6.4.1. Use Security Realms with Remote EJB Clients</h3></div></div></div><p>
					One way to add security to clients which invoke EJBs remotely is to use security realms. A security realm is a simple database of username/password pairs and username/role pairs. The terminology is also used in the context of web containers, with a slightly different meaning.
				</p><p>
					To authenticate a specific username/password pair that exists in a security realm against an EJB, follow these steps:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Add a new security realm to the domain controller or standalone server.
						</li><li class="listitem"><p class="simpara">
							Configure the <code class="literal">wildfly-config.xml</code> file, which is located in the class path of the application, as shown in the following example:
						</p><pre class="programlisting language-xml">&lt;configuration&gt;
   &lt;authentication-client xmlns="urn:elytron:client:1.2"&gt;
      &lt;authentication-rules&gt;
         &lt;rule use-configuration="default" /&gt;
      &lt;/authentication-rules&gt;
      &lt;authentication-configurations&gt;
         &lt;configuration name="default"&gt;
            &lt;sasl-mechanism-selector selector="DIGEST-MD5" /&gt;
            &lt;set-user-name name="admin" /&gt;
            &lt;credentials&gt;
               &lt;clear-password password="password123!" /&gt;
            &lt;/credentials&gt;
         &lt;/configuration&gt;
      &lt;/authentication-configurations&gt;
   &lt;/authentication-client&gt;
   &lt;jboss-ejb-client xmlns="urn:jboss:wildfly-client-ejb:3.0"&gt;
      &lt;connections&gt;
         &lt;connection uri="remote+http://127.0.0.1:8080" /&gt;
      &lt;/connections&gt;
   &lt;/jboss-ejb-client&gt;
&lt;/configuration&gt;</pre></li><li class="listitem">
							Create a custom remoting connector on the domain or standalone server that uses your new security realm.
						</li><li class="listitem">
							Deploy your EJB to the server group which is configured to use the profile with the custom Remoting connector, or to your standalone server if you are not using a managed domain.
						</li></ul></div></section><section class="section" id="add_a_new_security_realm"><div class="titlepage"><div><div><h3 class="title">6.4.2. Add a New Security Realm</h3></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Run the management CLI:
						</p><p class="simpara">
							Execute the <code class="literal">jboss-cli.sh</code> or <code class="literal">jboss-cli.bat</code> script and connect to the server.
						</p></li><li class="listitem"><p class="simpara">
							Create the new security realm itself:
						</p><p class="simpara">
							Run the following command to create a new security realm named <code class="literal">MyDomainRealm</code> on a domain controller or a standalone server.
						</p><p class="simpara">
							For a domain instance, use this command:
						</p><pre class="screen">/host=master/core-service=management/security-realm=MyDomainRealm:add()</pre><p class="simpara">
							For a standalone instance, use this command:
						</p><pre class="screen">/core-service=management/security-realm=MyDomainRealm:add()</pre></li><li class="listitem"><p class="simpara">
							Create a properties file named <code class="literal">myfile.properties</code>:
						</p><p class="simpara">
							For a standalone instance, create a file <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/standalone/configuration/myfile.properties</code> and for a domain instance, create a file <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/domain/configuration/myfile.properties</code>. These files need to have read and write access for the file owner.
						</p><pre class="screen">$ chmod 600 myfile.properties</pre></li><li class="listitem"><p class="simpara">
							Create the references to the properties file which will store information about the new role:
						</p><p class="simpara">
							Run the following command to create a pointer to the <code class="literal">myfile.properties</code> file, which will contain the properties pertaining to the new role.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								The properties file will not be created by the included <code class="literal">add-user.sh</code> and <code class="literal">add-user.bat</code> scripts. It must be created externally.
							</p></div></div><p class="simpara">
							For a domain instance, use this command:
						</p><pre class="screen">/host=master/core-service=management/security-realm=MyDomainRealm/authentication=properties:add(path=myfile.properties)</pre><p class="simpara">
							For a standalone instance, use this command:
						</p><pre class="screen">/core-service=management/security-realm=MyDomainRealm/authentication=properties:add(path=myfile.properties)</pre></li></ol></div><p>
					Your new security realm is created. When you add users and roles to this new realm, the information will be stored in a separate file from the default security realms. You can manage this new file using your own applications or procedures.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						When using the <code class="literal">add-user.sh</code> script to add a user to a non-default file, other than <code class="literal">application-users.properties</code>, you have to pass it the argument <code class="literal">--user-properties myfile.properties</code> otherwise it will try to use <code class="literal">application-users.properties</code>.
					</p></div></div></section><section class="section" id="add_a_user_to_a_security_realm"><div class="titlepage"><div><div><h3 class="title">6.4.3. Add a User to a Security Realm</h3></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Run the <code class="literal">add-user</code> script. Open a terminal and change directories to the <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/bin/</code> directory. If you are on Red Hat Enterprise Linux or any other UNIX-like operating system, run <code class="literal">add-user.sh</code>. If you are on Windows Server, run <code class="literal">add-user.bat</code>.
						</li><li class="listitem">
							Choose whether to add a management user or application user. For this procedure, type <code class="literal">b</code> to add an application user.
						</li><li class="listitem">
							Choose the realm the user will be added to. By default, the only available realm is <code class="literal">ApplicationRealm</code>. If you have added a custom realm, you may add the user to that instead.
						</li><li class="listitem">
							Type the username, password, and roles, when prompted. Type the desired username, password, and optional roles when prompted. Verify your choice by typing <code class="literal">yes</code>, or type <code class="literal">no</code> to cancel the changes. The changes are written to each of the properties files for the security realm.
						</li></ol></div></section><section class="section" id="assigning_security_realm_to_ejb"><div class="titlepage"><div><div><h3 class="title">6.4.4. Relationship Between Security Domains and Security Realms</h3></div></div></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
						For EJBs to be secured by security realms, they have to use a security domain which is configured to retrieve user credentials from the security realm. This means that the domain needs to contain the Remoting and RealmDirect login modules. Assigning a security domain is done by the <code class="literal">@SecurityDomain</code> annotation, which can be applied on an EJB.
					</p></div></div><p>
					The <code class="literal">other</code> security domain retrieves the user and password data from the underlying security realm. This security domain is the default one if there is no <code class="literal">@SecurityDomain</code> annotation on the EJB but the EJB contains any of the other security-related annotations to be considered secured.
				</p><p>
					The underlying <code class="literal">http-remoting connector</code>, which is used by the client to establish a connection, decides which security realm is used. For more information on <code class="literal">http-remoting connector</code>, see <a class="link" href="/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/configuration_guide/index/">About the Remoting Subsystem</a> in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
				</p><p>
					The security realm of the default connector can be changed this way:
				</p><pre class="screen">/subsystem=remoting/http-connector=http-remoting-connector:write-attribute(name=security-realm,value=MyDomainRealm)</pre></section><section class="section" id="about_remote_ejb_access_using_ssl_encryption"><div class="titlepage"><div><div><h3 class="title">6.4.5. About Remote EJB Access Using SSL Encryption</h3></div></div></div><p>
					By default, the network traffic for Remote Method Invocation (RMI) of EJB2 and EJB3 Beans is not encrypted. In instances where encryption is required, Secure Sockets Layer (SSL) can be utilized so that the connection between the client and server is encrypted. Using SSL also has the added benefit of allowing the network traffic to traverse some firewalls, depending on the firewall configuration.
				</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
						Red Hat recommends that SSLv2, SSLv3, and TLSv1.0 be explicitly disabled in favor of TLSv1.1 or TLSv1.2 in all affected packages.
					</p></div></div></section></section><section class="section" id="elytron_integration_ejb_subsystem"><div class="titlepage"><div><div><h2 class="title">6.5. Elytron Integration with the EJB Subsystem</h2></div></div></div><p>
				Starting with JBoss EAP 7.1, it is possible to map deployments so that their security is handled by the <code class="literal">elytron</code> subsystem. If a deployment references a mapped security domain, its security will be handled by Elytron, otherwise its security will be handled by the legacy security subsystem. This mapping is defined in the <code class="literal">ejb</code> subsystem.
			</p><p>
				Within the <code class="literal">ejb</code> subsystem, mappings are created from a security domain name, as referenced within a deployment, to a referenced Elytron security-domain. When a mapped security domain name is configured for a bean in a deployment, this indicates that security should be handled by Elytron. New EJB security interceptors are set up instead of the existing ones.
			</p><p>
				The new EJB security interceptors make use of the Elytron <code class="literal">SecurityDomain</code> associated with the invocation to obtain the current <code class="literal">SecurityIdentity</code> and perform the following tasks:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Establish the <code class="literal">run-as</code> principal.
					</li><li class="listitem">
						Create any extra roles for the <code class="literal">run-as</code> principal.
					</li><li class="listitem">
						Create the <code class="literal">run-as</code> roles.
					</li><li class="listitem">
						Make authorization decisions.
					</li></ul></div><p>
				JBoss EAP 7.1 introduced a new management resource in the <code class="literal">ejb</code> subsystem, <code class="literal">application-security-domains</code>. The <code class="literal">application-security-domains</code> element contains the application security domains that should be mapped to an Elytron security domain.
			</p><div class="table" id="idm140640818121424"><p class="title"><strong>Table 6.1. Attributes of the application-security-domain</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 30%; " class="col_1"><!--Empty--></col><col style="width: 70%; " class="col_2"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm140640818116560" scope="col">Attribute</th><th align="left" valign="top" id="idm140640818115472" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm140640818116560"> <p>
								<code class="literal">name</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140640818115472"> <p>
								This attribute refers to the name of the security domain as specified in a deployment.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140640818116560"> <p>
								<code class="literal">security-domain</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140640818115472"> <p>
								This attribute is a reference to the Elytron security domain that should be used.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140640818116560"> <p>
								<code class="literal">enable-jacc</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140640818115472"> <p>
								This attribute enables authorization using JACC.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm140640818116560"> <p>
								<code class="literal">referencing-deployments</code>
							</p>
							 </td><td align="left" valign="top" headers="idm140640818115472"> <p>
								This is a runtime attribute that lists all deployments currently referencing the ASD.
							</p>
							 </td></tr></tbody></table></div></div><p>
				You can configure the <code class="literal">application-security-domain</code> in the <code class="literal">ejb</code> subsystem in either of the following ways. You can <a class="link" href="#configure_the_application_security_domain_using_the_management_console" title="6.5.1. Configure the Application Security Domain Using the Management Console">use the management console</a>, or you can <a class="link" href="#configure_the_application_security_domain_using_the_management_cli" title="6.5.2. Configure the Application Security Domain Using the Management CLI">use the management CLI</a>.
			</p><section class="section" id="configure_the_application_security_domain_using_the_management_console"><div class="titlepage"><div><div><h3 class="title">6.5.1. Configure the Application Security Domain Using the Management Console</h3></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Access the management console. For more information, see <a class="link" href="/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/configuration_guide/index/">Management Console</a> in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
						</li><li class="listitem">
							Navigate to <span class="strong strong"><strong>Configuration</strong></span> → <span class="strong strong"><strong>Subsystems</strong></span> → <span class="strong strong"><strong>EJB</strong></span> and click <span class="strong strong"><strong>View</strong></span>.
						</li><li class="listitem">
							Select the <span class="strong strong"><strong>Security Domain</strong></span> tab and configure application security domains as necessary.
						</li></ol></div></section><section class="section" id="configure_the_application_security_domain_using_the_management_cli"><div class="titlepage"><div><div><h3 class="title">6.5.2. Configure the Application Security Domain Using the Management CLI</h3></div></div></div><p>
					In the following example, <code class="literal">MyAppSecurity</code> is a security domain that is referenced in the deployment and <code class="literal">ApplicationDomain</code> is an Elytron security domain that has been configured in the <code class="literal">elytron</code> subsystem.
				</p><pre class="screen">/subsystem=ejb3/application-security-domain=MyAppSecurity:add(security-domain=ApplicationDomain)</pre><p>
					The following XML is added to the <code class="literal">ejb</code> subsystem of the server configuration file as a result of this command.
				</p><pre class="programlisting language-xml">&lt;application-security-domains&gt;
    &lt;application-security-domain name="MyAppSecurity" security-domain="ApplicationDomain"/&gt;
&lt;/application-security-domains&gt;</pre><p>
					See the <code class="literal">ejb-security</code> quickstart that ships with JBoss EAP for a simple working example of an EJB that uses Elytron to handle security.
				</p></section></section></section><section class="chapter" id="container_and_client_interceptors"><div class="titlepage"><div><div><h1 class="title">Chapter 7. Container and Client Interceptors</h1></div></div></div><section class="section" id="about_container_interceptors"><div class="titlepage"><div><div><h2 class="title">7.1. About Container Interceptors</h2></div></div></div><p>
				Standard Java EE interceptors, as defined by the <a class="link mimir-link-warn" href="https://jcp.org/en/jsr/detail?id=345" title="Mimir does not include content from: jcp.org">JSR 345, Enterprise JavaBeans 3.2</a> specification, are expected to run after the container has completed security context propagation, transaction management, and other container provided invocation processing. This is a problem if the application must intercept a call before a specific container interceptor is run.
			</p><h4 id="positioning_of_the_container_interceptor_in_the_interceptor_chain">Positioning of the Container Interceptor in the Interceptor Chain</h4><p>
				The container interceptors configured for an EJB are guaranteed to be run before the JBoss EAP provided security interceptors, transaction management interceptors, and other server provided interceptors. This allows specific application container interceptors to process or configure relevant context data before the invocation proceeds.
			</p><h4 id="differences_between_the_container_interceptor_and_the_java_ee_interceptor_api">Differences Between the Container Interceptor and the Java EE Interceptor API</h4><p>
				Although container interceptors are modeled to be similar to Java EE interceptors, there are some differences in the semantics of the API. For example, it is illegal for container interceptors to invoke the <code class="literal">javax.interceptor.InvocationContext.getTarget()</code> method because these interceptors are invoked long before the EJB components are set up or instantiated.
			</p></section><section class="section" id="create_a_container_interceptor_class"><div class="titlepage"><div><div><h2 class="title">7.2. Create a Container Interceptor Class</h2></div></div></div><p>
				Container interceptor classes are simple Plain Old Java Objects (POJOs). They use the <code class="literal">@javax.annotation.AroundInvoke</code> to mark the method that is invoked during the invocation on the bean.
			</p><p>
				The following is an example of a container interceptor class that marks the <code class="literal">iAmAround</code> method for invocation:
			</p><div class="formalpara"><p class="title"><strong>Container Interceptor Code Example</strong></p><p>
					
<pre class="programlisting language-java">public class ClassLevelContainerInterceptor {
    @AroundInvoke
    private Object iAmAround(final InvocationContext invocationContext) throws Exception {
        return this.getClass().getName() + " " + invocationContext.proceed();
    }
}
----</pre>

				</p></div><p>
				For an example of how to configure a <code class="literal">jboss-ejb3.xml</code> descriptor file to use a container interceptor class, see <a class="link" href="#configure_a_container_interceptor" title="7.3. Configure a Container Interceptor">Configure a Container Interceptor</a>.
			</p></section><section class="section" id="configure_a_container_interceptor"><div class="titlepage"><div><div><h2 class="title">7.3. Configure a Container Interceptor</h2></div></div></div><p>
				Container interceptors use the standard Java EE interceptor libraries, meaning they use the same XSD elements that are allowed in <code class="literal">ejb-jar.xml</code> file for the 3.2 version of the ejb-jar deployment descriptor. Because they are based on the standard Java EE interceptor libraries, container interceptors may only be configured using deployment descriptors. This was done by design so applications would not require any JBoss specific annotation or other library dependencies. For more information about container interceptors, see <a class="link" href="#about_container_interceptors" title="7.1. About Container Interceptors">About Container Interceptors</a>.
			</p><p>
				The following procedure describes how to configure a container interceptor.
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Create a <code class="literal">jboss-ejb3.xml</code> file in the <code class="literal">META-INF/</code> directory of the EJB deployment.
					</li><li class="listitem"><p class="simpara">
						Configure the container interceptor elements in the descriptor file.
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								Use the <code class="literal">urn:container-interceptors:1.0</code> namespace to specify configuration of container interceptor elements.
							</li><li class="listitem">
								Use the <code class="literal">&lt;container-interceptors&gt;</code> element to specify the container interceptors.
							</li><li class="listitem"><p class="simpara">
								Use the <code class="literal">&lt;interceptor-binding&gt;</code> elements to bind the container interceptor to the EJBs. The interceptors can be bound in any of the following ways:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										Bind the interceptor to all the EJBs in the deployment using a wildcard (<code class="literal">*</code>).
									</li><li class="listitem">
										Bind the interceptor at the individual bean level using the specific EJB name.
									</li><li class="listitem"><p class="simpara">
										Bind the interceptor at the specific method level for the EJBs.
									</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
											These elements are configured using the EJB 3.2 XSD in the same way it is done for Java EE interceptors.
										</p></div></div></li></ul></div></li></ol></div></li><li class="listitem"><p class="simpara">
						Review the following descriptor file for examples of the above elements.
					</p><div class="formalpara"><p class="title"><strong>Container Interceptor <code class="literal">jboss-ejb3.xml</code> File Example</strong></p><p>
							
<pre class="programlisting language-xml">&lt;jboss xmlns="http://www.jboss.com/xml/ns/javaee"
       xmlns:jee="http://java.sun.com/xml/ns/javaee"
       xmlns:ci ="urn:container-interceptors:1.0"&gt;

    &lt;jee:assembly-descriptor&gt;
        &lt;ci:container-interceptors&gt;
            &lt;!-- Default interceptor --&gt;
            &lt;jee:interceptor-binding&gt;
                &lt;ejb-name&gt;*&lt;/ejb-name&gt;
                &lt;interceptor-class&gt;org.jboss.as.test.integration.ejb.container.interceptor.ContainerInterceptorOne&lt;/interceptor-class&gt;
            &lt;/jee:interceptor-binding&gt;
            &lt;!-- Class level container-interceptor --&gt;
            &lt;jee:interceptor-binding&gt;
                &lt;ejb-name&gt;AnotherFlowTrackingBean&lt;/ejb-name&gt;
                &lt;interceptor-class&gt;org.jboss.as.test.integration.ejb.container.interceptor.ClassLevelContainerInterceptor&lt;/interceptor-class&gt;
            &lt;/jee:interceptor-binding&gt;
            &lt;!-- Method specific container-interceptor --&gt;
            &lt;jee:interceptor-binding&gt;
                &lt;ejb-name&gt;AnotherFlowTrackingBean&lt;/ejb-name&gt;
                &lt;interceptor-class&gt;org.jboss.as.test.integration.ejb.container.interceptor.MethodSpecificContainerInterceptor&lt;/interceptor-class&gt;
                &lt;method&gt;
                    &lt;method-name&gt;echoWithMethodSpecificContainerInterceptor&lt;/method-name&gt;
                &lt;/method&gt;
            &lt;/jee:interceptor-binding&gt;
            &lt;!-- container interceptors in a specific order --&gt;
            &lt;jee:interceptor-binding&gt;
                &lt;ejb-name&gt;AnotherFlowTrackingBean&lt;/ejb-name&gt;
                &lt;interceptor-order&gt;
                    &lt;interceptor-class&gt;org.jboss.as.test.integration.ejb.container.interceptor.ClassLevelContainerInterceptor&lt;/interceptor-class&gt;
                    &lt;interceptor-class&gt;org.jboss.as.test.integration.ejb.container.interceptor.MethodSpecificContainerInterceptor&lt;/interceptor-class&gt;
                    &lt;interceptor-class&gt;org.jboss.as.test.integration.ejb.container.interceptor.ContainerInterceptorOne&lt;/interceptor-class&gt;
                &lt;/interceptor-order&gt;
                &lt;method&gt;
                    &lt;method-name&gt;echoInSpecificOrderOfContainerInterceptors&lt;/method-name&gt;
                &lt;/method&gt;
            &lt;/jee:interceptor-binding&gt;
        &lt;/ci:container-interceptors&gt;
    &lt;/jee:assembly-descriptor&gt;
&lt;/jboss&gt;</pre>

						</p></div></li></ol></div><p>
				The <code class="literal">allow-ejb-name-regex</code> attribute allows you to use regular expressions in interceptor bindings and maps the interceptors to all the beans that match the specified regular expression. Use the following management CLI command to enable the <code class="literal">allow-ejb-name-regex</code> attribute of the <code class="literal">ejb3</code> subsystem to <code class="literal">true</code>:
			</p><pre class="screen">/subsystem=ejb3:write-attribute(name=allow-ejb-name-regex,value=true)</pre><p>
				The schema for the <code class="literal">urn:container-interceptors:1.0</code> namespace is available at <a class="link mimir-link-warn" href="http://www.jboss.org/schema/jbossas/jboss-ejb-container-interceptors_1_0.xsd" title="Mimir does not include content from: www.jboss.org">http://www.jboss.org/schema/jbossas/jboss-ejb-container-interceptors_1_0.xsd</a>.
			</p></section><section class="section" id="change_the_security_context_identity"><div class="titlepage"><div><div><h2 class="title">7.4. Change the Security Context Identity</h2></div></div></div><p>
				By default, when you make a remote call to an EJB that is deployed to the application server, the connection to the server is authenticated and any subsequent requests that use the connection are executed using the original authenticated identity. This is true for both client-to-server and server-to-server calls. If you need to use different identities from the same client, normally you must open multiple connections to the server so that each one is authenticated as a different identity. Rather than open multiple client connections, you can give permission to the authenticated user to switch identities and execute a request on the existing connection as a different user.
			</p><p>
				Interceptors created and configured on the server-side are referred to as container interceptors. Interceptors created and configured on the client-side are referred to as client interceptors. To change the identity of a secured connection, you must create and configure the following three components.
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<a class="link" href="#create_and_configure_the_client_interceptor" title="Create and Configure the Client Interceptor">Client Interceptor</a>
					</li><li class="listitem">
						<a class="link" href="#create_and_configure_the_container_intercepter" title="Create and Configure the Container Interceptor">Container Interceptor</a>
					</li><li class="listitem">
						<a class="link" href="#create_the_jaas_loginmodule" title="Create the JAAS LoginModule">JAAS LoginModule</a>
					</li></ul></div><h4 id="create_and_configure_the_client_interceptor">Create and Configure the Client Interceptor</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Create the client interceptor.
					</p><p class="simpara">
						The client interceptor must implement the <code class="literal">org.jboss.ejb.client.EJBClientInterceptor</code> interface. The interceptor must pass the requested identity through the context data map, which can be obtained by using a call to <code class="literal">EJBClientInvocationContext.getContextData()</code>. The following is an example of a client interceptor that switches identities.
					</p><div class="formalpara"><p class="title"><strong>Client Interceptor Code Example</strong></p><p>
							
<pre class="programlisting language-java">public class ClientSecurityInterceptor implements EJBClientInterceptor {

    public void handleInvocation(EJBClientInvocationContext context) throws Exception {
        Principal currentPrincipal = SecurityActions.securityContextGetPrincipal();

        if (currentPrincipal != null) {
            Map&lt;String, Object&gt; contextData = context.getContextData();
            contextData.put(ServerSecurityInterceptor.DELEGATED_USER_KEY, currentPrincipal.getName());
        }
        context.sendRequest();
    }

    public Object handleInvocationResult(EJBClientInvocationContext context) throws Exception {
        return context.getResult();
    }
}</pre>

						</p></div></li><li class="listitem"><p class="simpara">
						Configure the client interceptor.
					</p><p class="simpara">
						An application can insert a client interceptor into the <code class="literal">EJBClientContext</code> interceptor chain programmatically or by using the service loader mechanism. For instructions to configure a client interceptor, see <a class="link" href="#use_a_client_interceptor_in_an_application" title="7.5. Use a Client Interceptor in an Application">Use a Client Interceptor in an Application</a>.
					</p></li></ol></div><h4 id="create_and_configure_the_container_intercepter">Create and Configure the Container Interceptor</h4><p>
				Container interceptor classes are simple Plain Old Java Objects (POJOs). They use the <code class="literal">@javax.annotation.AroundInvoke</code> annotation to mark the method that should be invoked during the invocation on the bean. For more information about container interceptors, see <a class="link" href="#about_container_interceptors" title="7.1. About Container Interceptors">About Container Interceptors</a>.
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Create the container interceptor.
					</p><p class="simpara">
						This interceptor receives the <code class="literal">InvocationContext</code> containing the identity and makes the request to switch to that new identity. The following is an abridged version of the actual code example:
					</p><div class="formalpara"><p class="title"><strong>Container Interceptor Code Example</strong></p><p>
							
<pre class="programlisting language-java">public class ServerSecurityInterceptor {

    private static final Logger logger = Logger.getLogger(ServerSecurityInterceptor.class);

    static final String DELEGATED_USER_KEY = ServerSecurityInterceptor.class.getName() + ".DelegationUser";

    @AroundInvoke
    public Object aroundInvoke(final InvocationContext invocationContext) throws Exception {
        Principal desiredUser = null;
        UserPrincipal connectionUser = null;

        Map&lt;String, Object&gt; contextData = invocationContext.getContextData();
        if (contextData.containsKey(DELEGATED_USER_KEY)) {
            desiredUser = new SimplePrincipal((String) contextData.get(DELEGATED_USER_KEY));

            Collection&lt;Principal&gt; connectionPrincipals = SecurityActions.getConnectionPrincipals();

            if (connectionPrincipals != null) {
                for (Principal current : connectionPrincipals) {
                    if (current instanceof UserPrincipal) {
                        connectionUser = (UserPrincipal) current;
                        break;
                    }
                }

            } else {
                throw new IllegalStateException("Delegation user requested but no user on connection found.");
            }
        }


        ContextStateCache stateCache = null;
        try {
            if (desiredUser != null &amp;&amp; connectionUser != null
                &amp;&amp; (desiredUser.getName().equals(connectionUser.getName()) == false)) {
                // The final part of this check is to verify that the change does actually indicate a change in user.
                try {
                    // We have been requested to use an authentication token
                    // so now we attempt the switch.
                    stateCache = SecurityActions.pushIdentity(desiredUser, new OuterUserCredential(connectionUser));
                } catch (Exception e) {
                    logger.error("Failed to switch security context for user", e);
                    // Don't propagate the exception stacktrace back to the client for security reasons
                    throw new EJBAccessException("Unable to attempt switching of user.");
                }
            }

            return invocationContext.proceed();
        } finally {
            // switch back to original context
            if (stateCache != null) {
                SecurityActions.popIdentity(stateCache);;
            }
        }
    }</pre>

						</p></div></li><li class="listitem"><p class="simpara">
						Configure the container interceptor.
					</p><p class="simpara">
						For information on how to configure container interceptors, see <a class="link" href="#configure_a_container_interceptor" title="7.3. Configure a Container Interceptor">Configure a Container Interceptor</a>.
					</p></li></ol></div><h4 id="create_the_jaas_loginmodule">Create the JAAS LoginModule</h4><p>
				The JAAS LoginModule component is responsible for verifying that the user is allowed to execute requests as the requested identity. The following abridged code example shows the methods that perform the login and validation:
			</p><div class="formalpara"><p class="title"><strong>LoginModule Code Example</strong></p><p>
					
<pre class="programlisting language-java">    @SuppressWarnings("unchecked")
    @Override
    public boolean login() throws LoginException {
        if (super.login() == true) {
            log.debug("super.login()==true");
            return true;
        }

        // Time to see if this is a delegation request.
        NameCallback ncb = new NameCallback("Username:");
        ObjectCallback ocb = new ObjectCallback("Password:");

        try {
            callbackHandler.handle(new Callback[] { ncb, ocb });
        } catch (Exception e) {
            if (e instanceof RuntimeException) {
                throw (RuntimeException) e;
            }
            // If the CallbackHandler can not handle the required callbacks then no chance.
            return false;
        }

        String name = ncb.getName();
        Object credential = ocb.getCredential();

        if (credential instanceof OuterUserCredential) {
            // This credential type will only be seen for a delegation request, if not seen then the request is not for us.

            if (delegationAcceptable(name, (OuterUserCredential) credential)) {
                identity = new SimplePrincipal(name);
                if (getUseFirstPass()) {
                    String userName = identity.getName();
                    if (log.isDebugEnabled())
                        log.debug("Storing username '" + userName + "' and empty password");
                    // Add the username and an empty password to the shared state map
                    sharedState.put("javax.security.auth.login.name", identity);
                    sharedState.put("javax.security.auth.login.password", "");
                }
                loginOk = true;
                return true;
            }
        }
        return false; // Attempted login but not successful.
    }

    // Make a trust user to decide if the user switch is acceptable.
    protected boolean delegationAcceptable(String requestedUser, OuterUserCredential connectionUser) {
    if (delegationMappings == null) {
        return false;
    }

    String[] allowedMappings = loadPropertyValue(connectionUser.getName(), connectionUser.getRealm());
    if (allowedMappings.length == 1 &amp;&amp; "*".equals(allowedMappings[0])) {
        // A wild card mapping was found.
        return true;
    }
    for (String current : allowedMappings) {
        if (requestedUser.equals(current)) {
            return true;
        }
    }
    return false;
}</pre>

				</p></div></section><section class="section" id="use_a_client_interceptor_in_an_application"><div class="titlepage"><div><div><h2 class="title">7.5. Use a Client Interceptor in an Application</h2></div></div></div><p>
				An application can insert a client interceptor into the <code class="literal">EJBClientContext</code> interceptor chain either programmatically or by using the service loader mechanism.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					An <code class="literal">EJBClientInterceptor</code> can request specific data from the server side invocation context by calling <code class="literal">org.jboss.ejb.client.EJBClientInvocationContext#addReturnedContextDataKey(<span class="emphasis"><em>String key</em></span>)</code>. If the requested data is present under the provided key in the context data map, it is sent to the client.
				</p></div></div><h4 id="insert_the_interceptor_programmatically">Insert the Interceptor Programmatically</h4><p>
				You must create an <code class="literal">EJBClientContext</code> with the interceptor registered.
			</p><pre class="programlisting language-java">EJBClientContext ctxWithInterceptors = EJBClientContext.getCurrent().withAddedInterceptors(clientInterceptor);</pre><p>
				Once you have created the <code class="literal">EJBClientContext</code>, there are two ways to insert the interceptor:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						You can run the following code with <code class="literal">EJBClientContext</code> applied using a <code class="literal">Callable</code> operation. EJB calls performed within the <code class="literal">Callable</code> operation will apply the client-side interceptors:
					</p><pre class="programlisting language-java">ctxWithInterceptors.runCallable(() -&gt; {
    // perform the calls which should use the interceptor
})</pre></li><li class="listitem"><p class="simpara">
						Alternatively you can mark the newly created <code class="literal">EJBClientContext</code> as the new default:
					</p><pre class="programlisting language-java">EJBClientContext.getContextManager().setThreadDefault(ctxWithInterceptors);</pre></li></ul></div><h4 id="insert_the_interceptor_using_the_service_loader_mechanism">Insert the Interceptor Using the Service Loader Mechanism</h4><p>
				Create a <code class="literal">META-INF/services/org.jboss.ejb.client.EJBClientInterceptor</code> file and place or package it in the class path of the client application. The rules for the file are dictated by the <a class="link mimir-link-warn" href="https://docs.oracle.com/javase/8/docs/api/java/util/ServiceLoader.html" title="Mimir does not include content from: docs.oracle.com">Java ServiceLoader Mechanism</a>.
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						This file is expected to contain a separate line for each fully qualified class name of the EJB client interceptor implementation.
					</li><li class="listitem">
						The EJB client interceptor classes must be available in the class path.
					</li></ul></div><p>
				EJB client interceptors that are added using the service loader mechanism are added in the order they are found in the class path and are added to the end of the client interceptor chain.
			</p><h4 id="insert_interceptor_using_client_interceptor_annotation">Insert the Interceptor Using the ClientInterceptors Annotation</h4><p>
				The <code class="literal">@org.jboss.ejb.client.annotation.ClientInterceptors</code> annotation allows you to place the EJB interceptor in the client-side of the remote call:
			</p><pre class="programlisting language-java">import org.jboss.ejb.client.annotation.ClientInterceptors;
@ClientInterceptors({HelloClientInterceptor.class})

public interface HelloBeanRemote {
   public String hello();
}</pre></section></section><section class="chapter" id="clustered_enterprise_javabeans"><div class="titlepage"><div><div><h1 class="title">Chapter 8. Clustered Enterprise JavaBeans</h1></div></div></div><section class="section" id="about_clustered_enterprise_javabeans_ejbs"><div class="titlepage"><div><div><h2 class="title">8.1. About Clustered Enterprise JavaBeans (EJBs)</h2></div></div></div><p>
				EJB components can be clustered for high-availability scenarios. They use different protocols than HTTP components, so they are clustered in different ways. EJB 2 and 3 stateful and stateless beans can be clustered.
			</p><p>
				For information on singletons, see <a class="link" href="/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/development_guide/index/#clustered_ha_singleton_service">HA Singleton Service</a> in the JBoss EAP <span class="emphasis"><em>Development Guide</em></span>
			</p></section><section class="section" id="ejb_client_code_simplification"><div class="titlepage"><div><div><h2 class="title">8.2. EJB Client Code Simplification</h2></div></div></div><p>
				You can simplify the EJB client code when invoking the EJB server-side clustered components. The following procedures outline the multiple ways to simplify the EJB client code:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<a class="link" href="#initial_context_lookup" title="5.2.1. Initial Context Lookup">Initial Context Lookup</a>
					</li><li class="listitem">
						<a class="link" href="#remote_ejb_configuration_file" title="5.2.2. Remote EJB Configuration File">Remote EJB Configuration File</a>
					</li><li class="listitem">
						<a class="link" href="#automatic_transaction_stickiness_for_ejbs" title="8.7. Automatic Transaction Stickiness for EJBs">Automatic Transaction Stickiness for EJBs</a>
					</li><li class="listitem">
						<a class="link" href="#ejb_transactions_in_a_clustered_environment" title="8.11. EJB Transactions in a Clustered Environment">EJB Transactions in a Clustered Environment</a>
					</li></ul></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					The use of the <code class="literal">jboss-ejb-client.properties</code> file is deprecated in favor of the <code class="literal">wildfly-config.xml</code> file.
				</p></div></div></section><section class="section" id="deploying_clustered_ejbs"><div class="titlepage"><div><div><h2 class="title">8.3. Deploying Clustered EJBs</h2></div></div></div><p>
				Clustering support is available in the HA profiles of JBoss EAP 7.3. Starting the standalone server with HA capabilities enabled involves starting it with the <code class="literal">standalone-ha.xml</code> or <code class="literal">standalone-full-ha.xml</code> file:
			</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/standalone.sh --server-config=standalone-ha.xml</pre><p>
				This will start a single instance of the server with HA capabilities.
			</p><p>
				To be able to see the benefits of clustering, you will need more than one instance of the server. So let us start another server with HA capabilities. That another instance of the server can either be on the same machine or on some other machine. If it is on the same machine, you will need to take care of two things:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Pass the port offset for the second instance
					</li><li class="listitem">
						Make sure that each of the server instances have a unique <code class="literal">jboss.node.name</code> system property.
					</li></ul></div><p>
				You can do that by passing the following two system properties to the startup command:
			</p><pre class="screen">$ <span class="emphasis"><em>EAP_HOME</em></span>/bin/standalone.sh --server-config=standalone-ha.xml -Djboss.socket.binding.port-offset=<span class="emphasis"><em>PORT_OFFSET</em></span> -Djboss.node.name=<span class="emphasis"><em>UNIQUE_NODE_NAME</em></span></pre><p>
				Follow whichever approach you feel comfortable with for deploying the EJB deployment to this instance too.
			</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
					Deploying the application on just one node of a standalone instance of a clustered server does not mean that it will be automatically deployed to the other clustered instance. You will have to do deploy it explicitly on the other standalone clustered instance too. Or you can start the servers in domain mode so that the deployment can be deployed to all the servers within a server group.
				</p></div></div><p>
				Now that you have deployed an application with clustered EJBs on both the instances, the EJBs are now capable of making use of the clustering features.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Starting with JBoss EAP 7, if JBoss EAP is started using an HA profile, the state of your stateful session bean will be replicated. You no longer need to use the <code class="literal">@Clustered</code> annotation to enable clustering behavior.
				</p><p>
					You can disable replication for a stateful session bean by setting <code class="literal">passivationCapable</code> to <code class="literal">false</code> in the <code class="literal">@Stateful</code> annotation:
				</p><pre class="programlisting language-java">@Stateful(passivationCapable=false)</pre><p>
					This instructs the server to use the <code class="literal">ejb</code> cache defined by <code class="literal">passivation-disabled-cache-ref</code> instead of <code class="literal">cache-ref</code>.
				</p><p>
					To globally disable the replication of stateful session beans, use the following management CLI command:
				</p><pre class="screen">/subsystem=ejb3:write-attribute(name=default-sfsb-cache,value=simple)</pre></div></div></section><section class="section" id="failover_for_clustered_ejbs"><div class="titlepage"><div><div><h2 class="title">8.4. Failover for Clustered EJBs</h2></div></div></div><p>
				Clustered EJBs have failover capability. The state of the <code class="literal">@Stateful</code> EJBs is replicated across the cluster nodes so that if one of the nodes in the cluster goes down, some other node will be able to take over the invocations.
			</p><p>
				Under some circumstances in a clustered environment, such as when a server in the cluster crashes, the EJB client might receive an exception instead of a response. The EJB client library will automatically retry the invocation when it is safe to do so, depending on the type of the failure that occurs. However, if a request fails and it cannot be determined conclusively to be safe to retry, then you can handle the exception as appropriate for your environment. You can, however, use custom interceptors to add additional retry behavior.
			</p></section><section class="section" id="remote_standalone_clients"><div class="titlepage"><div><div><h2 class="title">8.5. Remote Standalone Clients</h2></div></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					The use of the <code class="literal">jboss-ejb-client.properties</code> file is deprecated in favor of the <code class="literal">wildfly-config.xml</code> file.
				</p></div></div><p>
				A standalone remote client can use either the JNDI approach or native JBoss EJB client APIs to communicate with the servers. The important thing to note is that when you are invoking clustered EJB deployments, you do not have to list all the servers within the cluster. This would not have been feasible due the dynamic nature of cluster node additions within a cluster.
			</p><p>
				The remote client has to list only one of the servers with the clustering capability. This server will act as the starting point for cluster topology communication between the client and the clustered nodes.
			</p><p>
				Note that you have to configure the <code class="literal">ejb</code> cluster in the <code class="literal">jboss-ejb-client.properties</code> configuration file:
			</p><pre class="screen">remote.clusters=ejb
remote.cluster.ejb.connect.options.org.xnio.Options.SASL_POLICY_NOANONYMOUS=false
remote.cluster.ejb.connect.options.org.xnio.Options.SSL_ENABLED=false</pre></section><section class="section" id="cluster_topology_communication"><div class="titlepage"><div><div><h2 class="title">8.6. Cluster Topology Communication</h2></div></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					The use of the <code class="literal">jboss-ejb-client.properties</code> file is deprecated in favor of the <code class="literal">wildfly-config.xml</code> file.
				</p></div></div><p>
				When a client connects to a server, the JBoss EJB client implementation communicates internally with the server for the cluster topology information, if the server has clustering capability. For example, assuming that server X is listed as the initial server to connect to, when the client connects to server X, the server will send back an asynchronous cluster topology message to the client. This topology message consists of the cluster name and the information of the nodes that belong to the cluster. The node information includes the node address and port number to connect to, when required. So in this example, server X will send back the cluster topology consisting of the other server Y that belongs to the cluster.
			</p><p>
				In case of stateful clustered EJBs, the invocation flow happens in two steps.
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Creation of a session for the stateful bean, which happens when you do a JNDI lookup for that bean.
					</li><li class="listitem">
						Invocation of the returned proxy.
					</li></ol></div><p>
				The lookup for the stateful bean, internally, triggers a synchronous session creation request from the client to the server. In this case, the session creation request goes to server X because it was configured in the <code class="literal">jboss-ejb-client.properties</code> file. Since server X is clustered, it will return a session id and send back an <span class="emphasis"><em>affinity</em></span> of that session. In case of clustered servers, the <span class="emphasis"><em>affinity</em></span> is equal to the name of the cluster to which the stateful bean belongs on the server side. For non-clustered beans, the affinity is the node name on which the session was created. This <span class="emphasis"><em>affinity</em></span> will help the EJB client to route the invocations on the proxy, as appropriate, to either a node within a cluster for clustered beans, or to a specific node for non-clustered beans. While this session creation request is going on, server X will also send back an asynchronous message that contains the cluster topology. The JBoss EJB client implementation will record this topology information and use it later for connection creation to nodes within the cluster and routing invocations to those nodes, when required.
			</p><p>
				To understand how failover works, consider the same example of server X being the starting point and a client application looking up a stateful bean and invoking it. During these invocations, the client side collects the cluster topology information from the server. Assuming that for some reason server X goes down and the client application subsequently invokes on the proxy. The JBoss EJB client implementation at this stage must be aware of the <span class="emphasis"><em>affinity</em></span>, and in this case it is the cluster affinity. From the cluster topology information that the client has, it knows that the cluster has two nodes, server X and server Y. When the invocation arrives, the client notices that server X is down, so it uses a selector to fetch a suitable node from the cluster nodes. When the selector returns a node from the cluster nodes, the JBoss EJB client implementation creates a connection to that node, if the connection was not already created earlier, and creates an EJB receiver out of it. Since in this example, the only other node in the cluster is server Y, the selector will return server Y as the node and the JBoss EJB client implementation will use it to create an EJB receiver out of it and use this receiver to pass on the invocation on the proxy. Effectively, the invocation has now failed over to a different node within the cluster.
			</p></section><section class="section" id="automatic_transaction_stickiness_for_ejbs"><div class="titlepage"><div><div><h2 class="title">8.7. Automatic Transaction Stickiness for EJBs</h2></div></div></div><p>
				A transaction object, which is looked up from the same context as the EJB proxy, targets the same host. Having an active transaction pins the invocation context to the same node, if the context is multi-host or clustered.
			</p><p>
				This behavior depends on whether you have outflowed your transaction or you are using a remote user transaction.
			</p><p>
				For an outflowed transaction, when an application is looked up on a specific node, all the invocations to that application under the same transaction attempt to target this node. The nodes that have already received the outflowed transaction will be preferred over nodes that have not received it yet.
			</p><p>
				For a remote user transaction, the first successful invocation will lock the transaction to the given node, and subsequent invocations under this transaction must go to the same node, otherwise an exception is thrown.
			</p></section><section class="section" id="remote_clients_on_another_instance"><div class="titlepage"><div><div><h2 class="title">8.8. Remote Clients on Another Instance</h2></div></div></div><p>
				This section explains how a client application deployed on a JBoss EAP instance invokes a clustered stateful bean that is deployed on another JBoss EAP instance.
			</p><p>
				In the following example, there are three servers involved. Servers X and Y both belong to a cluster and have clustered EJBs deployed on them. There is another server instance server C, which may or may not have clustering capability. Server C acts as a client on which there is a deployment that wants to invoke the clustered beans deployed on servers X and Y and achieve failover.
			</p><p>
				The configurations are done in the <code class="literal">jboss-ejb-client.xml</code> file, which points to a remote outbound connection to the other server. The configuration in the <code class="literal">jboss-ejb-client.xml</code> file is in the deployment of server C because server C is the client. The client configuration need not point to all the clustered nodes, but just to one of them. This will act as a starting point for the communication.
			</p><p>
				In this case, a remote outbound connection is created from server C to server X and then server X is used as the starting point for the communication. Similar to the case of remote standalone clients, when the application on server C looks up a stateful bean, a session creation request is sent to server X that returns a session id and the cluster affinity for it. Server X also sends back an asynchronous message to server C containing the cluster topology. This topology information includes the node information of server Y, because server Y belongs to the cluster along with server X. Subsequent invocations on the proxy will be routed appropriately to the nodes in the cluster. If server X goes down, as explained earlier, a different node from the cluster will be selected and the invocation will be forwarded to that node.
			</p><p>
				Both remote standalone clients as well as remote clients on another JBoss EAP instance act similarly in terms of failover.
			</p></section><section class="section" id="standalone_and_in_server_client_configuration"><div class="titlepage"><div><div><h2 class="title">8.9. Standalone and In-server Client Configuration</h2></div></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					The use of the <code class="literal">jboss-ejb-client.properties</code> file is deprecated in favor of the <code class="literal">wildfly-config.xml</code> file.
				</p></div></div><p>
				To connect an EJB client to a clustered EJB application, you need to expand the existing configuration in standalone EJB client or in-server EJB client to include cluster connection configuration. The <code class="literal">jboss-ejb-client.properties</code> for standalone EJB client, or even <code class="literal">jboss-ejb-client.xml</code> file for a server-side application must be expanded to include a cluster configuration.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					An EJB client is any program that uses an EJB on a remote server. A client is <code class="literal">in-server</code> when the EJB client calling the remote server is itself running inside of a server. In other words, a JBoss EAP instance calling out to another JBoss EAP instance would be considered an in-server client.
				</p></div></div><p>
				This example shows the additional cluster configuration required for a standalone EJB client.
			</p><pre class="programlisting language-xml">remote.clusters=ejb
remote.cluster.ejb.connect.options.org.xnio.Options.SASL_POLICY_NOANONYMOUS=false
remote.cluster.ejb.connect.options.org.xnio.Options.SSL_ENABLED=false
remote.cluster.ejb.username=test
remote.cluster.ejb.password=password</pre><p>
				If an application uses the remote-outbound-connection, you need to configure the <code class="literal">jboss-ejb-client.xml</code> file and add cluster configuration as shown in the following example:
			</p><pre class="programlisting language-xml">&lt;jboss-ejb-client xmlns:xsi="urn:jboss:ejb-client:1.2" xsi:noNamespaceSchemaLocation="jboss-ejb-client_1_2.xsd"&gt;
  &lt;client-context&gt;
    &lt;ejb-receivers&gt;
      &lt;!-- this is the connection to access the app-one --&gt;
      &lt;remoting-ejb-receiver outbound-connection-ref="remote-ejb-connection-1" /&gt;
      &lt;!-- this is the connection to access the app-two --&gt;
      &lt;remoting-ejb-receiver outbound-connection-ref="remote-ejb-connection-2" /&gt;
    &lt;/ejb-receivers&gt;

    &lt;!-- If an outbound connection connects to a cluster,
             a list of members is provided after successful connection.
         To connect to this node this cluster element must be defined. --&gt;

    &lt;clusters&gt;
      &lt;!-- cluster of remote-ejb-connection-1 --&gt;
      &lt;cluster name="ejb" security-realm="ejb-security-realm-1" username="quickuser1"&gt;
        &lt;connection-creation-options&gt;
        &lt;property name="org.xnio.Options.SSL_ENABLED" value="false" /&gt;
        &lt;property name="org.xnio.Options.SASL_POLICY_NOANONYMOUS" value="false" /&gt;
        &lt;/connection-creation-options&gt;
      &lt;/cluster&gt;
    &lt;/clusters&gt;
  &lt;/client-context&gt;
&lt;/jboss-ejb-client&gt;</pre><p>
				For more information about remote-outbound-connection, see <a class="link" href="/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/configuration_guide/index/">About the Remoting Subsystem</a> in the JBoss EAP <span class="emphasis"><em>Configuration Guide</em></span>.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					For a secure connection you need to add the credentials to cluster configuration in order to avoid an authentication exception.
				</p></div></div></section><section class="section" id="implementing_a_custom_load_balancing_policy_for_ejb_calls"><div class="titlepage"><div><div><h2 class="title">8.10. Implementing a Custom Load Balancing Policy for EJB Calls</h2></div></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					The use of the <code class="literal">jboss-ejb-client.properties</code> file is deprecated in favor of the <code class="literal">wildfly-config.xml</code> file.
				</p></div></div><p>
				It is possible to implement an alternate or customized load balancing policy in order to balance an application’s EJB calls across servers.
			</p><p>
				You can implement <code class="literal">AllClusterNodeSelector</code> for EJB calls. The node selection behavior of <code class="literal">AllClusterNodeSelector</code> is similar to default selector except that <code class="literal">AllClusterNodeSelector</code> uses all available cluster nodes even in case of a large cluster (number of nodes &gt; 20). If an unconnected cluster node is returned, it is opened automatically. The following example shows <code class="literal">AllClusterNodeSelector</code> implementation:
			</p><pre class="programlisting language-java">package org.jboss.as.quickstarts.ejb.clients.selector;

import java.util.Arrays;
import java.util.Random;
import java.util.logging.Level;
import java.util.logging.Logger;

import org.jboss.ejb.client.ClusterNodeSelector;
public class AllClusterNodeSelector implements ClusterNodeSelector {
  private static final Logger LOGGER = Logger.getLogger(AllClusterNodeSelector.class.getName());

  @Override
  public String selectNode(final String clusterName, final String[] connectedNodes, final String[] availableNodes) {
    if(LOGGER.isLoggable(Level.FINER)) {
      LOGGER.finer("INSTANCE "+this+ " : cluster:"+clusterName+" connected:"+Arrays.deepToString(connectedNodes)+" available:"+Arrays.deepToString(availableNodes));
    }

    if (availableNodes.length == 1) {
        return availableNodes[0];
    }
    final Random random = new Random();
    final int randomSelection = random.nextInt(availableNodes.length);
    return availableNodes[randomSelection];
  }

}</pre><p>
				You can also implement the <code class="literal">SimpleLoadFactorNodeSelector</code> for EJB calls. Load balancing in <code class="literal">SimpleLoadFactorNodeSelector</code> happens based on a load factor. The load factor (2/3/4) is calculated based on the names of nodes (A/B/C) irrespective of the load on each node. The following example shows <code class="literal">SimpleLoadFactorNodeSelector</code> implementation:
			</p><pre class="programlisting language-java">package org.jboss.as.quickstarts.ejb.clients.selector;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collection;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.logging.Level;
import java.util.logging.Logger;

import org.jboss.ejb.client.DeploymentNodeSelector;
public class SimpleLoadFactorNodeSelector implements DeploymentNodeSelector {
  private static final Logger LOGGER = Logger.getLogger(SimpleLoadFactorNodeSelector.class.getName());
  private final Map&lt;String, List&lt;String&gt;[]&gt; nodes = new HashMap&lt;String, List&lt;String&gt;[]&gt;();
  private final Map&lt;String, Integer&gt; cursor = new HashMap&lt;String, Integer&gt;();

  private ArrayList&lt;String&gt; calculateNodes(Collection&lt;String&gt; eligibleNodes) {
    ArrayList&lt;String&gt; nodeList = new ArrayList&lt;String&gt;();

    for (String string : eligibleNodes) {
      if(string.contains("A") || string.contains("2")) {
        nodeList.add(string);
        nodeList.add(string);
      } else if(string.contains("B") || string.contains("3")) {
        nodeList.add(string);
        nodeList.add(string);
        nodeList.add(string);
      } else if(string.contains("C") || string.contains("4")) {
        nodeList.add(string);
        nodeList.add(string);
        nodeList.add(string);
        nodeList.add(string);
      }
    }
    return nodeList;
  }

  @SuppressWarnings("unchecked")
  private void checkNodeNames(String[] eligibleNodes, String key) {
    if(!nodes.containsKey(key) || nodes.get(key)[0].size() != eligibleNodes.length || !nodes.get(key)[0].containsAll(Arrays.asList(eligibleNodes))) {
      // must be synchronized as the client might call it concurrent
      synchronized (nodes) {
        if(!nodes.containsKey(key) || nodes.get(key)[0].size() != eligibleNodes.length || !nodes.get(key)[0].containsAll(Arrays.asList(eligibleNodes))) {
          ArrayList&lt;String&gt; nodeList = new ArrayList&lt;String&gt;();
          nodeList.addAll(Arrays.asList(eligibleNodes));

          nodes.put(key, new List[] { nodeList, calculateNodes(nodeList) });
        }
      }
    }
  }
   private synchronized String nextNode(String key) {
    Integer c = cursor.get(key);
    List&lt;String&gt; nodeList = nodes.get(key)[1];

    if(c == null || c &gt;= nodeList.size()) {
      c = Integer.valueOf(0);
    }

    String node = nodeList.get(c);
    cursor.put(key, Integer.valueOf(c + 1));

    return node;
  }

  @Override
  public String selectNode(String[] eligibleNodes, String appName, String moduleName, String distinctName) {
    if (LOGGER.isLoggable(Level.FINER)) {
      LOGGER.finer("INSTANCE " + this + " : nodes:" + Arrays.deepToString(eligibleNodes) + " appName:" + appName + " moduleName:" + moduleName
          + " distinctName:" + distinctName);
    }

    // if there is only one there is no sense to choice
    if (eligibleNodes.length == 1) {
      return eligibleNodes[0];
    }
    final String key = appName + "|" + moduleName + "|" + distinctName;

    checkNodeNames(eligibleNodes, key);
    return nextNode(key);
  }
}</pre><h4 id="configuring_the_jboss_ejb_client_properties_file">Configuring the jboss-ejb-client.properties File</h4><p>
				You need to add the property <code class="literal">remote.cluster.ejb.clusternode.selector</code> with the name of your implementation class (<code class="literal">AllClusterNodeSelector</code> or <code class="literal">SimpleLoadFactorNodeSelector</code>). The selector will see all configured servers that are available at the invocation time. The following example uses <code class="literal">AllClusterNodeSelector</code> as the cluster node selector:
			</p><pre class="screen">remote.clusters=ejb
remote.cluster.ejb.clusternode.selector=org.jboss.as.quickstarts.ejb.clients.selector.AllClusterNodeSelector
remote.cluster.ejb.connect.options.org.xnio.Options.SASL_POLICY_NOANONYMOUS=false
remote.cluster.ejb.connect.options.org.xnio.Options.SSL_ENABLED=false
remote.cluster.ejb.username=test
remote.cluster.ejb.password=password

remote.connectionprovider.create.options.org.xnio.Options.SSL_ENABLED=false
remote.connections=one,two
remote.connection.one.host=localhost
remote.connection.one.port = 8080
remote.connection.one.connect.options.org.xnio.Options.SASL_POLICY_NOANONYMOUS=false
remote.connection.one.username=user
remote.connection.one.password=user123
remote.connection.two.host=localhost
remote.connection.two.port = 8180
remote.connection.two.connect.options.org.xnio.Options.SASL_POLICY_NOANONYMOUS=false</pre><h4 id="using_ejb_client_api">Using EJB Client API</h4><p>
				You need to add the property <code class="literal">remote.cluster.ejb.clusternode.selector</code> to the list for the <code class="literal">PropertiesBasedEJBClientConfiguration</code> constructor. The following example uses <code class="literal">AllClusterNodeSelector</code> as the cluster node selector:
			</p><pre class="screen">Properties p = new Properties();
p.put("remote.clusters", "ejb");
p.put("remote.cluster.ejb.clusternode.selector", "org.jboss.as.quickstarts.ejb.clients.selector.AllClusterNodeSelector");
p.put("remote.cluster.ejb.connect.options.org.xnio.Options.SASL_POLICY_NOANONYMOUS", "false");
p.put("remote.cluster.ejb.connect.options.org.xnio.Options.SSL_ENABLED", "false");
p.put("remote.cluster.ejb.username", "test");
p.put("remote.cluster.ejb.password", "password");

p.put("remote.connectionprovider.create.options.org.xnio.Options.SSL_ENABLED", "false");
p.put("remote.connections", "one,two");
p.put("remote.connection.one.port", "8080");
p.put("remote.connection.one.host", "localhost");
p.put("remote.connection.two.port", "8180");
p.put("remote.connection.two.host", "localhost");

EJBClientConfiguration cc = new PropertiesBasedEJBClientConfiguration(p);
ContextSelector&lt;EJBClientContext&gt; selector = new ConfigBasedEJBClientContextSelector(cc);
EJBClientContext.setSelector(selector);

p = new Properties();
p.put(Context.URL_PKG_PREFIXES, "org.jboss.ejb.client.naming");
InitialContext context = new InitialContext(p);</pre><h4 id="configuring_the_jboss_ejb_client_xml_file">Configuring the jboss-ejb-client.xml File</h4><p>
				To use the load balancing policy for server to server communication, package the class together with the application and configure it within the <code class="literal">jboss-ejb-client.xml</code> settings located in <code class="literal">META-INF</code> folder. The following example uses <code class="literal">AllClusterNodeSelector</code> as the cluster node selector:
			</p><pre class="programlisting language-xml">&lt;jboss-ejb-client xmlns:xsi="urn:jboss:ejb-client:1.2" xsi:noNamespaceSchemaLocation="jboss-ejb-client_1_2.xsd"&gt;
  &lt;client-context deployment-node-selector="org.jboss.ejb.client.DeploymentNodeSelector"&gt;
    &lt;ejb-receivers&gt;
      &lt;!-- This is the connection to access the application. --&gt;
      &lt;remoting-ejb-receiver outbound-connection-ref="remote-ejb-connection-1" /&gt;
    &lt;/ejb-receivers&gt;
    &lt;!-- Specify the cluster configurations applicable for this client context --&gt;
    &lt;clusters&gt;
      &lt;!-- Configure the cluster of remote-ejb-connection-1. --&gt;
      &lt;cluster name="ejb" security-realm="ejb-security-realm-1" username="test" cluster-node-selector="org.jboss.as.quickstarts.ejb.clients.selector.AllClusterNodeSelector"&gt;
        &lt;connection-creation-options&gt;
          &lt;property name="org.xnio.Options.SSL_ENABLED" value="false" /&gt;
          &lt;property name="org.xnio.Options.SASL_POLICY_NOANONYMOUS" value="false" /&gt;
        &lt;/connection-creation-options&gt;
      &lt;/cluster&gt;
    &lt;/clusters&gt;
  &lt;/client-context&gt;
&lt;/jboss-ejb-client&gt;</pre><p>
				To use the above configuration with security, you will need to add <code class="literal">ejb-security-realm-1</code> to client-server configuration. The following example shows the CLI commands for adding security realm (<code class="literal">ejb-security-realm-1</code>) the value is the base64 encoded password for the user "test":
			</p><pre class="screen">/core-service=management/security-realm=ejb-security-realm-1:add()
/core-service=management/security-realm=ejb-security-realm-1/server-identity=secret:add(value=cXVpY2sxMjMr)</pre><p>
				If the load balancing policy should be used for server to server communication, the class can be packaged together with the application or as a module. This class is configured in the <code class="literal">jboss-ejb-client</code> settings file located in the <code class="literal">META-INF</code> directory of the top-level EAR archive. The following example uses <code class="literal">RoundRobinNodeSelector</code> as the deployment node selector.
			</p><pre class="programlisting language-xml">&lt;jboss-ejb-client xmlns="urn:jboss:ejb-client:1.2"&gt;
    &lt;client-context deployment-node-selector="org.jboss.example.RoundRobinNodeSelector"&gt;
        &lt;ejb-receivers&gt;
            &lt;remoting-ejb-receiver outbound-connection-ref="..."/&gt;
        &lt;/ejb-receivers&gt;
        ...
    &lt;/client-context&gt;
&lt;/jboss-ejb-client&gt;</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					If you are running a standalone server, use the start option <code class="literal">-Djboss.node.name=</code> or the server configuration file <code class="literal">standalone.xml</code> to configure the server name. Ensure that the server name is unique. If you are running a managed domain, the host controller automatically validates that the names are unique.
				</p></div></div></section><section class="section" id="ejb_transactions_in_a_clustered_environment"><div class="titlepage"><div><div><h2 class="title">8.11. EJB Transactions in a Clustered Environment</h2></div></div></div><p>
				If the client code invokes a clustered EJB, then the cluster affinity is set automatically. If you manage transactions on the client side, you can choose to <a class="link" href="#ejb_transactions_target_a_specific_node" title="EJB Transactions Target a Specific Node">target a specific node in the cluster</a> or you can <a class="link" href="#ejb_transactions_lazily_select_a_node" title="EJB Transactions Lazily Select a Node">allow the client to lazily select the cluster node</a> to handle transactions. This section describes both options.
			</p><h4 id="ejb_transactions_target_a_specific_node">EJB Transactions Target a Specific Node</h4><p>
				You can target a specific node in the cluster to handle a transaction using the following procedure.
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Specify the target cluster node address using the <code class="literal">PROVIDER_URL</code> property when creating the <code class="literal">InitialContext</code>.
					</p><pre class="programlisting language-java">props.put(Context.PROVIDER_URL, "remote+http://127.0.0.1:8080");
...
InitialContext ctx = new InitialContext(props);</pre></li><li class="listitem"><p class="simpara">
						In the client, look up the <code class="literal">txn:RemoteUserTransaction</code> from the <code class="literal">InitialContext</code>.
					</p><pre class="programlisting language-java">UserTransaction ut = (UserTransaction)ctx.lookup("txn:RemoteUserTransaction");</pre><p class="simpara">
						You can do a JNDI lookup for a <code class="literal">UserTransaction</code> by setting the <code class="literal">PROVIDER_URL</code> property to the URL of the server and then look up <code class="literal">txn:UserTransaction</code>, as shown in the code example below:
					</p><pre class="programlisting language-java">final Hashtable&lt;String, String&gt; jndiProperties = new Hashtable&lt;&gt;();
jndiProperties.put(Context.INITIAL_CONTEXT_FACTORY, "org.wildfly.naming.client.WildFlyInitialContextFactory");
jndiProperties.put(Context.PROVIDER_URL, "remote+http://localhost:8080");
final Context context = new InitialContext(jndiProperties);

SecuredEJBRemote reference = (SecuredEJBRemote) context.lookup("txn:UserTransaction");</pre><p class="simpara">
						<code class="literal">UserTransaction</code> is not bound to any particular destination until an actual invocation takes place. Upon invocation, this <code class="literal">UserTransaction</code> is bound to the respective destination for the entire lifetime of the transaction.
					</p><p class="simpara">
						You do not need to know the node name or the destination before beginning a <code class="literal">UserTransaction</code>. The <code class="literal">org.jboss.ejb.client.EJBClient.getUserTransaction()</code> method gives you a remote <code class="literal">UserTransaction</code> that automatically selects its destination based on the first invocation. Looking up a remote <code class="literal">UserTransaction</code> from JNDI also works the same way.
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							The <code class="literal">org.jboss.ejb.client.EJBClient.getUserTransaction()</code> method is deprecated.
						</p></div></div></li><li class="listitem">
						When the transaction begins, all EJB invocations are then bound to that specific node for duration of the transaction, establishing server affinity.
					</li><li class="listitem">
						When the transaction ends, the server affinity is released, and the EJB proxies return to a general cluster affinity.
					</li></ol></div><h4 id="ejb_transactions_lazily_select_a_node">EJB Transactions Lazily Select a Node</h4><p>
				You can allow the client to lazily select the cluster node to handle transactions during the first invocation pertaining to a transaction. This allows for load balancing of transactions across the cluster. To use this option, follow the procedure below.
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Do not specify the <code class="literal">PROVIDER_URL</code> property in the <code class="literal">InitialContext</code> used to invoke the EJBs.
					</li><li class="listitem"><p class="simpara">
						In the client, look up the <code class="literal">txn:RemoteUserTransaction</code> from the <code class="literal">InitialContext</code>.
					</p><pre class="programlisting language-java">UserTransaction ut = (UserTransaction)ctx.lookup("txn:RemoteUserTransaction");</pre></li><li class="listitem">
						When the transaction begins, one cluster node is selected automatically, establishing server affinity, and all EJB invocations are then bound to that specific node for duration of the transaction.
					</li><li class="listitem">
						When the transaction ends, the server affinity is released, and the EJB proxies return to a general cluster affinity.
					</li></ol></div></section></section><section class="chapter" id="tuning_ejb_subsystem"><div class="titlepage"><div><div><h1 class="title">Chapter 9. Tuning the EJB 3 Subsystem</h1></div></div></div><p>
			For tips on optimizing performance for the <code class="literal">ejb3</code> subsystem, see the <a class="link mimir-link-warn" href="https://access.redhat.com/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/performance_tuning_guide/#ejb_subsystem_tuning" title="This content is not included in Mimir.">EJB Subsystem Tuning</a> section of the <span class="emphasis"><em>Performance Tuning Guide</em></span>.
		</p></section><section class="appendix" id="reference_material"><div class="titlepage"><div><div><h1 class="title">Appendix A. Reference Material</h1></div></div></div><section class="section" id="ejb_jndi_naming_reference"><div class="titlepage"><div><div><h2 class="title">A.1. EJB JNDI Naming Reference</h2></div></div></div><p>
				The JNDI lookup name for a session bean uses the following syntax:
			</p><pre class="screen">ejb:&lt;appName&gt;/&lt;moduleName&gt;/&lt;distinctName&gt;/&lt;beanName&gt;!&lt;viewClassName&gt;?stateful</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">&lt;appName&gt;</code>: If the session bean’s JAR file has been deployed within an enterprise archive (EAR) then the <code class="literal">appName</code> is the name of the respective EAR. By default, the name of an EAR is its file name without the <code class="literal">.ear</code> suffix. The application name can be overridden in its <code class="literal">application.xml</code> file. If the session bean is not deployed in an EAR, then leave the <code class="literal">appName</code> blank.
					</li><li class="listitem">
						<code class="literal">&lt;moduleName&gt;</code>: The <code class="literal">moduleName</code> is the name of the JAR file in which the session bean is deployed. The default name of the JAR file is its file name without the <code class="literal">.jar</code> suffix. The module name can be overridden in the JAR’s <code class="literal">ejb-jar.xml</code> file.
					</li><li class="listitem">
						<code class="literal">&lt;distinctName&gt;</code>: JBoss EAP allows each deployment to specify an optional distinct name. If the deployment does not have a distinct name, then leave the <code class="literal">distinctName</code> blank.
					</li><li class="listitem">
						<code class="literal">&lt;beanName&gt;</code>: The <code class="literal">beanName</code> is the simple class name of the session bean to be invoked.
					</li><li class="listitem">
						<code class="literal">&lt;viewClassName&gt;</code>: The <code class="literal">viewClassName</code> is the fully qualified class name of the remote interface. This includes the package name of the interface.
					</li><li class="listitem">
						<code class="literal">?stateful</code>: The <code class="literal">?stateful</code> suffix is required when the JNDI name refers to a stateful session bean. It is not included for other bean types.
					</li></ul></div><p>
				For example, if we deployed <code class="literal">hello.jar</code> having a stateful bean <code class="literal">org.jboss.example.HelloBean</code> that exposed a remote interface <code class="literal">org.jboss.example.Hello</code>, then the JNDI lookup name would be:
			</p><pre class="screen">ejb:/hello/HelloBean!org.jboss.example.Hello?stateful"</pre></section><section class="section" id="ejb_reference_resolution"><div class="titlepage"><div><div><h2 class="title">A.2. EJB Reference Resolution</h2></div></div></div><p>
				This section covers how JBoss EAP implements <code class="literal">@EJB</code> and <code class="literal">@Resource</code>. Please note that XML always overrides annotations but the same rules apply.
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Rules for the @EJB annotation</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									The <code class="literal">@EJB</code> annotation also has a <code class="literal">mappedName()</code> attribute. The specification leaves this as vendor specific metadata, but JBoss EAP recognizes <code class="literal">mappedName()</code> as the global JNDI name of the EJB you are referencing. If you have specified a <code class="literal">mappedName()</code>, then all other attributes are ignored and this global JNDI name is used for binding.
								</li><li class="listitem"><p class="simpara">
									If you specify <code class="literal">@EJB</code> with no attributes defined:
								</p><pre class="programlisting language-java">@EJB
ProcessPayment myEjbref;</pre><p class="simpara">
									Then the following rules apply:
								</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
											The EJB JAR of the referencing bean is searched for an EJB with the interface used in the <code class="literal">@EJB</code> injection. If there are more than one EJB that publishes same business interface, then an exception is thrown. If there is only one bean with that interface then that one is used.
										</li><li class="listitem">
											Search the EAR for EJBs that publish that interface. If there are duplicates, then an exception is thrown. Otherwise the matching bean is returned.
										</li><li class="listitem">
											Search globally in JBoss EAP runtime for an EJB of that interface. Again, if duplicates are found, an exception is thrown.
										</li></ul></div></li><li class="listitem">
									<code class="literal">@EJB.beanName()</code> corresponds to <code class="literal">&lt;ejb-link&gt;</code>. If the <code class="literal">beanName()</code> is defined, then use the same algorithm as <code class="literal">@EJB</code> with no attributes defined except use the <code class="literal">beanName()</code> as a key in the search. An exception to this rule is if you use the ejb-link <span class="strong strong"><strong>#</strong></span> syntax: it allows you to put a relative path to a JAR in the EAR where the EJB you are referencing is located. Refer to the EJB 3.2 specification for more details.
								</li></ul></div></dd></dl></div></section><section class="section" id="project_dependencies_for_remote_ejb_clients"><div class="titlepage"><div><div><h2 class="title">A.3. Project Dependencies for Remote EJB Clients</h2></div></div></div><p>
				Maven projects that include the invocation of session beans from remote clients require the following dependencies from the JBoss EAP Maven repository. There are two ways to declare EJB client dependencies, as described in the sub-sections below.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					The <code class="literal">artifactId</code> versions are subject to change. See the <a class="link mimir-link-warn" href="https://maven.repository.redhat.com/ga/" title="Mimir does not include content from: maven.repository.redhat.com">JBoss EAP Maven Repository</a> for the latest versions.
				</p></div></div><h4 id="maven_dependencies_for_remote_ejb_clients">Maven Dependencies for Remote EJB Clients</h4><p>
				The <code class="literal">jboss-eap-javaee8</code> Bill of Materials (BOM) packages the correct version of many of the artifacts commonly required by a JBoss EAP application. The BOM dependency is specified in the <code class="literal">&lt;dependencyManagement&gt;</code> section of the <code class="literal">pom.xml</code> with the scope of <code class="literal">import</code>.
			</p><div class="formalpara"><p class="title"><strong>Example: POM File <code class="literal">&lt;dependencyManagement&gt;</code> Section</strong></p><p>
					
<pre class="programlisting language-xml">&lt;dependencyManagement&gt;
   &lt;dependencies&gt;
      &lt;dependency&gt;
      &lt;groupId&gt;org.jboss.bom&lt;/groupId&gt;
        &lt;artifactId&gt;jboss-eap-javaee8&lt;/artifactId&gt;
        &lt;version&gt;7.3.0.CD18&lt;/version&gt;
        &lt;type&gt;pom&lt;/type&gt;
        &lt;scope&gt;import&lt;/scope&gt;
      &lt;/dependency&gt;
   &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;</pre>

				</p></div><p>
				The remaining dependencies are specified in the <code class="literal">&lt;dependencies&gt;</code> section of the <code class="literal">pom.xml</code> file.
			</p><div class="formalpara"><p class="title"><strong>Example: POM File <code class="literal">&lt;dependencies&gt;</code> Section</strong></p><p>
					
<pre class="programlisting language-xml">&lt;dependencies&gt;
    &lt;!-- Include the EJB client JARs --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.jboss.eap&lt;/groupId&gt;
        &lt;artifactId&gt;wildfly-ejb-client-bom&lt;/artifactId&gt;
        &lt;type&gt;pom&lt;/type&gt;
    &lt;/dependency&gt;

    &lt;!-- Include any additional dependencies required by the application
        ...
    --&gt;

&lt;/dependencies&gt;</pre>

				</p></div><p>
				The <code class="literal">ejb-remote</code> quickstart that ships with JBoss EAP provides a complete working example of remote EJB client application. See the <code class="literal">client/pom.xml</code> file located in root directory of that quickstart for a complete example of dependency configuration for remote session bean invocation.
			</p><h4 id="single_artifactid_for_jboss_ejb_client_dependencies">Single artifactID for jboss-ejb-client Dependencies</h4><p>
				You can use the <code class="literal">wildfly-ejb-client-bom</code> <code class="literal">artifactID</code> and add the <code class="literal">jboss-ejb-client</code> library to include all the required dependencies for EJB clients:
			</p><pre class="programlisting language-xml">&lt;dependencyManagement&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.jboss.eap&lt;/groupId&gt;
            &lt;artifactId&gt;wildfly-ejb-client-bom&lt;/artifactId&gt;
            &lt;version&gt;<span class="emphasis"><em>EJB_CLIENT_BOM_VERSION</em></span>&lt;/version&gt;
            &lt;type&gt;pom&lt;/type&gt;
            &lt;scope&gt;import&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;
&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.jboss&lt;/groupId&gt;
        &lt;artifactId&gt;jboss-ejb-client&lt;/artifactId&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</pre><p>
				You must use the <span class="emphasis"><em>EJB_CLIENT_BOM_VERSION</em></span> that is available in the JBoss EAP Maven repository.
			</p></section><section class="section" id="jboss_ejb3_xml_deployment_descriptor_reference"><div class="titlepage"><div><div><h2 class="title">A.4. jboss-ejb3.xml Deployment Descriptor Reference</h2></div></div></div><p>
				<code class="literal">jboss-ejb3.xml</code> is a custom deployment descriptor that can be used in either EJB JAR or WAR archives. In an EJB JAR archive it must be located in the <code class="literal">META-INF/</code> directory. In a WAR archive it must be located in the <code class="literal">WEB-INF/</code> directory.
			</p><p>
				The format is similar to <code class="literal">ejb-jar.xml</code>, using some of the same namespaces and providing some other additional namespaces. The contents of <code class="literal">jboss-ejb3.xml</code> are merged with the contents of <code class="literal">ejb-jar.xml</code>, with the <code class="literal">jboss-ejb3.xml</code> items taking precedence.
			</p><p>
				This document only covers the additional non-standard namespaces used by <code class="literal">jboss-ejb3.xml</code>. See <a class="link mimir-link-warn" href="http://java.sun.com/xml/ns/javaee/" title="Mimir does not include content from: java.sun.com">http://java.sun.com/xml/ns/javaee/</a> for documentation on the standard namespaces.
			</p><p>
				The root namespace is <a class="link mimir-link-warn" href="http://www.jboss.com/xml/ns/javaee" title="Mimir does not include content from: www.jboss.com">http://www.jboss.com/xml/ns/javaee</a>.
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Assembly descriptor namespaces</span></dt><dd>
							The following namespaces can all be used in the <code class="literal">&lt;assembly-descriptor&gt;</code> element. They can be used to apply their configuration to a single bean, or to all beans in the deployment by using a wildcard (<code class="literal">*</code>) as the <code class="literal">ejb-name</code>.
						</dd><dt><span class="term">The security namespace (<code class="literal">urn:security</code>)</span></dt><dd><pre class="programlisting language-xml">xmlns:s="urn:security"</pre><p class="simpara">
							This allows you to set the <code class="literal">security-domain</code> and the <code class="literal">run-as-principal</code> for an EJB.
						</p><pre class="programlisting language-xml">&lt;s:security&gt;
  &lt;ejb-name&gt;*&lt;/ejb-name&gt;
  &lt;s:security-domain&gt;myDomain&lt;/s:security-domain&gt;
  &lt;s:run-as-principal&gt;myPrincipal&lt;/s:run-as-principal&gt;
&lt;/s:security&gt;</pre></dd><dt><span class="term">The resource adapter namespace: <code class="literal">urn:resource-adapter-binding</code></span></dt><dd><pre class="programlisting language-xml">xmlns:r="urn:resource-adapter-binding"</pre><p class="simpara">
							This allows you to set the resource adapter for a Message-Driven Bean.
						</p><pre class="programlisting language-xml">&lt;r:resource-adapter-binding&gt;
  &lt;ejb-name&gt;*&lt;/ejb-name&gt;
  &lt;r:resource-adapter-name&gt;myResourceAdapter&lt;/r:resource-adapter-name&gt;
&lt;/r:resource-adapter-binding&gt;</pre></dd><dt><span class="term">The IIOP namespace: <code class="literal">urn:iiop</code></span></dt><dd><pre class="programlisting language-xml">xmlns:u="urn:iiop"</pre><p class="simpara">
							The IIOP namespace is where IIOP settings are configured.
						</p></dd><dt><span class="term">The pool namespace: <code class="literal">urn:ejb-pool:1.0</code></span></dt><dd><pre class="programlisting language-xml">xmlns:p="urn:ejb-pool:1.0"</pre><p class="simpara">
							This allows you to select the pool that is used by the included stateless session beans or Message-Driven Beans. Pools are defined in the server configuration.
						</p><pre class="programlisting language-xml">&lt;p:pool&gt;
   &lt;ejb-name&gt;*&lt;/ejb-name&gt;
   &lt;p:bean-instance-pool-ref&gt;my-pool&lt;/p:bean-instance-pool-ref&gt;
&lt;/p:pool&gt;</pre></dd><dt><span class="term">The cache namespace: <code class="literal">urn:ejb-cache:1.0</code></span></dt><dd><pre class="programlisting language-xml">xmlns:c="urn:ejb-cache:1.0"</pre><p class="simpara">
							This allows you to select the cache that is used by the included stateful session beans. Caches are defined in the server configuration.
						</p><pre class="programlisting language-xml">&lt;c:cache&gt;
   &lt;ejb-name&gt;*&lt;/ejb-name&gt;
   &lt;c:cache-ref&gt;my-cache&lt;/c:cache-ref&gt;
&lt;/c:cache&gt;</pre><pre class="programlisting language-xml">&lt;?xml version="1.1" encoding="UTF-8"?&gt;
&lt;jboss:ejb-jar xmlns:jboss="http://www.jboss.com/xml/ns/javaee"
    xmlns="http://java.sun.com/xml/ns/javaee"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.jboss.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-2_0.xsd"
    version="3.1"
    impl-version="2.0"&gt;
  &lt;enterprise-beans&gt;
     &lt;message-driven&gt;
        &lt;ejb-name&gt;ReplyingMDB&lt;/ejb-name&gt;
        &lt;ejb-class&gt;org.jboss.as.test.integration.ejb.mdb.messagedestination.ReplyingMDB&lt;/ejb-class&gt;
        &lt;activation-config&gt;
           &lt;activation-config-property&gt;
              &lt;activation-config-property-name&gt;destination&lt;/activation-config-property-name&gt;
              &lt;activation-config-property-value&gt;java:jboss/mdbtest/messageDestinationQueue
              &lt;/activation-config-property-value&gt;
           &lt;/activation-config-property&gt;
        &lt;/activation-config&gt;
     &lt;/message-driven&gt;
  &lt;/enterprise-beans&gt;
 &lt;/jboss:ejb-jar&gt;</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								There are known issues with the <code class="literal">jboss-ejb3-spec-2_0.xsd</code> file that may result in schema validation errors. You can ignore these errors. For more information, see <a class="link mimir-link-warn" href="https://bugzilla.redhat.com/show_bug.cgi?id=1192591" title="Mimir does not include content from: bugzilla.redhat.com">https://bugzilla.redhat.com/show_bug.cgi?id=1192591</a>.
							</p></div></div></dd></dl></div></section><section class="section" id="assembly_configure_ejb_thread_pool_default"><div class="titlepage"><div><div><h2 class="title">A.5. Configure an EJB Thread Pool</h2></div></div></div><p>
				You can create an EJB thread pool using the management console or the management CLI.
			</p><section class="section" id="proc_configuring_ejb_thread_pool_management_console_default"><div class="titlepage"><div><div><h3 class="title">A.5.1. Configuring an EJB Thread Pool Using the Management Console</h3></div></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Log in to the management console.
						</li><li class="listitem">
							Navigate to <span class="strong strong"><strong>Configuration</strong></span> → <span class="strong strong"><strong>Subsystems</strong></span> → <span class="strong strong"><strong>EJB</strong></span> and click <span class="strong strong"><strong>View</strong></span>.
						</li><li class="listitem">
							Select <span class="strong strong"><strong>Container</strong></span> → <span class="strong strong"><strong>Thread Pool</strong></span>.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Add</strong></span> and specify the <span class="strong strong"><strong>Name</strong></span> and <span class="strong strong"><strong>Max Threads</strong></span> values.
						</li><li class="listitem">
							Click <span class="strong strong"><strong>Save</strong></span>.
						</li></ol></div></section><section class="section" id="configuring_ejb_thread_pool_cli_default"><div class="titlepage"><div><div><h3 class="title">A.5.2. Configure an EJB Thread Pool Using the Management CLI</h3></div></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Use the <code class="literal">add</code> operation with the following syntax:
						</p><pre class="screen">/subsystem=ejb3/thread-pool=<span class="emphasis"><em>THREAD_POOL_NAME</em></span>:add(max-threads=<span class="emphasis"><em>MAX_SIZE</em></span>)</pre><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									Replace <code class="literal"><span class="emphasis"><em>THREAD_POOL_NAME</em></span></code> with the required name for the thread pool.
								</li><li class="listitem">
									Replace <code class="literal"><span class="emphasis"><em>MAX_SIZE</em></span></code> with the maximum size of the thread pool.
								</li></ol></div></li><li class="listitem"><p class="simpara">
							Use the <code class="literal">read-resource</code> operation to confirm the creation of the thread pool:
						</p><pre class="screen">/subsystem=ejb3/thread-pool=<span class="emphasis"><em>THREAD_POOL_NAME</em></span>:read-resource</pre><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
									To reconfigure all the services in the <code class="literal">ejb3</code> subsystem to use a new thread pool, use the following commands:
								</p><pre class="screen">/subsystem=ejb3/thread-pool=bigger:add(max-threads=100, core-threads=10)
/subsystem=ejb3/service=async:write-attribute(name=thread-pool-name, value="bigger")
/subsystem=ejb3/service=remote:write-attribute(name=thread-pool-name, value="bigger")
/subsystem=ejb3/service=timer-service:write-attribute(name=thread-pool-name, value="bigger")
reload</pre><div class="formalpara"><p class="title"><strong>XML Configuration Sample:</strong></p><p>
										
<pre class="programlisting language-xml">&lt;subsystem xmlns="urn:jboss:domain:ejb3:5.0"&gt;
    ...
    &lt;async thread-pool-name="bigger"/&gt;
    ...
    &lt;timer-service thread-pool-name="bigger" default-data-store="default-file-store"&gt;
    ...
    &lt;remote connector-ref="http-remoting-connector" thread-pool-name="bigger"/&gt;
    ...
    &lt;thread-pools&gt;
        &lt;thread-pool name="default"&gt;
            &lt;max-threads count="10"/&gt;
            &lt;core-threads count="5"/&gt;
            &lt;keepalive-time time="100" unit="milliseconds"/&gt;
        &lt;/thread-pool&gt;
        &lt;thread-pool name="bigger"&gt;
            &lt;max-threads count="100"/&gt;
            &lt;core-threads count="5"/&gt;
        &lt;/thread-pool&gt;
    &lt;/thread-pools&gt;
    ...</pre>

									</p></div></li></ol></div></li></ol></div></section><section class="section" id="con_ejb_thread_pool_attributes_default"><div class="titlepage"><div><div><h3 class="title">A.5.3. EJB Thread Pool Attributes</h3></div></div></div><p>
					EJB thread pools can be configured using attributes to run more efficiently for specific configuration needs.
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							The <code class="literal">max-threads</code> attribute determines the total or maximum number of threads that the executor supports.
						</li></ul></div><pre class="screen">/subsystem=ejb3/thread-pool=default:write-attribute(name=max-threads, value=9)
{"outcome" =&gt; "success"}</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							The <code class="literal">core-threads</code> attribute determines the number of threads that are kept in the executor’s pool. This includes idle threads. If the <code class="literal">core-threads</code> attribute is not specified, it will default to the value of <code class="literal">max-threads</code>.
						</li></ul></div><pre class="screen">/subsystem=ejb3/thread-pool=default:write-attribute(name=core-threads, value=3)
{"outcome" =&gt; "success"}</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							The <code class="literal">keepalive-time</code> attribute determines the amount of time that a non-core thread may remain idle.
						</li></ul></div><pre class="screen">/subsystem=ejb3/thread-pool=default:write-attribute(name=keepalive-time, value={time=5, unit=MINUTES})
{"outcome"=&gt; "success"}</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							To change the time without changing the units of time for the <code class="literal">keepalive-time</code> attribute, use the following command:
						</li></ul></div><pre class="screen">/subsystem=ejb3/thread-pool=default:write-attribute(name=keepalive-time.time, value=10)
{"outcome"=&gt; "success"}</pre><p>
					<br/><br/><br/><br/>
				</p><p>
					<span class="emphasis"><em><span class="right right">Revised on 2019-12-05 13:41:25 UTC</span></em></span>
				</p></section></section></section><div><div xml:lang="en-US" class="legalnotice" id="idm140640818318048"><h1 class="legalnotice">Legal Notice</h1><div class="para">
		Copyright <span class="trademark"><!--Empty--></span>© 2019 Red Hat, Inc.
	</div><div class="para">
		The text of and illustrations in this document are licensed by Red Hat under a Creative Commons Attribution–Share Alike 3.0 Unported license ("CC-BY-SA"). An explanation of CC-BY-SA is available at <a class="uri mimir-link-warn" href="http://creativecommons.org/licenses/by-sa/3.0/" title="Mimir does not include content from: creativecommons.org">http://creativecommons.org/licenses/by-sa/3.0/</a>. In accordance with CC-BY-SA, if you distribute this document or an adaptation of it, you must provide the URL for the original version.
	</div><div class="para">
		Red Hat, as the licensor of this document, waives the right to enforce, and agrees not to assert, Section 4d of CC-BY-SA to the fullest extent permitted by applicable law.
	</div><div class="para">
		Red Hat, Red Hat Enterprise Linux, the Shadowman logo, the Red Hat logo, JBoss, OpenShift, Fedora, the Infinity logo, and RHCE are trademarks of Red Hat, Inc., registered in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Linux</span>® is the registered trademark of Linus Torvalds in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Java</span>® is a registered trademark of Oracle and/or its affiliates.
	</div><div class="para">
		<span class="trademark">XFS</span>® is a trademark of Silicon Graphics International Corp. or its subsidiaries in the United States and/or other countries.
	</div><div class="para">
		<span class="trademark">MySQL</span>® is a registered trademark of MySQL AB in the United States, the European Union and other countries.
	</div><div class="para">
		<span class="trademark">Node.js</span>® is an official trademark of Joyent. Red Hat is not formally related to or endorsed by the official Joyent Node.js open source or commercial project.
	</div><div class="para">
		The <span class="trademark">OpenStack</span>® Word Mark and OpenStack logo are either registered trademarks/service marks or trademarks/service marks of the OpenStack Foundation, in the United States and other countries and are used with the OpenStack Foundation's permission. We are not affiliated with, endorsed or sponsored by the OpenStack Foundation, or the OpenStack community.
	</div><div class="para">
		All other trademarks are the property of their respective owners.
	</div></div></div></div></body>

        
        
    </div>
    

</div> 


                            </bdo>
                        </main>
                    </div>
                </main>
            </div>
        
            <!--#include virtual="/includes/footer/index.html" -->
        </div>
    </body>
</html>
