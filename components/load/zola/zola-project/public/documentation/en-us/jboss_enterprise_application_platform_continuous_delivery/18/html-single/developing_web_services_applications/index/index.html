<!DOCTYPE html>
<html>
    <head>
        
        <link rel="stylesheet" type="text/css" media="screen" href="/mimir/styles/mimir.min.css">
        




    <link rel="stylesheet" type="text/css" media="screen" href="/sites/dxp-docs/files/css/css_87GMcmxT1ib8ziQiU2KUAnTDFtZQV6iP-KGslA9LigM.css" />

    <link rel="stylesheet" type="text/css" media="screen" href="/sites/dxp-docs/files/css/css_Bwzy34i9pSdDlzGALvqVwG4fpgGp08KLMAkClGNY9M4.css" />



<link rel="stylesheet" type="text/css" media="screen" href="/mimir/styles/mimir-doc-toc.min.css" />



        
        <!--#include virtual="/includes/head/index.html" -->

        
        <title>
Developing Web Services Applications - JBoss Enterprise Application Platform Continuous Delivery 18
</title>
        
<meta name="product" content="JBoss Enterprise Application Platform Continuous Delivery" />
<meta name="documentation_version" content="18" />
<meta name="documentKind" content="documentation" />
<meta name="portal_content_subtype" content="title" />
<meta name="lastModifiedDate" content="2019-12-06T22:33:13.000Z" />


        
            
        
        
            
                
                
                <!-- mimir_solr_yesindex -->
                <meta name="mimir_solr_yesindex" content="true" />
            
        
    </head>

    <body class="mimir-body">

        
        

        
        <div id="page-wrap" class="page-wrap">
            <div id="pers-top-page-wrap" class="top-page-wrap pers-loader-bg">
                <div id="hero-bg-top-left" class="summit-bg-shapes"></div>
                <div id="hero-bg-top-right" class="summit-bg-shapes"></div>

                <header class="masthead" id="masthead">

                    
                    <!--#include virtual="/includes/header/index.html" -->

                    
                    
                    
                        
                    
                    
                        <div class="breadcrumbs">
                            <div id="breadcrumbs" class="container">
                                
                                <a href="/">Home</a>
                                
                                <a href="/products/">Product Documentation</a>
                                
                                <a href="/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/20/">JBoss Enterprise Application Platform Continuous Delivery</a>
                                
                                <a href="/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/">18</a>
                                
                                
                                Developing Web Services Applications
                                
                            </div>
                        </div>
                    
                </header>

                <main id="cp-main" class="portal-content-area">
                    <div id="cp-content" class="main-content">
                        
                        <main class="container mimir-docs">
                            
                            <bdo>
                                

<script type="module" src="/mimir/scripts/mimir-doc-toc.min.js"></script>






<div class="docs-grid">

    <nav id="mimir-doc-toc" class="mimir-doc-toc">
      <div class="mimir-doc-toc-inner">
          <!-- single-page -->
        
            
              <ol>
                <li>
                        
                        <a href="#">Developing Web Services Applications</a>
                    </li><li>
                        <a href="#idm139695818756704">
                            Preface
                        </a>
                    </li><li>
                        <a href="#introduction_to_web_services">
                            1. Introduction to Web Services
                        </a>
                    </li><li>
                        <a href="#developing_jax_rs_web_services">
                            2. Developing JAX-RS Web Services
                        </a><ol>
                <li>
                        <a href="#JAX-RS_application">
                            2.1. JAX-RS Application
                        </a><ol>
                <li>
                        <a href="#simple_subclassing_literal_javax_ws_rs_core_application_literal">
                            2.1.1. Simple Subclassing javax.ws.rs.core.Application
                        </a>
                    </li><li>
                        <a href="#using_literal_web_xml_literal">
                            2.1.2. Using web.xml
                        </a>
                    </li><li>
                        <a href="#subclassing_literal_javax_ws_rs_core_application_literal_with_a_custom_implementation">
                            2.1.3. Subclassing javax.ws.rs.core.Application with a Custom Implementation
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#jax_rs_client">
                            2.2. JAX-RS Client
                        </a><ol>
                <li>
                        <a href="#JAX-RS_client_api">
                            2.2.1. JAX-RS Client API
                        </a>
                    </li><li>
                        <a href="#how_to_use_resteasy_with_closeable_apache_http_client">
                            2.2.2. Implementing RESTEasy with HTTP Client
                        </a><ol>
                <li>
                        <a href="#http_redirect">
                            2.2.2.1. HTTP Redirect
                        </a>
                    </li>
            </ol>
                    </li>
            </ol>
                    </li><li>
                        <a href="#jax_rs_request_processing">
                            2.3. JAX-RS Request Processing
                        </a><ol>
                <li>
                        <a href="#jaxrs_async_processing">
                            2.3.1. Asynchronous HTTP Request Processing
                        </a><ol>
                <li>
                        <a href="#resteasy_async_nio_request_processing">
                            2.3.1.1. Asynchronous NIO Request Processing
                        </a>
                    </li><li>
                        <a href="#server-async-response-processing">
                            2.3.1.2. Server Asynchronous Response Processing
                        </a><ol>
                <li>
                        <a href="#asyncresponse_api">
                            2.3.1.2.1. AsyncResponse API
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#async_invoker_client_api">
                            2.3.1.3. AsyncInvoker Client API
                        </a><ol>
                <li>
                        <a href="#using_future">
                            2.3.1.3.1. Using Future
                        </a>
                    </li><li>
                        <a href="#using_invocationcallback">
                            2.3.1.3.2. Using InvocationCallback
                        </a>
                    </li>
            </ol>
                    </li>
            </ol>
                    </li><li>
                        <a href="#custom_resteasy_annotations">
                            2.3.2. Custom RESTEasy Annotations
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#viewing_resteasy_endpoints">
                            2.4. Viewing RESTEasy Endpoints
                        </a>
                    </li><li>
                        <a href="#url_based_negotiation">
                            2.5. URL-Based Negotiation
                        </a><ol>
                <li>
                        <a href="#mapping_extensions_to_media_types">
                            2.5.1. Mapping Extensions to Media Types
                        </a>
                    </li><li>
                        <a href="#mapping_extensions_to_languages">
                            2.5.2. Mapping Extensions to Languages
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#content_marshalling_and_providers">
                            2.6. Content Marshalling and Providers
                        </a><ol>
                <li>
                        <a href="#default_providers_and_default_jax_rs_content_marshalling">
                            2.6.1. Default Providers and Default JAX-RS Content Marshalling
                        </a><ol>
                <li>
                        <a href="#text_media_types_charsets">
                            2.6.1.1. Text Media Types and Character Sets
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#jaxrs_content_marshalling_provider_classes">
                            2.6.2. Content Marshalling with @Provider classes
                        </a>
                    </li><li>
                        <a href="#jaxrs_provider_utility_class">
                            2.6.3. Providers Utility Class
                        </a>
                    </li><li>
                        <a href="#jaxrs_configure_doc_marshalling">
                            2.6.4. Configuring Document Marshalling
                        </a>
                    </li><li>
                        <a href="#using_mapprovider">
                            2.6.5. Using MapProvider
                        </a>
                    </li><li>
                        <a href="#converting_string_based_annotations_to_objects">
                            2.6.6. Converting String Based Annotations to Objects
                        </a>
                    </li><li>
                        <a href="#serializable_provider">
                            2.6.7. Serializable Provider
                        </a>
                    </li><li>
                        <a href="#json_provider">
                            2.6.8. JSON Provider
                        </a><ol>
                <li>
                        <a href="#resteasy_jackson2_json_filter_support">
                            2.6.8.1. JsonFilter Support in RESTEasy Jackson2
                        </a>
                    </li><li>
                        <a href="#resteasy_java_api_for_json_binding">
                            2.6.8.2. Java API for JSON Binding
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#jaxb_providers">
                            2.6.9. JAXB Providers
                        </a><ol>
                <li>
                        <a href="#jaxb_and_xml_provider">
                            2.6.9.1. JAXB and XML Provider
                        </a>
                    </li><li>
                        <a href="#resteasy-jaxb-json">
                            2.6.9.2. JAXB and JSON Provider
                        </a><ol>
                <li>
                        <a href="#jackson_module_support">
                            2.6.9.2.1. Jackson Module Support for Java 8
                        </a>
                    </li><li>
                        <a href="#switching_the_default_jackson_provider">
                            2.6.9.2.2. Switching the Default Jackson Provider
                        </a>
                    </li>
            </ol>
                    </li>
            </ol>
                    </li><li>
                        <a href="#jaxb_decorators">
                            2.6.10. Creating JAXB Decorators
                        </a>
                    </li><li>
                        <a href="#resteasy-multipart-providers">
                            2.6.11. Multipart Providers in JAX-RS
                        </a><ol>
                <li>
                        <a href="#resteasy-multipart-input">
                            2.6.11.1. Input with Multipart Data
                        </a><ol>
                <li>
                        <a href="#input_with_literal_multipart_mixed_literal">
                            2.6.11.1.1. Input with multipart/mixed
                        </a>
                    </li><li>
                        <a href="#input_with_literal_multipart_mixed_literal_and_literal_java_util_list_literal">
                            2.6.11.1.2. Input with multipart/mixed and java.util.List
                        </a>
                    </li><li>
                        <a href="#input_with_literal_multipart_form_data_literal">
                            2.6.11.1.3. Input with multipart/form-data
                        </a>
                    </li><li>
                        <a href="#literal_java_util_map_literal_with_literal_multipart_form_data_literal">
                            2.6.11.1.4. java.util.Map with multipart/form-data
                        </a>
                    </li><li>
                        <a href="#input_with_literal_multipart_related_literal">
                            2.6.11.1.5. Input with multipart/related
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#resteasy-multipart-output">
                            2.6.11.2. Output with Multipart Data
                        </a><ol>
                <li>
                        <a href="#multipart_output_with_literal_java_util_list_literal">
                            2.6.11.2.1. Multipart Output with java.util.List
                        </a>
                    </li><li>
                        <a href="#output_with_literal_multipart_form_data_literal">
                            2.6.11.2.2. Output with multipart/form-data
                        </a>
                    </li><li>
                        <a href="#multipart_formdata_output_with_literal_java_util_map_literal">
                            2.6.11.2.3. Multipart FormData Output with java.util.Map
                        </a>
                    </li><li>
                        <a href="#output_with_literal_multipart_related_literal">
                            2.6.11.2.4. Output with multipart/related
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#resteasy-multipart-form-pojo">
                            2.6.11.3. Mapping Multipart Forms to POJOs
                        </a>
                    </li><li>
                        <a href="#resteasy-multipart-xop">
                            2.6.11.4. XML-binary Optimized Packaging (XOP)
                        </a>
                    </li><li>
                        <a href="#resteasy-multipart-overwrite-fallback-content-type">
                            2.6.11.5. Overwriting the Default Fallback Content Type for Multipart Messages
                        </a>
                    </li><li>
                        <a href="#resteasy-multipart-overwrite-content-type">
                            2.6.11.6. Overwriting the Content Type for Multipart Messages
                        </a>
                    </li><li>
                        <a href="#resteasy-multipart-overwrite-fallback-charset">
                            2.6.11.7. Overwriting the Default Fallback charset for Multipart Messages
                        </a>
                    </li><li>
                        <a href="#resteasy_multipart_client">
                            2.6.11.8. Send Multipart Entity with RESTEasy Client
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#resteasy_atom_support">
                            2.6.12. RESTEasy Atom Support
                        </a><ol>
                <li>
                        <a href="#using_jaxb_with_atom_provider">
                            2.6.12.1. Using JAXB with Atom Provider
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#jaxrs_yaml_provider">
                            2.6.13. YAML Provider
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#jaxrs_json_p">
                            2.7. Using the JSON API for JSON Processing (JSON-P)
                        </a>
                    </li><li>
                        <a href="#ejb_integration">
                            2.8. RESTEasy/EJB Integration
                        </a>
                    </li><li>
                        <a href="#spring_integration">
                            2.9. Spring Integration
                        </a>
                    </li><li>
                        <a href="#cdi_integration">
                            2.10. CDI Integration
                        </a><ol>
                <li>
                        <a href="#default_scope">
                            2.10.1. Default Scope
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#resteasy_filters_interceptors">
                            2.11. RESTEasy Filters and Interceptors
                        </a><ol>
                <li>
                        <a href="#resteasy_server_filters">
                            2.11.1. Server-side Filters
                        </a>
                    </li><li>
                        <a href="#resteasy_client_filters">
                            2.11.2. Client-side Filters
                        </a>
                    </li><li>
                        <a href="#resteasy_interceptors">
                            2.11.3. RESTEasy Interceptors
                        </a><ol>
                <li>
                        <a href="#intercept_jax_rs_invocations">
                            2.11.3.1. Intercept JAX-RS Invocations
                        </a>
                    </li><li>
                        <a href="#registering_an_interceptor">
                            2.11.3.2. Registering an Interceptor
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#resteasy_gzip_compression_decompression">
                            2.11.4. GZIP Compression and Decompression
                        </a><ol>
                <li>
                        <a href="#configuring_gzip_compression_and_decompression">
                            2.11.4.1. Configuring GZIP Compression and Decompression
                        </a>
                    </li><li>
                        <a href="#reasteasy_gzip_server_side_configuration">
                            2.11.4.2. Server-side GZIP Configuration
                        </a><ol>
                <li>
                        <a href="#resteasy_gzip_client_side_configuration">
                            2.11.4.2.1. Client-side GZIP Configuration
                        </a>
                    </li>
            </ol>
                    </li>
            </ol>
                    </li><li>
                        <a href="#resteasy_per_resource_filters_interceptors">
                            2.11.5. Per-Resource Method Filters and Interceptors
                        </a>
                    </li><li>
                        <a href="#resteasy_ordering_filters_interceptors">
                            2.11.6. Ordering
                        </a>
                    </li><li>
                        <a href="#resteasy_exceptions_filters_interceptors">
                            2.11.7. Exception Handling with Filters and Interceptors
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#logging_resteasy_providers_interceptors">
                            2.12. Logging RESTEasy Providers and Interceptors
                        </a>
                    </li><li>
                        <a href="#resteasy_exceptions">
                            2.13. Exception Handling
                        </a><ol>
                <li>
                        <a href="#creating_an_exception_mapper">
                            2.13.1. Creating an Exception Mapper
                        </a>
                    </li><li>
                        <a href="#managing_internally_thrown_exceptions">
                            2.13.2. Managing Internally Thrown Exceptions
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#Enable_Role-Based_Security_RESTEasy_JAX-RS_Web_Service">
                            2.14. Securing JAX-RS Web Services
                        </a><ol>
                <li>
                        <a href="#enable_rbac_ws">
                            2.14.1. Enable Role-Based Security
                        </a>
                    </li><li>
                        <a href="#securing_jax_rs_web_services_using_annotations">
                            2.14.2. Securing JAX-RS Web Services Using Annotations
                        </a>
                    </li><li>
                        <a href="#setting-programmatic-security">
                            2.14.3. Setting Programmatic Security
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#resteasy_asynchronous_job_service">
                            2.15. RESTEasy Asynchronous Job Service
                        </a><ol>
                <li>
                        <a href="#enabling_the_asynchronous_job_service">
                            2.15.1. Enabling the Asynchronous Job Service
                        </a>
                    </li><li>
                        <a href="#configuring_asynchronous_jobs">
                            2.15.2. Configuring Asynchronous Jobs
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#resteasy_javascript_api">
                            2.16. RESTEasy JavaScript API
                        </a><ol>
                <li>
                        <a href="#about_the_resteasy_javascript_api">
                            2.16.1. About the RESTEasy JavaScript API
                        </a><ol>
                <li>
                        <a href="#enable_the_resteasy_javascript_api_servlet">
                            2.16.1.1. Enable the RESTEasy JavaScript API Servlet
                        </a>
                    </li><li>
                        <a href="#build_ajax_queries">
                            2.16.1.2. Build AJAX Queries
                        </a>
                    </li>
            </ol>
                    </li>
            </ol>
                    </li><li>
                        <a href="#resteasy_spi_to_modify_resource_metadata">
                            2.17. RESTEasy SPI to Modify Resource Metadata
                        </a>
                    </li><li>
                        <a href="#microprofile_rest_client">
                            2.18. MicroProfile REST Client
                        </a><ol>
                <li>
                        <a href="#intuitive_syntax">
                            2.18.1. Intuitive Syntax
                        </a>
                    </li><li>
                        <a href="#programmatic_registration_of_providers">
                            2.18.2. Programmatic Registration of Providers
                        </a>
                    </li><li>
                        <a href="#declarative_registration_of_providers">
                            2.18.3. Declarative Registration of Providers
                        </a>
                    </li><li>
                        <a href="#responseexceptionmapper">
                            2.18.4. ResponseExceptionMapper
                        </a>
                    </li><li>
                        <a href="#cdi_integration-1">
                            2.18.5. CDI Integration
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#support_for_completionstage_type">
                            2.19. Support for the CompletionStage Type
                        </a>
                    </li><li>
                        <a href="#extending_support_asynch_request_processing">
                            2.20. Extending RESTEasy Support for Asynchronous Request Processing and Reactive Return Types
                        </a><ol>
                <li>
                        <a href="#pluggable_reactive_types">
                            2.20.1. Pluggable Reactive Types
                        </a>
                    </li><li>
                        <a href="#extensions_for_additional_reactive_classes">
                            2.20.2. Extensions for Additional Reactive Classes
                        </a>
                    </li><li>
                        <a href="#reactive_clients_api">
                            2.20.3. Reactive Clients API
                        </a>
                    </li><li>
                        <a href="#asynchronous_filters">
                            2.20.4. Asynchronous Filters
                        </a>
                    </li><li>
                        <a href="#proxies">
                            2.20.5. Proxies
                        </a>
                    </li>
            </ol>
                    </li>
            </ol>
                    </li><li>
                        <a href="#developing_jax_ws_web_services">
                            3. Developing JAX-WS Web Services
                        </a><ol>
                <li>
                        <a href="#using_jax_ws_tools">
                            3.1. Using JAX-WS Tools
                        </a><ol>
                <li>
                        <a href="#server_side_dev_strategies">
                            3.1.1. Server-side Development Strategies
                        </a>
                    </li><li>
                        <a href="#client_side_dev_strategies">
                            3.1.2. Client-side Development Strategies
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#jax_ws_web_service_endpoints">
                            3.2. JAX-WS Web Service Endpoints
                        </a><ol>
                <li>
                        <a href="#about_jax_ws_web_service_endpoints">
                            3.2.1. About JAX-WS Web Service Endpoints
                        </a>
                    </li><li>
                        <a href="#developing_and_deploying_jax_ws_web_service_endpoint">
                            3.2.2. Developing and Deploying JAX-WS Web Service Endpoint
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#ws_clients">
                            3.3. JAX-WS Web Service Clients
                        </a><ol>
                <li>
                        <a href="#consume_and_access_a_jax_ws_web_service">
                            3.3.1. Consume and Access a JAX-WS Web Service
                        </a>
                    </li><li>
                        <a href="#develop_a_jax_ws_client_application">
                            3.3.2. Develop a JAX-WS Client Application
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#configure_web_services_options">
                            3.4. Configuring the Web Services Subsystem
                        </a><ol>
                <li>
                        <a href="#jax_ws_endpoint_configs">
                            3.4.1. Endpoint Configurations
                        </a>
                    </li><li>
                        <a href="#jax_ws_handler_chains">
                            3.4.2. Handler Chains
                        </a>
                    </li><li>
                        <a href="#jax_ws_handlers">
                            3.4.3. Handlers
                        </a>
                    </li><li>
                        <a href="#published_endpoint_addresses">
                            3.4.4. Published Endpoint Addresses
                        </a>
                    </li><li>
                        <a href="#runtime_information">
                            3.4.5. Viewing Runtime Information
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#ws_endpoint_assign_config">
                            3.5. Assigning Client and Endpoint Configurations
                        </a><ol>
                <li>
                        <a href="#ws_endpoint_explict_config_assignment">
                            3.5.1. Explicit Configuration Assignment
                        </a><ol>
                <li>
                        <a href="#ws_endpoint_config_deployment_desc">
                            3.5.1.1. Configuration Deployment Descriptor
                        </a>
                    </li><li>
                        <a href="#ws_endpoint_config_app_server">
                            3.5.1.2. Application Server Configuration
                        </a>
                    </li><li>
                        <a href="#ws_endpoint_config_annotation">
                            3.5.1.3. EndpointConfig Annotation
                        </a>
                    </li><li>
                        <a href="#ws_endpoint_config_feature">
                            3.5.1.4. JAX-WS Feature
                        </a>
                    </li><li>
                        <a href="#ws_endpoint_explicit_setup_api">
                            3.5.1.5. Explicit Setup Through API
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#ws_endpoint_automatic_config_default_descriptors">
                            3.5.2. Automatic Configuration from Default Descriptors
                        </a>
                    </li><li>
                        <a href="#ws_endpoint_automatic_config_assignemnt_container">
                            3.5.3. Automatic Configuration Assignment from Container
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#setting_module_depencies_for_web_service_applications">
                            3.6. Setting Module Dependencies for Web Service Applications
                        </a><ol>
                <li>
                        <a href="#using_manifest_mf">
                            3.6.1. Using MANIFEST.MF
                        </a><ol>
                <li>
                        <a href="#using_jaxb">
                            3.6.1.1. Using JAXB
                        </a>
                    </li><li>
                        <a href="#using_apache_cxf">
                            3.6.1.2. Using Apache CXF
                        </a>
                    </li><li>
                        <a href="#client_side_web_services_aggregation_module">
                            3.6.1.3. Client-side Web Services Aggregation Module
                        </a>
                    </li><li>
                        <a href="#annotation_scanning">
                            3.6.1.4. Annotation Scanning
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#using_jboss_deployment_structure_xml">
                            3.6.2. Using jboss-deployment-structure.xml
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#configuring_http_timeout">
                            3.7. Configuring HTTP Timeout
                        </a>
                    </li><li>
                        <a href="#ws_sec_ws">
                            3.8. Securing JAX-WS Web Services
                        </a><ol>
                <li>
                        <a href="#ws_security_applying">
                            3.8.1. Applying Web Services Security (WS-Security)
                        </a><ol>
                <li>
                        <a href="#ws_security_cxf">
                            3.8.1.1. Apache CXF WS-Security Implementation
                        </a>
                    </li><li>
                        <a href="#ws_security_policy_support">
                            3.8.1.2. WS-Security Policy Support
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#about_ws_trust">
                            3.8.2. WS-Trust
                        </a><ol>
                <li>
                        <a href="#ws_trust_scenario">
                            3.8.2.1. Scenario: Basic WS-Trust
                        </a>
                    </li><li>
                        <a href="#ws_trust_sts_apache_CXF_support">
                            3.8.2.2. Apache CXF Support
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#about_sts">
                            3.8.3. Security Token Service (STS)
                        </a><ol>
                <li>
                        <a href="#setting_up_plink_sts_idp">
                            3.8.3.1. Configuring a PicketLink WS-Trust Security Token Service (STS)
                        </a><ol>
                <li>
                        <a href="#create_a_security_domain_for_the_sts">
                            3.8.3.1.1. Create a Security Domain for the STS
                        </a>
                    </li><li>
                        <a href="#configure_the_web_xml_file_for_the_sts">
                            3.8.3.1.2. Configure the web.xml File for the STS
                        </a>
                    </li><li>
                        <a href="#configure_the_authenticator_for_the_sts">
                            3.8.3.1.3. Configure the Authenticator for the STS
                        </a>
                    </li><li>
                        <a href="#declare_the_necessary_dependencies_for_the_sts">
                            3.8.3.1.4. Declare the Necessary Dependencies for the STS
                        </a>
                    </li><li>
                        <a href="#configure_the_web_service_portion_of_the_sts">
                            3.8.3.1.5. Configure the Web-Service Portion of the STS
                        </a>
                    </li><li>
                        <a href="#create_and_configure_a_picketlink_xml_file_for_the_sts">
                            3.8.3.1.6. Create and Configure a picketlink.xml File for the STS
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#configure-sts-client-server">
                            3.8.3.2. Using a WS-Trust Security Token Service (STS) with a Client
                        </a>
                    </li><li>
                        <a href="#sts-client-pools">
                            3.8.3.3. STS Client Pooling
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#propagate_authenticated_identity_to_ejb_subsystem">
                            3.8.4. Propagating Authenticated Identity to the EJB Subsystem
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#jax_ws_logging">
                            3.9. JAX-WS Logging
                        </a><ol>
                <li>
                        <a href="#jax_ws_logging_handlers">
                            3.9.1. Using JAX-WS Handlers
                        </a>
                    </li><li>
                        <a href="#cxf_logging_interceptors">
                            3.9.2. Using Apache CXF Logging Interceptors
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#enabling_web_services_addressing_ws_addressing">
                            3.10. Enabling Web Services Addressing (WS-Addressing)
                        </a>
                    </li><li>
                        <a href="#ws_msging">
                            3.11. Enabling Web Services Reliable Messaging
                        </a>
                    </li><li>
                        <a href="#ws_policies">
                            3.12. Specifying Web Services Policies
                        </a>
                    </li><li>
                        <a href="#cxf_integration">
                            3.13. Apache CXF Integration
                        </a><ol>
                <li>
                        <a href="#cxf_server_side_integration_customization">
                            3.13.1. Server-side Integration Customization
                        </a><ol>
                <li>
                        <a href="#cxf_deployment_descriptor_properties">
                            3.13.1.1. Deployment Descriptor Properties
                        </a>
                    </li><li>
                        <a href="#cxf_workqueue_configuration">
                            3.13.1.2. WorkQueue Configuration
                        </a>
                    </li><li>
                        <a href="#cxf_policy_alternative_selector">
                            3.13.1.3. Policy Alternative Selector
                        </a>
                    </li><li>
                        <a href="#cxf_mbean_management">
                            3.13.1.4. MBean Management
                        </a>
                    </li><li>
                        <a href="#cxf_schema_validation">
                            3.13.1.5. Schema Validation
                        </a>
                    </li><li>
                        <a href="#cxf-interceptors">
                            3.13.1.6. Apache CXF Interceptors
                        </a>
                    </li><li>
                        <a href="#cxf_features">
                            3.13.1.7. Apache CXF Features
                        </a>
                    </li><li>
                        <a href="#cxf_properties_driven_bean_creation">
                            3.13.1.8. Properties-Driven Bean Creation
                        </a>
                    </li>
            </ol>
                    </li>
            </ol>
                    </li>
            </ol>
                    </li><li>
                        <a href="#reference_material">
                            A. Reference Material
                        </a><ol>
                <li>
                        <a href="#jax_rs_resteasy_annotations">
                            A.1. JAX-RS/RESTEasy Annotations
                        </a>
                    </li><li>
                        <a href="#resteasy_configuration_parameters">
                            A.2. RESTEasy Configuration Parameters
                        </a>
                    </li><li>
                        <a href="#resteasy_javascript_api_parameters">
                            A.3. RESTEasy JavaScript API Parameters
                        </a>
                    </li><li>
                        <a href="#rest_request_class_members">
                            A.4. REST.Request Class Members
                        </a>
                    </li><li>
                        <a href="#Asynchronous_Job_Service_Configuration_Parameters">
                            A.5. RESTEasy Asynchronous Job Service Configuration Parameters
                        </a>
                    </li><li>
                        <a href="#jax_ws_tools">
                            A.6. JAX-WS Tools
                        </a>
                    </li><li>
                        <a href="#jax_ws_common_api_reference">
                            A.7. JAX-WS Common API Reference
                        </a>
                    </li><li>
                        <a href="#advanced_trust_scenarios">
                            A.8. Advanced WS-Trust Scenarios
                        </a><ol>
                <li>
                        <a href="#SAML_holder_of_key_assertion_scenario">
                            A.8.1. Scenario: SAML Holder-Of-Key Assertion Scenario
                        </a><ol>
                <li>
                        <a href="#SAML_holder_of_key_assertion_scenario_WSP">
                            A.8.1.1. Web Service Provider
                        </a><ol>
                <li>
                        <a href="#SAML_holder_of_key_assertion_scenario_WSP_WSDL">
                            A.8.1.1.1. Web Service Provider WSDL
                        </a>
                    </li><li>
                        <a href="#SAML_holder_of_key_assertion_scenario_WSP_SSL_conf">
                            A.8.1.1.2. SSL Configuration
                        </a>
                    </li><li>
                        <a href="#SAML_holder_of_key_assertion_scenario_WSP_interface">
                            A.8.1.1.3. Web Service Provider Interface
                        </a>
                    </li><li>
                        <a href="#SAML_holder_of_key_assertion_scenario_WSP_implementation">
                            A.8.1.1.4. Web Service Provider Implementation
                        </a>
                    </li><li>
                        <a href="#SAML_holder_of_key_assertion_scenario_WSP_crypto_prop_keystore_files">
                            A.8.1.1.5. Crypto Properties and Keystore Files
                        </a>
                    </li><li>
                        <a href="#SAML_holder_of_key_assertion_scenario_WSP_manifest">
                            A.8.1.1.6. Default MANIFEST.MF
                        </a>
                    </li>
            </ol>
                    </li>
            </ol>
                    </li><li>
                        <a href="#scenario_saml_bearer_assertion">
                            A.8.2. Scenario: SAML Bearer Assertion
                        </a><ol>
                <li>
                        <a href="#SAML_bearer_assertion_scenario_WSP">
                            A.8.2.1. Web Service Provider
                        </a><ol>
                <li>
                        <a href="#SAML_bearer_assertion_scenario_WSP_wsdl">
                            A.8.2.1.1. Bearer Web Service Provider WSDL
                        </a>
                    </li><li>
                        <a href="#SAML_bearer_assertion_scenario_WSP_ssl_conf">
                            A.8.2.1.2. SSL Configuration
                        </a>
                    </li><li>
                        <a href="#SAML_bearer_assertion_scenario_WSP_interface">
                            A.8.2.1.3. Bearer Web Service Providers Interface
                        </a>
                    </li><li>
                        <a href="#SAML_bearer_assertion_scenario_WSP_implementation">
                            A.8.2.1.4. Bearer Web Service Providers Implementation
                        </a>
                    </li><li>
                        <a href="#SAML_bearer_assertion_scenario_WSP_crypto_prop_keystore_files">
                            A.8.2.1.5. Crypto Properties and Keystore Files
                        </a>
                    </li><li>
                        <a href="#SAML_bearer_assertion_scenario_WSP_manifest">
                            A.8.2.1.6. Default MANIFEST.MF
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#SAML_bearer_assertion_scenario_STS">
                            A.8.2.2. Bearer Security Token Service
                        </a><ol>
                <li>
                        <a href="#SAML_bearer_assertion_scenario_STS_security_domain">
                            A.8.2.2.1. Security Domain
                        </a>
                    </li><li>
                        <a href="#SAML_bearer_assertion_scenario_STS_sts_wsdl">
                            A.8.2.2.2. STS WSDL
                        </a>
                    </li><li>
                        <a href="#SAML_bearer_assertion_scenario_STS_implementation">
                            A.8.2.2.3. STS Implementation Class
                        </a>
                    </li><li>
                        <a href="#SAML_bearer_assertion_scenario_STS_STSBearerCallbackHandler">
                            A.8.2.2.4. STSBearerCallbackHandler Class
                        </a>
                    </li><li>
                        <a href="#SAML_bearer_assertion_scenario_STS_crypto_prop_keystore_files">
                            A.8.2.2.5. Crypto Properties and Keystore Files
                        </a>
                    </li><li>
                        <a href="#SAML_bearer_assertion_scenario_STS_manifest">
                            A.8.2.2.6. Default MANIFEST.MF
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#SAML_bearer_assertion_scenario_WSR">
                            A.8.2.3. Web Service Requester
                        </a><ol>
                <li>
                        <a href="#SAML_bearer_assertion_scenario_WSR_implementation">
                            A.8.2.3.1. Web Service Requester Implementation
                        </a>
                    </li><li>
                        <a href="#SAML_bearer_assertion_scenario_WSR_ClientCallbackHandler">
                            A.8.2.3.2. ClientCallbackHandler
                        </a>
                    </li><li>
                        <a href="#SAML_bearer_assertion_scenario_WSR_crypto_prop_keystore_files">
                            A.8.2.3.3. Crypto Properties and Keystore Files
                        </a>
                    </li>
            </ol>
                    </li>
            </ol>
                    </li><li>
                        <a href="#scenario_onbehalfof_ws_trust">
                            A.8.3. Scenario: OnBehalfOf WS-Trust
                        </a><ol>
                <li>
                        <a href="#OnBehalfOf_ws_trust_scenario_WSP">
                            A.8.3.1. Web Service Provider
                        </a><ol>
                <li>
                        <a href="#OnBehalfOf_ws_trust_scenario_WSP_wsdl">
                            A.8.3.1.1. Web Service Provider WSDL
                        </a>
                    </li><li>
                        <a href="#OnBehalfOf_ws_trust_scenario_WSP_interface">
                            A.8.3.1.2. Web Service Provider Interface
                        </a>
                    </li><li>
                        <a href="#OnBehalfOf_ws_trust_scenario_WSP_implementation">
                            A.8.3.1.3. Web Service Provider Implementation
                        </a>
                    </li><li>
                        <a href="#OnBehalfOf_ws_trust_scenario_WSP_OnBehalfOfCallbackHandler">
                            A.8.3.1.4. OnBehalfOfCallbackHandler Class
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#OnBehalfOf_ws_trust_scenario_WSR">
                            A.8.3.2. Web Service Requester
                        </a><ol>
                <li>
                        <a href="#OnBehalfOf_ws_trust_scenario_WSR_implementation">
                            A.8.3.2.1. OnBehalfOf Web Service Requester Implementation Class
                        </a>
                    </li>
            </ol>
                    </li>
            </ol>
                    </li><li>
                        <a href="#ActAs_ws_trust_scenario">
                            A.8.4. Scenario: ActAs WS-Trust
                        </a><ol>
                <li>
                        <a href="#ActAs_ws_trust_scenario_WSP">
                            A.8.4.1. Web Service Provider
                        </a><ol>
                <li>
                        <a href="#ActAs_ws_trust_scenario_WSP_wsdl">
                            A.8.4.1.1. Web Service Provider WSDL
                        </a>
                    </li><li>
                        <a href="#ActAs_ws_trust_scenario_WSP_interface">
                            A.8.4.1.2. Web Service Provider Interface
                        </a>
                    </li><li>
                        <a href="#ActAs_ws_trust_scenario_WSP_implementation">
                            A.8.4.1.3. Web Service Provider Implementation
                        </a>
                    </li><li>
                        <a href="#ActAs_ws_trust_scenario_WSP_ActAsCallbackHandler">
                            A.8.4.1.4. ActAsCallbackHandler Class
                        </a>
                    </li><li>
                        <a href="#ActAs_ws_trust_scenario_WSP_UsernameTokenCallbackHandler">
                            A.8.4.1.5. UsernameTokenCallbackHandler
                        </a>
                    </li><li>
                        <a href="#ActAs_ws_trust_scenario_WSP_crypto_prop_keystore_files">
                            A.8.4.1.6. Crypto properties and keystore files
                        </a>
                    </li><li>
                        <a href="#ActAs_ws_trust_scenario_WSP_manifest">
                            A.8.4.1.7. Default MANIFEST.MF
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#ActAs_ws_trust_scenario_STS">
                            A.8.4.2. Security Token Service
                        </a><ol>
                <li>
                        <a href="#ActAs_ws_trust_scenario_STS_implementation">
                            A.8.4.2.1. STS Implementation Class
                        </a>
                    </li><li>
                        <a href="#ActAs_ws_trust_scenario_STS_STSCallbackHandler">
                            A.8.4.2.2. STSCallbackHandler Class
                        </a>
                    </li><li>
                        <a href="#ActAs_ws_trust_scenario_WSR">
                            A.8.4.2.3. Web Service Requester
                        </a>
                    </li><li>
                        <a href="#ActAs_ws_trust_scenario_WSR_implementation">
                            A.8.4.2.4. Web Service Requester Implementation Class
                        </a>
                    </li>
            </ol>
                    </li>
            </ol>
                    </li>
            </ol>
                    </li>
            </ol>
                    </li><li>
                        <a href="#idm139695810578400">
                            Legal Notice
                        </a>
                    </li>
            </ol>
            
        
      </div>
    </nav>

    
    <div class="pvof-doc__wrapper" id="doc-wrapper">
        <section class="mimir-doc-title" id="mimir-doc--developing_web_services_applications">
            <h1 class="title">Developing Web Services Applications</h1>
        </section>
        <body><div xml:lang="en-US" class="book" id="idm139695803915504"><div class="titlepage"><div><div class="producttitle"><span class="productname">JBoss Enterprise Application Platform Continuous Delivery</span> <span class="productnumber">18</span></div><div><h2 class="subtitle">For Use with JBoss Enterprise Application Platform Continuous Delivery 18</h2></div><div><div xml:lang="en-US" class="authorgroup"><span class="orgname">Red Hat Customer Content Services </span></div></div><div><a href="#idm139695810578400">Legal Notice</a></div><div><div class="abstract"><p class="title"><strong>Abstract</strong></p><div class="para">
				This guide provides information about how to develop web service applications with JBoss Enterprise Application Platform Continuous Delivery.
			</div></div></div></div><hr/></div><section class="preface" id="idm139695818756704"><div class="titlepage"><div><div><h1 class="title">Preface</h1></div></div></div><p id="preface_cd">
			This document is intended for use with the JBoss Enterprise Application Platform continuous delivery release 18, which is a Technology Preview release available in the cloud only.
		</p><p>
			Some features described in this document might not work or might not be available on Red Hat OpenShift Online and Red Hat OpenShift Container Platform. For specific details about the feature differences in the JBoss EAP CD release, see the <a class="link" href="/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/jboss_eap_continuous_delivery_18_release_notes/index/#cd_release_limitations">Release Limitations</a> section in the <span class="emphasis"><em>JBoss EAP Continuous Delivery 18 Release Notes</em></span>.
		</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
				This continuous delivery release for JBoss EAP is provided as Technology Preview only. Technology Preview features are not supported with Red Hat production service level agreements (SLAs), might not be functionally complete, and Red Hat does not recommend to use them for production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.
			</p><p>
				See <a class="link mimir-link-warn" href="https://access.redhat.com/support/offerings/techpreview" title="This content is not included in Mimir.">Technology Preview Features Support Scope</a> on the Red Hat Customer Portal for information about the support scope for Technology Preview features.
			</p></div></div></section><section class="chapter" id="introduction_to_web_services"><div class="titlepage"><div><div><h1 class="title">Chapter 1. Introduction to Web Services</h1></div></div></div><p>
			Web services provide a standard means of interoperating among different software applications. Each application can run on a variety of platforms and frameworks.
		</p><p>
			Web services facilitate internal, heterogeneous subsystem communication. The interoperability increases service reuse because functions do not need to be rewritten for various environments.
		</p></section><section class="chapter" id="developing_jax_rs_web_services"><div class="titlepage"><div><div><h1 class="title">Chapter 2. Developing JAX-RS Web Services</h1></div></div></div><p>
			JAX-RS is the Java API for RESTful web services. It provides support for building web services using REST, through the use of annotations. These annotations simplify the process of mapping Java objects to web resources.
		</p><p>
			RESTEasy is the Red Hat JBoss Enterprise Application Platform 7 implementation of JAX-RS and is fully compliant with the <a class="link mimir-link-warn" href="https://https://www.jcp.org/en/jsr/detail?id=370" title="Mimir does not include content from: https">JSR 370: Java™ API for RESTful Web Services (JAX-RS 2.1)</a> specification. It also provides additional features to the specification.
		</p><p>
			To get started with JAX-RS, see the <code class="literal">helloworld-rs</code>, <code class="literal">jaxrs-client</code>, and <code class="literal">kitchensink</code> quickstarts that ship with Red Hat JBoss Enterprise Application Platform 7.
		</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
				JBoss EAP does not support the <code class="literal">resteasy-crypto</code>, <code class="literal">resteasy-yaml-provider</code>, and <code class="literal">jose-jwt</code> modules.
			</p></div></div><section class="section" id="JAX-RS_application"><div class="titlepage"><div><div><h2 class="title">2.1. JAX-RS Application</h2></div></div></div><p>
				When creating providers and web resources, you have the following options for declaring them:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Simple subclassing of <code class="literal">javax.ws.rs.core.Application</code> without a <code class="literal">web.xml</code> file.
					</li><li class="listitem">
						Using a <code class="literal">web.xml</code> file.
					</li><li class="listitem">
						Subclassing <code class="literal">javax.ws.rs.core.Application</code> and providing a custom implementation.
					</li></ul></div><section class="section" id="simple_subclassing_literal_javax_ws_rs_core_application_literal"><div class="titlepage"><div><div><h3 class="title">2.1.1. Simple Subclassing <code class="literal">javax.ws.rs.core.Application</code></h3></div></div></div><p>
					You can use the <a class="link mimir-link-warn" href="https://access.redhat.com/webassets/avalon/d/jboss_enterprise_application_platform_continuous_delivery/18/javadocs/javax/ws/rs/core/Application.html" title="This content is not included in Mimir."><code class="literal">javax.ws.rs.core.Application</code></a> class to create a subclass that declares those providers and web resources. This class is provided by the RESTEasy libraries included with JBoss EAP.
				</p><p>
					To configure a resource or provider using <code class="literal">javax.ws.rs.core.Application</code>, simply create a class that extends it and add an <code class="literal">@ApplicationPath</code> annotation.
				</p><div class="formalpara"><p class="title"><strong>Example: Application Class</strong></p><p>
						
<pre class="programlisting language-java">import javax.ws.rs.ApplicationPath;
import javax.ws.rs.core.Application;

@ApplicationPath("/root-path")
public class MyApplication extends Application
{
}</pre>

					</p></div></section><section class="section" id="using_literal_web_xml_literal"><div class="titlepage"><div><div><h3 class="title">2.1.2. Using <code class="literal">web.xml</code></h3></div></div></div><p>
					Alternatively, if you do not want to create a class that extends <code class="literal">javax.ws.rs.core.Application</code>, you can add the following to your <code class="literal">web.xml</code> file.
				</p><div class="formalpara"><p class="title"><strong>Example: web.xml</strong></p><p>
						
<pre class="programlisting language-xml">&lt;web-app version="3.0" xmlns="http://java.sun.com/xml/ns/javaee"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"&gt;
  &lt;servlet&gt;
      &lt;servlet-name&gt;javax.ws.rs.core.Application&lt;/servlet-name&gt;
  &lt;/servlet&gt;
  &lt;servlet-mapping&gt;
      &lt;servlet-name&gt;javax.ws.rs.core.Application&lt;/servlet-name&gt;
      &lt;url-pattern&gt;/root-path/*&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
  ...
&lt;/web-app&gt;</pre>

					</p></div></section><section class="section" id="subclassing_literal_javax_ws_rs_core_application_literal_with_a_custom_implementation"><div class="titlepage"><div><div><h3 class="title">2.1.3. Subclassing <code class="literal">javax.ws.rs.core.Application</code> with a Custom Implementation</h3></div></div></div><p>
					When subclassing <a class="link mimir-link-warn" href="https://access.redhat.com/webassets/avalon/d/jboss_enterprise_application_platform_continuous_delivery/18/javadocs/javax/ws/rs/core/Application.html" title="This content is not included in Mimir."><code class="literal">javax.ws.rs.core.Application</code></a> you can choose to provide a custom implementation for any of the existing methods. The <code class="literal">getClasses</code> and <code class="literal">getSingletons</code> methods return a collection of classes or singletons that must be included in the published JAX-RS application.
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							If either <code class="literal">getClasses</code> and <code class="literal">getSingletons</code> returns a non-empty collection, <span class="emphasis"><em>only</em></span> those classes and singletons are published in the JAX-RS application.
						</li><li class="listitem">
							If <span class="emphasis"><em>both</em></span> <code class="literal">getClasses</code> and <code class="literal">getSingletons</code> return an empty collection, then <span class="emphasis"><em>all</em></span> root resource classes and providers that are packaged in the web application are included in the JAX-RS application. RESTEasy will then automatically discover those resources.
						</li></ul></div></section></section><section class="section" id="jax_rs_client"><div class="titlepage"><div><div><h2 class="title">2.2. JAX-RS Client</h2></div></div></div><section class="section" id="JAX-RS_client_api"><div class="titlepage"><div><div><h3 class="title">2.2.1. JAX-RS Client API</h3></div></div></div><p>
					JAX-RS 2.0 introduced a new client API to send HTTP requests to remote RESTful web services. It is a <span class="emphasis"><em>fluent</em></span> request-building API with 3 main classes:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							<code class="literal">Client</code>
						</li><li class="listitem">
							<code class="literal">WebTarget</code>
						</li><li class="listitem">
							<code class="literal">Response</code>
						</li></ul></div><p>
					The <code class="literal">Client</code> interface is a builder of WebTarget instances. The <code class="literal">WebTarget</code> represents a distinct URL or URL template to build subresource WebTargets or invoke requests on.
				</p><p>
					There are two ways to create a client: the standard way, or using the <code class="literal">ResteasyClientBuilder</code> class. The advantage of using the <code class="literal">ResteasyClientBuilder</code> class is that it provides a few more helper methods to configure your client.
				</p><h5 id="using_the_standard_way_to_create_a_client">Using the Standard Way to Create a Client</h5><p>
					The following example shows one of the standard ways to create a client:
				</p><pre class="programlisting language-java">Client client = ClientBuilder.newClient();</pre><p>
					Alternatively, you can use another standard way to create a client as shown in the example below:
				</p><pre class="programlisting language-java">Client client = ClientBuilder.newBuilder().build();
WebTarget target = client.target("http://foo.com/resource");
Response response = target.request().get();
String value = response.readEntity(String.class);
response.close();  // You should close connections!</pre><h5 id="using_the_resteasyclientbuilder_class_to_create_a_client">Using the ResteasyClientBuilder Class to Create a Client</h5><pre class="programlisting language-java">ResteasyClient client = new ResteasyClientBuilder().build();
ResteasyWebTarget target = client.target("http://foo.com/resource");</pre><p>
					RESTEasy automatically loads a set of default providers that includes all classes listed in the <code class="literal">META-INF/services/javax.ws.rs.ext.Providers</code> file. Additionally, you can manually register other providers, filters, and interceptors through the configuration object provided by the method call <code class="literal">Client.configuration()</code>. Configuration also lets you set configuration properties that might be needed.
				</p><p>
					Each <code class="literal">WebTarget</code> has a configuration instance that inherits the components and properties registered with the parent instance. This lets you set specific configuration options for each target resource, for example, the username and password.
				</p><h5 id="using_resteasy_client_classes">Using RESTEasy Client Classes</h5><p>
					You must add the following dependency for RESTEasy client to your Maven <code class="literal">pom.xml</code> file:
				</p><pre class="programlisting language-xml">&lt;dependency&gt;
	&lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
	&lt;artifactId&gt;resteasy-client&lt;/artifactId&gt;
	&lt;version&gt;<span class="emphasis"><em>VERSION_IN_EAP</em></span>&lt;/version&gt;
 &lt;/dependency&gt;</pre><p>
					See the <code class="literal">jaxrs-client</code> quickstart that ships with JBoss EAP for a working example that uses the RESTEasy client classes.
				</p><h5 id="client_side_filters">Client-side Filters</h5><p>
					The client side has two types of filters:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">ClientRequestFilter</code></span></dt><dd>
								A <code class="literal">ClientRequestFilter</code> runs before an HTTP request is sent over the wire to the server. The <code class="literal">ClientRequestFilter</code> is also allowed to abort the request execution and provide a canned response without going over the wire to the server.
							</dd><dt><span class="term"><code class="literal">ClientResponseFilter</code></span></dt><dd>
								A <code class="literal">ClientResponseFilter</code> runs after a response is received from the server, but before the response body is unmarshalled. The <code class="literal">ClientResponseFilter</code> can modify the response object before it is handed to the application code. The following example illustrates these concepts:
							</dd></dl></div><pre class="programlisting language-java">// execute request filters
for (ClientRequestFilter filter : requestFilters) {
	filter.filter(requestContext);
	if (isAborted(requestContext)) {
    return requestContext.getAbortedResponseObject();
  }
}

// send request over the wire
response = sendRequest(request);

// execute response filters
for (ClientResponseFilter filter : responseFilters) {
	filter.filter(requestContext, responseContext);
}</pre><h5 id="register_client_side_filters_to_the_client_request">Register Client-side Filters to the Client Request</h5><p>
					The following example shows how to register the client-side filters to the client request:
				</p><pre class="programlisting language-java">client = ClientBuilder.newClient();
WebTarget base = client.target(generateURL("/") + "get");
base.register(ClientExceptionsCustomClientResponseFilter.class).request("text/plain").get();</pre><h5 id="client_side_cache">Client-side Cache</h5><p>
					RESTEasy has the ability to set up a client-side cache. This cache looks for cache-control headers sent back with a server response. If the cache-control headers specify that the client is allowed to cache the response, RESTEasy caches it within the local memory.
				</p><pre class="programlisting language-java">ResteasyWebTarget target = client.target(generateBaseUrl());
target.register(BrowserCacheFeature.class);</pre><h5 id="chunked_encoding_support">Chunked Encoding Support</h5><p>
					RESTEasy provides the client API the ability to specify that requests should be sent in a <span class="emphasis"><em>chunked</em></span> transfer mode. There are two ways of specifying the <span class="emphasis"><em>chunked</em></span> transfer mode, as shown below.
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							You can configure the <code class="literal">org.jboss.resteasy.client.jaxrs.ResteasyWebTarget</code> to send all the requests in chunked mode:
						</p><pre class="programlisting language-java">ResteasyClient client = new ResteasyClientBuilder().build();
ResteasyWebTarget target = client.target("http://localhost:8081/test");
target.setChunked(b.booleanValue());
Invocation.Builder request = target.request();</pre></li><li class="listitem"><p class="simpara">
							Alternatively, you can configure a particular request to be sent in chunked mode:
						</p><pre class="programlisting language-java">ResteasyClient client = new ResteasyClientBuilder().build();
ResteasyWebTarget target = client.target("http://localhost:8081/test");
ClientInvocationBuilder request = (ClientInvocationBuilder) target.request();
request.setChunked(b);</pre><p class="simpara">
							Unlike the <code class="literal">javax.ws.rs.client.Invocation.Builder</code> class, <code class="literal">org.jboss.resteasy.client.jaxrs.internal.ClientInvocationBuilder</code> is a RESTEasy class.
						</p></li></ul></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						The ability to send the requests in chunked mode depends on the underlying transport layer. In particular, it depends on the implementation of the <code class="literal">org.jboss.resteasy.client.jaxrs.ClientHttpEngine</code> class being used. Currently, only the default implementation <code class="literal">ApacheHttpClient43Engine</code> and the previous implementation <code class="literal">ApacheHttpClient4Engine</code> support the chunked mode. Both these are available in the <code class="literal">org.jboss.resteasy.client.jaxrs.engines</code> package. See section <a class="link" href="#how_to_use_resteasy_with_closeable_apache_http_client" title="2.2.2. Implementing RESTEasy with HTTP Client">Implementing RESTEasy with HTTP Client</a> for more information.
					</p></div></div></section><section class="section" id="how_to_use_resteasy_with_closeable_apache_http_client"><div class="titlepage"><div><div><h3 class="title">2.2.2. Implementing RESTEasy with HTTP Client</h3></div></div></div><p>
					Network communication between the client and server is handled by default in RESTEasy. It uses the <code class="literal">HttpClient</code> from the Apache <code class="literal">HttpComponents</code> project. The interface between the RESTEasy client framework and the network is defined by the <code class="literal">ClientHttpEngine</code> interface.
				</p><p>
					RESTEasy ships with four implementations of this interface. The default implementation is <code class="literal">ApacheHttpClient43Engine</code>. This implementation uses Apache 4.3.
				</p><p>
					<code class="literal">ApacheHttpClient4Engine</code> is an implementation that uses the versions earlier than Apache 4.3. This class provides backward compatibility. RESTEasy automatically selects one of these two <code class="literal">ClientHttpEngine</code> implementations based on the detection of the Apache version. <code class="literal">InMemoryClientEngine</code> is an implementation that dispatches requests to a server in the same JVM, and <code class="literal">URLConnectionEngine</code> is an implementation that uses <code class="literal">java.net.HttpURLConnection</code>.
				</p><p>
					A client executor can be passed to a specific <code class="literal">ClientRequest</code>:
				</p><pre class="programlisting language-java">ResteasyClient client = new
ResteasyClientBuilder().httpEngine(engine).build();</pre><p>
					RESTEasy and <code class="literal">HttpClient</code> make the default decisions to use the client framework without referencing <code class="literal">HttpClient</code>. However, for some applications it might be necessary to drill down into the <code class="literal">HttpClient</code> details. <code class="literal">ApacheHttpClient43Engine</code> and <code class="literal">ApacheHttpClient4Engine</code> can be supplied with an instance of <code class="literal">org.apache.http.client.HttpClient</code> and <code class="literal">org.apache.http.protocol.HttpContext</code>, which can carry additional configuration details into the <code class="literal">HttpClient</code> layer. For example, authentication can be configured as follows:
				</p><pre class="programlisting language-java">// Configure HttpClient to authenticate preemptively
// by prepopulating the authentication data cache.

// 1. Create AuthCache instance
AuthCache authCache = new BasicAuthCache();

// 2. Generate BASIC scheme object and add it to the local auth cache
AuthScheme basicAuth = new BasicScheme();
authCache.put(new HttpHost("sippycups.bluemonkeydiamond.com"), basicAuth);

// 3. Add AuthCache to the execution context
BasicHttpContext localContext = new BasicHttpContext();
localContext.setAttribute(ClientContext.AUTH_CACHE, authCache);

// 4. Create client executor and proxy
HttpClient httpClient = HttpClientBuilder.create().build();
ApacheHttpClient4Engine engine = new ApacheHttpClient4Engine(httpClient, localContext);
ResteasyClient client = new ResteasyClientBuilder().httpEngine(engine).build();</pre><p>
					<code class="literal">HttpContextProvider</code> is an interface provided by RESTEasy, using which you can supply a custom <code class="literal">HttpContext</code> to the <code class="literal">ApacheHttpClient43Engine</code> and <code class="literal">ApacheHttpClient4Engine</code> implementations.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						It is important to understand the difference between <span class="emphasis"><em>releasing</em></span> a connection and <span class="emphasis"><em>closing</em></span> a connection. Releasing a connection makes it available for reuse. Closing a connection frees its resources and makes it unusable.
					</p></div></div><p>
					RESTEasy releases the connection without notification. The only counter example is the case in which the response is an instance of <code class="literal">InputStream</code>, which must be closed explicitly.
				</p><p>
					On the other hand, if the result of an invocation is an instance of <code class="literal">Response</code>, the <code class="literal">Response.close()</code> method must be used to release the connection.
				</p><pre class="programlisting language-java">WebTarget target = client.target("http://localhost:8081/customer/123");
Response response = target.request().get();
System.out.println(response.getStatus());
response.close();</pre><p>
					You may execute this in a <code class="literal">try-finally</code> block. Releasing a connection makes it available for another use. It does not normally close the socket.
				</p><p>
					<code class="literal">ApacheHttpClient4Engine.finalize()</code> closes any open sockets, if it created the <code class="literal">HttpClient</code> that it has been using. It is not safe to rely on JDK to call <code class="literal">finalize()</code>. If an <code class="literal">HttpClient</code> is passed to the <code class="literal">ApacheHttpClient4Executor</code>, the user must close the connections, as shown below:
				</p><pre class="programlisting language-java">HttpClient httpClient = new HttpClientBuilder.create().build();
ApacheHttpClient4Engine executor = new ApacheHttpClient4Engine(httpClient);
...
httpClient.getConnectionManager().shutdown();</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						If <code class="literal">ApacheHttpClient4Engine</code> has created its own instance of <code class="literal">HttpClient</code>, it is not necessary to wait for <code class="literal">finalize()</code> to close open sockets. The <code class="literal">ClientHttpEngine</code> interface has a <code class="literal">close()</code> method for this purpose.
					</p></div></div><p>
					Finally, if the <code class="literal">javax.ws.rs.client.Client</code> class has created the engine automatically, call <code class="literal">Client.close()</code>. This call cleans up any socket connections.
				</p><section class="section" id="http_redirect"><div class="titlepage"><div><div><h4 class="title">2.2.2.1. HTTP Redirect</h4></div></div></div><p>
						The <code class="literal">ClientHttpEngine</code> implementations based on the Apache HttpClient support HTTP redirection. This feaure is disabled by default. You can enable this by setting the <code class="literal">setFollowRedirects</code> method to <code class="literal">true</code>, as shown below:
					</p><pre class="programlisting language-java">ApacheHttpClient43Engine engine = new ApacheHttpClient43Engine();
engine.setFollowRedirects(true);
Client client = new ResteasyClientBuilder().httpEngine(engine).build();</pre></section></section></section><section class="section" id="jax_rs_request_processing"><div class="titlepage"><div><div><h2 class="title">2.3. JAX-RS Request Processing</h2></div></div></div><section class="section" id="jaxrs_async_processing"><div class="titlepage"><div><div><h3 class="title">2.3.1. Asynchronous HTTP Request Processing</h3></div></div></div><p>
					Asynchronous request processing allows you to process a single HTTP request using non-blocking input and output and, if required, in separate threads.
				</p><p>
					Consider an AJAX chat client in which you want to push and pull from both the client and the server. This scenario has the client blocking for a long time on the server’s socket, waiting for a new message. In case of synchronous HTTP processing, where the server is blocking on incoming and outgoing input and output, you have one separate thread consumed per client connection. This model of request processing consumes a lot of memory and valuable thread resources.
				</p><p>
					Asynchronous processing separates the connection accepting and the request processing operations. It allocates two different threads: one to accept the client connection; the other to handle heavy, time-consuming operations. In this model, the container works as follows:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							It dispatches a thread to accept a client connection, which is the acceptor.
						</li><li class="listitem">
							Then it hands over the request to the processing thread, which is the worker.
						</li><li class="listitem">
							Finally, it releases the acceptor thread.
						</li></ol></div><p>
					The result is sent back to the client by the worker thread. Hence, the client’s connection remains open, thereby improving the server’s throughput and scalability.
				</p><section class="section" id="resteasy_async_nio_request_processing"><div class="titlepage"><div><div><h4 class="title">2.3.1.1. Asynchronous NIO Request Processing</h4></div></div></div><p>
						RESTEasy’s default asynchronous engine implementation class is <code class="literal">ApacheHttpAsyncClient4Engine</code>. It is built on <code class="literal">HttpAsyncClient</code> from the Apache <code class="literal">HttpComponents</code>, which internally dispatches requests using a non-blocking IO model.
					</p><p>
						You can set the asynchronous engine as the active engine by calling the <code class="literal">useAsyncHttpEngine</code> method in the <code class="literal">ResteasyClientBuilder</code> class:
					</p><pre class="programlisting language-java">Client asyncClient = new ResteasyClientBuilder().useAsyncHttpEngine()
                     .build();
Future&lt;Response&gt; future = asyncClient
                          .target("http://locahost:8080/test").request()
                          .async().get();
Response res = future.get();
Assert.assertEquals(HttpResponseCodes.SC_OK, res.getStatus());
String entity = res.readEntity(String.class);</pre></section><section class="section" id="server-async-response-processing"><div class="titlepage"><div><div><h4 class="title">2.3.1.2. Server Asynchronous Response Processing</h4></div></div></div><p>
						On the server side, asynchronous processing involves suspending the original request thread and initiating the request processing on a different thread, which releases the original server-side thread to accept other incoming requests.
					</p><section class="section" id="asyncresponse_api"><div class="titlepage"><div><div><h5 class="title">2.3.1.2.1. AsyncResponse API</h5></div></div></div><p>
							The JAX-RS 2.0 specification added asynchronous HTTP support using two classes: the <code class="literal">@Suspended</code> annotation and the <code class="literal">AsyncResponse</code> interface.
						</p><p>
							Injecting an <code class="literal">AsyncResponse</code> as a parameter to your JAX-RS method prompts RESTEasy to detach the HTTP request and response from the thread being executed currently. This ensures that the current thread does not try to automatically process the response.
						</p><p>
							The <code class="literal">AsyncResponse</code> is the callback object. The act of calling one of the <code class="literal">resume()</code> methods causes a response to be sent back to the client and also terminates the HTTP request. The following is an example of asynchronous processing:
						</p><pre class="programlisting language-java">import javax.ws.rs.container.Suspended;
import javax.ws.rs.container.AsyncResponse;

@Path("/")
public class SimpleResource {
   @GET
   @Path("basic")
   @Produces("text/plain")
   public void getBasic(@Suspended final AsyncResponse response) throws Exception {
      Thread t = new Thread() {
         @Override
         public void run() {
            try {
               Response jaxrs = Response.ok("basic").type(MediaType.TEXT_PLAIN).build();
               response.resume(jaxrs);
            }
            catch (Exception e) {
               e.printStackTrace();
            }
         }
      };
      t.start();
   }
}</pre></section></section><section class="section" id="async_invoker_client_api"><div class="titlepage"><div><div><h4 class="title">2.3.1.3. AsyncInvoker Client API</h4></div></div></div><p>
						Similarly, on the client side, asynchronous processing prevents blocking the request thread since no time is spent waiting for a response from the server. For instance, a thread that issued a request may also update a user interface component. If that thread is blocked waiting for a response, the user’s perceived performance of the application will suffer.
					</p><section class="section" id="using_future"><div class="titlepage"><div><div><h5 class="title">2.3.1.3.1. Using Future</h5></div></div></div><p>
							In the code snippet below, the <code class="literal">get()</code> method is called on the <code class="literal">async()</code> method rather than the request. This changes the call mechanism from synchronous to asynchronous. Instead of responding synchronously, the <code class="literal">async()</code> method returns a <code class="literal">future</code> object. When you call the <code class="literal">get()</code> method, the call is blocked until the response is ready. The <code class="literal">future.get()</code> method will be returned whenever the response is ready.
						</p><pre class="programlisting language-java">import java.util.concurrent.Future;
import javax.ws.rs.client.Client;
...

@Test
public void AsyncGetTest() throws Exception {
    Client client = ClientBuilder.newClient();
    Future&lt;String&gt; future = client.target(generateURL("/test")).request().async().get(String.class);
    String entity = future.get();
    Assert.assertEquals("get", entity);
}</pre></section><section class="section" id="using_invocationcallback"><div class="titlepage"><div><div><h5 class="title">2.3.1.3.2. Using InvocationCallback</h5></div></div></div><p>
							The <code class="literal">AsyncInvoker</code> interface allows you to register an object that will be called back when the asynchronous invocation is ready for processing. The <code class="literal">InvocationCallback</code> interface provides two methods: <code class="literal">completed()</code> and <code class="literal">failed()</code>. The <code class="literal">completed()</code> method is called whenever the processing is finished successfully and the response is received. Conversely, the <code class="literal">failed()</code> method is called whenever the request processing is not successful.
						</p><pre class="programlisting language-java">import javax.ws.rs.client.InvocationCallback;
...

@Test
public void AsyncCallbackGetTest() throws Exception {
    Client client = ClientBuilder.newClient();
	final CountDownLatch latch = new CountDownLatch(1);
        Future&lt;Response&gt; future = client.target(generateURL("/test")).request().async().get(new InvocationCallback&lt;Response&gt;() {
         	@Override
                public void completed(Response response) {
                    String entity = response.readEntity(String.class);
                    Assert.assertEquals("get", entity);
                    latch.countDown();
                }

                @Override
                public void failed(Throwable error) {
                }
            });
            Response res = future.get();
            Assert.assertEquals(HttpResponseCodes.SC_OK, res.getStatus());
            Assert.assertTrue("Asynchronous invocation didn't use custom implemented Invocation callback", latch.await(5, imeUnit.SECONDS));
}</pre></section></section></section><section class="section" id="custom_resteasy_annotations"><div class="titlepage"><div><div><h3 class="title">2.3.2. Custom RESTEasy Annotations</h3></div></div></div><p>
					With the addition of parameter names in the bytecode, you are no longer required to specify the parameter names in the following annotations: <code class="literal">@PathParam</code>, <code class="literal">@QueryParam</code>, <code class="literal">@FormParam</code>, <code class="literal">@CookieParam</code>, <code class="literal">@HeaderParam</code> and <code class="literal">@MatrixParam</code>. To do so, you must switch to the new annotations with the same name, in a different package, which have an optional value parameter. You can achieve this by following the steps below:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Import the <code class="literal">org.jboss.resteasy.annotations.jaxrs</code> package to replace annotations from the JAX-RS specifications.
						</li><li class="listitem"><p class="simpara">
							Configure your build system to record the method parameter names in the bytecode.
						</p><p class="simpara">
							Maven users can enable recording method parameter names in the bytecode by setting the <code class="literal">maven.compiler.parameters</code> to <code class="literal">true</code>:
						</p><pre class="programlisting language-java">&lt;properties&gt;
    &lt;maven.compiler.parameters&gt;true&lt;/maven.compiler.parameters&gt;
&lt;/properties&gt;</pre></li><li class="listitem"><p class="simpara">
							Remove the annotation value if the name matches the name of the annotated variable.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								You can omit the annotation name for annotated method parameters as well as annotated fields or the JavaBean properties.
							</p></div></div></li></ol></div><p>
					Consider the following usage for an example:
				</p><pre class="programlisting language-java">import org.jboss.resteasy.annotations.jaxrs.*;

@Path("/library")
public class Library {

   @GET
   @Path("/book/{isbn}")
   public String getBook(@PathParam String isbn) {
      // search my database and get a string representation and return it
   }
}</pre><p>
					If your annotated variable does not have the same name as the path parameter, you can specify the name as shown below:
				</p><pre class="programlisting language-java">import org.jboss.resteasy.annotations.jaxrs.*;

@Path("/library")
public class Library {

   @GET
   @Path("/book/{isbn}")
   public String getBook(@PathParam("isbn") String id) {
      // search my database and get a string representation and return it
   }
}</pre></section></section><section class="section" id="viewing_resteasy_endpoints"><div class="titlepage"><div><div><h2 class="title">2.4. Viewing RESTEasy Endpoints</h2></div></div></div><p>
				You can use the <code class="literal">read-resource</code> operation of the <code class="literal">jaxrs</code> subsystem to view structured output of each RESTEasy endpoint. An example of the management CLI command and the expected outcome is provided below.
			</p><pre class="screen">/deployment=<span class="emphasis"><em>DEPLOYMENT_NAME</em></span>/subsystem=jaxrs/rest-resource=org.jboss.as.quickstarts.rshelloworld.HelloWorld:read-resource(include-runtime=true)
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "resource-class" =&gt; "org.jboss.as.quickstarts.rshelloworld.HelloWorld",
        "rest-resource-paths" =&gt; [
            {
                "resource-path" =&gt; "/hello/json",
                "consumes" =&gt; undefined,
                "produces" =&gt; [
                    "application/json",
                    "text/plain"
                ],
                "java-method" =&gt; "java.lang.String org.jboss.as.quickstarts.rshelloworld.HelloWorld.getHelloWorldJSON()",
                "resource-methods" =&gt; [
                    "POST /wildfly-helloworld-rs/rest/hello/json",
                    "GET /wildfly-helloworld-rs/rest/hello/json"
                ]
            },
            {
                "resource-path" =&gt; "/hello/xml",
                "consumes" =&gt; undefined,
                "produces" =&gt; ["application/xml"],
                "java-method" =&gt; "java.lang.String org.jboss.as.quickstarts.rshelloworld.HelloWorld.getHelloWorldXML(@QueryParam java.lang.String name = 'LGAO')",
                "resource-methods" =&gt; ["GET /wildfly-helloworld-rs/rest/hello/xml"]
            }
        ],
        "sub-resource-locators" =&gt; [{
            "resource-class" =&gt; "org.jboss.as.quickstarts.rshelloworld.SubHelloWorld",
            "rest-resource-paths" =&gt; [
                {
                    "resource-path" =&gt; "/hello/subMessage/",
                    "consumes" =&gt; undefined,
                    "produces" =&gt; undefined,
                    "java-method" =&gt; "java.lang.String org.jboss.as.quickstarts.rshelloworld.SubHelloWorld.helloInSub()",
                    "resource-methods" =&gt; ["GET /wildfly-helloworld-rs/rest/hello/subMessage/"]
                },
                {
                    "resource-path" =&gt; "/hello/subMessage/subPath",
                    "consumes" =&gt; undefined,
                    "produces" =&gt; undefined,
                    "java-method" =&gt; "java.lang.String org.jboss.as.quickstarts.rshelloworld.SubHelloWorld.subPath()",
                    "resource-methods" =&gt; ["GET /wildfly-helloworld-rs/rest/hello/subMessage/subPath"]
                }
            ],
            "sub-resource-locators" =&gt; undefined
        }]
    }
}</pre><p>
				In the example above, the output information is grouped by the <code class="literal">resource-class</code> and ordered as per the <code class="literal">resource-path</code>:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">resource-path</code> is the address to access the endpoint.
					</li><li class="listitem">
						<code class="literal">resource-class</code> defines the class, where the endpoint is defined.
					</li><li class="listitem">
						<code class="literal">rest-resource-paths</code> includes the Java methods that define the resource path, HTTP method, consumes and produces of the endpoint.
					</li><li class="listitem">
						<code class="literal">java-method</code> specifies the name of the Java method and its parameters. It also contains information about the following JAX-RS annotations, if defined: <code class="literal">@PathParam</code>, <code class="literal">@QueryParam</code>, <code class="literal">@HeaderParam</code>, <code class="literal">@MatrixParam</code>, <code class="literal">@CookieParam</code>, <code class="literal">@FormParam</code> and <code class="literal">@DefaultValue</code>.
					</li></ul></div><p>
				Alternatively, you can use the <code class="literal">read-resource</code> operation without the <code class="literal">rest-resource</code> parameter defined and get the information about all the endpoints, as shown in the example below:
			</p><pre class="screen">/deployment=<span class="emphasis"><em>DEPLOYMENT_NAME</em></span>/subsystem=jaxrs:read-resource(include-runtime=true,recursive=true)</pre></section><section class="section" id="url_based_negotiation"><div class="titlepage"><div><div><h2 class="title">2.5. URL-Based Negotiation</h2></div></div></div><section class="section" id="mapping_extensions_to_media_types"><div class="titlepage"><div><div><h3 class="title">2.5.1. Mapping Extensions to Media Types</h3></div></div></div><p>
					Some clients, such as browsers, cannot use the <code class="literal">Accept</code> and <code class="literal">Accept-Language</code> headers to negotiate the representation media type or language. RESTEasy can map file name suffixes to media types and languages to deal with this issue.
				</p><p>
					To map media types to file extensions using the <code class="literal">web.xml</code> file, you need to add a <code class="literal">resteasy.media.type.mappings</code> context param and the list of mappings as the <code class="literal">param-value</code>. The list is comma separated and uses colons (<code class="literal">:</code>) to delimit the file extension and media type.
				</p><div class="formalpara"><p class="title"><strong>Example <code class="literal">web.xml</code> Mapping File Extensions to Media Types</strong></p><p>
						
<pre class="programlisting language-xml">&lt;context-param&gt;
    &lt;param-name&gt;resteasy.media.type.mappings&lt;/param-name&gt;
    &lt;param-value&gt;html : text/html, json : application/json, xml : application/xml&lt;/param-value&gt;
&lt;/context-param&gt;</pre>

					</p></div><p>
					In this example, the following URL variants for <code class="literal">http://localhost:8080/my-application/test</code> would be mapped:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							<code class="literal">http://localhost:8080/my-application/test.html</code>
						</li><li class="listitem">
							<code class="literal">http://localhost:8080/my-application/test.json</code>
						</li><li class="listitem">
							<code class="literal">http://localhost:8080/my-application/test.xml</code>
						</li></ul></div></section><section class="section" id="mapping_extensions_to_languages"><div class="titlepage"><div><div><h3 class="title">2.5.2. Mapping Extensions to Languages</h3></div></div></div><p>
					Some clients, such as browsers, cannot use the <code class="literal">Accept</code> and <code class="literal">Accept-Language</code> headers to negotiate the representation media type or language. RESTEasy can map file name suffixes to media types and languages to deal with this issue. Follow these steps to map languages to file extensions, in the <code class="literal">web.xml</code> file.
				</p><p>
					To map media types to file extensions using the <code class="literal">web.xml</code> file, you need to add a <code class="literal">resteasy.language.mappings</code> context param and the list of mappings as the <code class="literal">param-value</code>. The list is comma separated and uses colons (<code class="literal">:</code>) to delimit the file extension and language type.
				</p><div class="formalpara"><p class="title"><strong>Example <code class="literal">web.xml</code> Mapping File Extensions to Language Types</strong></p><p>
						
<pre class="programlisting language-xml">&lt;context-param&gt;
    &lt;param-name&gt;resteasy.language.mappings&lt;/param-name&gt;
    &lt;param-value&gt; en : en-US, es : es, fr : fr&lt;/param-name&gt;
&lt;/context-param&gt;</pre>

					</p></div><p>
					In this example, the following URL variants for <code class="literal">http://localhost:8080/my-application/test</code> would be mapped:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							<code class="literal">http://localhost:8080/my-application/test.en</code>
						</li><li class="listitem">
							<code class="literal">http://localhost:8080/my-application/test.es</code>
						</li><li class="listitem">
							<code class="literal">http://localhost:8080/my-application/test.fr</code>
						</li></ul></div></section></section><section class="section" id="content_marshalling_and_providers"><div class="titlepage"><div><div><h2 class="title">2.6. Content Marshalling and Providers</h2></div></div></div><section class="section" id="default_providers_and_default_jax_rs_content_marshalling"><div class="titlepage"><div><div><h3 class="title">2.6.1. Default Providers and Default JAX-RS Content Marshalling</h3></div></div></div><p>
					RESTEasy can automatically marshal and unmarshal a few different message bodies.
				</p><div class="table" id="idm139695818805440"><p class="title"><strong>Table 2.1. Supported Media Types and Java Types</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"><!--Empty--></col><col style="width: 50%; " class="col_2"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139695815859632" scope="col">Media Types</th><th align="left" valign="top" id="idm139695815858544" scope="col">Java Types</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139695815859632"> <p>
									<code class="literal">application/* +xml</code>, <code class="literal">text/* +xml</code>, <code class="literal">application/* +json</code>, <code class="literal">application/* +fastinfoset</code>, <code class="literal">application/ atom+*</code>
								</p>
								 </td><td align="left" valign="top" headers="idm139695815858544"> <p>
									JAXB annotated classes
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695815859632"> <p>
									<code class="literal">application/* +xml</code>, <code class="literal">text/* +xml</code>
								</p>
								 </td><td align="left" valign="top" headers="idm139695815858544"> <p>
									org.w3c.dom.Document
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695815859632"> <p>
									* / *
								</p>
								 </td><td align="left" valign="top" headers="idm139695815858544"> <p>
									java.lang.String
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695815859632"> <p>
									* / *
								</p>
								 </td><td align="left" valign="top" headers="idm139695815858544"> <p>
									java.io.InputStream
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695815859632"> <p>
									<code class="literal">text/plain</code>
								</p>
								 </td><td align="left" valign="top" headers="idm139695815858544"> <p>
									primitives, java.lang.String, or any type that has a String constructor, or static valueOf(String) method for input, toString() for output
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695815859632"> <p>
									* / *
								</p>
								 </td><td align="left" valign="top" headers="idm139695815858544"> <p>
									javax.activation.DataSource
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695815859632"> <p>
									* / *
								</p>
								 </td><td align="left" valign="top" headers="idm139695815858544"> <p>
									java.io.File
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695815859632"> <p>
									* / *
								</p>
								 </td><td align="left" valign="top" headers="idm139695815858544"> <p>
									byte
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695815859632"> <p>
									<code class="literal">application/x-www-form-urlencoded</code>
								</p>
								 </td><td align="left" valign="top" headers="idm139695815858544"> <p>
									javax.ws.rs.core.MultivaluedMap
								</p>
								 </td></tr></tbody></table></div></div><section class="section" id="text_media_types_charsets"><div class="titlepage"><div><div><h4 class="title">2.6.1.1. Text Media Types and Character Sets</h4></div></div></div><p>
						According to the JAX-RS specification, implementations must adhere to application-supplied character set metadata when writing responses. If a character set is not specified by the application or if the application specifies a character set that is not supported, then the implementations must use UTF-8 character set.
					</p><p>
						On the contrary, according to the HTTP specification, when no explicit charset parameter is provided by the sender, media subtypes of the <code class="literal">text</code> type are defined to have a default charset value of <code class="literal">ISO-8859-1</code> when received via HTTP. Data in character sets other than <code class="literal">ISO-8859-1</code> or its subsets must be labeled with an appropriate charset value.
					</p><p>
						In the absence of a character set specified by a resource or resource method, RESTEasy uses UTF-8 as the character set for text media types. In order to do so, RESTEasy adds an explicit charset parameter to the content-type response header.
					</p><p>
						To specify the original behavior, in which UTF-8 is used for text media types but the explicit charset parameter is not appended, set the context parameter <code class="literal">resteasy.add.charset</code> to <code class="literal">false</code>. The default value of this parameter is <code class="literal">true</code>.
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							Text media types include:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									Media types with type <code class="literal">text</code> and any subtype.
								</li><li class="listitem">
									Media types with type <code class="literal">application</code> and subtype beginning with <code class="literal">xml</code>. This includes <code class="literal">application/xml-external-parsed-entity</code> and <code class="literal">application/xml-dtd</code>.
								</li></ul></div></div></div></section></section><section class="section" id="jaxrs_content_marshalling_provider_classes"><div class="titlepage"><div><div><h3 class="title">2.6.2. Content Marshalling with @Provider classes</h3></div></div></div><p>
					The JAX-RS specification allows you to plug in your own request/response body readers and writers. To do this, you annotate a class with <code class="literal">@Provider</code> and specify the <code class="literal">@Produces</code> types for a writer and <code class="literal">@Consumes</code> types for a reader. You must also implement a <code class="literal">MessageBodyReader/Writer</code> interface.
				</p><p>
					The RESTEasy <code class="literal">ServletContextLoader</code> automatically scans the <code class="literal">WEB-INF/lib</code> and classes directories for classes annotated with <code class="literal">@Provider</code>, or you can manually configure them in the <code class="literal">web.xml</code> file.
				</p></section><section class="section" id="jaxrs_provider_utility_class"><div class="titlepage"><div><div><h3 class="title">2.6.3. Providers Utility Class</h3></div></div></div><p>
					<code class="literal">javax.ws.rs.ext.Providers</code> is a simple injectable interface that allows you to look up <code class="literal">MessageBodyReaders</code>, <code class="literal">Writers</code>, <code class="literal">ContextResolvers</code>, and <code class="literal">ExceptionMappers</code>. It is very useful for implementing multipart providers and content types that embed other random content types.
				</p><pre class="programlisting language-java">public interface Providers {
  &lt;T&gt; MessageBodyReader&lt;T&gt; getMessageBodyReader(Class&lt;T&gt; type, Type genericType, Annotation annotations[], MediaType mediaType);
  &lt;T&gt; MessageBodyWriter&lt;T&gt; getMessageBodyWriter(Class&lt;T&gt; type, Type genericType, Annotation annotations[], MediaType mediaType);
  &lt;T extends="" throwable=""&gt; ExceptionMapper&lt;T&gt; getExceptionMapper(Class&lt;T&gt; type);
  &lt;T&gt; ContextResolver&lt;T&gt; getContextResolver(Class&lt;T&gt; contextType, MediaType mediaType);
}</pre><p>
					A <code class="literal">Providers</code> instance is injectable into <code class="literal">MessageBodyReader</code> or <code class="literal">Writers</code>:
				</p><pre class="programlisting language-java">@Provider
@Consumes("multipart/fixed")
public class MultipartProvider implements MessageBodyReader {

  private @Context Providers providers;
  ...
}</pre></section><section class="section" id="jaxrs_configure_doc_marshalling"><div class="titlepage"><div><div><h3 class="title">2.6.4. Configuring Document Marshalling</h3></div></div></div><p>
					XML document parsers are subject to a form of attack known as the XXE (XML eXternal Entity) attack, in which expanding an external entity causes an unsafe file to be loaded. For example, the following document could cause the <code class="literal">/etc/passwd</code> file to be loaded.
				</p><pre class="programlisting language-xml">&lt;!--?xml version="1.0"?--&gt;
&lt;!DOCTYPE foo
[&lt;!ENTITY xxe SYSTEM "file:///etc/passwd"&gt;]&gt;
&lt;search&gt;
 &lt;user&gt;bill&lt;/user&gt;
 &lt;file&gt;&amp;xxe;&lt;file&gt;
&lt;/search&gt;</pre><p>
					By default, the RESTEasy built-in unmarshaller for <code class="literal">org.w3c.dom.Document</code> documents does not expand external entities. It replaces them with an empty string. You can configure it to replace external entities with values defined in the DTD. This is done by setting the <code class="literal">resteasy.document.expand.entity.references</code> context parameter to <code class="literal">true</code> in the <code class="literal">web.xml</code> file.
				</p><div class="formalpara"><p class="title"><strong>Example: Setting the <code class="literal">resteasy.document.expand.entity.references</code> Context Parameter</strong></p><p>
						
<pre class="programlisting language-xml">&lt;context-param&gt;
 &lt;param-name&gt;resteasy.document.expand.entity.references&lt;/param-name&gt;
 &lt;param-value&gt;true&lt;/param-value&gt;
&lt;/context-param&gt;</pre>

					</p></div><p>
					Another way of dealing with the problem is by prohibiting DTDs, which RESTEasy does by default. This behavior can be changed by setting the <code class="literal">resteasy.document.secure.disableDTDs</code> context parameter to <code class="literal">false</code>.
				</p><div class="formalpara"><p class="title"><strong>Example: Setting the <code class="literal">resteasy.document.secure.disableDTDs</code> Context Parameter</strong></p><p>
						
<pre class="programlisting language-xml">&lt;context-param&gt;
 &lt;param-name&gt;resteasy.document.secure.disableDTDs&lt;/param-name&gt;
 &lt;param-value&gt;false&lt;/param-value&gt;
&lt;/context-param&gt;</pre>

					</p></div><p>
					Documents are also subject to <span class="emphasis"><em>Denial of Service Attacks</em></span> when buffers are overrun by large entities or too many attributes. For example, if a DTD defined the following entities, the expansion of <code class="literal">&amp;foo6;</code> would result in 1,000,000 foos.
				</p><pre class="programlisting language-xml">&lt;!--ENTITY foo 'foo'--&gt;
&lt;!--ENTITY foo1 '&amp;foo;&amp;foo;&amp;foo;&amp;foo;&amp;foo;&amp;foo;&amp;foo;&amp;foo;&amp;foo;&amp;foo;'--&gt;
&lt;!--ENTITY foo2 '&amp;foo1;&amp;foo1;&amp;foo1;&amp;foo1;&amp;foo1;&amp;foo1;&amp;foo1;&amp;foo1;&amp;foo1;&amp;foo1;'--&gt;
&lt;!--ENTITY foo3 '&amp;foo2;&amp;foo2;&amp;foo2;&amp;foo2;&amp;foo2;&amp;foo2;&amp;foo2;&amp;foo2;&amp;foo2;&amp;foo2;'--&gt;
&lt;!--ENTITY foo4 '&amp;foo3;&amp;foo3;&amp;foo3;&amp;foo3;&amp;foo3;&amp;foo3;&amp;foo3;&amp;foo3;&amp;foo3;&amp;foo3;'--&gt;
&lt;!--ENTITY foo5 '&amp;foo4;&amp;foo4;&amp;foo4;&amp;foo4;&amp;foo4;&amp;foo4;&amp;foo4;&amp;foo4;&amp;foo4;&amp;foo4;'--&gt;
&lt;!--ENTITY foo6 '&amp;foo5;&amp;foo5;&amp;foo5;&amp;foo5;&amp;foo5;&amp;foo5;&amp;foo5;&amp;foo5;&amp;foo5;&amp;foo5;'--&gt;</pre><p>
					By default, RESTEasy limits the number of expansions and the number of attributes per entity. The exact behavior depends on the underlying parser. The limit can be turned off by setting the <code class="literal">resteasy.document.secure.processing.feature</code> context parameter to <code class="literal">false</code>.
				</p><div class="formalpara"><p class="title"><strong>Example: Setting the <code class="literal">resteasy.document.secure.processing.feature</code> Context Parameter</strong></p><p>
						
<pre class="programlisting language-xml">&lt;context-param&gt;
 &lt;param-name&gt;resteasy.document.secure.processing.feature&lt;/param-name&gt;
 &lt;param-value&gt;false&lt;/param-value&gt;
&lt;/context-param&gt;</pre>

					</p></div></section><section class="section" id="using_mapprovider"><div class="titlepage"><div><div><h3 class="title">2.6.5. Using MapProvider</h3></div></div></div><p>
					You can use <code class="literal">MapProvider</code> to accept and return a map with JAX-RS resources.
				</p><div class="formalpara"><p class="title"><strong>Example: Resource Accepting and Returning a Map</strong></p><p>
						
<pre class="programlisting language-java">@Path("manipulateMap")
@POST
@Consumes("application/x-www-form-urlencoded")
@Produces("application/x-www-form-urlencoded")
public MultivaluedMap&lt;String, String&gt; manipulateMap(MultivaluedMap&lt;String, String&gt; map) {
  //do something
  return map;
}</pre>

					</p></div><p>
					You can also send and receive maps to JAX-RS resources using the client.
				</p><div class="formalpara"><p class="title"><strong>Example: Client</strong></p><p>
						
<pre class="programlisting language-java">MultivaluedMap&lt;String, String&gt; map = new MultivaluedHashMap&lt;String, String&gt;();

//add values to the map...

Response response = client.target(generateURL("/manipulateMap"))
                          .request(MediaType.APPLICATION_FORM_URLENCODED_TYPE)
                          .post(Entity.entity(map, MediaType.APPLICATION_FORM_URLENCODED_TYPE));

String data = response.readEntity(String.class);

//handle data...</pre>

					</p></div></section><section class="section" id="converting_string_based_annotations_to_objects"><div class="titlepage"><div><div><h3 class="title">2.6.6. Converting String Based Annotations to Objects</h3></div></div></div><p>
					JAX-RS <code class="literal">@*Param</code> annotations, including <code class="literal">@QueryParam</code>, <code class="literal">@MatrixParam</code>, <code class="literal">@HeaderParam</code>, <code class="literal">@PathParam</code>, and <code class="literal">@FormParam</code>, are represented as strings in a raw HTTP request. These types of injected parameters can be converted to objects if these objects have a <code class="literal">valueOf(String)</code> static method or a constructor that takes one <code class="literal">String</code> parameter.
				</p><p>
					If you have a class where the <code class="literal">valueOf()</code> method or the string constructor does not exist or is inappropriate for an HTTP request, JAX-RS provides the <code class="literal">javax.ws.rs.ext.ParamConverterProvider</code> and <code class="literal">javax.ws.rs.ext.ParamConverter</code> to help convert the message parameter value to the corresponding custom Java type. <code class="literal">ParamConverterProvider</code> must be either programmatically registered in a JAX-RS runtime or must be annotated with <code class="literal">@Provider</code> annotation to be automatically discovered by the JAX-RS runtime during a provider scanning phase.
				</p><p>
					For example: The steps below demonstrate how to create a custom POJO object. The conversion from message parameter value such as <code class="literal">@QueryParam</code>, <code class="literal">@PathParam</code>, <code class="literal">@MatrixParam</code>, <code class="literal">@HeaderParam</code> into POJO object is done by implementation of <code class="literal">ParamConverter</code> and <code class="literal">ParamConverterProvider</code> interfaces.
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Create the custom POJO class.
						</p><pre class="programlisting language-java">public class POJO {
  private String name;

  public String getName() {
    return name;
  }

  public void setName(String name) {
    this.name = name;
  }
}</pre></li><li class="listitem"><p class="simpara">
							Create the custom POJO Converter class.
						</p><pre class="programlisting language-java">public class POJOConverter implements ParamConverter&lt;POJO&gt; {
  public POJO fromString(String str) {
    System.out.println("FROM STRNG: " + str);
    POJO pojo = new POJO();
    pojo.setName(str);
    return pojo;
  }

  public String toString(POJO value) {
    return value.getName();
  }
}</pre></li><li class="listitem"><p class="simpara">
							Create the custom POJO Converter Provider class.
						</p><pre class="programlisting language-java">public class POJOConverterProvider implements ParamConverterProvider {
  @Override
  public &lt;T&gt; ParamConverter&lt;T&gt; getConverter(Class&lt;T&gt; rawType, Type genericType, Annotation[] annotations) {
    if (!POJO.class.equals(rawType)) return null;
    return (ParamConverter&lt;T&gt;)new POJOConverter();
  }
}</pre></li><li class="listitem"><p class="simpara">
							Create the custom MyResource class.
						</p><pre class="programlisting language-java">@Path("/")
public class MyResource {
  @Path("{pojo}")
  @PUT
  public void put(@QueryParam("pojo") POJO q, @PathParam("pojo") POJO pp, @MatrixParam("pojo") POJO mp,
    @HeaderParam("pojo") POJO hp) {
    ...
  }
}</pre></li></ol></div><h5 id="extending_paramconverter_functionality">Extending the Functionality of the ParamConverter</h5><p>
					In the JAX-RS semantics, a <code class="literal">ParamConverter</code> converts a single string that represents an individual object. RESTEasy extends the semantics to allow a <code class="literal">ParamConverter</code> to parse the string representation of multiple objects and generate a <code class="literal">List&lt;T&gt;</code>, <code class="literal">Set&lt;T&gt;</code>, <code class="literal">SortedSet&lt;T&gt;</code>, <code class="literal">array</code>, or any other multi-valued data structure.
				</p><p>
					For an example, consider the resource:
				</p><pre class="programlisting language-java">@Path("queryParam")
public static class TestResource {
   @GET
   @Path("")
   public Response conversion(@QueryParam("q") List&lt;String&gt; list) {
      return Response.ok(stringify(list)).build();
   }
}

private static &lt;T&gt; String stringify(List&lt;T&gt; list) {
   StringBuffer sb = new StringBuffer();
   for (T s : list) {
      sb.append(s).append(',');
   }
   return sb.toString();
}</pre><p>
					Calling <code class="literal">TestResource</code> as follows, using the standard notation:
				</p><pre class="programlisting language-java">@Test
public void testQueryParamStandard() throws Exception {
   ResteasyClient client = new ResteasyClientBuilder().build();
   Invocation.Builder request = client.target("http://localhost:8081/queryParam?q=20161217&amp;q=20161218&amp;q=20161219").request();
   Response response = request.get();
   System.out.println("response: " + response.readEntity(String.class));
}</pre><p>
					results in <code class="literal">response: 20161217,20161218,20161219,</code>.
				</p><p>
					If you want to use a comma-separated notation instead, you can add:
				</p><pre class="programlisting language-java">public static class MultiValuedParamConverterProvider implements ParamConverterProvider
   @SuppressWarnings("unchecked")
   @Override
   public &lt;T&gt; ParamConverter&lt;T&gt; getConverter(Class&lt;T&gt; rawType, Type genericType, Annotation[] annotations) {
      if (List.class.isAssignableFrom(rawType)) {
         return (ParamConverter&lt;T&gt;) new MultiValuedParamConverter();
      }
      return null;
   }
}

public static class MultiValuedParamConverter implements ParamConverter&lt;List&lt;?&gt;&gt; {
   @Override
   public List&lt;?&gt; fromString(String param) {
      if (param == null || param.trim().isEmpty()) {
         return null;
      }
      return parse(param.split(","));
   }

   @Override
   public String toString(List&lt;?&gt; list) {
      if (list == null || list.isEmpty()) {
         return null;
      }
      return stringify(list);
   }

   private static List&lt;String&gt; parse(String[] params) {
      List&lt;String&gt; list = new ArrayList&lt;String&gt;();
      for (String param : params) {
         list.add(param);
      }
      return list;
   }
}</pre><p>
					Now you can call <code class="literal">TestResource</code> as follows:
				</p><pre class="programlisting language-java">@Test
public void testQueryParamCustom() throws Exception {
   ResteasyClient client = new ResteasyClientBuilder().build();
   Invocation.Builder request = client.target("http://localhost:8081/queryParam?q=20161217,20161218,20161219").request();
   Response response = request.get();
   System.out.println("response: " + response.readEntity(String.class));
}</pre><p>
					and get <code class="literal">response: 20161217,20161218,20161219,</code>.
				</p><p>
					In this case, the <code class="literal">MultiValuedParamConverter.fromString()</code> function creates and returns an <code class="literal">ArrayList</code>, so that the <code class="literal">TestResource.conversion()</code> function can be rewritten:
				</p><pre class="programlisting language-java">@Path("queryParam")
public static class TestResource {

   @GET
   @Path("")
   public Response conversion(@QueryParam("q") ArrayList&lt;String&gt; list) {
      return Response.ok(stringify(list)).build();
   }
}</pre><p>
					Alternatively, <code class="literal">MultiValuedParamConverter</code> can be rewritten to return a <code class="literal">LinkList</code> and the parameter list in <code class="literal">TestResource.conversion()</code> can be either a <code class="literal">List</code> or a <code class="literal">LinkedList</code>.
				</p><p>
					Finally, note that this extension works for arrays as well. For example,
				</p><pre class="programlisting language-java">public static class Foo {
    private String foo;
    public Foo(String foo) {
        this.foo = foo;
    }
    public String getFoo() {
        return foo;
    }
}

public static class FooArrayParamConverter implements ParamConverter &lt; Foo[] &gt; {
    @Override
    public Foo[] fromString(String value) {
        String[] ss = value.split(",");
        Foo[] fs = new Foo[ss.length];
        int i = 0;
        for (String s: ss) {
            fs[i++] = new Foo(s);
        }
        return fs;
    }

    @Override
    public String toString(Foo[] values) {
        StringBuffer sb = new StringBuffer();
        for (int i = 0; i &lt; values.length; i++) {
            sb.append(values[i].getFoo()).append(",");
        }
        if (sb.length() &gt; 0) {
            sb.deleteCharAt(sb.length() - 1);
        }
        return sb.toString();
    }
}

@Provider
public static class FooArrayParamConverterProvider implements ParamConverterProvider {
    @SuppressWarnings("unchecked")
    @Override
    public &lt; T &gt; ParamConverter &lt; T &gt; getConverter(Class &lt; T &gt; rawType, Type genericType, Annotation[] annotations) {
        if (rawType.equals(Foo[].class));
        return (ParamConverter &lt; T &gt; ) new FooArrayParamConverter();
    }
}

@Path("")
public static class ParamConverterResource {

    @GET
    @Path("test")
    public Response test(@QueryParam("foos") Foo[] foos) {
        return Response.ok(new FooArrayParamConverter().toString(foos)).build();
    }
}</pre><h5 id="java-util-optional-parameter-types_default"><code class="literal">java.util.Optional</code> Parameter Types</h5><p>
					RESTEasy offers several additional <code class="literal">java.util.Optional</code> parameter types. These parameter types act as wrapper object types. They allow users to input optional typed parameters, and eliminate all null checks by using methods like <code class="literal">Optional.orElse()</code>.
				</p><pre class="programlisting language-java">@Path("/double")
@GET
public String optDouble(@QueryParam("value") OptionalDouble value) {
    return Double.toString(value.orElse(4242.0));
}</pre><p>
					The example above demonstrates that the <code class="literal">OptionalDouble</code> can be used as a parameter type. If a value is not provided in <code class="literal">@QueryParam</code>, then the default value will be returned. Optional parameters are supported for the following parameter types:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							<code class="literal">@QueryParam</code>
						</li><li class="listitem">
							<code class="literal">@MatrixParam</code>
						</li><li class="listitem">
							<code class="literal">@FormParam</code>
						</li><li class="listitem">
							<code class="literal">@HeaderParam</code>
						</li><li class="listitem">
							<code class="literal">@CookieParam</code>
						</li></ul></div></section><section class="section" id="serializable_provider"><div class="titlepage"><div><div><h3 class="title">2.6.7. Serializable Provider</h3></div></div></div><p>
					Deserializing Java objects from untrusted sources is not safe. Therefore, <code class="literal">org.jboss.resteasy.plugins.providers.SerializableProvider</code> is disabled by default. It is not recommended to use this provider.
				</p></section><section class="section" id="json_provider"><div class="titlepage"><div><div><h3 class="title">2.6.8. JSON Provider</h3></div></div></div><section class="section" id="resteasy_jackson2_json_filter_support"><div class="titlepage"><div><div><h4 class="title">2.6.8.1. JsonFilter Support in RESTEasy Jackson2</h4></div></div></div><p>
						<code class="literal">JsonFilter</code> facilitates dynamic filtering by allowing you to annotate a class with <code class="literal">@JsonFilter</code>. The following example defines mapping from the <code class="literal">nameFilter</code> class to the filter instances, and then filtering out bean properties when serializing the instances to JSON format.
					</p><pre class="programlisting language-java">@JsonFilter(value="nameFilter")
public class Jackson2Product {
    protected String name;
    protected int id;
    public Jackson2Product() {
    }
    public Jackson2Product(final int id, final String name) {
        this.id = id;
        this.name = name;
    }
    public String getName() {
        return name;
    }
    public void setName(String name) {
        this.name = name;
    }
    public int getId() {
        return id;
    }
    public void setId(int id) {
        this.id = id;
    }
}</pre><p>
						<code class="literal">@JsonFilter</code> annotates the resource class to filter out the property that should not be serialized in the JSON response. To map the filter ID and instance, you must create another Jackson class and add the ID and filter instance map to it, as shown in the example below.
					</p><pre class="programlisting language-java">public class ObjectFilterModifier extends ObjectWriterModifier {
	public ObjectFilterModifier() {
	}
	@Override
	public ObjectWriter modify(EndpointConfigBase&lt;?&gt; endpoint,
		MultivaluedMap&lt;String, Object&gt; httpHeaders, Object valueToWrite,
		ObjectWriter w, JsonGenerator jg) throws IOException {

		FilterProvider filterProvider = new SimpleFilterProvider().addFilter(
			"nameFilter",
			SimpleBeanPropertyFilter.filterOutAllExcept("name"));
		return w.with(filterProvider);
	}
}</pre><p>
						In the example above, the method <code class="literal">modify()</code> takes care of filtering all properties except the <code class="literal">name</code> property before writing the response. For this to work, RESTEasy must know about this mapping information. You can set the mapping information either in a <code class="literal">WriterInterceptor</code> or a servlet filter, as shown in the examples below.
					</p><div class="formalpara"><p class="title"><strong>Example: Setting ObjectFilterModifier Using WriterInterceptor</strong></p><p>
							
<pre class="programlisting language-java">@Provider
public class JsonFilterWriteInterceptor implements WriterInterceptor{

	private ObjectFilterModifier modifier = new ObjectFilterModifier();
	@Override
	public void aroundWriteTo(WriterInterceptorContext context)
		throws IOException, WebApplicationException {
	    	//set a threadlocal modifier
            ObjectWriterInjector.set(modifier);
                context.proceed();
	}

}</pre>

						</p></div><div class="formalpara"><p class="title"><strong>Example: Setting ObjectFilterModifier Using Servlet Filter</strong></p><p>
							
<pre class="programlisting language-java">public class ObjectWriterModifierFilter implements Filter {
	private static ObjectFilterModifier modifier = new ObjectFilterModifier();

	@Override
	public void init(FilterConfig filterConfig) throws ServletException {
	}

	@Override
	public void doFilter(ServletRequest request, ServletResponse response,
		FilterChain chain) throws IOException, ServletException {
		    ObjectWriterInjector.set(modifier);
		    chain.doFilter(request, response);
	}

	@Override
	public void destroy() {
	}

}</pre>

						</p></div><p>
						Now, RESTEasy can get the <code class="literal">ObjectFilterModifier</code> from the <code class="literal">ThreadLocal</code> variable and configure it to modify <code class="literal">ObjectWriter</code> before writing the response.
					</p></section><section class="section" id="resteasy_java_api_for_json_binding"><div class="titlepage"><div><div><h4 class="title">2.6.8.2. Java API for JSON Binding</h4></div></div></div><p>
						RESTEasy supports both JSON-B and JSON-P. In accordance with the specification, entity providers for JSON-B take precedence over the ones for JSON-P for all types of entities except <code class="literal">JsonValue</code> and its sub-types.
					</p><p>
						The <code class="literal">JsonBindingProvider</code> property from <code class="literal">resteasy-json-binding-provider</code> module provides support for JSON-B. To satisfy JAX-RS 2.1 requirements, the <code class="literal">JsonBindingProvider</code> provider takes precedence over the other providers for dealing with JSON payloads, in particular the Jackson payload.
					</p><p>
						For the same input, the JSON outputs from Jackson and JSON-B reference implementation can vary. Consequently, in order to retain backward compatibility, you can set the <code class="literal">resteasy.preferJacksonOverJsonB</code> context property to <code class="literal">true</code> and disable the <code class="literal">JsonBindingProvider</code> configuration for the current deployment.
					</p><p>
						JBoss EAP supports specifying the default value for the <code class="literal">resteasy.preferJacksonOverJsonB</code> context property by setting a system property with the same name. If no value is set for the context and system properties, it scans JAX-RS deployments for Jackson annotations and sets the property to <code class="literal">true</code> if any of these annotations is found.
					</p></section></section><section class="section" id="jaxb_providers"><div class="titlepage"><div><div><h3 class="title">2.6.9. JAXB Providers</h3></div></div></div><section class="section" id="jaxb_and_xml_provider"><div class="titlepage"><div><div><h4 class="title">2.6.9.1. JAXB and XML Provider</h4></div></div></div><p>
						RESTEasy provides JAXB provider support for XML.
					</p><h6 id="xmlheader_and_stylesheet">@XmlHeader and @Stylesheet</h6><p>
						RESTEasy provides setting an XML header using the <code class="literal">@org.jboss.resteasy.annotations.providers.jaxb.XmlHeader</code> annotation.
					</p><div class="formalpara"><p class="title"><strong>Example: Using the <code class="literal">@XmlHeader</code> Annotation</strong></p><p>
							
<pre class="programlisting language-java">@XmlRootElement
public static class Thing {
   private String name;

   public String getName() {
      return name;
   }

   public void setName(String name) {
      this.name = name;
   }
}

@Path("/test")
public static class TestService {

   @GET
   @Path("/header")
   @Produces("application/xml")
   @XmlHeader("&lt;?xml-stylesheet type='text/xsl' href='${baseuri}foo.xsl' ?&gt;")
   public Thing get() {
      Thing thing = new Thing();
      thing.setName("bill");
      return thing;
   }
}</pre>

						</p></div><p>
						The <code class="literal">@XmlHeader</code> ensures that the XML output has an XML-stylesheet header.
					</p><p>
						RESTEasy has a convenient annotation for stylesheet headers.
					</p><div class="formalpara"><p class="title"><strong>Example: Using the <code class="literal">@Stylesheet</code> Annotation</strong></p><p>
							
<pre class="programlisting language-java">@XmlRootElement
public static class Thing {
   private String name;

   public String getName() {
      return name;
   }

   public void setName(String name) {
      this.name = name;
   }
}

@Path("/test")
public static class TestService {

   @GET
   @Path("/stylesheet")
   @Produces("application/xml")
   @Stylesheet(type="text/css", href="${basepath}foo.xsl")
   @Junk
   public Thing getStyle() {
      Thing thing = new Thing();
      thing.setName("bill");
      return thing;
   }
}</pre>

						</p></div></section><section class="section" id="resteasy-jaxb-json"><div class="titlepage"><div><div><h4 class="title">2.6.9.2. JAXB and JSON Provider</h4></div></div></div><p>
						RESTEasy allows you to marshal JAXB annotated POJOs to and from JSON using the JSON provider. This provider wraps the Jackson JSON library to accomplish this task. It has a Java Beans based model and APIs similar to JAXB.
					</p><p>
						While Jackson already includes JAX-RS integration, it was expanded by RESTEasy. To include it in your project, you need to update the Maven dependencies.
					</p><div class="formalpara"><p class="title"><strong>Maven Dependencies for Jackson</strong></p><p>
							
<pre class="programlisting language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
    &lt;artifactId&gt;resteasy-jackson2-provider&lt;/artifactId&gt;
    &lt;version&gt;${version.org.jboss.resteasy}&lt;/version&gt;
    &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;</pre>

						</p></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							The default JSON provider for RESTEasy is Jackson2. Previous versions of JBoss EAP included the Jackson1 JSON provider. For more details on migrating your existing applications from the Jackson1 provider, see the <a class="link mimir-link-warn" href="https://access.redhat.com/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/migration_guide/#migrate_jackson_provider_changes" title="This content is not included in Mimir.">JBoss EAP <span class="emphasis"><em>Migration Guide</em></span></a>. If you still want to use the Jackson1 provider, you have to <a class="link" href="/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/development_guide/index/#add_an_explicit_module_dependency_to_a_deployment">explicitly update the Maven dependencies to obtain it</a>.
						</p></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							The default JSON provider for RESTEasy in previous versions of JBoss EAP was Jettison, but is now deprecated in JBoss EAP 7. For more details, see the JBoss EAP <a class="link mimir-link-warn" href="https://access.redhat.com/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/migration_guide/#migrate_resteasy_jettison_json_provider" title="This content is not included in Mimir."><span class="emphasis"><em>Migration Guide</em></span></a>.
						</p></div></div><div class="formalpara"><p class="title"><strong>Example JSON Provider</strong></p><p>
							
<pre class="programlisting language-java">@XmlRootElement
public static class Thing {
  private String name;

  public String getName() {
    return name;
  }

  public void setName(String name) {
    this.name = name;
  }
}

@Path("/test")
public static class TestService {
  @GET
  @Path("/thing")
  @Produces("application/json")
  public Thing get() {
    Thing thing = new Thing();
    thing.setName("the thing");
    return thing;
  }
}</pre>

						</p></div><section class="section" id="jackson_module_support"><div class="titlepage"><div><div><h5 class="title">2.6.9.2.1. Jackson Module Support for Java 8</h5></div></div></div><p>
							This section provides the Maven dependencies and shows how to register the Jackson modules needed to support Java 8 features, when the core Jackson modules do not require Java 8 runtime environment. These Jackson modules include:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									Java 8 data types
								</li><li class="listitem">
									Java 8 date/time
								</li></ul></div><p>
							Add the following Maven dependencies:
						</p><pre class="programlisting language-java">&lt;dependency&gt;
    &lt;groupId&gt;com.fasterxml.jackson.datatype&lt;/groupId&gt;
    &lt;artifactId&gt;jackson-datatype-jdk8&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.fasterxml.jackson.datatype&lt;/groupId&gt;
    &lt;artifactId&gt;jackson-datatype-jsr310&lt;/artifactId&gt;
&lt;/dependency&gt;</pre><p>
							You can find and register all the modules using <code class="literal">findAndRegisterModules()</code> or <code class="literal">ObjectMapper.registerModule()</code>, as shown in the examples below:
						</p><pre class="programlisting language-java">ObjectMapper mapper = new ObjectMapper();
mapper.findAndRegisterModules();</pre><pre class="programlisting language-java">ObjectMapper mapper = new ObjectMapper()
   .registerModule(new ParameterNamesModule())
   .registerModule(new Jdk8Module())
   .registerModule(new JavaTimeModule());</pre><div class="formalpara"><p class="title"><strong>Example: Duration Data Type</strong></p><p>
								
<pre class="programlisting language-java">@GET
@Path("/duration")
@Produces(MediaType.APPLICATION_JSON)
public Duration getDuration() {
    return Duration.ofSeconds(5, 6);
}</pre>

							</p></div><div class="formalpara"><p class="title"><strong>Example: Optional Data Type</strong></p><p>
								
<pre class="programlisting language-java">@GET
@Path("/optional/{nullParam}")
@Produces(MediaType.APPLICATION_JSON)
public Optional&lt;String&gt; getOptional(@PathParam("nullParam") boolean nullParameter) {
    return nullParameter ? Optional.&lt;String&gt;empty() : Optional.of("info@example.com");
}</pre>

							</p></div><p>
							You must use the custom implementation of the <code class="literal">ContextResolver</code> in order to use these Jackson modules in RESTEasy.
						</p><pre class="programlisting language-java">@Provider
@Produces(MediaType.APPLICATION_JSON)
public class JacksonDatatypeJacksonProducer implements ContextResolver&lt;ObjectMapper&gt; {
    private final ObjectMapper json;
    public JacksonDatatypeJacksonProducer() throws Exception {
        this.json = new ObjectMapper()
                .findAndRegisterModules()
                .configure(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS, false)
                .configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);
    }
    @Override
    public ObjectMapper getContext(Class&lt;?&gt; objectType) {
        return json;
    }
}</pre></section><section class="section" id="switching_the_default_jackson_provider"><div class="titlepage"><div><div><h5 class="title">2.6.9.2.2. Switching the Default Jackson Provider</h5></div></div></div><p>
							JBoss EAP 7 includes Jackson 2.6.x or greater and <code class="literal">resteasy-jackson2-provider</code> is now the default Jackson provider.
						</p><p>
							To switch to the default <code class="literal">resteasy-jackson-provider</code> that was included in the previous release of JBoss EAP, exclude the new provider and add a dependency for the previous provider in the <code class="literal">jboss-deployment-structure.xml</code> application deployment descriptor file.
						</p><pre class="programlisting language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;jboss-deployment-structure&gt;
   &lt;deployment&gt;
       &lt;exclusions&gt;
           &lt;module name="org.jboss.resteasy.resteasy-jackson2-provider"/&gt;
       &lt;/exclusions&gt;
       &lt;dependencies&gt;
           &lt;module name="org.jboss.resteasy.resteasy-jackson-provider" services="import"/&gt;
       &lt;/dependencies&gt;
   &lt;/deployment&gt;
&lt;/jboss-deployment-structure&gt;</pre></section></section></section><section class="section" id="jaxb_decorators"><div class="titlepage"><div><div><h3 class="title">2.6.10. Creating JAXB Decorators</h3></div></div></div><p>
					RESTEasy’s JAXB providers have a pluggable way to decorate Marshaller and Unmarshaller instances. You can create an annotation that can trigger either a Marshaller or Unmarshaller instance, which can be used to decorate methods.
				</p><h5 id="create_a_jaxb_decorator_with_resteasy">Create a JAXB Decorator with RESTEasy</h5><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Create the Processor class.
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									Create a class that implements <code class="literal">DecoratorProcessor&lt;Target, Annotation&gt;</code>. The target is either the JAXB Marshaller or Unmarshaller class. The annotation is created in step two.
								</li><li class="listitem">
									Annotate the class with <code class="literal">@DecorateTypes</code>, and declare the MIME types the decorator should decorate.
								</li><li class="listitem"><p class="simpara">
									Set properties or values within the decorate function.
								</p><div class="formalpara"><p class="title"><strong>Example: Processor Class</strong></p><p>
										
<pre class="programlisting language-java">import org.jboss.resteasy.core.interception.DecoratorProcessor;
import org.jboss.resteasy.annotations.DecorateTypes;
import javax.xml.bind.Marshaller;
import javax.xml.bind.PropertyException;
import javax.ws.rs.core.MediaType;
import javax.ws.rs.Produces;
import java.lang.annotation.Annotation;

@DecorateTypes({"text/*+xml", "application/*+xml"})
public class PrettyProcessor implements DecoratorProcessor&lt;Marshaller, Pretty&gt; {
    public Marshaller decorate(Marshaller target, Pretty annotation,
      Class type, Annotation[] annotations, MediaType mediaType) {
    target.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT, Boolean.TRUE);
    }
}</pre>

									</p></div></li></ol></div></li><li class="listitem"><p class="simpara">
							Create the annotation.
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									Create a custom interface that is annotated with the <code class="literal">@Decorator</code> annotation.
								</li><li class="listitem"><p class="simpara">
									Declare the processor and target for the <code class="literal">@Decorator</code> annotation. The processor is created in step one. The target is either the JAXB <code class="literal">Marshaller</code> or <code class="literal">Unmarshaller</code> class.
								</p><div class="formalpara"><p class="title"><strong>Example: Custom Interface with <code class="literal">@Decorator</code> Annotation</strong></p><p>
										
<pre class="programlisting language-java">import org.jboss.resteasy.annotations.Decorator;

@Target({ElementType.TYPE, ElementType.METHOD, ElementType.PARAMETER, ElementType.FIELD})
@Retention(RetentionPolicy.RUNTIME)
@Decorator(processor = PrettyProcessor.class, target = Marshaller.class)
public @interface Pretty {}</pre>

									</p></div></li></ol></div></li><li class="listitem">
							Add the annotation created in step two to a function so that either the input or output is decorated when it is marshaled.
						</li></ol></div><p>
					You have now created a JAXB decorator, which can be applied within a JAX-RS web service.
				</p></section><section class="section" id="resteasy-multipart-providers"><div class="titlepage"><div><div><h3 class="title">2.6.11. Multipart Providers in JAX-RS</h3></div></div></div><p>
					The multipart MIME format is used to pass lists of content bodies embedded in one message. One example of a multipart MIME format is the <code class="literal">multipart/form-data</code> MIME type. This is often found in web application HTML form documents and is generally used to upload files. The <code class="literal">form-data</code> format in this MIME type is the same as other multipart formats, except that each inlined piece of content has a name associated with it.
				</p><p>
					RESTEasy allows for the <code class="literal">multipart/form-data</code> and <code class="literal">multipart/*</code> MIME types. RESTEasy also provides a custom API for reading and writing multipart types as well as marshalling arbitrary <code class="literal">List</code> (for any multipart type) and <code class="literal">Map</code> (multipart/form-data only) objects.
				</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
						There are a lot of frameworks doing multipart parsing automatically with the help of filters and interceptors, such as <code class="literal">org.jboss.seam.web.MultipartFilter</code> in Seam or <code class="literal">org.springframework.web.multipart.MultipartResolver</code> in Spring. However, the incoming multipart request stream can be parsed only once. RESTEasy users working with multipart should make sure that nothing parses the stream before RESTEasy gets it.
					</p></div></div><section class="section" id="resteasy-multipart-input"><div class="titlepage"><div><div><h4 class="title">2.6.11.1. Input with Multipart Data</h4></div></div></div><p>
						When writing a JAX-RS service, RESTEasy provides the <code class="literal">org.jboss.resteasy.plugins.providers.multipart.MultipartInput</code> interface to allow you to read in any multipart MIME type.
					</p><pre class="programlisting language-java">package org.jboss.resteasy.plugins.providers.multipart;

public interface MultipartInput {

   List&lt;InputPart&gt; getParts();
   String getPreamble();

   // You must call close to delete any temporary files created
   // Otherwise they will be deleted on garbage collection or on JVM exit
   void close();
}

public interface InputPart {

   MultivaluedMap&lt;String, String&gt; getHeaders();
   String getBodyAsString();
   &lt;T&gt; T getBody(Class&lt;T&gt; type, Type genericType) throws IOException;
   &lt;T&gt; T getBody(org.jboss.resteasy.util.GenericType&lt;T&gt; type) throws IOException;
   MediaType getMediaType();
   boolean isContentTypeFromMessage();
}</pre><p>
						<code class="literal">MultipartInput</code> is a simple interface that allows you to get access to each part of the multipart message. Each part is represented by an <code class="literal">InputPart</code> interface, and each part has a set of headers associated with it. You can unmarshal the part by calling one of the <code class="literal">getBody()</code> methods. The <code class="literal">genericType</code> parameter can be <code class="literal">null</code>, but the <code class="literal">type</code> parameter must be set. RESTEasy will find a <code class="literal">MessageBodyReader</code> based on the media type of the part as well as the type information you pass in.
					</p><section class="section" id="input_with_literal_multipart_mixed_literal"><div class="titlepage"><div><div><h5 class="title">2.6.11.1.1. Input with <code class="literal">multipart/mixed</code></h5></div></div></div><div class="formalpara"><p class="title"><strong>Example: Unmarshalling Parts</strong></p><p>
								
<pre class="programlisting language-java">@Path("/multipart")
public class MyService {

    @PUT
    @Consumes("multipart/mixed")
    public void put(MultipartInput input) {
        List&lt;Customer&gt; customers = new ArrayList...;
        for (InputPart part : input.getParts()) {
            Customer cust = part.getBody(Customer.class, null);
            customers.add(cust);
        }
        input.close();
    }
}</pre>

							</p></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								The above example assumes the <code class="literal">Customer</code> class is annotated with JAXB.
							</p></div></div><p>
							Sometimes you may want to unmarshal a body part that is sensitive to generic type metadata. In this case you can use the <code class="literal">org.jboss.resteasy.util.GenericType</code> class.
						</p><div class="formalpara"><p class="title"><strong>Example: Unmarshalling a Type Sensitive to Generic Type Metadata</strong></p><p>
								
<pre class="programlisting language-java">@Path("/multipart")
public class MyService {

    @PUT
    @Consumes("multipart/mixed")
    public void put(MultipartInput input) {
        for (InputPart part : input.getParts()) {
            List&lt;Customer&gt; cust = part.getBody(new GenericType&lt;List&lt;Customer&gt;&gt;() {});
        }
        input.close();
    }
}</pre>

							</p></div><p>
							Use of <code class="literal">GenericType</code> is required because it is the only way to obtain generic type information at runtime.
						</p></section><section class="section" id="input_with_literal_multipart_mixed_literal_and_literal_java_util_list_literal"><div class="titlepage"><div><div><h5 class="title">2.6.11.1.2. Input with <code class="literal">multipart/mixed</code> and <code class="literal">java.util.List</code></h5></div></div></div><p>
							If the body parts are uniform, you do not have to manually unmarshal each and every part. You can just provide a <code class="literal">java.util.List</code> as your input parameter. It must have the type it is unmarshalling with the generic parameter of the <code class="literal">List</code> type declaration.
						</p><div class="formalpara"><p class="title"><strong>Example: Unmarshalling a <code class="literal">List</code> of <code class="literal">Customers</code></strong></p><p>
								
<pre class="programlisting language-java">@Path("/multipart")
public class MyService {

    @PUT
    @Consumes("multipart/mixed")
    public void put(List&lt;Customer&gt; customers) {
        ...
    }
}</pre>

							</p></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								The above example assumes the <code class="literal">Customer</code> class is annotated with JAXB.
							</p></div></div></section><section class="section" id="input_with_literal_multipart_form_data_literal"><div class="titlepage"><div><div><h5 class="title">2.6.11.1.3. Input with <code class="literal">multipart/form-data</code></h5></div></div></div><p>
							When writing a JAX-RS service, RESTEasy provides an interface that allows you to read in <code class="literal">multipart/form-data</code> MIME type. <code class="literal">multipart/form-data</code> is often found in web application HTML form documents and is generally used to upload files. The <code class="literal">form-data</code> format is the same as other multipart formats, except that each inlined piece of content has a name associated with it. The interface used for form-data input is <code class="literal">org.jboss.resteasy.plugins.providers.multipart.MultipartFormDataInput</code>.
						</p><div class="formalpara"><p class="title"><strong>Example: MultipartFormDataInput Interface</strong></p><p>
								
<pre class="programlisting language-java">public interface MultipartFormDataInput extends MultipartInput {

    @Deprecated
    Map&lt;String, InputPart&gt; getFormData();
    Map&lt;String, List&lt;InputPart&gt;&gt; getFormDataMap();
    &lt;T&gt; T getFormDataPart(String key, Class&lt;T&gt; rawType, Type genericType) throws IOException;
    &lt;T&gt; T getFormDataPart(String key, GenericType&lt;T&gt; type) throws IOException;
}</pre>

							</p></div><p>
							It works in much the same way as <code class="literal">MultipartInput</code> <a class="link" href="#resteasy-multipart-input" title="2.6.11.1. Input with Multipart Data">described earlier</a>.
						</p></section><section class="section" id="literal_java_util_map_literal_with_literal_multipart_form_data_literal"><div class="titlepage"><div><div><h5 class="title">2.6.11.1.4. <code class="literal">java.util.Map</code> with <code class="literal">multipart/form-data</code></h5></div></div></div><p>
							With form-data, if the body parts are uniform, you do not have to manually unmarshal each and every part. You can just provide a <code class="literal">java.util.Map</code> as your input parameter. It must have the type it is unmarshalling with the generic parameter of the <code class="literal">List</code> type declaration.
						</p><div class="formalpara"><p class="title"><strong>Example: Unmarshalling a <code class="literal">Map</code> of <code class="literal">Customer</code> objects</strong></p><p>
								
<pre class="programlisting language-java">@Path("/multipart")
public class MyService {

    @PUT
    @Consumes("multipart/form-data")
    public void put(Map&lt;String, Customer&gt; customers) {
        ...
    }
}</pre>

							</p></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								The above example assumes the <code class="literal">Customer</code> class is annotated with JAXB.
							</p></div></div></section><section class="section" id="input_with_literal_multipart_related_literal"><div class="titlepage"><div><div><h5 class="title">2.6.11.1.5. Input with <code class="literal">multipart/related</code></h5></div></div></div><p>
							When writing a JAX-RS service, RESTEasy provides an interface that allows you to read in <code class="literal">multipart/related</code> MIME type. A <code class="literal">multipart/related</code> is used to indicate that message parts should not be considered individually but rather as parts of an aggregate whole and is defined by <a class="link mimir-link-warn" href="http://tools.ietf.org/html/rfc2387" title="Mimir does not include content from: tools.ietf.org">RFC 2387</a>.
						</p><p>
							One example usage for <code class="literal">multipart/related</code> is to send a web page complete with images in a single message. Every <code class="literal">multipart/related</code> message has a root/start part that references the other parts of the message. The parts are identified by their <code class="literal">Content-ID</code> headers. The interface used for related input is <code class="literal">org.jboss.resteasy.plugins.providers.multipart.MultipartRelatedInput</code>.
						</p><div class="formalpara"><p class="title"><strong>Example: MultipartRelatedInput Interface</strong></p><p>
								
<pre class="programlisting language-java">public interface MultipartRelatedInput extends MultipartInput {

    String getType();
    String getStart();
    String getStartInfo();
    InputPart getRootPart();
    Map&lt;String, InputPart&gt; getRelatedMap();
}</pre>

							</p></div><p>
							It works in much the same way as <code class="literal">MultipartInput</code>.
						</p></section></section><section class="section" id="resteasy-multipart-output"><div class="titlepage"><div><div><h4 class="title">2.6.11.2. Output with Multipart Data</h4></div></div></div><p>
						RESTEasy provides a simple API to output multipart data.
					</p><pre class="programlisting language-java">package org.jboss.resteasy.plugins.providers.multipart;

public class MultipartOutput {

    public OutputPart addPart(Object entity, MediaType mediaType)
    public OutputPart addPart(Object entity, GenericType type, MediaType mediaType)
    public OutputPart addPart(Object entity, Class type, Type genericType, MediaType mediaType)
    public List&lt;OutputPart&gt; getParts()
    public String getBoundary()
    public void setBoundary(String boundary)
}

public class OutputPart {

    public MultivaluedMap&lt;String, Object&gt; getHeaders()
    public Object getEntity()
    public Class getType()
    public Type getGenericType()
    public MediaType getMediaType()
}</pre><p>
						To output multipart data, you need to create a <code class="literal">MultipartOutput</code> object and call the <code class="literal">addPart()</code> method. RESTEasy will automatically find a <code class="literal">MessageBodyWriter</code> to marshal your entity objects. Similar to <code class="literal">MultipartInput</code>, sometimes you might have marshalling that is sensitive to generic type metadata. In that case, use the <code class="literal">GenericType</code>. Usually, passing in an object and its <code class="literal">MediaType</code> should be enough.
					</p><div class="formalpara"><p class="title"><strong>Example: Returning a <code class="literal">multipart/mixed</code> Format</strong></p><p>
							
<pre class="programlisting language-java">@Path("/multipart")
public class MyService {

    @GET
    @Produces("multipart/mixed")
    public MultipartOutput get() {

        MultipartOutput output = new MultipartOutput();
        output.addPart(new Customer("bill"), MediaType.APPLICATION_XML_TYPE);
        output.addPart(new Customer("monica"), MediaType.APPLICATION_XML_TYPE);
        return output;
    }
}</pre>

						</p></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							The above example assumes the <code class="literal">Customer</code> class is annotated with JAXB.
						</p></div></div><section class="section" id="multipart_output_with_literal_java_util_list_literal"><div class="titlepage"><div><div><h5 class="title">2.6.11.2.1. Multipart Output with <code class="literal">java.util.List</code></h5></div></div></div><p>
							If the body parts are uniform, you do not have to manually marshal each and every part or even use a <code class="literal">MultipartOutput</code> object. You can provide a <code class="literal">java.util.List</code> which must have the generic type it is marshalling with the generic parameter of the <code class="literal">List</code> type declaration. You must also annotate the method with the <code class="literal">@PartType</code> annotation to specify the media type of each part.
						</p><div class="formalpara"><p class="title"><strong>Example: Returning a <code class="literal">List</code> of <code class="literal">Customer</code> Objects</strong></p><p>
								
<pre class="programlisting language-java">@Path("/multipart")
public class MyService {

    @GET
    @Produces("multipart/mixed")
    @PartType("application/xml")
    public List&lt;Customer&gt; get(){
        ...
    }
}</pre>

							</p></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								The above example assumes the <code class="literal">Customer</code> class is annotated with JAXB.
							</p></div></div></section><section class="section" id="output_with_literal_multipart_form_data_literal"><div class="titlepage"><div><div><h5 class="title">2.6.11.2.2. Output with <code class="literal">multipart/form-data</code></h5></div></div></div><p>
							RESTEasy provides a simple API to output <code class="literal">multipart/form-data</code>.
						</p><pre class="programlisting language-java">package org.jboss.resteasy.plugins.providers.multipart;

public class MultipartFormDataOutput extends MultipartOutput {

    public OutputPart addFormData(String key, Object entity, MediaType mediaType)
    public OutputPart addFormData(String key, Object entity, GenericType type, MediaType mediaType)
    public OutputPart addFormData(String key, Object entity, Class type, Type genericType, MediaType mediaType)
    public Map&lt;String, OutputPart&gt; getFormData()
}</pre><p>
							To output <code class="literal">multipart/form-data</code>, you must create a <code class="literal">MultipartFormDataOutput</code> object and call the <code class="literal">addFormData()</code> method. RESTEasy will automatically find a <code class="literal">MessageBodyWriter</code> to marshal your entity objects. Similar to <code class="literal">MultipartInput</code>, sometimes you might have marshalling that is sensitive to generic type metadata. In that case, use the <code class="literal">GenericType</code>. Usually, passing in an object and its <code class="literal">MediaType</code> should be enough.
						</p><div class="formalpara"><p class="title"><strong>Example: Returning <code class="literal">multipart/form-data</code> Format</strong></p><p>
								
<pre class="programlisting language-java">@Path("/form")
public class MyService {

    @GET
    @Produces("multipart/form-data")
    public MultipartFormDataOutput get() {

        MultipartFormDataOutput output = new MultipartFormDataOutput();
        output.addPart("bill", new Customer("bill"), MediaType.APPLICATION_XML_TYPE);
        output.addPart("monica", new Customer("monica"), MediaType.APPLICATION_XML_TYPE);
        return output;
    }
}</pre>

							</p></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								The above example assumes the <code class="literal">Customer</code> class is annotated with JAXB.
							</p></div></div></section><section class="section" id="multipart_formdata_output_with_literal_java_util_map_literal"><div class="titlepage"><div><div><h5 class="title">2.6.11.2.3. Multipart FormData Output with <code class="literal">java.util.Map</code></h5></div></div></div><p>
							If the body parts are uniform, you do not have to manually marshal every part or use a <code class="literal">MultipartFormDataOutput</code> object. You can just provide a <code class="literal">java.util.Map</code> which must have the generic type it is marshalling with the generic parameter of the <code class="literal">Map</code> type declaration. You must also annotate the method with the <code class="literal">@PartType</code> annotation to specify the media type of each part.
						</p><div class="formalpara"><p class="title"><strong>Example: Returning a <code class="literal">Map</code> of <code class="literal">Customer</code> Objects</strong></p><p>
								
<pre class="programlisting language-java">@Path("/multipart")
public class MyService {

    @GET
    @Produces("multipart/form-data")
    @PartType("application/xml")
    public Map&lt;String, Customer&gt; get() {
        ...
    }
}</pre>

							</p></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								The above example assumes the <code class="literal">Customer</code> class is annotated with JAXB.
							</p></div></div></section><section class="section" id="output_with_literal_multipart_related_literal"><div class="titlepage"><div><div><h5 class="title">2.6.11.2.4. Output with <code class="literal">multipart/related</code></h5></div></div></div><p>
							RESTEasy provides a simple API to output <code class="literal">multipart/related</code>.
						</p><pre class="programlisting language-java">package org.jboss.resteasy.plugins.providers.multipart;

public class MultipartRelatedOutput extends MultipartOutput {

    public OutputPart getRootPart()
    public OutputPart addPart(Object entity, MediaType mediaType,
        String contentId, String contentTransferEncoding)
    public String getStartInfo()
    public void setStartInfo(String startInfo)
}</pre><p>
							To output <code class="literal">multipart/related</code>, you must create a <code class="literal">MultipartRelatedOutput</code> object and call the <code class="literal">addPart()</code> method. The first added part is used as the root part of the <code class="literal">multipart/related</code> message, and RESTEasy automatically finds a <code class="literal">MessageBodyWriter</code> to marshal your entity objects. Similar to <code class="literal">MultipartInput</code>, sometimes you might have marshalling that is sensitive to generic type metadata. In that case, use the <code class="literal">GenericType</code>. Usually, passing in an object and its <code class="literal">MediaType</code> should be enough.
						</p><div class="formalpara"><p class="title"><strong>Example: Returning <code class="literal">multipart/related</code> Format Sending Two Images</strong></p><p>
								
<pre class="programlisting language-java">@Path("/related")
public class MyService {

    @GET
    @Produces("multipart/related")
    public MultipartRelatedOutput get() {

        MultipartRelatedOutput output = new MultipartRelatedOutput();
        output.setStartInfo("text/html");

        Map&lt;String, String&gt; mediaTypeParameters = new LinkedHashMap&lt;String, String&gt;();
        mediaTypeParameters.put("charset", "UTF-8");
        mediaTypeParameters.put("type", "text/html");
        output.addPart(
            "&lt;html&gt;&lt;body&gt;\n"
            + "This is me: &lt;img src='cid:http://example.org/me.png' /&gt;\n"
            + "&lt;br /&gt;This is you: &lt;img src='cid:http://example.org/you.png' /&gt;\n"
            + "&lt;/body&gt;&lt;/html&gt;",
            new MediaType("text", "html", mediaTypeParameters),
            "&lt;mymessage.xml@example.org&gt;", "8bit");
        output.addPart("// binary octets for me png",
            new MediaType("image", "png"), "&lt;http://example.org/me.png&gt;",
            "binary");
        output.addPart("// binary octets for you png", new MediaType(
            "image", "png"),
            "&lt;http://example.org/you.png&gt;", "binary");
        client.putRelated(output);
        return output;
    }
}</pre>

							</p></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								The above example assumes the <code class="literal">Customer</code> class is annotated with JAXB.
							</p></div></div></section></section><section class="section" id="resteasy-multipart-form-pojo"><div class="titlepage"><div><div><h4 class="title">2.6.11.3. Mapping Multipart Forms to POJOs</h4></div></div></div><p>
						If you have an exact knowledge of your multipart/form-data packets, you can map them to and from a POJO class. This is accomplished using the <code class="literal">org.jboss.resteasy.annotations.providers.multipart.MultipartForm</code> annotation (<code class="literal">@MultipartForm</code>) and the JAX-RS <code class="literal">@FormParam</code> annotation. To do so, you need to define a POJO with at least a default constructor and annotate its fields and/or properties with <code class="literal">@FormParams</code>. These <code class="literal">@FormParams</code> must also be annotated with <code class="literal">org.jboss.resteasy.annotations.providers.multipart.PartType</code> (<code class="literal">@PartType</code>) if you are creating output.
					</p><div class="formalpara"><p class="title"><strong>Example: Mapping Multipart Forms to a POJO</strong></p><p>
							
<pre class="programlisting language-java">public class CustomerProblemForm {

    @FormParam("customer")
    @PartType("application/xml")
    private Customer customer;

    @FormParam("problem")
    @PartType("text/plain")
    private String problem;

    public Customer getCustomer() { return customer; }
    public void setCustomer(Customer cust) { this.customer = cust; }
    public String getProblem() { return problem; }
    public void setProblem(String problem) { this.problem = problem; }
}</pre>

						</p></div><p>
						After defining your POJO class you can then use it to represent <code class="literal">multipart/form-data</code>.
					</p><div class="formalpara"><p class="title"><strong>Example: Submit <code class="literal">CustomerProblemForm</code></strong></p><p>
							
<pre class="programlisting language-java">@Path("portal")
public interface CustomerPortal {

    @Path("issues/{id}")
    @Consumes("multipart/form-data")
    @PUT
    public void putProblem(@MultipartForm CustomerProblemForm,
                           @PathParam("id") int id);
}

// Somewhere using it:
{
    CustomerPortal portal = ProxyFactory.create(CustomerPortal.class, "http://example.com");
    CustomerProblemForm form = new CustomerProblemForm();
    form.setCustomer(...);
    form.setProblem(...);

    portal.putProblem(form, 333);
}</pre>

						</p></div><p>
						The <code class="literal">@MultipartForm</code> annotation tells RESTEasy that the object has <code class="literal">@FormParam</code> and that it should be marshaled from that. You can also use the same object to receive multipart data.
					</p><div class="formalpara"><p class="title"><strong>Example: Receive <code class="literal">CustomerProblemForm</code></strong></p><p>
							
<pre class="programlisting language-java">@Path("portal")
public class CustomerPortalServer {

    @Path("issues/{id})
    @Consumes("multipart/form-data")
    @PUT
    public void putIssue(@MultipartForm CustomerProblemForm,
                         @PathParam("id") int id) {
       ... write to database...
    }
}</pre>

						</p></div></section><section class="section" id="resteasy-multipart-xop"><div class="titlepage"><div><div><h4 class="title">2.6.11.4. XML-binary Optimized Packaging (XOP)</h4></div></div></div><p>
						If you have a JAXB annotated POJO that also holds some binary content, you may choose to send it in such a way that the binary does not need to be encoded in any way such as base64 or hex. This is accomplished using <a class="link mimir-link-warn" href="http://www.w3.org/TR/xop10/" title="Mimir does not include content from: www.w3.org">XOP</a> and results in faster transport while still using the convenient POJO.
					</p><p>
						RESTEasy allows for XOP messages packaged as <code class="literal">multipart/related</code>.
					</p><p>
						To configure XOP, you first need a JAXB annotated POJO.
					</p><div class="formalpara"><p class="title"><strong>Example: JAXB POJO</strong></p><p>
							
<pre class="programlisting language-java">@XmlRootElement
@XmlAccessorType(XmlAccessType.FIELD)
public static class Xop {

    private Customer bill;
    private Customer monica;

    @XmlMimeType(MediaType.APPLICATION_OCTET_STREAM)
    private byte[] myBinary;

    @XmlMimeType(MediaType.APPLICATION_OCTET_STREAM)
    private DataHandler myDataHandler;

    // methods, other fields ...
}</pre>

						</p></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							@XmlMimeType tells JAXB the mime type of the binary content. This is not required to do XOP packaging but it is recommended to be set if you know the exact type.
						</p></div></div><p>
						In the above POJO <code class="literal">myBinary</code> and <code class="literal">myDataHandler</code> will be processed as binary attachments while the whole XOP object will be sent as XML. In place of the binaries, only their references will be generated. <code class="literal">javax.activation.DataHandler</code> is the most general supported type. If you need a <code class="literal">java.io.InputStream</code> or a <code class="literal">javax.activation.DataSource</code>, you need to use the <code class="literal">DataHandler</code>. <code class="literal">java.awt.Image</code> and <code class="literal">javax.xml.transform.SourceSome</code> are available as well.
					</p><div class="formalpara"><p class="title"><strong>Example: Client Sending Binary Content with XOP</strong></p><p>
							
<pre class="programlisting language-java">// our client interface:
@Path("mime")
public static interface MultipartClient {
    @Path("xop")
    @PUT
    @Consumes(MultipartConstants.MULTIPART_RELATED)
    public void putXop(@XopWithMultipartRelated Xop bean);
}

// Somewhere using it:
{
    MultipartClient client = ProxyFactory.create(MultipartClient.class,
        "http://www.example.org");
    Xop xop = new Xop(new Customer("bill"), new Customer("monica"),
        "Hello Xop World!".getBytes("UTF-8"),
        new DataHandler(new ByteArrayDataSource("Hello Xop World!".getBytes("UTF-8"),
        MediaType.APPLICATION_OCTET_STREAM)));
    client.putXop(xop);
}</pre>

						</p></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							The above example assumes the <code class="literal">Customer</code> class is annotated with JAXB.
						</p></div></div><p>
						The <code class="literal">@Consumes(MultipartConstants.MULTIPART_RELATED)</code> is used to tell RESTEasy that you want to send <code class="literal">multipart/related</code> packages, which is the container format that holds the XOP message. <code class="literal">@XopWithMultipartRelated</code> is used to tell RESTEasy that you want to make XOP messages.
					</p><div class="formalpara"><p class="title"><strong>Example: RESTEasy Server for Receiving XOP</strong></p><p>
							
<pre class="programlisting language-java">@Path("/mime")
public class XopService {
    @PUT
    @Path("xop")
    @Consumes(MultipartConstants.MULTIPART_RELATED)
    public void putXopWithMultipartRelated(@XopWithMultipartRelated Xop xop) {
        // do very important things here
    }
}</pre>

						</p></div><p>
						<code class="literal">@Consumes(MultipartConstants.MULTIPART_RELATED)</code> is used to tell RESTEasy that you want to read <code class="literal">multipart/related</code> packages. <code class="literal">@XopWithMultipartRelated</code> is used to tell RESTEasy that you want to read XOP messages. You can configure a RESTEasy server to produce XOP values in a similar way by adding a <code class="literal">@Produces</code> annotation and returning the appropriate type.
					</p></section><section class="section" id="resteasy-multipart-overwrite-fallback-content-type"><div class="titlepage"><div><div><h4 class="title">2.6.11.5. Overwriting the Default Fallback Content Type for Multipart Messages</h4></div></div></div><p>
						By default, if no <code class="literal">Content-Type</code> header is present in a part, <code class="literal">text/plain; charset=us-ascii</code> is used as a fallback. This is defined by the MIME RFC. However some web clients, such as many browsers, may send <code class="literal">Content-Type</code> headers for the file parts, but not for all fields in a <code class="literal">multipart/form-data</code> request. This can cause character encoding and unmarshalling errors on the server side. The <code class="literal">PreProcessInterceptor</code> infrastructure of RESTEasy can be used to correct this issue. You can use it to define another, non-RFC compliant fallback value, dynamically per request.
					</p><div class="formalpara"><p class="title"><strong>Example: Setting <code class="literal">* / *; charset=UTF-8</code> as the Default Fallback</strong></p><p>
							
<pre class="programlisting language-java">import org.jboss.resteasy.plugins.providers.multipart.InputPart;

@Provider
@ServerInterceptor
public class ContentTypeSetterPreProcessorInterceptor implements PreProcessInterceptor {

    public ServerResponse preProcess(HttpRequest request, ResourceMethod method)
            throws Failure, WebApplicationException {
        request.setAttribute(InputPart.DEFAULT_CONTENT_TYPE_PROPERTY, "*/*; charset=UTF-8");
        return null;
    }
}</pre>

						</p></div></section><section class="section" id="resteasy-multipart-overwrite-content-type"><div class="titlepage"><div><div><h4 class="title">2.6.11.6. Overwriting the Content Type for Multipart Messages</h4></div></div></div><p>
						Using an interceptor and the <code class="literal">InputPart.DEFAULT_CONTENT_TYPE_PROPERTY attribute</code> allows you to set a default <code class="literal">Content-Type</code>. You can also override the <code class="literal">Content-Type</code> in any input part by calling <code class="literal">org.jboss.resteasy.plugins.providers.multipart.InputPart.setMediaType()</code>.
					</p><div class="formalpara"><p class="title"><strong>Example: Overriding the <code class="literal">Content-Type</code></strong></p><p>
							
<pre class="programlisting language-java">@POST
@Path("query")
@Consumes(MediaType.MULTIPART_FORM_DATA)
@Produces(MediaType.TEXT_PLAIN)
public Response setMediaType(MultipartInput input) throws IOException {

    List&lt;InputPart&gt; parts = input.getParts();
    InputPart part = parts.get(0);
    part.setMediaType(MediaType.valueOf("application/foo+xml"));
    String s = part.getBody(String.class, null);
    ...
}</pre>

						</p></div></section><section class="section" id="resteasy-multipart-overwrite-fallback-charset"><div class="titlepage"><div><div><h4 class="title">2.6.11.7. Overwriting the Default Fallback <code class="literal">charset</code> for Multipart Messages</h4></div></div></div><p>
						In some cases, part of a multipart message may have a <code class="literal">Content-Type</code> header with no <code class="literal">charset</code> parameter. If the <code class="literal">InputPart.DEFAULT_CONTENT_TYPE_PROPERTY</code> property is set and the value has a <code class="literal">charset</code> parameter, that value will be appended to an existing <code class="literal">Content-Type</code> header that has no <code class="literal">charset</code> parameter.
					</p><p>
						You can also specify a default <code class="literal">charset</code> using the constant <code class="literal">InputPart.DEFAULT_CHARSET_PROPERTY</code> (<code class="literal">resteasy.provider.multipart.inputpart.defaultCharset</code>).
					</p><div class="formalpara"><p class="title"><strong>Example: Specifying a Default <code class="literal">charset</code></strong></p><p>
							
<pre class="programlisting language-java">import org.jboss.resteasy.plugins.providers.multipart.InputPart;

@Provider
@ServerInterceptor
public class ContentTypeSetterPreProcessorInterceptor implements PreProcessInterceptor {

    public ServerResponse preProcess(HttpRequest request, ResourceMethod method)
            throws Failure, WebApplicationException {
        request.setAttribute(InputPart.DEFAULT_CHARSET_PROPERTY, "UTF-8");
        return null;
    }
}</pre>

						</p></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							If both <code class="literal">InputPart.DEFAULT_CONTENT_TYPE_PROPERTY</code> and <code class="literal">InputPart.DEFAULT_CHARSET_PROPERTY</code> are set, then the value of <code class="literal">InputPart.DEFAULT_CHARSET_PROPERTY</code> will override any charset in the value of <code class="literal">InputPart.DEFAULT_CONTENT_TYPE_PROPERTY</code>.
						</p></div></div></section><section class="section" id="resteasy_multipart_client"><div class="titlepage"><div><div><h4 class="title">2.6.11.8. Send Multipart Entity with RESTEasy Client</h4></div></div></div><p>
						In addition to configuring multipart providers, you can also configure the RESTEasy client to send multipart data.
					</p><h6 id="using_resteasy_client_classes_2">Using RESTEasy Client Classes</h6><p>
						To use RESTEasy client classes in your application, you must add the Maven dependencies to your project’s POM file.
					</p><div class="formalpara"><p class="title"><strong>Example: Maven Dependencies</strong></p><p>
							
<pre class="programlisting language-xml">&lt;dependency&gt;
  &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
  &lt;artifactId&gt;resteasy-client&lt;/artifactId&gt;
  &lt;version&gt;${version.org.jboss.resteasy}&lt;/version&gt;
  &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
  &lt;artifactId&gt;resteasy-multipart-provider&lt;/artifactId&gt;
  &lt;version&gt;${version.org.jboss.resteasy}&lt;/version&gt;
  &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;</pre>

						</p></div><h6 id="sending_multipart_data_using_the_resteasy_client">Sending Multipart Data Using the RESTEasy Client</h6><p>
						To send multipart data, you first need to configure a <a class="link" href="#JAX-RS_client_api" title="2.2.1. JAX-RS Client API">RESTEasy Client</a> and construct a <code class="literal">org.jboss.resteasy.plugins.providers.multipart.MultipartFormDataOutput</code> object to contain your multipart data. You can then use the client to send that <code class="literal">MultipartFormDataOutput</code> object as a <code class="literal">javax.ws.rs.core.GenericEntity</code>.
					</p><div class="formalpara"><p class="title"><strong>Example: RESTEasy Client</strong></p><p>
							
<pre class="programlisting language-java">ResteasyClient client = new ResteasyClientBuilder().build();
ResteasyWebTarget target = client.target("http://foo.com/resource");

MultipartFormDataOutput formOutputData = new MultipartFormDataOutput();
formOutputData.addFormData("part1", "this is part 1", MediaType.TEXT_PLAIN);
formOutputData.addFormData("part2", "this is part 2", MediaType.TEXT_PLAIN);

GenericEntity&lt;MultipartFormDataOutput&gt; data = new GenericEntity&lt;MultipartFormDataOutput&gt;(formOutputData) { };

Response response = target.request().put(Entity.entity(data, MediaType.MULTIPART_FORM_DATA_TYPE));

response.close();</pre>

						</p></div></section></section><section class="section" id="resteasy_atom_support"><div class="titlepage"><div><div><h3 class="title">2.6.12. RESTEasy Atom Support</h3></div></div></div><p>
					The RESTEasy Atom API and Provider is a simple object model that RESTEasy defines to represent Atom. The main classes for the API are in the <code class="literal">org.jboss.resteasy.plugins.providers.atom</code> package. RESTEasy uses JAXB to marshal and unmarshal the API. The provider is JAXB based, and is not limited to sending Atom objects using XML. All JAXB providers that RESTEasy has can be reused by the Atom API and provider, including JSON.
				</p><pre class="programlisting language-java">import org.jboss.resteasy.plugins.providers.atom.Content;
import org.jboss.resteasy.plugins.providers.atom.Entry;
import org.jboss.resteasy.plugins.providers.atom.Feed;
import org.jboss.resteasy.plugins.providers.atom.Link;
import org.jboss.resteasy.plugins.providers.atom.Person;

@Path("atom")
public class MyAtomService {

   @GET
   @Path("feed")
   @Produces("application/atom+xml")
   public Feed getFeed() throws URISyntaxException {
      Feed feed = new Feed();
      feed.setId(new URI("http://example.com/42"));
      feed.setTitle("My Feed");
      feed.setUpdated(new Date());
      Link link = new Link();
      link.setHref(new URI("http://localhost"));
      link.setRel("edit");
      feed.getLinks().add(link);
      feed.getAuthors().add(new Person("John Brown"));
      Entry entry = new Entry();
      entry.setTitle("Hello World");
      Content content = new Content();
      content.setType(MediaType.TEXT_HTML_TYPE);
      content.setText("Nothing much");
      entry.setContent(content);
      feed.getEntries().add(entry);
      return feed;
   }
}</pre><section class="section" id="using_jaxb_with_atom_provider"><div class="titlepage"><div><div><h4 class="title">2.6.12.1. Using JAXB with Atom Provider</h4></div></div></div><p>
						The <code class="literal">org.jboss.resteasy.plugins.providers.atom.Content</code> class allows you to unmarshal and marshal JAXB annotated objects that are the body of the content.
					</p><div class="formalpara"><p class="title"><strong>Example: Entry with a Customer</strong></p><p>
							
<pre class="programlisting language-java">@XmlRootElement(namespace = "http://jboss.org/Customer")
@XmlAccessorType(XmlAccessType.FIELD)
public class Customer {
   @XmlElement
   private String name;

   public Customer() {
   }

   public Customer(String name) {
      this.name = name;
   }

   public String getName() {
      return name;
   }
}

@Path("atom")
public static class AtomServer {
   @GET
   @Path("entry")
   @Produces("application/atom+xml")
   public Entry getEntry() {
      Entry entry = new Entry();
      entry.setTitle("Hello World");
      Content content = new Content();
      content.setJAXBObject(new Customer("bill"));
      entry.setContent(content);
      return entry;
   }
}</pre>

						</p></div><p>
						The <code class="literal">Content.setJAXBObject()</code> method lets you specify the content object you send to JAXB to marshal appropriately. If you are using a different base format other than XML, that is <code class="literal">application/atom+json</code>, the attached JAXB object is marshalled in the same format. If you have an Atom document as input, you can also extract JAXB objects from <code class="literal">Content</code> using the <code class="literal">Content.getJAXBObject(Class clazz)</code> method.
					</p><div class="formalpara"><p class="title"><strong>Example: Atom Document Extracting a Customer Object</strong></p><p>
							
<pre class="programlisting language-java">@Path("atom")
public static class AtomServer {
   @PUT
   @Path("entry")
   @Produces("application/atom+xml")
   public void putCustomer(Entry entry) {
      Content content = entry.getContent();
      Customer cust = content.getJAXBObject(Customer.class);
   }
}</pre>

						</p></div></section></section><section class="section" id="jaxrs_yaml_provider"><div class="titlepage"><div><div><h3 class="title">2.6.13. YAML Provider</h3></div></div></div><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
						The <code class="literal">resteasy-yaml-provider</code> module is not supported. Its use is not recommended due to a security issue in the <code class="literal">SnakeYAML</code> library used by RESTEasy for unmarshalling.
					</p></div></div><p>
					RESTEasy comes with built in support for YAML using the <code class="literal">SnakeYAML</code> library.
				</p><p>
					In releases prior to JBoss EAP 7.1, the YAML provider setting was enabled by default and you only needed to configure the Maven dependencies for YAML to use it in your application. Starting with JBoss EAP 7.1, the YAML provider is disabled by default and must be explicitly enabled in the application.
				</p><h5 id="jaxrs_yaml_provider_enablement">Enable the YAML Provider</h5><p>
					To enable the YAML provider in your application, follow these steps:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							Create or update a file named <code class="literal">javax.ws.rs.ext.Providers</code>.
						</li><li class="listitem"><p class="simpara">
							Add the following content to the file.
						</p><pre class="screen">org.jboss.resteasy.plugins.providers.YamlProvider</pre></li><li class="listitem">
							Place the file in the <code class="literal">META-INF/services/</code> folder of your WAR or JAR file.
						</li></ol></div><h5 id="jaxrs_yaml_provider_maven_dependencies">YAML Provider Maven Dependencies</h5><p>
					To use the YAML provider in your application, you must add the <code class="literal">snakeyaml</code> JAR dependencies to the project POM file of your application.
				</p><div class="formalpara"><p class="title"><strong>Example: Maven Dependencies for YAML</strong></p><p>
						
<pre class="programlisting language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.jboss.resteasy&lt;/groupId&gt;
    &lt;artifactId&gt;resteasy-yaml-provider&lt;/artifactId&gt;
    &lt;version&gt;${version.org.jboss.resteasy}&lt;/version&gt;
    &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;org.yaml&lt;/groupId&gt;
    &lt;artifactId&gt;snakeyaml&lt;/artifactId&gt;
    &lt;version&gt;${version.org.yaml.snakeyaml}&lt;/version&gt;
&lt;/dependency&gt;</pre>

					</p></div><h5 id="jaxrs_yaml_provider_example">YAML Provider Code Example</h5><p>
					The YAML provider recognizes three mime types:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							text/x-yaml
						</li><li class="listitem">
							text/yaml
						</li><li class="listitem">
							application/x-yaml
						</li></ul></div><p>
					The following is an example of how to use YAML in a resource method.
				</p><div class="formalpara"><p class="title"><strong>Example: Resource Producing YAML</strong></p><p>
						
<pre class="programlisting language-java">import javax.ws.rs.Consumes;
import javax.ws.rs.GET;
import javax.ws.rs.Path;
import javax.ws.rs.Produces;

@Path("/yaml")
public class YamlResource {

  @GET
  @Produces("text/x-yaml")
  public MyObject getMyObject() {
    return createMyObject();
  }
...
}</pre>

					</p></div></section></section><section class="section" id="jaxrs_json_p"><div class="titlepage"><div><div><h2 class="title">2.7. Using the JSON API for JSON Processing (JSON-P)</h2></div></div></div><p>
				The JSON API for JSON Processing (JSON-P) was introduced in the Java EE 7 specification, which is defined in <a class="link mimir-link-warn" href="https://jcp.org/en/jsr/detail?id=353" title="Mimir does not include content from: jcp.org">JSR 353</a>. Additional specifications are defined in <a class="link mimir-link-warn" href="https://jcp.org/en/jsr/detail?id=374" title="Mimir does not include content from: jcp.org">JSR 374</a> for Java EE 8.
			</p><p>
				JSON-P defines an API to process JSON. JBoss EAP has support for <code class="literal">javax.json.JsonObject</code>, <code class="literal">javax.json.JsonArray</code>, and <code class="literal">javax.json.JsonStructure</code> as request or response entities.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					The JSON API for JSON Processing (JSON-P) is different from JSON with Padding (JSONP).
				</p></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					JSON-P will not conflict with Jackson if they are on the same classpath.
				</p></div></div><p>
				To create a <code class="literal">JsonObject</code>, use the <code class="literal">JsonObjectBuilder</code> by calling <code class="literal">Json.createObjectBuilder()</code> and building the JSON object.
			</p><div class="formalpara"><p class="title"><strong>Example: Create <code class="literal">javax.json.JsonObject</code></strong></p><p>
					
<pre class="programlisting language-java">JsonObject obj = Json.createObjectBuilder().add("name", "Bill").build();</pre>

				</p></div><div class="formalpara"><p class="title"><strong>Example: Corresponding JSON for <code class="literal">javax.json.JsonObject</code></strong></p><p>
					
<pre class="screen">{
  "name":"Bill"
}</pre>

				</p></div><p>
				To create a <code class="literal">JsonArray</code>, use the <code class="literal">JsonArrayBuilder</code> by calling <code class="literal">Json.createArrayBuilder()</code> and building the JSON array.
			</p><div class="formalpara"><p class="title"><strong>Example: Create <code class="literal">javax.json.JsonArray</code></strong></p><p>
					
<pre class="programlisting language-java">JsonArray array =
  Json.createArrayBuilder()
    .add(Json.createObjectBuilder().add("name", "Bill").build())
    .add(Json.createObjectBuilder().add("name", "Monica").build()).build();</pre>

				</p></div><div class="formalpara"><p class="title"><strong>Example: Corresponding JSON for <code class="literal">javax.json.JsonArray</code></strong></p><p>
					
<pre class="screen">[
  {
  "name":"Bill"
  },
  {
  "name":"Monica"
  }
]</pre>

				</p></div><p>
				<code class="literal">JsonStructure</code> is a parent class of <code class="literal">JsonObject</code> and <code class="literal">JsonArray</code>.
			</p><div class="formalpara"><p class="title"><strong>Example: Create <code class="literal">javax.json.JsonStructure</code></strong></p><p>
					
<pre class="programlisting language-java">JsonObject obj = Json.createObjectBuilder().add("name", "Bill").build();

JsonArray array =
  Json.createArrayBuilder()
    .add(Json.createObjectBuilder().add("name", "Bill").build())
    .add(Json.createObjectBuilder().add("name", "Monica").build()).build();

JsonStructure sObj = (JsonStructure) obj;
JsonStructure sArray = (JsonStructure) array;</pre>

				</p></div><p>
				You can use <code class="literal">JsonObject</code>, <code class="literal">JsonArray</code>, and <code class="literal">JsonStructure</code> directly in JAX-RS resources.
			</p><div class="formalpara"><p class="title"><strong>Example: JAX-RS Resources with JSON-P</strong></p><p>
					
<pre class="programlisting language-java">@Path("object")
@POST
@Produces("application/json")
@Consumes("application/json")
public JsonObject object(JsonObject obj) {
  // do something
  return obj;
 }

@Path("array")
@POST
@Produces("application/json")
@Consumes("application/json")
public JsonArray array(JsonArray array) {
  // do something
  return array;
}

@Path("structure")
@POST
@Produces("application/json")
@Consumes("application/json")
public JsonStructure structure(JsonStructure structure) {
  // do something
  return structure;
}</pre>

				</p></div><p>
				You can also use JSON-P from a client to send JSON.
			</p><div class="formalpara"><p class="title"><strong>Example: Client Using JSON-P</strong></p><p>
					
<pre class="programlisting language-java">WebTarget target = client.target(...);
JsonObject obj = Json.createObjectBuilder().add("name", "Bill").build();
JsonObject newObj = target.request().post(Entity.json(obj), JsonObject.class);</pre>

				</p></div></section><section class="section" id="ejb_integration"><div class="titlepage"><div><div><h2 class="title">2.8. RESTEasy/EJB Integration</h2></div></div></div><p>
				To integrate RESTEasy with EJB, add JAX-RS annotations to the EJB classes that you want to expose as JAX-RS endpoints. You can also apply the annotations on the bean’s business interface. There are two ways to activate the beans as endpoints:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Using the <code class="literal">web.xml</code> file.
					</li><li class="listitem">
						Using <code class="literal">javax.ws.rs.core.Application</code>.
					</li></ul></div><p>
				To make an EJB function as a JAX-RS resource, annotate a stateless session bean’s <code class="literal">@Remote</code> or <code class="literal">@Local</code> interface with JAX-RS annotations:
			</p><pre class="programlisting language-java">@Local
@Path("/Library")
public interface Library {
   @GET
   @Path("/books/{isbn}")
   public String getBook(@PathParam("isbn") String isbn);
}
@Stateless
public class LibraryBean implements Library {
...
}</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Note that the <code class="literal">Library</code> interface is referenced by fully qualified name, whereas <code class="literal">LibraryBean</code> is referenced only by the simple class name.
				</p></div></div><p>
				Then, manually register the EJB with RESTEasy using the <code class="literal">resteasy.jndi.resources</code> context parameter in the RESTEasy <code class="literal">web.xml</code> file:
			</p><pre class="programlisting language-xml">&lt;web-app&gt;
   &lt;display-name&gt;Archetype Created Web Application&lt;/display-name&gt;
   &lt;context-param&gt;
      &lt;param-name&gt;resteasy.jndi.resources&lt;/param-name&gt;
      &lt;param-value&gt;java:module/LibraryBean!org.app.Library&lt;/param-value&gt;
   &lt;/context-param&gt;
   &lt;listener&gt;
      &lt;listener-class&gt;org.jboss.resteasy.plugins.server.servlet.ResteasyBootstrap&lt;/listener-class&gt;
   &lt;/listener&gt;
   &lt;servlet&gt;
      &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
      &lt;servlet-class&gt;org.jboss.resteasy.plugins.server.servlet.HttpServletDispatcher&lt;/servlet-class&gt;
   &lt;/servlet&gt;
   &lt;servlet-mapping&gt;
      &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
      &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
   &lt;/servlet-mapping&gt;
&lt;/web-app&gt;</pre><p>
				You can also specify multiple JNDI names of EJBs, separated by commas, for the <code class="literal">resteasy.jndi.resources</code> context parameter.
			</p><p>
				An alternate Java EE-standard way to activate EJBs as RESTEasy endpoints is by using <code class="literal">javax.ws.rs.core.Application</code>. This is achieved by including the EJB implementation class into the set returned by the application’s <code class="literal">getClasses()</code> method. This approach does not need anything to be specified in the <code class="literal">web.xml</code> file.
			</p><p>
				See the <code class="literal">kitchensink</code>, <code class="literal">helloworld-html5</code>, and <code class="literal">managed-executor-service</code> quickstarts that ship with JBoss EAP for working examples that demonstrate RESTEasy integration with EJBs.
			</p></section><section class="section" id="spring_integration"><div class="titlepage"><div><div><h2 class="title">2.9. Spring Integration</h2></div></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Your application must have an existing JAX-WS service and client configuration.
				</p></div></div><p>
				RESTEasy integrates with Spring 4.2.x.
			</p><p>
				Maven users must use the <code class="literal">resteasy-spring</code> artifact. Alternatively, the JAR is available as a module in JBoss EAP.
			</p><p>
				RESTEasy comes with its own Spring <code class="literal">ContextLoaderListener</code> that registers a RESTEasy specific <code class="literal">BeanPostProcessor</code> that processes JAX-RS annotations when a bean is created by a <code class="literal">BeanFactory</code>. This means that RESTEasy automatically scans for <code class="literal">@Provider</code> and JAX-RS resource annotations on your bean class and registers them as JAX-RS resources.
			</p><p>
				Add the following to your <code class="literal">web.xml</code> file to enable the RESTEasy/Spring integration functionality:
			</p><pre class="programlisting language-xml">&lt;web-app&gt;
   &lt;display-name&gt;Archetype Created Web Application&lt;/display-name&gt;
   &lt;listener&gt;
      &lt;listener-class&gt;org.jboss.resteasy.plugins.server.servlet.ResteasyBootstrap&lt;/listener-class&gt;
   &lt;/listener&gt;
   &lt;listener&gt;
      &lt;listener-class&gt;org.jboss.resteasy.plugins.spring.SpringContextLoaderListener&lt;/listener-class&gt;
   &lt;/listener&gt;
   &lt;listener&gt;
      &lt;listener-class&gt;org.springframework.web.context.request.RequestContextListener&lt;/listener-class&gt;
   &lt;/listener&gt;
   &lt;servlet&gt;
      &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
      &lt;servlet-class&gt;org.jboss.resteasy.plugins.server.servlet.HttpServletDispatcher&lt;/servlet-class&gt;
   &lt;/servlet&gt;
   &lt;servlet-mapping&gt;
      &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
      &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
   &lt;/servlet-mapping&gt;
&lt;/web-app&gt;</pre><p>
				The <code class="literal">SpringContextLoaderListener</code> must be declared after <code class="literal">ResteasyBootstrap</code> as it uses <code class="literal">ServletContext</code> attributes initialized by it.
			</p><p>
				See the <code class="literal">spring-resteasy</code> quickstart that ships with JBoss EAP for a working example of a web application that demonstrates RESTEasy integration with Spring.
			</p></section><section class="section" id="cdi_integration"><div class="titlepage"><div><div><h2 class="title">2.10. CDI Integration</h2></div></div></div><p>
				Integration between RESTEasy and CDI is provided by the <code class="literal">resteasy-cdi</code> module.
			</p><p>
				Both the JAX-RS and CDI specifications introduce their own component models. Every class placed in a CDI archive, which fulfills a set of basic constraints, is implicitly a CDI bean. Explicit declaration of your Java class with <code class="literal">@Path</code> or <code class="literal">@Provider</code> is required for it to become a JAX-RS component. Without the integration code, annotating a class suitable for being a CDI bean with JAX-RS annotations gives a faulty result and the JAX-RS component is not managed by the CDI. The <code class="literal">resteasy-cdi</code> module is a bridge that allows RESTEasy to work with class instances obtained from the CDI container.
			</p><p>
				During a web service invocation, the <code class="literal">resteasy-cdi</code> module asks the CDI container for the managed instance of a JAX-RS component. Then, this instance is passed to RESTEasy. If a managed instance is not available for some reason, such as the class being placed in a JAR file that is not a bean deployment archive, RESTEasy falls back to instantiating the class itself.
			</p><p>
				As a result, CDI services like injection, lifecycle management, events, decoration, and interceptor bindings can be used in JAX-RS components.
			</p><section class="section" id="default_scope"><div class="titlepage"><div><div><h3 class="title">2.10.1. Default Scope</h3></div></div></div><p>
					A CDI bean that does not explicitly define a scope is <code class="literal">@Dependent</code> scoped by default. This pseudo-scope means that the bean adapts to the lifecycle of the bean that it is injected into. Normal scopes, including request, session, and application, are more suitable for JAX-RS components as they designate the component’s lifecycle boundaries explicitly. Therefore, the <code class="literal">resteasy-cdi</code> module alters the default scoping in the following way:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							If a JAX-RS root resource does not define a scope explicitly, it is bound to the request scope.
						</li><li class="listitem">
							If a JAX-RS provider or <code class="literal">javax.ws.rs.Application</code> subclass does not define a scope explicitly, it is bound to the application scope.
						</li></ul></div><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
						Since the scope of all beans that do not declare a scope is modified by the <code class="literal">resteasy-cdi</code> module, this affects session beans as well. As a result, a conflict occurs if the scope of a stateless session bean or singleton is changed automatically as the specification prohibits these components to be <code class="literal">@RequestScoped</code>. Therefore, you need to explicitly define a scope when using stateless session beans or singletons. This requirement is likely to be removed in future releases.
					</p></div></div><p>
					The <code class="literal">resteasy-cdi</code> module is bundled with JBoss EAP. Therefore, there is no need to download the module separately or add any additional configuration. See the <code class="literal">kitchensink</code> quickstart that ships with JBoss EAP for a working example of using CDI beans with a JAX-RS resource.
				</p></section></section><section class="section" id="resteasy_filters_interceptors"><div class="titlepage"><div><div><h2 class="title">2.11. RESTEasy Filters and Interceptors</h2></div></div></div><p>
				JAX-RS has two different concepts for interceptions: filters and interceptors. Filters are mainly used to modify or process incoming and outgoing request headers or response headers. They execute before and after request and response processing.
			</p><section class="section" id="resteasy_server_filters"><div class="titlepage"><div><div><h3 class="title">2.11.1. Server-side Filters</h3></div></div></div><p>
					On the server side, you have two different types of filters: <code class="literal">ContainerRequestFilters</code> and <code class="literal">ContainerResponseFilters</code>. <code class="literal">ContainerRequestFilters</code> run before your JAX-RS resource method is invoked. <code class="literal">ContainerResponseFilters</code> run after your JAX-RS resource method is invoked.
				</p><p>
					In addition, there are two types of <code class="literal">ContainerRequestFilters</code>: pre-matching and post-matching. Pre-matching <code class="literal">ContainerRequestFilters</code> are designated with the <code class="literal">@PreMatching</code> annotation and execute before the JAX-RS resource method is matched with the incoming HTTP request. Post-matching <code class="literal">ContainerRequestFilters</code> are designated with the <code class="literal">@PostMatching</code> annotation and execute after the JAX-RS resource method is matched with the incoming HTTP request.
				</p><p>
					Pre-matching filters often are used to modify request attributes to change how it matches to a specific resource method, for example to strip <code class="literal">.xml</code> and add an <code class="literal">Accept</code> header. <code class="literal">ContainerRequestFilters</code> can abort the request by calling <code class="literal">ContainerRequestContext.abortWith(Response)</code>. For example, a filter might want to abort if it implements a custom authentication protocol.
				</p><p>
					After the resource class method is executed, JAX-RS runs all <code class="literal">ContainerResponseFilters</code>. These filters allow you to modify the outgoing response before it is marshalled and sent to the client.
				</p><div class="formalpara"><p class="title"><strong>Example: Request Filter</strong></p><p>
						
<pre class="programlisting language-java">public class RoleBasedSecurityFilter implements ContainerRequestFilter {
  protected String[] rolesAllowed;
  protected boolean denyAll;
  protected boolean permitAll;

  public RoleBasedSecurityFilter(String[] rolesAllowed, boolean denyAll, boolean permitAll) {
    this.rolesAllowed = rolesAllowed;
    this.denyAll = denyAll;
    this.permitAll = permitAll;
  }

  @Override
  public void filter(ContainerRequestContext requestContext) throws IOException  {
    if (denyAll) {
       requestContext.abortWith(Response.status(403).entity("Access forbidden: role not allowed").build());
       return;
    }
    if (permitAll) return;
    if (rolesAllowed != null) {
       SecurityContext context = ResteasyProviderFactory.getContextData(SecurityContext.class);
       if (context != null) {
          for (String role : rolesAllowed) {
             if (context.isUserInRole(role)) return;
          }
          requestContext.abortWith(Response.status(403).entity("Access forbidden: role not allowed").build());
          return;
       }
    }
    return;
  }
}</pre>

					</p></div><div class="formalpara"><p class="title"><strong>Example: Response Filter</strong></p><p>
						
<pre class="programlisting language-java">public class CacheControlFilter implements ContainerResponseFilter {
   private int maxAge;

   public CacheControlFilter(int maxAge) {
      this.maxAge = maxAge;
   }

   public void filter(ContainerRequestContext req, ContainerResponseContext res)
           throws IOException {
      if (req.getMethod().equals("GET")) {
         CacheControl cc = new CacheControl();
         cc.setMaxAge(this.maxAge);
         res.getHeaders().add("Cache-Control", cc);
      }
   }
}</pre>

					</p></div></section><section class="section" id="resteasy_client_filters"><div class="titlepage"><div><div><h3 class="title">2.11.2. Client-side Filters</h3></div></div></div><p>
					More information on client-side filters can be found in the <a class="link" href="#JAX-RS_client_api" title="2.2.1. JAX-RS Client API">JAX-RS Client API</a> section of this guide.
				</p></section><section class="section" id="resteasy_interceptors"><div class="titlepage"><div><div><h3 class="title">2.11.3. RESTEasy Interceptors</h3></div></div></div><section class="section" id="intercept_jax_rs_invocations"><div class="titlepage"><div><div><h4 class="title">2.11.3.1. Intercept JAX-RS Invocations</h4></div></div></div><p>
						RESTEasy can intercept JAX-RS invocations and route them through listener-like objects called interceptors.
					</p><p>
						While filters modify request or response headers, interceptors deal with message bodies. Interceptors are executed in the same call stack as their corresponding reader or writer. <code class="literal">ReaderInterceptors</code> wrap around the execution of <code class="literal">MessageBodyReaders</code>. <code class="literal">WriterInterceptors</code> wrap around the execution of <code class="literal">MessageBodyWriters</code>. They can be used to implement a specific content-encoding. They can be used to generate digital signatures or to post or pre-process a Java object model before or after it is marshalled.
					</p><p>
						<code class="literal">ReaderInterceptors</code> and <code class="literal">WriterInterceptors</code> can be used on either the server or client side. They are annotated with <code class="literal">@Provider</code>, as well as either <code class="literal">@ServerInterceptor</code> or <code class="literal">@ClientInterceptor</code> so that RESTEasy knows whether or not to add them to the interceptor list.
					</p><p>
						These interceptors wrap around the invocation of <code class="literal">MessageBodyReader.readFrom()</code> or <code class="literal">MessageBodyWriter.writeTo()</code>. They can be used to wrap the <code class="literal">Output</code> or <code class="literal">Input</code> streams.
					</p><div class="formalpara"><p class="title"><strong>Example: Interceptor</strong></p><p>
							
<pre class="programlisting language-java">@Provider
public class BookReaderInterceptor implements ReaderInterceptor {
    @Inject private Logger log;
    @Override
    @ReaderInterceptorBinding
    public Object aroundReadFrom(ReaderInterceptorContext context) throws IOException, WebApplicationException {
        log.info("*** Intercepting call in BookReaderInterceptor.aroundReadFrom()");
        VisitList.add(this);
        Object result = context.proceed();
        log.info("*** Back from intercepting call in BookReaderInterceptor.aroundReadFrom()"); return result;
    }
}</pre>

						</p></div><p>
						The interceptors and the <code class="literal">MessageBodyReader</code> or <code class="literal">Writer</code> are invoked in one big Java call stack. <code class="literal">ReaderInterceptorContext.proceed()</code> or <code class="literal">WriterInterceptorContext.proceed()</code> are called in order to go to the next interceptor or, if there are no more interceptors to invoke, the <code class="literal">readFrom()</code> or <code class="literal">writeTo()</code> method of the <code class="literal">MessageBodyReader</code> or <code class="literal">MessageBodyWriter</code>. This wrapping allows objects to be modified before they get to the <code class="literal">Reader</code> or <code class="literal">Writer</code>, and then cleaned up after <code class="literal">proceed()</code> returns.
					</p><p>
						The example below is a server-side interceptor that adds a header value to the response.
					</p><pre class="programlisting language-java">@Provider
public class BookWriterInterceptor implements WriterInterceptor {
   @Inject private Logger log;

   @Override
   @WriterInterceptorBinding
   public void aroundWriteTo(WriterInterceptorContext context) throws IOException, WebApplicationException {
      log.info("*** Intercepting call in BookWriterInterceptor.aroundWriteTo()");
      VisitList.add(this);
      context.proceed();
      log.info("*** Back from intercepting call in BookWriterInterceptor.aroundWriteTo()");
   }
}</pre></section><section class="section" id="registering_an_interceptor"><div class="titlepage"><div><div><h4 class="title">2.11.3.2. Registering an Interceptor</h4></div></div></div><p>
						To register a RESTEasy JAX-RS interceptor in an application, list it in the <code class="literal">web.xml</code> file under the <code class="literal">resteasy.providers</code> parameter in the <code class="literal">context-param</code> element, or return it as a class or as an object in the <code class="literal">Application.getClasses()</code> or <code class="literal">Application.getSingletons()</code> method.
					</p><pre class="programlisting language-xml">&lt;context-param&gt;
    &lt;param-name&gt;resteasy.providers&lt;/param-name&gt;
    &lt;param-value&gt;my.app.CustomInterceptor&lt;/paramvalue&gt;
&lt;/context-param&gt;</pre><pre class="programlisting language-java">package org.jboss.resteasy.example;

import javax.ws.rs.core.Application;
import java.util.HashSet;
import java.util.Set;

public class MyApp extends Application {

  public java.util.Set&lt;java.lang.Class&lt;?&gt;&gt; getClasses() {
    Set&lt;Class&lt;?&gt;&gt; resources = new HashSet&lt;Class&lt;?&gt;&gt;();
    resources.add(MyResource.class);
    resources.add(MyProvider.class);
    return resources;
  }
}</pre><pre class="programlisting language-java">package org.jboss.resteasy.example;

import javax.ws.rs.core.Application;
import java.util.HashSet;
import java.util.Set;

public class MyApp extends Application {

    protected Set&lt;Object&gt; singletons = new HashSet&lt;Object&gt;();

    public MyApp() {
        singletons.add(new MyResource());
        singletons.add(new MyProvider());
    }

    @Override
    public Set&lt;Object&gt; getSingletons() {
        return singletons;
    }
}</pre></section></section><section class="section" id="resteasy_gzip_compression_decompression"><div class="titlepage"><div><div><h3 class="title">2.11.4. GZIP Compression and Decompression</h3></div></div></div><p>
					RESTEasy supports GZIP compression and decompression. To support GZIP decompression, the client framework or a JAX-RS service automatically decompresses a message body with a <code class="literal">Content-Encoding</code> of <code class="literal">gzip</code>, and it can automatically set the <code class="literal">Accept-Encoding</code> header to <code class="literal">gzip, deflate</code> so that you do not have to set this header manually. To support GZIP compression, RESTEasy compresses the outgoing message if the client framework is sending a request or if the server is sending a response with the <code class="literal">Content-Encoding</code> header set to <code class="literal">gzip</code>. You can use the <code class="literal">@org.jboss.resteasy.annotation.GZIP</code> annotation to set the <code class="literal">Content-Encoding</code> header.
				</p><p>
					The following example tags the outgoing message body <code class="literal">order</code> to be gzip compressed.
				</p><div class="formalpara"><p class="title"><strong>Example: GZIP Compression</strong></p><p>
						
<pre class="programlisting language-java">@Path("/")
public interface MyProxy {

   @Consumes("application/xml")
   @PUT
   public void put(@GZIP Order order);
}</pre>

					</p></div><div class="formalpara"><p class="title"><strong>Example: GZIP Compression Tagging Server Responses</strong></p><p>
						
<pre class="programlisting language-java">@Path("/")
public class MyService {

   @GET
   @Produces("application/xml")
   @GZIP
   public String getData() {...}
}</pre>

					</p></div><section class="section" id="configuring_gzip_compression_and_decompression"><div class="titlepage"><div><div><h4 class="title">2.11.4.1. Configuring GZIP Compression and Decompression</h4></div></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							RESTEasy disables GZIP compression and decompression by default in order to prevent decompression of an entity that might be huge in size but has been compressed by an attacker and sent to the server.
						</p></div></div><p>
						There are three interceptors that are relevant to GZIP compression and decompression:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<code class="literal">org.jboss.resteasy.plugins.interceptors.GZIPDecodingInterceptor</code>: If the <code class="literal">Content-Encoding</code> header is present and has the value <code class="literal">gzip</code>, <code class="literal">GZIPDecodingInterceptor</code> installs an <code class="literal">InputStream</code> that decompresses the message body.
							</li><li class="listitem">
								<code class="literal">org.jboss.resteasy.plugins.interceptors.GZIPEncodingInterceptor</code>: If the <code class="literal">Content-Encoding</code> header is present and has the value <code class="literal">gzip</code>, <code class="literal">GZIPEncodingInterceptor</code> installs an <code class="literal">OutputStream</code> that compresses the message body.
							</li><li class="listitem"><p class="simpara">
								<code class="literal">org.jboss.resteasy.plugins.interceptors.AcceptEncodingGZIPFilter</code>: If the <code class="literal">Accept-Encoding</code> header does not exist, <code class="literal">AcceptEncodingGZIPFilter</code> adds <code class="literal">Accept-Encoding</code> header with the value <code class="literal">gzip, deflate</code>. If the <code class="literal">Accept-Encoding</code> header exists but does not contain <code class="literal">gzip</code>, <code class="literal">AcceptEncodingGZIPFilter</code> interceptor appends the value <code class="literal">, gzip</code>.
							</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
									Enabling GZIP compression or decompression does not depend on the presence of the <code class="literal">AcceptEncodingGZIPFilter</code> interceptor.
								</p></div></div></li></ul></div><p>
						Enabling GZIP decompression sets an upper limit on the number of bytes the <code class="literal">GZIPDecodingInterceptor</code> can extract from the compressed message body. The default limit is <code class="literal">10,000,000</code>.
					</p></section><section class="section" id="reasteasy_gzip_server_side_configuration"><div class="titlepage"><div><div><h4 class="title">2.11.4.2. Server-side GZIP Configuration</h4></div></div></div><p>
						You can enable the interceptors by including their class names in the <code class="literal">javax.ws.rs.ext.Providers</code> file on the class path. The upper limit on deflated files is set using the web application context parameter <code class="literal">resteasy.gzip.max.input</code>. If this limit is exceeded on the server side, <code class="literal">GZIPDecodingInterceptor</code> returns a response with status <code class="literal">413 - Request Entity Too Large</code> and a message specifying the upper limit.
					</p><section class="section" id="resteasy_gzip_client_side_configuration"><div class="titlepage"><div><div><h5 class="title">2.11.4.2.1. Client-side GZIP Configuration</h5></div></div></div><p>
							You can enable the GZIP interceptors by registering them with, for example, a <code class="literal">Client</code> or <code class="literal">WebTarget</code>. For example:
						</p><pre class="screen">Client client = new ResteasyClientBuilder() // Activate gzip compression on client:
    .register(AcceptEncodingGZIPFilter.class)
    .register(GZIPDecodingInterceptor.class)
    .register(GZIPEncodingInterceptor.class)
    .build();</pre><p>
							You can configure the upper limit on deflated files by creating an instance of <code class="literal">GZIPDecodingInterceptor</code> with a specific value:
						</p><pre class="screen">Client client = new ResteasyClientBuilder() // Activate gzip compression on client:
    .register(AcceptEncodingGZIPFilter.class)
    .register(new GZIPDecodingInterceptor(256))
    .register(GZIPEncodingInterceptor.class)
    .build();</pre><p>
							If the upper limit is exceeded on the client side, <code class="literal">GZIPDecodingInterceptor</code> throws a <code class="literal">ProcessingException</code> with a message specifying the upper limit.
						</p></section></section></section><section class="section" id="resteasy_per_resource_filters_interceptors"><div class="titlepage"><div><div><h3 class="title">2.11.5. Per-Resource Method Filters and Interceptors</h3></div></div></div><p>
					Sometimes you want a filter or interceptor to only run for a specific resource method. You can do this in two different ways:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							<a class="link" href="#implement_dynamicfeature_interface" title="Implement the DynamicFeature Interface">Implement the <code class="literal">DynamicFeature</code> interface</a>.
						</li><li class="listitem">
							<a class="link" href="#use_namebinding_annotation" title="Use the @NameBinding Annotation">Use the <code class="literal">@NameBinding</code> annotation</a>.
						</li></ul></div><h5 id="implement_dynamicfeature_interface">Implement the <code class="literal">DynamicFeature</code> Interface</h5><p>
					The <code class="literal">DynamicFeature</code> interface includes a callback method, <code class="literal">configure(ResourceInfo resourceInfo, FeatureContext context)</code>, which is invoked for each and every deployed JAX-RS method. The <code class="literal">ResourceInfo</code> parameter contains information about the current JAX-RS method being deployed. <code class="literal">FeatureContext</code> is an extension of the <code class="literal">Configurable</code> interface. You can use the <code class="literal">register()</code> method of this parameter to bind the filters and interceptors that you want to assign to this method.
				</p><div class="formalpara"><p class="title"><strong>Example: Using the DynamicFeature Interface</strong></p><p>
						
<pre class="programlisting language-java">@Provider
public class AnimalTypeFeature implements DynamicFeature {
    @Override
    public void configure(ResourceInfo info, FeatureContext context) {
        if (info.getResourceMethod().getAnnotation(GET.class) != null)
            AnimalFilter filter = new AnimalFilter();
            context.register(filter);
        }
    }
}</pre>

					</p></div><p>
					In the example above, the provider that you register using <code class="literal">AnimalTypeFeature</code> must implement one of the interfaces. This example registers the provider <code class="literal">AnimalFilter</code> that must implement one of the following interfaces: <code class="literal">ContainerRequestFilter</code>, <code class="literal">ContainerResponseFilter</code>, <code class="literal">ReaderInterceptor</code>, <code class="literal">WriterInterceptor</code>, or <code class="literal">Feature</code>. In this case <code class="literal">AnimalFilter</code> will be applied to all resource methods annotated with GET annotation. See <a class="link mimir-link-warn" href="https://docs.oracle.com/javaee/7/api/javax/ws/rs/container/DynamicFeature.html" title="Mimir does not include content from: docs.oracle.com">DynamicFeature Documentation</a> for details.
				</p><h5 id="use_namebinding_annotation">Use the @NameBinding Annotation</h5><p>
					<code class="literal">@NameBinding</code> works a lot like CDI interceptors. You annotate a custom annotation with <code class="literal">@NameBinding</code> and then apply that custom annotation to your filter and resource method.
				</p><div class="formalpara"><p class="title"><strong>Example: Using @NameBinding</strong></p><p>
						
<pre class="programlisting language-java">@NameBinding
public @interface DoIt {}

@DoIt
public class MyFilter implements ContainerRequestFilter {...}

@Path("/root")
public class MyResource {

   @GET
   @DoIt
   public String get() {...}
}</pre>

					</p></div><p>
					See <a class="link mimir-link-warn" href="https://docs.oracle.com/javaee/7/api/javax/ws/rs/NameBinding.html" title="Mimir does not include content from: docs.oracle.com">NameBinding Documentation</a> for details.
				</p></section><section class="section" id="resteasy_ordering_filters_interceptors"><div class="titlepage"><div><div><h3 class="title">2.11.6. Ordering</h3></div></div></div><p>
					Ordering is accomplished by using the <a class="link mimir-link-warn" href="http://docs.oracle.com/javaee/7/api/javax/annotation/Priority.html" title="Mimir does not include content from: docs.oracle.com"><code class="literal">@Priority</code></a> annotation on your filter or interceptor class.
				</p></section><section class="section" id="resteasy_exceptions_filters_interceptors"><div class="titlepage"><div><div><h3 class="title">2.11.7. Exception Handling with Filters and Interceptors</h3></div></div></div><p>
					Exceptions associated with filters or interceptors can occur on either the client side or the server side. On the client side, there are two types of exceptions you will have to handle: <code class="literal">javax.ws.rs.client.ProcessingException</code> and <code class="literal">javax.ws.rs.client.ResponseProcessingException</code>. A <code class="literal">javax.ws.rs.client.ProcessingException</code> will be thrown on the client side if there was an error before a request is sent to the server. A <code class="literal">javax.ws.rs.client.ResponseProcessingException</code> will be thrown on the client side if there was an error in processing the response received by the client from the server.
				</p><p>
					On the server side, exceptions thrown by filters or interceptors are handled in the same way as other exceptions thrown from JAX-RS methods, which tries to find an <code class="literal">ExceptionMapper</code> for the exception being thrown. More details on how exceptions are handled in JAX-RS methods can be found in the <a class="link" href="#resteasy_exceptions" title="2.13. Exception Handling">Exception Handling</a> section.
				</p></section></section><section class="section" id="logging_resteasy_providers_interceptors"><div class="titlepage"><div><div><h2 class="title">2.12. Logging RESTEasy Providers and Interceptors</h2></div></div></div><p>
				RESTEasy logs the used providers and interceptors in the <code class="literal">DEBUG</code> level of logging. You can use the following management CLI commands to enable all the log levels related to RESTEasy:
			</p><pre class="screen">/subsystem=logging/console-handler=CONSOLE:write-attribute(name=level,value=ALL)

/subsystem=logging/logger=org.jboss.resteasy:add(level=ALL)

/subsystem=logging/logger=javax.xml.bind:add(level=ALL)

/subsystem=logging/logger=com.fasterxml.jackson:add(level=ALL)</pre></section><section class="section" id="resteasy_exceptions"><div class="titlepage"><div><div><h2 class="title">2.13. Exception Handling</h2></div></div></div><section class="section" id="creating_an_exception_mapper"><div class="titlepage"><div><div><h3 class="title">2.13.1. Creating an Exception Mapper</h3></div></div></div><p>
					Exception mappers are custom components provided by applications that catch thrown exceptions and write specific HTTP responses.
				</p><p>
					When you create an exception mapper, you create a class that is annotated with the <code class="literal">@Provider</code> annotation and implements the <code class="literal">ExceptionMapper</code> interface.
				</p><p>
					An example exception mapper is provided below:
				</p><pre class="programlisting language-java">@Provider
public class EJBExceptionMapper implements ExceptionMapper&lt;javax.ejb.EJBException&gt; {
  public Response toResponse(EJBException exception) {
    return Response.status(500).build();
  }
}</pre><p>
					To register an exception mapper, list it in the <code class="literal">web.xml</code> file, under the <code class="literal">resteasy.providers</code> <code class="literal">context-param</code>, or register it programmatically through the <code class="literal">ResteasyProviderFactory</code> class.
				</p></section><section class="section" id="managing_internally_thrown_exceptions"><div class="titlepage"><div><div><h3 class="title">2.13.2. Managing Internally Thrown Exceptions</h3></div></div></div><div class="table" id="idm139695815419696"><p class="title"><strong>Table 2.2. Exception List</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"><!--Empty--></col><col style="width: 33%; " class="col_2"><!--Empty--></col><col style="width: 33%; " class="col_3"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139695815413936" scope="col">Exception</th><th align="left" valign="top" id="idm139695815412848" scope="col">HTTP Code</th><th align="left" valign="top" id="idm139695815411760" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139695815413936"> <p>
									BadRequestException
								</p>
								 </td><td align="left" valign="top" headers="idm139695815412848"> <p>
									400
								</p>
								 </td><td align="left" valign="top" headers="idm139695815411760"> <p>
									Bad Request. The request was not formatted correctly, or there was a problem processing the request input.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695815413936"> <p>
									UnauthorizedException
								</p>
								 </td><td align="left" valign="top" headers="idm139695815412848"> <p>
									401
								</p>
								 </td><td align="left" valign="top" headers="idm139695815411760"> <p>
									Unauthorized. Security exception thrown if you are using RESTEasy’s annotation-based role-based security.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695815413936"> <p>
									InternalServerErrorException
								</p>
								 </td><td align="left" valign="top" headers="idm139695815412848"> <p>
									500
								</p>
								 </td><td align="left" valign="top" headers="idm139695815411760"> <p>
									Internal Server Error.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695815413936"> <p>
									MethodNotAllowedException
								</p>
								 </td><td align="left" valign="top" headers="idm139695815412848"> <p>
									405
								</p>
								 </td><td align="left" valign="top" headers="idm139695815411760"> <p>
									There is no JAX-RS method for the resource to handle the invoked HTTP operation.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695815413936"> <p>
									NotAcceptableException
								</p>
								 </td><td align="left" valign="top" headers="idm139695815412848"> <p>
									406
								</p>
								 </td><td align="left" valign="top" headers="idm139695815411760"> <p>
									There is no JAX-RS method that can produce the media types listed in the Accept header.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695815413936"> <p>
									NotFoundException
								</p>
								 </td><td align="left" valign="top" headers="idm139695815412848"> <p>
									404
								</p>
								 </td><td align="left" valign="top" headers="idm139695815411760"> <p>
									There is no JAX-RS method that serves the request path/resource.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695815413936"> <p>
									ReaderException
								</p>
								 </td><td align="left" valign="top" headers="idm139695815412848"> <p>
									400
								</p>
								 </td><td align="left" valign="top" headers="idm139695815411760"> <p>
									All exceptions thrown from MessageBodyReaders are wrapped within this exception. If there is no ExceptionMapper for the wrapped exception, or if the exception is not a WebApplicationException, then by default, RESTEasy returns a 400 code.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695815413936"> <p>
									WriterException
								</p>
								 </td><td align="left" valign="top" headers="idm139695815412848"> <p>
									500
								</p>
								 </td><td align="left" valign="top" headers="idm139695815411760"> <p>
									All exceptions thrown from MessageBodyWriters are wrapped within this exception. If there is no ExceptionMapper for the wrapped exception, or if the exception is not a WebApplicationException, then by default, RESTEasy returns a 400 code.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695815413936"> <p>
									JAXBUnmarshalException
								</p>
								 </td><td align="left" valign="top" headers="idm139695815412848"> <p>
									400
								</p>
								 </td><td align="left" valign="top" headers="idm139695815411760"> <p>
									The JAXB providers (XML and Jackson) throw this exception on reads which might wrap JAXBExceptions. This class extends ReaderException.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695815413936"> <p>
									JAXBMarshalException
								</p>
								 </td><td align="left" valign="top" headers="idm139695815412848"> <p>
									500
								</p>
								 </td><td align="left" valign="top" headers="idm139695815411760"> <p>
									The JAXB providers (XML and Jackson) throw this exception on writes which might wrap JAXBExceptions. This class extends WriterException.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695815413936"> <p>
									ApplicationException
								</p>
								 </td><td align="left" valign="top" headers="idm139695815412848"> <p>
									N/A
								</p>
								 </td><td align="left" valign="top" headers="idm139695815411760"> <p>
									Wraps all exceptions thrown from application code, and it functions in the same way as InvocationTargetException. If there is an ExceptionMapper for wrapped exception, then that is used to handle the request.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695815413936"> <p>
									Failure
								</p>
								 </td><td align="left" valign="top" headers="idm139695815412848"> <p>
									N/A
								</p>
								 </td><td align="left" valign="top" headers="idm139695815411760"> <p>
									Internal RESTEasy error. Not logged.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695815413936"> <p>
									LoggableFailure
								</p>
								 </td><td align="left" valign="top" headers="idm139695815412848"> <p>
									N/A
								</p>
								 </td><td align="left" valign="top" headers="idm139695815411760"> <p>
									Internal RESTEasy error. Logged.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695815413936"> <p>
									DefaultOptionsMethodException
								</p>
								 </td><td align="left" valign="top" headers="idm139695815412848"> <p>
									N/A
								</p>
								 </td><td align="left" valign="top" headers="idm139695815411760"> <p>
									If the user invokes <code class="literal">HTTP OPTIONS</code> and no JAX-RS method for it, RESTEasy provides a default behavior by throwing this exception.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695815413936"> <p>
									UnrecognizedPropertyExceptionHandler
								</p>
								 </td><td align="left" valign="top" headers="idm139695815412848"> <p>
									400
								</p>
								 </td><td align="left" valign="top" headers="idm139695815411760"> <p>
									RESTEasy Jackson provider throws this exception when JSON data is determined to be invalid.
								</p>
								 </td></tr></tbody></table></div></div></section></section><section class="section" id="Enable_Role-Based_Security_RESTEasy_JAX-RS_Web_Service"><div class="titlepage"><div><div><h2 class="title">2.14. Securing JAX-RS Web Services</h2></div></div></div><p>
				RESTEasy supports the <code class="literal">@RolesAllowed</code>, <code class="literal">@PermitAll</code>, and <code class="literal">@DenyAll</code> annotations on JAX-RS methods. However, you must enable role-based security in order for these annotations to be recognized.
			</p><section class="section" id="enable_rbac_ws"><div class="titlepage"><div><div><h3 class="title">2.14.1. Enable Role-Based Security</h3></div></div></div><p>
					Follow these steps to configure the <code class="literal">web.xml</code> file to enable role-based security.
				</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
						Do not activate role-based security if the application uses EJBs. The EJB container will provide the functionality, instead of RESTEasy.
					</p></div></div><div class="orderedlist"><p class="title"><strong>Enable Role-Based Security for a RESTEasy JAX-RS Web Service</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Open the <code class="literal">web.xml</code> file for the application in a text editor.
						</li><li class="listitem"><p class="simpara">
							Add the following <code class="literal">&lt;context-param&gt;</code> to the file, within the <code class="literal">&lt;web-app&gt;</code> tags.
						</p><pre class="programlisting language-xml">&lt;context-param&gt;
  &lt;param-name&gt;resteasy.role.based.security&lt;/param-name&gt;
  &lt;param-value&gt;true&lt;/param-value&gt;
&lt;/context-param&gt;</pre></li><li class="listitem"><p class="simpara">
							Declare all roles used within the RESTEasy JAX-RS WAR file, using the <code class="literal">&lt;security-role&gt;</code> tags.
						</p><pre class="programlisting language-xml">&lt;security-role&gt;
  &lt;role-name&gt;<span class="emphasis"><em>ROLE_NAME</em></span>&lt;/role-name&gt;
&lt;/security-role&gt;
&lt;security-role&gt;
  &lt;role-name&gt;<span class="emphasis"><em>ROLE_NAME</em></span>&lt;/role-name&gt;
&lt;/security-role&gt;</pre></li><li class="listitem"><p class="simpara">
							Authorize access to all URLs handled by the JAX-RS runtime for all roles.
						</p><pre class="programlisting language-xml">&lt;security-constraint&gt;
  &lt;web-resource-collection&gt;
    &lt;web-resource-name&gt;Resteasy&lt;/web-resource-name&gt;
    &lt;url-pattern&gt;<span class="emphasis"><em>/PATH</em></span>&lt;/url-pattern&gt;
  &lt;/web-resource-collection&gt;
  &lt;auth-constraint&gt;
    &lt;role-name&gt;<span class="emphasis"><em>ROLE_NAME</em></span>&lt;/role-name&gt;
    &lt;role-name&gt;<span class="emphasis"><em>ROLE_NAME</em></span>&lt;/role-name&gt;
  &lt;/auth-constraint&gt;
&lt;/security-constraint&gt;</pre></li><li class="listitem"><p class="simpara">
							Define the appropriate login configuration for this application.
						</p><pre class="programlisting language-xml">&lt;login-config&gt;
  &lt;auth-method&gt;BASIC&lt;/auth-method&gt;
  &lt;realm-name&gt;jaxrs&lt;/realm-name&gt;
&lt;/login-config&gt;</pre></li></ol></div><p>
					Role-based security has been enabled within the application, with a set of defined roles.
				</p><div class="formalpara"><p class="title"><strong>Example: Role-Based Security Configuration</strong></p><p>
						
<pre class="programlisting language-xml">&lt;web-app&gt;

  &lt;context-param&gt;
    &lt;param-name&gt;resteasy.role.based.security&lt;/param-name&gt;
    &lt;param-value&gt;true&lt;/param-value&gt;
  &lt;/context-param&gt;

  &lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
      &lt;web-resource-name&gt;Resteasy&lt;/web-resource-name&gt;
      &lt;url-pattern&gt;/security&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
      &lt;role-name&gt;admin&lt;/role-name&gt;
      &lt;role-name&gt;user&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
  &lt;/security-constraint&gt;

  &lt;login-config&gt;
    &lt;auth-method&gt;BASIC&lt;/auth-method&gt;
    &lt;realm-name&gt;jaxrs&lt;/realm-name&gt;
  &lt;/login-config&gt;

  &lt;security-role&gt;
    &lt;role-name&gt;admin&lt;/role-name&gt;
  &lt;/security-role&gt;
  &lt;security-role&gt;
    &lt;role-name&gt;user&lt;/role-name&gt;
  &lt;/security-role&gt;

&lt;/web-app&gt;</pre>

					</p></div></section><section class="section" id="securing_jax_rs_web_services_using_annotations"><div class="titlepage"><div><div><h3 class="title">2.14.2. Securing JAX-RS Web Services Using Annotations</h3></div></div></div><p>
					To secure JAX-RS web services using an annotation, complete the following steps.
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							<a class="link" href="#enable_rbac_ws" title="2.14.1. Enable Role-Based Security">Enable role-based security</a>.
						</li><li class="listitem"><p class="simpara">
							Add security annotations to the JAX-RS web service. RESTEasy supports the following annotations:
						</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">@RolesAllowed</code></span></dt><dd>
										Defines which roles can access the method. All roles should be defined in the <code class="literal">web.xml</code> file.
									</dd><dt><span class="term"><code class="literal">@PermitAll</code></span></dt><dd>
										Allows all roles defined in the <code class="literal">web.xml</code> file to access the method.
									</dd><dt><span class="term"><code class="literal">@DenyAll</code></span></dt><dd>
										Denies all access to the method.
									</dd></dl></div></li></ol></div><p>
					Below is an example that uses the <code class="literal">@RolesAllowed</code> annotation to specify that the <code class="literal">admin</code> role can access the web service.
				</p><pre class="programlisting language-java">@RolesAllowed("admin")
@Path("/test")
public class TestService {
  ...
}</pre></section><section class="section" id="setting-programmatic-security"><div class="titlepage"><div><div><h3 class="title">2.14.3. Setting Programmatic Security</h3></div></div></div><p>
					JAX-RS includes a programmatic API for gathering security information about a secured request. The <code class="literal">javax.ws.rs.core.SecurityContext</code> interface has a method for determining the identity of the user making the secured HTTP invocation. It also has a method that allows you to check whether or not the current user belongs to a certain role:
				</p><pre class="programlisting language-java">public interface SecurityContext {

   public Principal getUserPrincipal();
   public boolean isUserInRole(String role);
   public boolean isSecure();
   public String getAuthenticationScheme();
}</pre><p>
					You can access a <code class="literal">SecurityContext</code> instance by injecting it into a field, setter method, or resource method parameter using the <code class="literal">@Context</code> annotation.
				</p><pre class="programlisting language-java">@Path("test")
public class SecurityContextResource {
    @Context
    SecurityContext securityContext;

    @GET
    @Produces("text/plain")
    public String get() {
        if (!securityContext.isUserInRole("admin")) {
            throw new WebApplicationException(Response.serverError().status(HttpResponseCodes.SC_UNAUTHORIZED)
                    .entity("User " + securityContext.getUserPrincipal().getName() + " is not authorized").build());
        }
        return "Good user " + securityContext.getUserPrincipal().getName();
    }
}</pre></section></section><section class="section" id="resteasy_asynchronous_job_service"><div class="titlepage"><div><div><h2 class="title">2.15. RESTEasy Asynchronous Job Service</h2></div></div></div><p>
				The RESTEasy Asynchronous Job Service is designed to add asynchronous behavior to the HTTP protocol. While HTTP is a synchronous protocol, it is aware of asynchronous invocations. The HTTP 1.1 response code <code class="literal">202 Accepted</code> means that the server has received and accepted the response for processing, but the processing has not yet been completed. The Asynchronous Job Service builds around this.
			</p><section class="section" id="enabling_the_asynchronous_job_service"><div class="titlepage"><div><div><h3 class="title">2.15.1. Enabling the Asynchronous Job Service</h3></div></div></div><p>
					Enable the asynchronous job service in the <code class="literal">web.xml</code> file:
				</p><pre class="programlisting language-xml">&lt;context-param&gt;
    &lt;param-name&gt;resteasy.async.job.service.enabled&lt;/param-name&gt;
    &lt;param-value&gt;true&lt;/param-value&gt;
&lt;/context-param&gt;</pre></section><section class="section" id="configuring_asynchronous_jobs"><div class="titlepage"><div><div><h3 class="title">2.15.2. Configuring Asynchronous Jobs</h3></div></div></div><p>
					This section covers examples of the query parameters for asynchronous jobs with RESTEasy.
				</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
						Role based security does not work with the Asynchronous Job Service as it cannot be implemented portably. If the Asynchronous Job Service is used, application security must be done through XML declarations in the <code class="literal">web.xml</code> file instead.
					</p></div></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
						While GET, DELETE, and PUT methods can be invoked asynchronously, this breaks the HTTP 1.1 contract of these methods. While these invocations might not change the state of the resource if invoked more than once, they do change the state of the server as new job entries with each invocation.
					</p></div></div><p>
					The <code class="literal">asynch</code> query parameter is used to run invocations in the background. A <code class="literal">202 Accepted</code> response is returned, as well as a location header with a URL pointing to where the response of the background method is located.
				</p><pre class="screen">POST http://example.com/myservice?asynch=true</pre><p>
					The example above returns a <code class="literal">202 Accepted</code> response. It also returns a location header with a URL pointing to where the response of the background method is located. An example of the location header is shown below:
				</p><pre class="screen">HTTP/1.1 202 Accepted
Location: http://example.com/asynch/jobs/3332334</pre><p>
					The URI will take the form of:
				</p><pre class="screen">/asynch/jobs/{job-id}?wait={milliseconds}|nowait=true</pre><p>
					GET, POST and DELETE operations can be performed on this URL.
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							GET returns the JAX-RS resource method invoked as a response if the job was completed. If the job has not been completed, the GET returns a <code class="literal">202 Accepted</code> response code. Invoking GET does not remove the job, so it can be called multiple times.
						</li><li class="listitem">
							POST does a read of the job response and removes the job if it has been completed.
						</li><li class="listitem">
							DELETE is called to manually clean up the job queue.
						</li></ul></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						When the job queue is full, it evicts the earliest job from memory automatically without needing to call DELETE.
					</p></div></div><p>
					The GET and POST operations allow for the maximum wait time to be defined, using the <code class="literal">wait</code> and <code class="literal">nowait</code> query parameters. If the <code class="literal">wait</code> parameter is not specified, the operation will default to <code class="literal">nowait=true</code>, and will not wait at all if the job is not complete. The <code class="literal">wait</code> parameter is defined in milliseconds.
				</p><pre class="screen">POST http://example.com/asynch/jobs/122?wait=3000</pre><p>
					RESTEasy supports fire and forget jobs, using the <code class="literal">oneway</code> query parameter.
				</p><pre class="screen">POST http://example.com/myservice?oneway=true</pre><p>
					The example above returns a <code class="literal">202 Accepted</code> response, but no job is created.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						The configuration parameters for the Asynchronous Job Service can be found in the <a class="link" href="#Asynchronous_Job_Service_Configuration_Parameters" title="A.5. RESTEasy Asynchronous Job Service Configuration Parameters">RESTEasy Asynchronous Job Service Configuration Parameters</a> section in the appendix.
					</p></div></div></section></section><section class="section" id="resteasy_javascript_api"><div class="titlepage"><div><div><h2 class="title">2.16. RESTEasy JavaScript API</h2></div></div></div><section class="section" id="about_the_resteasy_javascript_api"><div class="titlepage"><div><div><h3 class="title">2.16.1. About the RESTEasy JavaScript API</h3></div></div></div><p>
					RESTEasy can generate a JavaScript API that uses AJAX calls to invoke JAX-RS operations. Each JAX-RS resource class will generate a JavaScript object of the same name as the declaring class or interface. The JavaScript object contains each JAX-RS method as properties.
				</p><pre class="programlisting language-java">@Path("foo")
public class Foo {

  @Path("{id}")
  @GET
  public String get(@QueryParam("order") String order, @HeaderParam("X-Foo") String header,
    @MatrixParam("colour") String colour, @CookieParam("Foo-Cookie") String cookie) {
  }

  @POST
  public void post(String text) {
  }
}</pre><p>
					The following JavaScript code uses the JAX-RS API that was generated in the previous example.
				</p><pre class="programlisting language-javascript">var text = Foo.get({order: 'desc', 'X-Foo': 'hello', colour: 'blue', 'Foo-Cookie': 123987235444});
Foo.post({$entity: text});</pre><p>
					Each JavaScript API method takes an optional object as single parameter where each property is a cookie, header, path, query or form parameter as identified by its name, or the API parameter properties. For details about the API parameter properties see <a class="link" href="#resteasy_javascript_api_parameters" title="A.3. RESTEasy JavaScript API Parameters">RESTEasy Javascript API Parameters</a> appendix.
				</p><section class="section" id="enable_the_resteasy_javascript_api_servlet"><div class="titlepage"><div><div><h4 class="title">2.16.1.1. Enable the RESTEasy JavaScript API Servlet</h4></div></div></div><p>
						The RESTEasy JavaScript API is disabled by default. Follow these steps to enable it by updating the <code class="literal">web.xml</code> file.
					</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
								Open the <code class="literal">web.xml</code> file of the application in a text editor.
							</li><li class="listitem"><p class="simpara">
								Add the following configuration to the file, inside the <code class="literal">web-app</code> tags:
							</p><pre class="programlisting language-xml">&lt;servlet&gt;
    &lt;servlet-name&gt;RESTEasy JSAPI&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.jboss.resteasy.jsapi.JSAPIServlet&lt;/servlet-class&gt;
&lt;/servlet&gt;

&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;RESTEasy JSAPI&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;</pre></li></ol></div></section><section class="section" id="build_ajax_queries"><div class="titlepage"><div><div><h4 class="title">2.16.1.2. Build AJAX Queries</h4></div></div></div><p>
						The RESTEasy JavaScript API can be used to manually construct requests. The following are some examples of this behavior.
					</p><div class="formalpara"><p class="title"><strong>Example: REST Object Used to Override RESTEasy JavaScript API Client Behavior</strong></p><p>
							
<pre class="programlisting language-javascript">// Change the base URL used by the API:
REST.apiURL = "http://api.service.com";

// log everything in a div element
REST.log = function(text) {
  jQuery("#log-div").append(text);
};</pre>

						</p></div><p>
						The <code class="literal">REST</code> object contains the following read-write properties:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<code class="literal">apiURL</code>: Set by default to the JAX-RS root URL. Used by every JavaScript client API functions when constructing the requests.
							</li><li class="listitem">
								<code class="literal">log</code>: Set to <code class="literal">function(string)</code> in order to receive RESTEasy client API logs. This is useful if you want to debug your client API and place the logs where you can see them.
							</li></ul></div><div class="formalpara"><p class="title"><strong>Example: Class Using REST.Request() Method to Build Custom Requests</strong></p><p>
							
<pre class="programlisting language-javascript">var r = new REST.Request();
r.setURI("http://api.service.com/orders/23/json");
r.setMethod("PUT");
r.setContentType("application/json");
r.setEntity({id: "23"});
r.addMatrixParameter("JSESSIONID", "12309812378123");
r.execute(function(status, request, entity) {
  log("Response is " + status);
});</pre>

						</p></div></section></section></section><section class="section" id="resteasy_spi_to_modify_resource_metadata"><div class="titlepage"><div><div><h2 class="title">2.17. RESTEasy SPI to Modify Resource Metadata</h2></div></div></div><p>
				JBoss EAP provides a RESTEasy service provider interface (SPI) to modify resource class metadata, which is created using <code class="literal">ResourceBuilder</code>. When processing JAX-RS deployments, RESTEasy uses <code class="literal">ResourceBuilder</code> to create metadata for each JAX-RS resource. Such metadata is defined using the metadata SPI in package <code class="literal">org.jboss.resteasy.spi.metadata</code>, in particular the <code class="literal">ResourceClass</code> interface:
			</p><pre class="programlisting language-java">package org.jboss.resteasy.spi.metadata;

public interface ResourceClass
{
  String getPath();

  Class&lt;?&gt; getClazz();

  ResourceConstructor getConstructor();

  FieldParameter[] getFields();

  SetterParameter[] getSetters();

  ResourceMethod[] getResourceMethods();

  ResourceLocator[] getResourceLocators();
}</pre><p>
				RESTEasy allows customizing the metadata generation by providing implementations of the <code class="literal">ResourceClassProcessor</code> interface. The following example illustrates the usage of this SPI:
			</p><pre class="programlisting language-java">package org.jboss.resteasy.test.core.spi.resource;

import org.jboss.logging.Logger;
import org.jboss.resteasy.spi.metadata.ResourceClass;
import org.jboss.resteasy.spi.metadata.ResourceClassProcessor;

import javax.ws.rs.ext.Provider;

@Provider
public class ResourceClassProcessorImplementation implements ResourceClassProcessor {

    protected static final Logger logger = Logger.getLogger(ResourceClassProcessorImplementation.class.getName());
@Override
    public ResourceClass process(ResourceClass clazz) {
        logger.info(String.format("ResourceClassProcessorImplementation#process method called on class %s",
                            clazz.getClazz().getSimpleName()));
        String clazzName = clazz.getClazz().getSimpleName();
        if (clazzName.startsWith("ResourceClassProcessorEndPoint")
                || clazzName.equals("ResourceClassProcessorProxy")
                || clazzName.equals("ResourceClassProcessorProxyEndPoint")) {
            return new ResourceClassProcessorClass(clazz);
        }
        return clazz;
    }</pre><p>
				The new processors, which are stored using the <code class="literal">ResteasyProviderFactory</code> class, are resolved as regular JAX-RS annotated providers. They allow wrapping resource metadata classes with custom versions that you can use for various advanced scenarios, such as:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Adding additional resource method or locators to the resource.
					</li><li class="listitem">
						Modifying the HTTP methods.
					</li><li class="listitem">
						Modifying the <code class="literal">@Produces</code> or the <code class="literal">@Consumes</code> media types.
					</li></ul></div></section><section class="section" id="microprofile_rest_client"><div class="titlepage"><div><div><h2 class="title">2.18. MicroProfile REST Client</h2></div></div></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					MicroProfile REST client is provided as Technology Preview only. Technology Preview features are not supported with Red Hat production service level agreements (SLAs), might not be functionally complete, and Red Hat does not recommend to use them for production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.
				</p><p>
					See <a class="link mimir-link-warn" href="https://access.redhat.com/support/offerings/techpreview" title="This content is not included in Mimir.">Technology Preview Features Support Scope</a> on the Red Hat Customer Portal for information about the support scope for Technology Preview features.
				</p></div></div><p>
				JBoss EAP supports the MicroProfile REST client 1.3.x that builds on JAX-RS 2.1 client APIs to provide a type-safe approach to invoke RESTful services over HTTP. The MicroProfile Type Safe REST clients are defined as Java interfaces. With the MicroProfile REST clients, you can write client applications with executable code.
			</p><p>
				The MicroProfile REST client enables:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						An intuitive syntax
					</li><li class="listitem">
						Programmatic registration of providers
					</li><li class="listitem">
						Declarative registration of providers
					</li><li class="listitem">
						<code class="literal">ResponseExceptionMapper</code>
					</li><li class="listitem">
						CDI integration
					</li></ul></div><section class="section" id="intuitive_syntax"><div class="titlepage"><div><div><h3 class="title">2.18.1. Intuitive Syntax</h3></div></div></div><p>
					The MicroProfile REST client enables a version of distributed object communication, which is also implemented in CORBA, Java Remote Method Invocation (RMI), the JBoss Remoting Project, and RESTEasy. For example, consider the resource:
				</p><pre class="programlisting language-java">@Path("resource")
public class TestResource {
   @Path("test")
   @GET
   String test() {
      return "test";
   }
 }</pre><p>
					The JAX-RS native way of accessing the <code class="literal">TestResource</code> class is:
				</p><pre class="programlisting language-java">Client client = ClientBuilder.newClient();
String response = client.target("http://localhost:8081/test").request().get(String.class);</pre><p>
					However, Microprofile REST client supports a more intuitive syntax by directly calling the <code class="literal">test()</code> method:
				</p><pre class="programlisting language-java">@Path("resource")
public interface TestResourceIntf {
    @Path("test")
    @GET
    public String test();
}

TestResourceIntf service = RestClientBuilder.newBuilder()
                              .baseUrl(http://localhost:8081/))
                              .build(TestResourceIntf.class);
String s = service.test();</pre><p>
					In the example above, making calls on the <code class="literal">TestResource</code> class becomes much easier with the <code class="literal">TestResourceIntf</code> class, as illustrated by the call <code class="literal">service.test()</code>.
				</p><p>
					The following example is a more elaborate version of the <code class="literal">TestResourceIntf</code> class:
				</p><pre class="programlisting language-java">@Path("resource")
public interface TestResourceIntf2 {
   @Path("test/{path}")mes("text/plain")
   @Produces("text/html")
   @POST
   public String test(@PathParam("path") String path, @QueryParam("query") String query, String entity);
}</pre><p>
					Calling the <code class="literal">service.test("p", "q", "e")</code> method results in an HTTP message that looks like:
				</p><pre class="programlisting language-java">POST /resource/test/p/?query=q HTTP/1.1
Accept: text/html
Content-Type: text/plain
Content-Length: 1

e</pre></section><section class="section" id="programmatic_registration_of_providers"><div class="titlepage"><div><div><h3 class="title">2.18.2. Programmatic Registration of Providers</h3></div></div></div><p>
					With the MicroProfile REST client, you can also configure the client environment by registering providers. For example:
				</p><pre class="programlisting language-java">TestResourceIntf service = RestClientBuilder.newBuilder()
                              .baseUrl(http://localhost:8081/))
                              .register(MyClientResponseFilter.class)
                              .register(MyMessageBodyReader.class)
                              .build(TestResourceIntf.class);</pre></section><section class="section" id="declarative_registration_of_providers"><div class="titlepage"><div><div><h3 class="title">2.18.3. Declarative Registration of Providers</h3></div></div></div><p>
					You can also register providers declaratively by adding the <code class="literal">org.eclipse.microprofile.rest.client.annotation.RegisterProvider</code> annotation to the target interface as shown below:
				</p><pre class="programlisting language-java">@Path("resource")
@RegisterProvider(MyClientResponseFilter.class)
@RegisterProvider(MyMessageBodyReader.class)
public interface TestResourceIntf2 {
   @Path("test/{path}")
   @Consumes("text/plain")
   @Produces("text/html")
   @POST
   public String test(@PathParam("path") String path, @QueryParam("query") String query, String entity);
}</pre><p>
					Declaring the <code class="literal">MyClientResponseFilter</code> class and the <code class="literal">MyMessageBodyReader</code> class with annotations eliminates the need to call the <code class="literal">RestClientBuilder.register()</code> method.
				</p></section><section class="section" id="responseexceptionmapper"><div class="titlepage"><div><div><h3 class="title">2.18.4. ResponseExceptionMapper</h3></div></div></div><p>
					The <code class="literal">org.eclipse.microprofile.rest.client.ext.ResponseExceptionMapper</code> class is the client-side inverse of the <code class="literal">javax.ws.rs.ext.ExceptionMapper</code> class defined in JAX-RS. That is, where the <code class="literal">ExceptionMapper.toResponse()</code> method turns an <code class="literal">Exception</code> class thrown during the server-side processing into a <code class="literal">Response</code> class, the <code class="literal">ResponseExceptionMapper.toThrowable()</code> method turns a Response class received on the client-side with an HTTP error status into an <code class="literal">Exception</code> class.
				</p><p>
					You can register the <code class="literal">ResponseExceptionMapper</code> class either programmatically or declaratively. In the absence of a registered <code class="literal">ResponseExceptionMapper</code> class, a default <code class="literal">ResponseExceptionMapper</code> class maps any response with status <code class="literal">&gt;= 400</code> to a <code class="literal">WebApplicationException</code> class.
				</p></section><section class="section" id="cdi_integration-1"><div class="titlepage"><div><div><h3 class="title">2.18.5. CDI Integration</h3></div></div></div><p>
					In MicroProfile REST client, you must annotate any interface that is managed as a CDI bean with the <code class="literal">@RegisterRestClient</code> class. For example:
				</p><pre class="programlisting language-java">@Path("resource")
@RegisterProvider(MyClientResponseFilter.class)
public static class TestResourceImpl {
      @Inject TestDataBase db;

      @Path("test/{path}")
      @Consumes("text/plain")
      @Produces("text/html")
      @POST
      public String test(@PathParam("path") String path, @QueryParam("query")
      String query, String entity) {
         return db.getByName(query);
      }
   }
   @Path("database")
   @RegisterRestClient
   public interface TestDataBase {

      @Path("")
      @POST
      public String getByName(String name);
   }</pre><p>
					Here, the MicroProfile REST client implementation creates a client for a <code class="literal">TestDataBase</code> class service, allowing easy access by the <code class="literal">TestResourceImpl</code> class. However, it does not include the information about the path to the <code class="literal">TestDataBase</code> class implementation. This information can be supplied by the optional <code class="literal">@Reg- isterProvider</code> parameter <code class="literal">baseUri</code>:
				</p><pre class="programlisting language-java">@Path("database")
@RegisterRestClient(baseUri="https://localhost:8080/webapp")
public interface TestDataBase {
   @Path("")
   @POST
   public String getByName(String name);
}</pre><p>
					This indicates that you can access the implementation of <code class="literal">TestDataBase</code> at <a class="link mimir-link-warn" href="https://localhost:8080/webapp" title="Mimir does not include content from: localhost">https://localhost:8080/webapp</a>. You can also supply the information externally with the following system variable:
				</p><pre class="programlisting language-java">&lt;fully qualified name of TestDataBase&gt;/mp-rest/url=&lt;URL&gt;</pre><p>
					For example, the following indicates that you can access an implementation of the <code class="literal">com.bluemonkeydiamond.TestDatabase</code> class at https://localhost:8080/webapp:
				</p><pre class="programlisting language-java">com.bluemonkeydiamond.TestDatabase/mp-rest/url=https://localhost:8080/webapp</pre></section></section><section class="section" id="support_for_completionstage_type"><div class="titlepage"><div><div><h2 class="title">2.19. Support for the CompletionStage Type</h2></div></div></div><p>
				The JAX-RS 2.1 specification supports declaring asynchronous resource methods by returning a <code class="literal">CompletionStage</code> instead of using the <code class="literal">@Suspended</code> annotation.
			</p><p>
				Whenever a resource method returns a <code class="literal">CompletionStage</code> that it subscribed to, the request is suspended. The request is resumed only when the <code class="literal">CompletionStage</code> type is:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Resolved to a value, which is then treated as the return value for the method.
					</li><li class="listitem">
						Treated as an error case, and the exception is processed as if it were thrown by the resource method.
					</li></ul></div><p>
				The following is an example of asynchronous processing using <code class="literal">CompletionStage</code>:
			</p><pre class="programlisting language-java">public class SimpleResource
{

   @GET
   @Path("basic")
   @Produces("text/plain")
   public CompletionStage&lt;Response&gt; getBasic() throws Exception
   {
      final CompletableFuture&lt;Response&gt; response = new CompletableFuture&lt;&gt;();
      Thread t = new Thread()
      {
         @Override
         public void run()
         {
            try
            {
               Response jaxrs = Response.ok("basic").type(MediaType.TEXT_PLAIN).build();
               response.complete(jaxrs);
            }
            catch (Exception e)
            {
               response.completeExceptionally(e);
            }
         }
      };
      t.start();
      return response;
   }
}</pre></section><section class="section" id="extending_support_asynch_request_processing"><div class="titlepage"><div><div><h2 class="title">2.20. Extending RESTEasy Support for Asynchronous Request Processing and Reactive Return Types</h2></div></div></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					Extending RESTEasy support is provided as Technology Preview only. Technology Preview features are not supported with Red Hat production service level agreements (SLAs), might not be functionally complete, and Red Hat does not recommend to use them for production. These features provide early access to upcoming product features, enabling customers to test functionality and provide feedback during the development process.
				</p><p>
					See <a class="link mimir-link-warn" href="https://access.redhat.com/support/offerings/techpreview" title="This content is not included in Mimir.">Technology Preview Features Support Scope</a> on the Red Hat Customer Portal for information about the support scope for Technology Preview features.
				</p></div></div><section class="section" id="pluggable_reactive_types"><div class="titlepage"><div><div><h3 class="title">2.20.1. Pluggable Reactive Types</h3></div></div></div><p>
					JAX-RS 2.1 is extensible to support various reactive libraries. RESTEasy’s optional module <code class="literal">resteasy-rxjava2</code> supports the following reactive types:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							<code class="literal">io.reactivex.Single</code>: Similar to <code class="literal">CompletionStage</code>, because it holds one potential value at the most.
						</li><li class="listitem">
							<code class="literal">io.reactivex.Flowable</code>: Implements <code class="literal">io.reactivex.Publisher</code>.
						</li><li class="listitem">
							<code class="literal">io.reactivex.Observable</code>: Similar to <code class="literal">Flowable</code>, except that it does not support backpressure, the ability of a subscriber to control the load it receives from a producer by calling <code class="literal">Subscription.request()</code>.
						</li></ul></div><p>
					If you import <code class="literal">resteasy-rxjava2</code>, you can return these reactive types from your resource methods on the server side and receive them on the client side.
				</p><p>
					The <code class="literal">resteasy-rxjava2</code> module supports the following three classes to access Singles, Observables, and Flowables respectively on the client side:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							<code class="literal">org.jboss.resteasy.rxjava2.SingleRxInvoker</code>
						</li><li class="listitem">
							<code class="literal">org.jboss.resteasy.rxjava2.FlowableRxInvoker</code>
						</li><li class="listitem">
							<code class="literal">org.jboss.resteasy.rxjava2.ObservableRxInvoker</code>
						</li></ul></div></section><section class="section" id="extensions_for_additional_reactive_classes"><div class="titlepage"><div><div><h3 class="title">2.20.2. Extensions for Additional Reactive Classes</h3></div></div></div><p>
					RESTEasy implements a framework that supports extensions for additional reactive classes. On the server side, when a resource method returns a <code class="literal">CompletionStage</code> type, RESTEasy subscribes to it using the <code class="literal">org.jboss.resteasy.core.AsyncResponseConsumer.CompletionStageResponseConsumer</code> class. When the <code class="literal">CompletionStage</code> completes, it calls <code class="literal">CompletionStageResponseConsumer.accept()</code>, which sends the result back to the client.
				</p><p>
					Support for <code class="literal">CompletionStage</code> is built in to RESTEasy. We can extend that support to a class like <code class="literal">Single</code> by providing a mechanism for transforming a <code class="literal">Single</code> into a <code class="literal">CompletionStage</code>. In the <code class="literal">resteasy-rxjava2</code> module, <code class="literal">org.jboss.resteasy.rxjava2.SingleProvider</code>, which implements the <code class="literal">org.jboss.resteasy.spi.AsyncResponseProvider&lt;Single&lt;?&gt;&gt;</code> interface provides this mechanism:
				</p><pre class="programlisting language-java">public interface AsyncResponseProvider&lt;T&gt; {
   public CompletionStage toCompletionStage(T asyncResponse);
}</pre><p>
					Given the <code class="literal">SingleProvider</code> class, RESTEasy can take a <code class="literal">Single</code>, transform it into a <code class="literal">CompletionStage</code> and then use <code class="literal">CompletionStageResponseConsumer</code> to handle the eventual value of the <code class="literal">Single</code>. Similarly, when a resource method returns a streaming reactive class like <code class="literal">Flowable</code>, RESTEasy subscribes to it, receives a stream of data elements, and sends them to the client. <code class="literal">AsyncResponseConsumer</code> has several supporting classes, each of which implements a different mode of streaming.
				</p><p>
					For example, <code class="literal">AsyncResponseConsumer.AsyncGeneralStreamingSseResponseConsumer</code> handles general streaming and SSE streaming. Subscription is done by calling <code class="literal">org.reactivestreams.Publisher.subscribe()</code>, so it needs a mechanism to turn a <code class="literal">Flowable</code> into a <code class="literal">Publisher</code>, for example. That is, an implementation of <code class="literal">org.jboss.resteasy.spi.AsyncStreamProvider&lt;Flowable&gt;</code> is called for, which defines <code class="literal">AsyncStreamProvider</code> as shown in the following example:
				</p><pre class="programlisting language-java">public interface AsyncStreamProvider&lt;T&gt; {
   public Publisher toAsyncStream(T asyncResponse);
}</pre><p>
					In the <code class="literal">resteasy-rxjava2</code> module, <code class="literal">org.jboss.resteasy.FlowableProvider</code> provides that mechanism for <code class="literal">Flowable</code>.
				</p><p>
					That means, on the server side, you can add support for other reactive types by declaring a <code class="literal">@Provider</code> annotation for the <code class="literal">AsyncStreamProvider</code> interface for streams or the <code class="literal">AsyncResponseProvider</code> interface for single values. Both these interfaces have a single method to convert the new reactive type into a <code class="literal">Publisher</code> or a <code class="literal">CompletionStage</code> for streams or for single values respectively.
				</p><p>
					On the client side, the JAX-RS 2.1 imposes two requirements for support of the reactive classes:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Support for <code class="literal">CompletionStage</code> as an implementation of the <code class="literal">javax.ws.rs.client.CompletionStageRxInvoker</code> interface.
						</li><li class="listitem">
							Extensibility by supporting the registration of providers that implement:
						</li></ul></div><pre class="programlisting language-java">public interface RxInvokerProvider&lt;T extends RxInvoker&gt; {
    public boolean isProviderFor(Class&lt;T&gt; clazz);
    public T getRxInvoker(SyncInvoker syncInvoker, ExecutorService executorService);
}</pre><p>
					Once an RxInvokerProvider is registered, you can request an RxInvoker by calling the <code class="literal">javax.ws.rs.client.Invocation.Builder</code> method:
				</p><pre class="programlisting language-java">public &lt;T extends RxInvoker&gt; T rx(Class&lt;T&gt; clazz);</pre><p>
					You can use the RxInvoker for making an invocation that returns the appropriate reactive class. For example:
				</p><pre class="programlisting language-java">FlowableRxInvoker invoker = client.target(generateURL("/get/string")).request().rx(FlowableRxInvoker.class);
Flowable&lt;String&gt; flowable = (Flowable&lt;String&gt;) invoker.get();</pre><p>
					RESTEasy provides partial support for implementing <code class="literal">RxInvokers</code>. For example, <code class="literal">SingleProvider</code>, mentioned above, also implements <code class="literal">org.jboss.resteasy.spi.AsyncClientResponseProvider&lt;Single&lt;?&gt;&gt;</code>, where <code class="literal">AsyncClientResponseProvider</code> is defined as the following:
				</p><pre class="programlisting language-java">public interface AsyncClientResponseProvider&lt;T&gt; {
   public T fromCompletionStage(CompletionStage&lt;?&gt; completionStage);
}</pre></section><section class="section" id="reactive_clients_api"><div class="titlepage"><div><div><h3 class="title">2.20.3. Reactive Clients API</h3></div></div></div><p>
					RESTEasy defines a new type of invoker named <code class="literal">RxInvoker</code>, and a default implementation of this type named <code class="literal">CompletionStageRxInvoker</code>. <code class="literal">CompletionStageRxInvoker</code> implements Java 8’s interface <code class="literal">CompletionStage</code>. This interface declares a large number of methods dedicated to managing asynchronous computations.
				</p></section><section class="section" id="asynchronous_filters"><div class="titlepage"><div><div><h3 class="title">2.20.4. Asynchronous Filters</h3></div></div></div><p>
					If you must suspend execution of your filter until a certain resource is available, you can convert it into an asynchronous filter. Turning a request asynchronous does not require any change to your resource method declaration or the additional filter declaration.
				</p><p>
					To turn a filter’s execution asynchronous, you must cast:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							The <code class="literal">ContainerRequestContext</code> into <code class="literal">SuspendableContainerRequestContext</code> for pre and post request filters.
						</li><li class="listitem">
							The <code class="literal">ContainerResponseContext</code> into a <code class="literal">SuspendableContainerResponseContext</code> for response filters.
						</li></ul></div><p>
					These context objects can turn the current filter’s execution into asynchronous by calling the <code class="literal">suspend()</code> method. Once asynchronous, the filter chain is suspended, and resumes only after one of the following methods is called on the context object:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							<code class="literal">abortWith(Response)</code>: Terminate the filter chain, return the given Response to the client. This applies only to ContainerRequestFilter.
						</li><li class="listitem">
							<code class="literal">resume()</code>: Resume execution of the filter chain by calling the next filter.
						</li><li class="listitem">
							<code class="literal">resume(Throwable)</code>: Abort execution of the filter chain by throwing the given exception. This behaves as if the filter were synchronous and threw the given exception.
						</li></ul></div></section><section class="section" id="proxies"><div class="titlepage"><div><div><h3 class="title">2.20.5. Proxies</h3></div></div></div><p>
					Proxies are a RESTEasy extension that supports an intuitive programming style, which replaces generic JAX-RS invoker calls with application-specific interface calls. The proxy framework is extended to include both <code class="literal">CompletionStage</code> and the RxJava2 types <code class="literal">Single</code>, <code class="literal">Observable</code>, and <code class="literal">Flowable</code>. The two following examples illustrate how RESTEasy proxies work:
				</p><p>
					Example 1:
				</p><pre class="programlisting language-java">@Path("")
public interface RxCompletionStageResource {

   @GET
   @Path("get/string")
   @Produces(MediaType.TEXT_PLAIN)
   public CompletionStage&lt;String&gt; getString();
}

@Path("")
public class RxCompletionStageResourceImpl {

   @GET
   @Path("get/string")
   @Produces(MediaType.TEXT_PLAIN)
   public CompletionStage&lt;String&gt; getString() { .... }
}

public class RxCompletionStageProxyTest {

   private static ResteasyClient client;
   private static RxCompletionStageResource proxy;

   static {
      client = new ResteasyClientBuilder().build();
      proxy = client.target(generateURL("/")).proxy(RxCompletionStageResource.class);
   }

   @Test
   public void testGet() throws Exception {
      CompletionStage&lt;String&gt; completionStage = proxy.getString();
      Assert.assertEquals("x", completionStage.toCompletableFuture().get());
   }
}</pre><p>
					Example 2:
				</p><pre class="programlisting language-java">public interface Rx2FlowableResource {

   @GET
   @Path("get/string")
   @Produces(MediaType.TEXT_PLAIN)
   @Stream
   public Flowable&lt;String&gt; getFlowable();
}

@Path("")
public class Rx2FlowableResourceImpl {

   @GET
   @Path("get/string")
   @Produces(MediaType.TEXT_PLAIN)
   @Stream
   public Flowable&lt;String&gt; getFlowable() { ... }
}

public class Rx2FlowableProxyTest {

   private static ResteasyClient client;
   private static Rx2FlowableResource proxy;

   static {
      client = new ResteasyClientBuilder().build();
      proxy = client.target(generateURL("/")).proxy(Rx2FlowableResource.class);
   }

   @Test
   public void testGet() throws Exception {
      Flowable&lt;String&gt; flowable = proxy.getFlowable();
      flowable.subscribe(
         (String o) -&gt; stringList.add(o),
         (Throwable t) -&gt; errors.incrementAndGet(),
         () -&gt; latch.countDown());
      boolean waitResult = latch.await(30, TimeUnit.SECONDS);
      Assert.assertTrue("Waiting for event to be delivered has timed out.", waitResult);
      Assert.assertEquals(0, errors.get());
      Assert.assertEquals(xStringList, stringList);
   }
}</pre></section></section></section><section class="chapter" id="developing_jax_ws_web_services"><div class="titlepage"><div><div><h1 class="title">Chapter 3. Developing JAX-WS Web Services</h1></div></div></div><p>
			The Java API for XML-Based Web Services (JAX-WS) defines the mapping between WSDL and Java, as well as the classes to be used for accessing web services and publishing them. JBossWS implements the latest <a class="link mimir-link-warn" href="https://www.jcp.org/en/jsr/detail?id=224" title="Mimir does not include content from: www.jcp.org">JAX-WS specification</a>, which users can reference for any vendor-agnostic web service usage need.
		</p><section class="section" id="using_jax_ws_tools"><div class="titlepage"><div><div><h2 class="title">3.1. Using JAX-WS Tools</h2></div></div></div><p>
				The following JAX-WS command-line tools are included with the JBoss EAP distribution. These tools can be used in a variety of ways for <a class="link" href="#server_side_dev_strategies" title="3.1.1. Server-side Development Strategies">server</a> and <a class="link" href="#client_side_dev_strategies" title="3.1.2. Client-side Development Strategies">client-side</a> development.
			</p><div class="table" id="idm139695815385728"><p class="title"><strong>Table 3.1. JAX-WS Command-Line Tools</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 25%; " class="col_1"><!--Empty--></col><col style="width: 75%; " class="col_2"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139695815380880" scope="col">Command</th><th align="left" valign="top" id="idm139695815379792" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139695815380880"> <p>
								<a class="link" href="#wsprovide_tool" title="wsprovide">wsprovide</a>
							</p>
							 </td><td align="left" valign="top" headers="idm139695815379792"> <p>
								Generates JAX-WS portable artifacts, and provides the abstract contract. Used for bottom-up development.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695815380880"> <p>
								<a class="link" href="#wsconsume_tool" title="wsconsume">wsconsume</a>
							</p>
							 </td><td align="left" valign="top" headers="idm139695815379792"> <p>
								Consumes the abstract contract (WSDL and Schema files), and produces artifacts for both a server and client. Used for top-down and client development.
							</p>
							 </td></tr></tbody></table></div></div><p>
				See <a class="link" href="#jax_ws_tools" title="A.6. JAX-WS Tools">JAX-WS Tools</a> for more details on the usage of these tools.
			</p><section class="section" id="server_side_dev_strategies"><div class="titlepage"><div><div><h3 class="title">3.1.1. Server-side Development Strategies</h3></div></div></div><p>
					When developing a web service endpoint on the server side, you have the option of starting from Java code, known as <span class="emphasis"><em>bottom-up development</em></span>, or from the WSDL that defines your service, known as <span class="emphasis"><em>top-down development</em></span>. If this is a new service, meaning that there is no existing contract, then the bottom-up approach is the fastest route; you only need to add a few annotations to your classes to get a service up and running. However, if you are developing a service with a contract already defined, it is far simpler to use the top-down approach, since the tool can generate the annotated code for you.
				</p><p>
					Bottom-up use cases:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Exposing an already existing EJB3 bean as a web service.
						</li><li class="listitem">
							Providing a new service, and you want the contract to be generated for you.
						</li></ul></div><p>
					Top-down use cases:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Replacing the implementation of an existing web service, and you can not break compatibility with older clients.
						</li><li class="listitem">
							Exposing a service that conforms to a contract specified by a third party, for example, a vendor that calls you back using an already defined protocol.
						</li><li class="listitem">
							Creating a service that adheres to the XML Schema and WSDL you developed by hand up front.
						</li></ul></div><h5 id="bottom_up_strategy_using_wsprovide">Bottom-Up Strategy Using wsprovide</h5><p>
					The bottom-up strategy involves developing the Java code for your service, and then annotating it using JAX-WS annotations. These annotations can be used to customize the contract that is generated for your service. For example, you can change the operation name to map to anything you like. However, all of the annotations have sensible defaults, so only the <code class="literal">@WebService</code> annotation is required.
				</p><p>
					This can be as simple as creating a single class:
				</p><pre class="programlisting language-java">package echo;

@javax.jws.WebService
public class Echo {

   public String echo(String input) {
      return input;
   }
}</pre><p>
					A deployment can be built using this class, and it is the only Java code needed to deploy on JBossWS. The WSDL, and all other Java artifacts called <span class="emphasis"><em>wrapper classes</em></span> will be generated for you at deploy time.
				</p><p>
					The primary purpose of the <code class="literal">wsprovide</code> tool is to generate portable JAX-WS artifacts. Additionally, it can be used to provide the WSDL file for your service. This can be obtained by invoking <code class="literal">wsprovide</code> using the <code class="literal">-w</code> option:
				</p><pre class="screen">$ javac -d . Echo.java
$ EAP_HOME/bin/wsprovide.sh --classpath=. -w echo.Echo</pre><p>
					Inspecting the WSDL reveals a service named <code class="literal">EchoService</code>:
				</p><pre class="programlisting language-xml">&lt;wsdl:service name="EchoService"&gt;
  &lt;wsdl:port name="EchoPort" binding="tns:EchoServiceSoapBinding"&gt;
    &lt;soap:address location="http://localhost:9090/EchoPort"/&gt;
  &lt;/wsdl:port&gt;
&lt;/wsdl:service&gt;</pre><p>
					As expected, this service defines an operation, <code class="literal">echo</code>:
				</p><pre class="programlisting language-xml">&lt;wsdl:portType name="Echo"&gt;
  &lt;wsdl:operation name="echo"&gt;
    &lt;wsdl:input name="echo" message="tns:echo"&gt;
    &lt;/wsdl:input&gt;
    &lt;wsdl:output name="echoResponse" message="tns:echoResponse"&gt;
    &lt;/wsdl:output&gt;
  &lt;/wsdl:operation&gt;
&lt;/wsdl:portType&gt;</pre><p>
					When deploying you do not need to run this tool. You only need it for generating portable artifacts or the abstract contract for your service.
				</p><p>
					A POJO endpoint for the deployment can be created in a simple <code class="literal">web.xml</code> file:
				</p><pre class="programlisting language-xml">&lt;web-app xmlns="http://java.sun.com/xml/ns/j2ee"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"
  version="2.4"&gt;

  &lt;servlet&gt;
    &lt;servlet-name&gt;Echo&lt;/servlet-name&gt;
    &lt;servlet-class&gt;echo.Echo&lt;/servlet-class&gt;
  &lt;/servlet&gt;

  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;Echo&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/Echo&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
&lt;/web-app&gt;</pre><p>
					The <code class="literal">web.xml</code> and the single Java class can now be used to create a WAR:
				</p><pre class="screen">$ mkdir -p WEB-INF/classes
$ cp -rp echo WEB-INF/classes/
$ cp web.xml WEB-INF
$ jar cvf echo.war WEB-INF
added manifest
adding: WEB-INF/(in = 0) (out= 0)(stored 0%)
adding: WEB-INF/classes/(in = 0) (out= 0)(stored 0%)
adding: WEB-INF/classes/echo/(in = 0) (out= 0)(stored 0%)
adding: WEB-INF/classes/echo/Echo.class(in = 340) (out= 247)(deflated 27%)
adding: WEB-INF/web.xml(in = 576) (out= 271)(deflated 52%)</pre><p>
					The WAR can then be deployed to JBoss EAP. This will internally invoke <code class="literal">wsprovide</code>, which will generate the WSDL. If the deployment was successful, and you are using the default settings, it should be available in the management console.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						For a portable JAX-WS deployment, the wrapper classes generated earlier could be added to the deployment.
					</p></div></div><h5 id="top_down_strategy_using_wsconsume">Top-Down Strategy Using wsconsume</h5><p>
					The top-down development strategy begins with the abstract contract for the service, which includes the WSDL file and zero or more schema files. The <code class="literal">wsconsume</code> tool is then used to consume this contract, and produce annotated Java classes, and optionally sources, that define it.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						<code class="literal">wsconsume</code> might have problems with symlinks on Unix systems.
					</p></div></div><p>
					Using the WSDL file from the bottom-up example, a new Java implementation that adheres to this service can be generated. The <code class="literal">-k</code> option is passed to <code class="literal">wsconsume</code> to preserve the Java source files that are generated, instead of providing just Java classes:
				</p><pre class="screen">$ EAP_HOME/bin/wsconsume.sh -k EchoService.wsdl</pre><p>
					The following table shows the purpose of each generated file:
				</p><div class="table" id="idm139695805188176"><p class="title"><strong>Table 3.2. Generated Files</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 25%; " class="col_1"><!--Empty--></col><col style="width: 75%; " class="col_2"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139695817229568" scope="col">File</th><th align="left" valign="top" id="idm139695817228480" scope="col">Purpose</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139695817229568"> <p>
									Echo.java
								</p>
								 </td><td align="left" valign="top" headers="idm139695817228480"> <p>
									Service Endpoint Interface
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695817229568"> <p>
									EchoResponse.java
								</p>
								 </td><td align="left" valign="top" headers="idm139695817228480"> <p>
									Wrapper bean for response message
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695817229568"> <p>
									EchoService.java
								</p>
								 </td><td align="left" valign="top" headers="idm139695817228480"> <p>
									Used only by JAX-WS clients
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695817229568"> <p>
									Echo_Type.java
								</p>
								 </td><td align="left" valign="top" headers="idm139695817228480"> <p>
									Wrapper bean for request message
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695817229568"> <p>
									ObjectFactory.java
								</p>
								 </td><td align="left" valign="top" headers="idm139695817228480"> <p>
									JAXB XML Registry
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695817229568"> <p>
									package-info.java
								</p>
								 </td><td align="left" valign="top" headers="idm139695817228480"> <p>
									Holder for JAXB package annotations
								</p>
								 </td></tr></tbody></table></div></div><p>
					Examining the service endpoint interface reveals annotations that are more explicit than in the class written by hand in the bottom-up example, however, these evaluate to the same contract.
				</p><pre class="programlisting language-java">@WebService(targetNamespace = "http://echo/", name = "Echo")
@XmlSeeAlso({ObjectFactory.class})
public interface Echo {

    @WebMethod
    @RequestWrapper(localName = "echo", targetNamespace = "http://echo/", className = "echo.Echo_Type")
    @ResponseWrapper(localName = "echoResponse", targetNamespace = "http://echo/", className = "echo.EchoResponse")
    @WebResult(name = "return", targetNamespace = "")
    public java.lang.String echo(
        @WebParam(name = "arg0", targetNamespace = "")
        java.lang.String arg0
    );
}</pre><p>
					The only missing piece, other than for packaging, is the implementation class, which can now be written using the above interface.
				</p><pre class="programlisting language-java">package echo;

@javax.jws.WebService(endpointInterface="echo.Echo")
public class EchoImpl implements Echo {
   public String echo(String arg0) {
      return arg0;
   }
}</pre></section><section class="section" id="client_side_dev_strategies"><div class="titlepage"><div><div><h3 class="title">3.1.2. Client-side Development Strategies</h3></div></div></div><p>
					Before going in to detail on the client side, it is important to understand the decoupling concept that is central to web services. Web services are not the best fit for internal RPC, even though they can be used in this way. There are much better technologies for this, such as CORBA and RMI. Web services were designed specifically for interoperable coarse-grained correspondence. There is no expectation or guarantee that any party participating in a web service interaction will be at any particular location, running on any particular operating system, or written in any particular programming language. So because of this, it is important to clearly separate client and server implementations. The only thing they should have in common is the abstract contract definition. If, for whatever reason, your software does not adhere to this principal, then you should not be using web services. For the above reasons, the recommended methodology for developing a client is to follow the top-down approach, even if the client is running on the same server.
				</p><h5 id="top_down_strategy_using_wsconsume_2">Top-Down Strategy Using wsconsume</h5><p>
					This section repeats the process of the server-side top-down section, however, it uses a deployed WSDL. This is to retrieve the correct value for <code class="literal">soap:address</code>, shown below, which is computed at deploy time. This value can be edited manually in the WSDL if necessary, but you must take care to provide the correct path.
				</p><div class="formalpara"><p class="title"><strong>Example: <code class="literal">soap:address</code> in a Deployed WSDL</strong></p><p>
						
<pre class="programlisting language-xml">&lt;wsdl:service name="EchoService"&gt;
  &lt;wsdl:port name="EchoPort" binding="tns:EchoServiceSoapBinding"&gt;
    &lt;soap:address location="http://localhost.localdomain:8080/echo/Echo"/&gt;
  &lt;/wsdl:port&gt;
&lt;/wsdl:service&gt;</pre>

					</p></div><p>
					Use <code class="literal">wsconsume</code> to generate Java classes for the deployed WSDL.
				</p><pre class="screen">$ EAP_HOME/bin/wsconsume.sh -k http://localhost:8080/echo/Echo?wsdl</pre><p>
					Notice how the <code class="literal">EchoService.java</code> class stores the location from which the WSDL was obtained.
				</p><pre class="programlisting language-java">@WebServiceClient(name = "EchoService",
                  wsdlLocation = "http://localhost:8080/echo/Echo?wsdl",
                  targetNamespace = "http://echo/")
public class EchoService extends Service {

    public final static URL WSDL_LOCATION;

    public final static QName SERVICE = new QName("http://echo/", "EchoService");
    public final static QName EchoPort = new QName("http://echo/", "EchoPort");

    ...

    @WebEndpoint(name = "EchoPort")
    public Echo getEchoPort() {
        return super.getPort(EchoPort, Echo.class);
    }

    @WebEndpoint(name = "EchoPort")
    public Echo getEchoPort(WebServiceFeature... features) {
        return super.getPort(EchoPort, Echo.class, features);
    }
}</pre><p>
					As you can see, this generated class extends the main client entry point in JAX-WS, <code class="literal">javax.xml.ws.Service</code>. While you can use <code class="literal">Service</code> directly, this is far simpler since it provides the configuration information for you. Note the <code class="literal">getEchoPort()</code> method, which returns an instance of our service endpoint interface. Any web service operation can then be called by just invoking a method on the returned interface.
				</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
						Do not refer to a remote WSDL URL in a production application. This causes network I/O every time you instantiate the <code class="literal">Service</code> object. Instead, use the tool on a saved local copy, or use the URL version of the constructor to provide a new WSDL location.
					</p></div></div><p>
					Write and compile the client:
				</p><pre class="programlisting language-java">import echo.*;

public class EchoClient {

   public static void main(String args[]) {

      if (args.length != 1) {
          System.err.println("usage: EchoClient &lt;message&gt;");
          System.exit(1);
      }

      EchoService service = new EchoService();
      Echo echo = service.getEchoPort();
      System.out.println("Server said: " + echo.echo(args0));
   }
}</pre><p>
					You can change the endpoint address of your operation at runtime, by setting the <code class="literal">ENDPOINT_ADDRESS_PROPERTY</code> as shown below:
				</p><pre class="programlisting language-java">EchoService service = new EchoService();
Echo echo = service.getEchoPort();

/* Set NEW Endpoint Location */
String endpointURL = "http://NEW_ENDPOINT_URL";
BindingProvider bp = (BindingProvider)echo;
bp.getRequestContext().put(BindingProvider.ENDPOINT_ADDRESS_PROPERTY, endpointURL);

System.out.println("Server said: " + echo.echo(args0));</pre></section></section><section class="section" id="jax_ws_web_service_endpoints"><div class="titlepage"><div><div><h2 class="title">3.2. JAX-WS Web Service Endpoints</h2></div></div></div><section class="section" id="about_jax_ws_web_service_endpoints"><div class="titlepage"><div><div><h3 class="title">3.2.1. About JAX-WS Web Service Endpoints</h3></div></div></div><p>
					A JAX-WS web service endpoint is the server component of a web service. Clients and other web services communicate with it over the HTTP protocol using an XML language called Simple Object Access Protocol (SOAP). The endpoint itself is deployed into the JBoss EAP container.
				</p><p>
					WSDL descriptors can be created in one of the following two ways:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Writing WSDL descriptors manually.
						</li><li class="listitem">
							Using JAX-WS annotations that create the WSDL descriptors automatically. This is the most common method for creating WSDL descriptors.
						</li></ul></div><p>
					An endpoint implementation bean is annotated with JAX-WS annotations and deployed to the server. The server automatically generates and publishes the abstract contract in WSDL format for client consumption. All marshalling and unmarshalling is delegated to the Java Architecture for XML Binding (JAXB) service.
				</p><p>
					The endpoint itself might be a Plain Old Java Object (POJO) or a Java EE web application. You can also expose endpoints using an EJB3 stateless session bean. It is packaged into a web archive (WAR) file. The specification for packaging the endpoint, called a Java Service Endpoint (JSE) is defined in <a class="link mimir-link-warn" href="http://jcp.org/aboutJava/communityprocess/mrel/jsr181/index2.html" title="Mimir does not include content from: jcp.org">JSR-181</a>.
				</p><div class="formalpara"><p class="title"><strong>Example: POJO Endpoint</strong></p><p>
						
<pre class="programlisting language-java">@WebService
@SOAPBinding(style = SOAPBinding.Style.RPC)
public class JSEBean {
    @WebMethod
    public String echo(String input) {
        ...
    }
}</pre>

					</p></div><div class="formalpara"><p class="title"><strong>Example: Web Services Endpoint</strong></p><p>
						
<pre class="programlisting language-xml">&lt;web-app ...&gt;
  &lt;servlet&gt;
    &lt;servlet-name&gt;TestService&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.jboss.quickstarts.ws.jaxws.samples.jsr181pojo.JSEBean01&lt;/servlet-class&gt;
  &lt;/servlet&gt;
  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;TestService&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
&lt;/web-app&gt;</pre>

					</p></div><p>
					The following EJB3 stateless session bean exposes the same method on the remote interface as well as an endpoint operation.
				</p><pre class="programlisting language-java">@Stateless
@Remote(EJB3RemoteInterface.class)

@WebService

@SOAPBinding(style = SOAPBinding.Style.RPC)
public class EJB3Bean implements EJB3RemoteInterface {
    @WebMethod
    public String echo(String input) {
        ...
    }
}</pre><h4 id="service_endpoint_interface">Service Endpoint Interface</h4><p>
					JAX-WS services typically implement a Java service endpoint interface (SEI), which might be mapped from a WSDL port type, either directly or using annotations. This SEI provides a high-level abstraction that hides the details between Java objects and their XML representations.
				</p><h4 id="endpoint_provider_interface">Endpoint Provider Interface</h4><p>
					In some cases, JAX-WS services need the ability to operate at the XML message level. The endpoint <code class="literal">Provider</code> interface provides this functionality to the web services that implement it.
				</p><h4 id="consuming_and_accessing_the_endpoint">Consuming and Accessing the Endpoint</h4><p>
					After you deploy your web service, you can consume the WSDL to create the component stubs which will be the basis for your application. Your application can then access the endpoint to do its work.
				</p></section><section class="section" id="developing_and_deploying_jax_ws_web_service_endpoint"><div class="titlepage"><div><div><h3 class="title">3.2.2. Developing and Deploying JAX-WS Web Service Endpoint</h3></div></div></div><p>
					A JAX-WS service endpoint is a server-side component that responds to requests from JAX-WS clients and publishes the WSDL definition for itself.
				</p><p>
					See the following quickstarts that ship with JBoss EAP for working examples of how to develop JAX-WS endpoint applications.
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							jaxws-addressing
						</li><li class="listitem">
							jaxws-ejb
						</li><li class="listitem">
							jaxws-pojo
						</li><li class="listitem">
							jaxws-retail
						</li><li class="listitem">
							wsat-simple
						</li><li class="listitem">
							wsba-coordinator-completion-simple
						</li><li class="listitem">
							wsba-participant-completion-simple
						</li></ul></div><h4 id="development_requirements">Development Requirements</h4><p>
					A web service must fulfill the requirements of the JAX-WS API and the <a class="link mimir-link-warn" href="http://www.jcp.org/en/jsr/summary?id=181" title="Mimir does not include content from: www.jcp.org">JSR 181: Web Services Metadata for the Java Platform</a> specification. A valid implementation meets the following requirements:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							It contains a <code class="literal">javax.jws.WebService</code> annotation.
						</li><li class="listitem">
							All method parameters and return types are compatible with the <a class="link mimir-link-warn" href="http://www.jcp.org/en/jsr/summary?id=222" title="Mimir does not include content from: www.jcp.org">JSR 222: JavaTM Architecture for XML Binding (JAXB) 2.0</a> specification.
						</li></ul></div><p>
					The following is an example of a web service implementation that meets these requirements.
				</p><div class="formalpara"><p class="title"><strong>Example: Web Service Implementation</strong></p><p>
						
<pre class="programlisting language-java">package org.jboss.quickstarts.ws.jaxws.samples.retail.profile;

import javax.ejb.Stateless;
import javax.jws.WebService;
import javax.jws.WebMethod;
import javax.jws.soap.SOAPBinding;

@Stateless

@WebService(
    name = "ProfileMgmt",
    targetNamespace = "http://org.jboss.ws/samples/retail/profile",
    serviceName = "ProfileMgmtService")
@SOAPBinding(parameterStyle = SOAPBinding.ParameterStyle.BARE)
public class ProfileMgmtBean {
    @WebMethod
    public DiscountResponse getCustomerDiscount(DiscountRequest request) {
        DiscountResponse dResponse = new DiscountResponse();
        dResponse.setCustomer(request.getCustomer());
        dResponse.setDiscount(10.00);
        return dResponse;
    }
}</pre>

					</p></div><p>
					The following is an example of the <code class="literal">DiscountRequest</code> class that is used by the <code class="literal">ProfileMgmtBean</code> bean in the previous example. The annotations are included for verbosity. Typically, the JAXB defaults are reasonable and do not need to be specified.
				</p><div class="formalpara"><p class="title"><strong>Example: DiscountRequest Class</strong></p><p>
						
<pre class="programlisting language-java">package org.jboss.test.ws.jaxws.samples.retail.profile;

import javax.xml.bind.annotation.XmlAccessType;
import javax.xml.bind.annotation.XmlAccessorType;
import javax.xml.bind.annotation.XmlType;

import org.jboss.test.ws.jaxws.samples.retail.Customer;

@XmlAccessorType(XmlAccessType.FIELD)
@XmlType(
  name = "discountRequest",
  namespace="http://org.jboss.ws/samples/retail/profile",
  propOrder = { "customer" }
)
public class DiscountRequest {

   protected Customer customer;

   public DiscountRequest() {
   }

   public DiscountRequest(Customer customer) {
      this.customer = customer;
   }

   public Customer getCustomer() {
      return customer;
   }

   public void setCustomer(Customer value) {
      this.customer = value;
   }

}</pre>

					</p></div><h4 id="packaging_your_deployment">Packaging Your Deployment</h4><p>
					The implementation class is wrapped in a JAR deployment. Any metadata required for deployment is taken from the annotations on the implementation class and the service endpoint interface. You can deploy the JAR using the management CLI or the management console, and the HTTP endpoint is created automatically.
				</p><p>
					The following listing shows an example of the structure for a JAR deployment of an EJB web service.
				</p><pre class="screen">$ jar -tf jaxws-samples-retail.jar
org/jboss/test/ws/jaxws/samples/retail/profile/DiscountRequest.class
org/jboss/test/ws/jaxws/samples/retail/profile/DiscountResponse.class
org/jboss/test/ws/jaxws/samples/retail/profile/ObjectFactory.class
org/jboss/test/ws/jaxws/samples/retail/profile/ProfileMgmt.class
org/jboss/test/ws/jaxws/samples/retail/profile/ProfileMgmtBean.class
org/jboss/test/ws/jaxws/samples/retail/profile/ProfileMgmtService.class
org/jboss/test/ws/jaxws/samples/retail/profile/package-info.class</pre></section></section><section class="section" id="ws_clients"><div class="titlepage"><div><div><h2 class="title">3.3. JAX-WS Web Service Clients</h2></div></div></div><section class="section" id="consume_and_access_a_jax_ws_web_service"><div class="titlepage"><div><div><h3 class="title">3.3.1. Consume and Access a JAX-WS Web Service</h3></div></div></div><p>
					After creating a web service endpoint, either manually or using JAX-WS annotations, you can access its WSDL. This WSDL can be used to create the basic client application that will communicate with the web service. The process of generating Java code from the published WSDL is called consuming the web service. This happens in the following phases:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
							<a class="link" href="#create_client_artifacts" title="Create the Client Artifacts">Create the client artifacts</a>.
						</li><li class="listitem">
							<a class="link" href="#construct_service_stub" title="Construct a Service Stub">Construct a service stub</a>.
						</li></ol></div><h5 id="create_client_artifacts">Create the Client Artifacts</h5><p>
					Before you can create client artifacts, you need to create your WSDL contract. The following WSDL contract is used for the examples presented in the rest of this section.
				</p><p>
					The examples below rely on having this WSDL contract in the <code class="literal">ProfileMgmtService.wsdl</code> file.
				</p><pre class="programlisting language-xml">&lt;definitions
    name='ProfileMgmtService'
    targetNamespace='http://org.jboss.ws/samples/retail/profile'
    xmlns='http://schemas.xmlsoap.org/wsdl/'
    xmlns:ns1='http://org.jboss.ws/samples/retail'
    xmlns:soap='http://schemas.xmlsoap.org/wsdl/soap/'
    xmlns:tns='http://org.jboss.ws/samples/retail/profile'
    xmlns:xsd='http://www.w3.org/2001/XMLSchema'&gt;

   &lt;types&gt;

      &lt;xs:schema targetNamespace='http://org.jboss.ws/samples/retail'
                 version='1.0' xmlns:xs='http://www.w3.org/2001/XMLSchema'&gt;
         &lt;xs:complexType name='customer'&gt;
            &lt;xs:sequence&gt;
               &lt;xs:element minOccurs='0' name='creditCardDetails' type='xs:string'/&gt;
               &lt;xs:element minOccurs='0' name='firstName' type='xs:string'/&gt;
               &lt;xs:element minOccurs='0' name='lastName' type='xs:string'/&gt;
            &lt;/xs:sequence&gt;
         &lt;/xs:complexType&gt;
      &lt;/xs:schema&gt;

      &lt;xs:schema
          targetNamespace='http://org.jboss.ws/samples/retail/profile'
          version='1.0'
          xmlns:ns1='http://org.jboss.ws/samples/retail'
          xmlns:tns='http://org.jboss.ws/samples/retail/profile'
          xmlns:xs='http://www.w3.org/2001/XMLSchema'&gt;

         &lt;xs:import namespace='http://org.jboss.ws/samples/retail'/&gt;
         &lt;xs:element name='getCustomerDiscount'
                     nillable='true' type='tns:discountRequest'/&gt;
         &lt;xs:element name='getCustomerDiscountResponse'
                     nillable='true' type='tns:discountResponse'/&gt;
         &lt;xs:complexType name='discountRequest'&gt;
            &lt;xs:sequence&gt;
               &lt;xs:element minOccurs='0' name='customer' type='ns1:customer'/&gt;

            &lt;/xs:sequence&gt;
         &lt;/xs:complexType&gt;
         &lt;xs:complexType name='discountResponse'&gt;
            &lt;xs:sequence&gt;
               &lt;xs:element minOccurs='0' name='customer' type='ns1:customer'/&gt;
               &lt;xs:element name='discount' type='xs:double'/&gt;
            &lt;/xs:sequence&gt;
         &lt;/xs:complexType&gt;
      &lt;/xs:schema&gt;

   &lt;/types&gt;

   &lt;message name='ProfileMgmt_getCustomerDiscount'&gt;
      &lt;part element='tns:getCustomerDiscount' name='getCustomerDiscount'/&gt;
   &lt;/message&gt;
   &lt;message name='ProfileMgmt_getCustomerDiscountResponse'&gt;
      &lt;part element='tns:getCustomerDiscountResponse'
            name='getCustomerDiscountResponse'/&gt;
   &lt;/message&gt;
   &lt;portType name='ProfileMgmt'&gt;
      &lt;operation name='getCustomerDiscount'
                 parameterOrder='getCustomerDiscount'&gt;

         &lt;input message='tns:ProfileMgmt_getCustomerDiscount'/&gt;
         &lt;output message='tns:ProfileMgmt_getCustomerDiscountResponse'/&gt;
      &lt;/operation&gt;
   &lt;/portType&gt;
   &lt;binding name='ProfileMgmtBinding' type='tns:ProfileMgmt'&gt;
      &lt;soap:binding style='document'
                    transport='http://schemas.xmlsoap.org/soap/http'/&gt;
      &lt;operation name='getCustomerDiscount'&gt;
         &lt;soap:operation soapAction=''/&gt;
         &lt;input&gt;

            &lt;soap:body use='literal'/&gt;
         &lt;/input&gt;
         &lt;output&gt;
            &lt;soap:body use='literal'/&gt;
         &lt;/output&gt;
      &lt;/operation&gt;
   &lt;/binding&gt;
   &lt;service name='ProfileMgmtService'&gt;
      &lt;port binding='tns:ProfileMgmtBinding' name='ProfileMgmtPort'&gt;

         &lt;!-- service address will be rewritten to actual one when WSDL is requested from running server --&gt;
         &lt;soap:address location='http://SERVER:PORT/jaxws-retail/ProfileMgmtBean'/&gt;
      &lt;/port&gt;
   &lt;/service&gt;
&lt;/definitions&gt;</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						If you use JAX-WS annotations to create your web service endpoint, the WSDL contract is generated automatically, and you only need its URL. You can find this URL by navigating to <span class="strong strong"><strong>Runtime</strong></span>, selecting the applicable server, selecting <span class="strong strong"><strong>Webservices</strong></span>, then choosing the endpoint.
					</p></div></div><p>
					The <code class="literal">wsconsume.sh</code> or <code class="literal">wsconsume.bat</code> tool is used to consume the abstract contract (WSDL) and produce annotated Java classes and optional sources that define it. The tool is located in the <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/bin/</code> directory.
				</p><pre class="screen">$ ./wsconsume.sh --help
WSConsumeTask is a cmd line tool that generates portable JAX-WS artifacts from a WSDL file.

usage: org.jboss.ws.tools.cmd.WSConsume [options] &lt;wsdl-url&gt;

options:
    -h, --help                  Show this help message
    -b, --binding=&lt;file&gt;        One or more JAX-WS or JAXB binding files
    -k, --keep                  Keep/Generate Java source
    -c  --catalog=&lt;file&gt;        Oasis XML Catalog file for entity resolution
    -p  --package=&lt;name&gt;        The target package for generated source
    -w  --wsdlLocation=&lt;loc&gt;    Value to use for @WebService.wsdlLocation
    -o, --output=&lt;directory&gt;    The directory to put generated artifacts
    -s, --source=&lt;directory&gt;    The directory to put Java source
    -t, --target=&lt;2.0|2.1|2.2&gt;  The JAX-WS specification target
    -q, --quiet                 Be somewhat more quiet
    -v, --verbose               Show full exception stack traces
    -l, --load-consumer         Load the consumer and exit (debug utility)
    -e, --extension             Enable SOAP 1.2 binding extension
    -a, --additionalHeaders     Enable processing of implicit SOAP headers
    -n, --nocompile             Do not compile generated sources</pre><p>
					The following command generates the source <code class="literal">.java</code> files listed in the output, from the <code class="literal">ProfileMgmtService.wsdl</code> file. The sources use the directory structure of the package, which is specified with the <code class="literal">-p</code> switch.
				</p><pre class="screen">[user@host bin]$
output/org/jboss/test/ws/jaxws/samples/retail/profile/Customer.java
output/org/jboss/test/ws/jaxws/samples/retail/profile/DiscountRequest.java
output/org/jboss/test/ws/jaxws/samples/retail/profile/DiscountResponse.java
output/org/jboss/test/ws/jaxws/samples/retail/profile/ObjectFactory.java
output/org/jboss/test/ws/jaxws/samples/retail/profile/ProfileMgmt.java
output/org/jboss/test/ws/jaxws/samples/retail/profile/ProfileMgmtService.java
output/org/jboss/test/ws/jaxws/samples/retail/profile/package-info.java
output/org/jboss/test/ws/jaxws/samples/retail/profile/Customer.class
output/org/jboss/test/ws/jaxws/samples/retail/profile/DiscountRequest.class
output/org/jboss/test/ws/jaxws/samples/retail/profile/DiscountResponse.class
output/org/jboss/test/ws/jaxws/samples/retail/profile/ObjectFactory.class
output/org/jboss/test/ws/jaxws/samples/retail/profile/ProfileMgmt.class
output/org/jboss/test/ws/jaxws/samples/retail/profile/ProfileMgmtService.class
output/org/jboss/test/ws/jaxws/samples/retail/profile/package-info.class</pre><p>
					Both <code class="literal">.java</code> source files and compiled <code class="literal">.class</code> files are generated into the <code class="literal">output/</code> directory within the directory where you run the command.
				</p><div class="table" id="idm139695808773424"><p class="title"><strong>Table 3.3. Descriptions of Artifacts Created by <code class="literal">wsconsume.sh</code></strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"><!--Empty--></col><col style="width: 50%; " class="col_2"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139695808768256" scope="col">File</th><th align="left" valign="top" id="idm139695808767168" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139695808768256"> <p>
									<code class="literal">ProfileMgmt.java</code>
								</p>
								 </td><td align="left" valign="top" headers="idm139695808767168"> <p>
									Service endpoint interface.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695808768256"> <p>
									<code class="literal">Customer.java</code>
								</p>
								 </td><td align="left" valign="top" headers="idm139695808767168"> <p>
									Custom data type.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695808768256"> <p>
									<code class="literal">Discount.java</code>
								</p>
								 </td><td align="left" valign="top" headers="idm139695808767168"> <p>
									Custom data types.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695808768256"> <p>
									<code class="literal">ObjectFactory.java</code>
								</p>
								 </td><td align="left" valign="top" headers="idm139695808767168"> <p>
									JAXB XML registry.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695808768256"> <p>
									<code class="literal">package-info.java</code>
								</p>
								 </td><td align="left" valign="top" headers="idm139695808767168"> <p>
									JAXB package annotations.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695808768256"> <p>
									<code class="literal">ProfileMgmtService.java</code>
								</p>
								 </td><td align="left" valign="top" headers="idm139695808767168"> <p>
									Service factory.
								</p>
								 </td></tr></tbody></table></div></div><p>
					The <code class="literal">wsconsume</code> command generates all custom data types (JAXB annotated classes), the service endpoint interface, and a service factory class. These artifacts are used to build web service client implementations.
				</p><h5 id="construct_service_stub">Construct a Service Stub</h5><p>
					Web service clients use service stubs to abstract the details of a remote web service invocation. To a client application, a web service invocation looks like an invocation of any other business component. In this case the service endpoint interface acts as the business interface, and a service factory class is not used to construct it as a service stub.
				</p><p>
					The following example first creates a service factory using the WSDL location and the service name. Next, it uses the service endpoint interface created by <code class="literal">wsconsume</code> to build the service stub. Finally, the stub can be used just as any other business interface would be.
				</p><p>
					You can find the WSDL URL for your endpoint in the JBoss EAP management console. You can find this URL by navigating to <span class="strong strong"><strong>Runtime</strong></span>, selecting the applicable server, selecting <span class="strong strong"><strong>Webservices</strong></span>, then choosing the endpoint.
				</p><pre class="programlisting language-java">import javax.xml.ws.Service;
[...]
Service service = Service.create(
new URL("http://example.org/service?wsdl"),
new QName("MyService")
);
ProfileMgmt profileMgmt = service.getPort(ProfileMgmt.class);

// Use the service stub in your application</pre></section><section class="section" id="develop_a_jax_ws_client_application"><div class="titlepage"><div><div><h3 class="title">3.3.2. Develop a JAX-WS Client Application</h3></div></div></div><p>
					The client communicates with, and requests work from, the JAX-WS endpoint, which is deployed in the Java Enterprise Edition 7 container. For detailed information about the classes, methods, and other implementation details mentioned below, see the relevant sections of the Javadocs bundle included with JBoss EAP.
				</p><h5 id="overview">Overview</h5><p>
					A <code class="literal">Service</code> is an abstraction which represents a WSDL service. A WSDL service is a collection of related ports, each of which includes a port type bound to a particular protocol and a particular endpoint address.
				</p><p>
					Usually, the Service is generated when the rest of the component stubs are generated from an existing WSDL contract. The WSDL contract is available via the WSDL URL of the deployed endpoint, or can be created from the endpoint source using the <code class="literal">wsprovide</code> tool in the <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/bin/</code> directory.
				</p><p>
					This type of usage is referred to as the static use case. In this case, you create instances of the <code class="literal">Service</code> class which is created as one of the component stubs.
				</p><p>
					You can also create the service manually, using the <code class="literal">Service.create</code> method. This is referred to as the dynamic use case.
				</p><h5 id="usage">Usage</h5><h6 id="static_use_case">Static Use Case</h6><p>
					The static use case for a JAX-WS client assumes that you already have a WSDL contract. This might be generated by an external tool or generated by using the correct JAX-WS annotations when you create your JAX-WS endpoint.
				</p><p>
					To generate your component stubs, you use the <code class="literal">wsconsume</code> tool included in <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/bin</code>. The tool takes the WSDL URL or file as a parameter, and generates multiple files, structured in a directory tree. The source and class files representing your <code class="literal">Service</code> are named <code class="literal">_Service.java</code> and <code class="literal">_Service.class</code>, respectively.
				</p><p>
					The generated implementation class has two public constructors, one with no arguments and one with two arguments. The two arguments represent the WSDL location (a <code class="literal">java.net.URL</code>) and the service name (a <code class="literal">javax.xml.namespace.QName</code>) respectively.
				</p><p>
					The no-argument constructor is the one used most often. In this case the WSDL location and service name are those found in the WSDL. These are set implicitly from the <code class="literal">@WebServiceClient</code> annotation that decorates the generated class.
				</p><pre class="programlisting language-java">@WebServiceClient(name="StockQuoteService", targetNamespace="http://example.com/stocks", wsdlLocation="http://example.com/stocks.wsdl")
public class StockQuoteService extends javax.xml.ws.Service
{
   public StockQuoteService() {
      super(new URL("http://example.com/stocks.wsdl"), new QName("http://example.com/stocks", "StockQuoteService"));
   }

   public StockQuoteService(String wsdlLocation, QName serviceName) {
      super(wsdlLocation, serviceName);
   }
   ...
}</pre><p>
					For details about how to obtain a port from the service and how to invoke an operation on the port, see <a class="link" href="#dynamic_proxy" title="Dynamic Proxy">Dynamic Proxy</a>. For details about how to work with the XML payload directly or with the XML representation of the entire SOAP message, see <a class="link" href="#dispatch" title="Dispatch">Dispatch</a>.
				</p><h6 id="dynamic_use_case">Dynamic Use Case</h6><p>
					In the dynamic case, no stubs are generated automatically. Instead, a web service client uses the <code class="literal">Service.create</code> method to create <code class="literal">Service</code> instances. The following code fragment illustrates this process.
				</p><pre class="programlisting language-java">URL wsdlLocation = new URL("http://example.org/my.wsdl");
QName serviceName = new QName("http://example.org/sample", "MyService");
Service service = Service.create(wsdlLocation, serviceName);</pre><h6 id="handler_resolver">Handler Resolver</h6><p>
					JAX-WS provides a flexible plug-in framework for message processing modules, known as handlers. These handlers extend the capabilities of a JAX-WS runtime system. A <code class="literal">Service</code> instance provides access to a <code class="literal">HandlerResolver</code> via a pair of <code class="literal">getHandlerResolver</code> and <code class="literal">setHandlerResolver</code> methods that can configure a set of handlers on a per-service, per-port or per-protocol binding basis.
				</p><p>
					When a <code class="literal">Service</code> instance creates a proxy or a <code class="literal">Dispatch</code> instance, the handler resolver currently registered with the service creates the required handler chain. Subsequent changes to the handler resolver configured for a <code class="literal">Service</code> instance do not affect the handlers on previously created proxies or <code class="literal">Dispatch</code> instances.
				</p><h6 id="executor">Executor</h6><p>
					<code class="literal">Service</code> instances can be configured with a <code class="literal">java.util.concurrent.Executor</code>. The <code class="literal">Executor</code> invokes any asynchronous callbacks requested by the application. The <code class="literal">setExecutor</code> and <code class="literal">getExecutor</code> methods of <code class="literal">Service</code> can modify and retrieve the <code class="literal">Executor</code> configured for a service.
				</p><h5 id="dynamic_proxy">Dynamic Proxy</h5><p>
					A dynamic proxy is an instance of a client proxy using one of the <code class="literal">getPort</code> methods provided in the <code class="literal">Service</code>. The <code class="literal">portName</code> specifies the name of the WSDL port the service uses. The <code class="literal">serviceEndpointInterface</code> specifies the service endpoint interface supported by the created dynamic proxy instance.
				</p><pre class="programlisting language-java">public &lt;T&gt; T getPort(QName portName, Class&lt;T&gt; serviceEndpointInterface)
public &lt;T&gt; T getPort(Class&lt;T&gt; serviceEndpointInterface)</pre><p>
					The Service Endpoint Interface is usually generated using the <code class="literal">wsconsume</code> tool, which parses the WSDL and creates Java classes from it.
				</p><p>
					A typed method, which returns a port, is also provided. These methods also return dynamic proxies that implement the SEI. See the following example.
				</p><pre class="programlisting language-java">@WebServiceClient(name = "TestEndpointService", targetNamespace = "http://org.jboss.ws/wsref",
   wsdlLocation = "http://localhost.localdomain:8080/jaxws-samples-webserviceref?wsdl")

public class TestEndpointService extends Service {
    ...

    public TestEndpointService(URL wsdlLocation, QName serviceName) {
        super(wsdlLocation, serviceName);
    }

    @WebEndpoint(name = "TestEndpointPort")
    public TestEndpoint getTestEndpointPort() {
        return (TestEndpoint)super.getPort(TESTENDPOINTPORT, TestEndpoint.class);
    }
}</pre><h5 id="webserviceref">@WebServiceRef</h5><p>
					The <code class="literal">@WebServiceRef</code> annotation declares a reference to a web service. It follows the resource pattern shown by the <code class="literal">javax.annotation.Resource</code> annotation defined in <a class="link mimir-link-warn" href="http://www.jcp.org/en/jsr/summary?id=250" title="Mimir does not include content from: www.jcp.org">JSR 250</a>.
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							You can use it to define a reference whose type is a generated <code class="literal">Service</code> class. In this case, the type and value element each refer to the generated <code class="literal">Service</code> class type. Moreover, if the reference type can be inferred by the field or method declaration the annotation is applied to, the type and value elements might, but are not required to, have the default value of <code class="literal">Object.class</code>. If the type cannot be inferred, then at least the type element must be present with a non-default value.
						</li><li class="listitem"><p class="simpara">
							You can use it to define a reference whose type is an SEI. In this case, the type element might (but is not required to) be present with its default value if the type of the reference can be inferred from the annotated field or method declaration. However, the value element must always be present and refer to a generated service class type, which is a subtype of <code class="literal">javax.xml.ws.Service</code>. The <code class="literal">wsdlLocation</code> element, if present, overrides the WSDL location information specified in the <code class="literal">@WebService</code> annotation of the referenced generated service class.
						</p><pre class="programlisting language-java">public class EJB3Client implements EJB3Remote
{
   @WebServiceRef
   public TestEndpointService service4;

   @WebServiceRef
   public TestEndpoint port3;
 }</pre></li></ul></div><h5 id="dispatch">Dispatch</h5><p>
					XML web services use XML messages for communication between the endpoint, which is deployed in the Java EE container, and any clients. The XML messages use an XML language called Simple Object Access Protocol (SOAP). The JAX-WS API provides the mechanisms for the endpoint and clients to each be able to send and receive SOAP messages. Marshalling is the process of converting a Java Object into a SOAP XML message. Unmarshalling is the process of converting the SOAP XML message back into a Java Object.
				</p><p>
					In some cases, you need access to the raw SOAP messages themselves, rather than the result of the conversion. The <code class="literal">Dispatch</code> class provides this functionality. <code class="literal">Dispatch</code> operates in one of two usage modes, which are identified by one of the following constants.
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							<code class="literal">javax.xml.ws.Service.Mode.MESSAGE</code> - This mode directs client applications to work directly with protocol-specific message structures. When used with a SOAP protocol binding, a client application works directly with a SOAP message.
						</li><li class="listitem">
							<code class="literal">javax.xml.ws.Service.Mode.PAYLOAD</code> - This mode causes the client to work with the payload itself. For instance, if it is used with a SOAP protocol binding, a client application would work with the contents of the SOAP body rather than the entire SOAP message.
						</li></ul></div><p>
					<code class="literal">Dispatch</code> is a low-level API which requires clients to structure messages or payloads as XML, with strict adherence to the standards of the individual protocol and a detailed knowledge of message or payload structure. <code class="literal">Dispatch</code> is a generic class which supports input and output of messages or message payloads of any type.
				</p><pre class="programlisting language-java">Service service = Service.create(wsdlURL, serviceName);
Dispatch dispatch = service.createDispatch(portName, StreamSource.class, Mode.PAYLOAD);

String payload = "&lt;ns1:ping xmlns:ns1='http://oneway.samples.jaxws.ws.test.jboss.org/'/&gt;";
dispatch.invokeOneWay(new StreamSource(new StringReader(payload)));

payload = "&lt;ns1:feedback xmlns:ns1='http://oneway.samples.jaxws.ws.test.jboss.org/'/&gt;";
Source retObj = (Source)dispatch.invoke(new StreamSource(new StringReader(payload)));</pre><h5 id="asynchronous_invocations">Asynchronous Invocations</h5><p>
					The <code class="literal">BindingProvider</code> interface represents a component that provides a protocol binding which clients can use. It is implemented by proxies and is extended by the <code class="literal">Dispatch</code> interface.
				</p><p>
					<code class="literal">BindingProvider</code> instances might provide asynchronous operation capabilities. Asynchronous operation invocations are decoupled from the <code class="literal">BindingProvider</code> instance at invocation time. The response context is not updated when the operation completes. Instead, a separate response context is made available using the <code class="literal">Response</code> interface.
				</p><pre class="programlisting language-java">public void testInvokeAsync() throws Exception {
   URL wsdlURL = new URL("http://" + getServerHost() + ":8080/jaxws-samples-asynchronous?wsdl");
   QName serviceName = new QName(targetNS, "TestEndpointService");
   Service service = Service.create(wsdlURL, serviceName);
   TestEndpoint port = service.getPort(TestEndpoint.class);
   Response response = port.echoAsync("Async");
   // access future
   String retStr = (String) response.get();
   assertEquals("Async", retStr);
}</pre><h5 id="oneway_invocations">@Oneway Invocations</h5><p>
					The <code class="literal">@Oneway</code> annotation indicates that the given web method takes an input message but returns no output message. Usually, a <code class="literal">@Oneway</code> method returns the thread of control to the calling application before the business method is executed.
				</p><pre class="programlisting language-java">@WebService (name="PingEndpoint")
@SOAPBinding(style = SOAPBinding.Style.RPC)
public class PingEndpointImpl {
   private static String feedback;

   @WebMethod
   @Oneway
   public void ping() {
      log.info("ping");
      feedback = "ok";
   }

   @WebMethod
   public String feedback() {
      log.info("feedback");
      return feedback;
   }
}</pre><h5 id="timeout_configuration">Timeout Configuration</h5><p>
					Two different properties control the timeout behavior of the HTTP connection and the timeout of a client which is waiting to receive a message. The first is <code class="literal">javax.xml.ws.client.connectionTimeout</code> and the second is <code class="literal">javax.xml.ws.client.receiveTimeout</code>. Each is expressed in milliseconds, and the correct syntax is shown below.
				</p><pre class="programlisting language-java">public void testConfigureTimeout() throws Exception {
   //Set timeout until a connection is established
   ((BindingProvider)port).getRequestContext().put("javax.xml.ws.client.connectionTimeout", "6000");

   //Set timeout until the response is received
   ((BindingProvider) port).getRequestContext().put("javax.xml.ws.client.receiveTimeout", "1000");

   port.echo("testTimeout");
}</pre></section></section><section class="section" id="configure_web_services_options"><div class="titlepage"><div><div><h2 class="title">3.4. Configuring the Web Services Subsystem</h2></div></div></div><p>
				JBossWS components handle the processing of web service endpoints and are provided to JBoss EAP through the <code class="literal">webservices</code> subsystem. The subsystem supports the configuration of published endpoint addresses and endpoint handler chains.
			</p><p>
				A default <code class="literal">webservices</code> subsystem is provided in the server’s domain and standalone configuration files. It contains several predefined endpoint and client configurations.
			</p><pre class="programlisting language-xml">&lt;subsystem xmlns="urn:jboss:domain:webservices:2.0"&gt;
  &lt;wsdl-host&gt;${jboss.bind.address:127.0.0.1}&lt;/wsdl-host&gt;
  &lt;endpoint-config name="Standard-Endpoint-Config"/&gt;
  &lt;endpoint-config name="Recording-Endpoint-Config"&gt;
    &lt;pre-handler-chain name="recording-handlers" protocol-bindings="##SOAP11_HTTP ##SOAP11_HTTP_MTOM ##SOAP12_HTTP ##SOAP12_HTTP_MTOM"&gt;
      &lt;handler name="RecordingHandler" class="org.jboss.ws.common.invocation.RecordingServerHandler"/&gt;
    &lt;/pre-handler-chain&gt;
  &lt;/endpoint-config&gt;
  &lt;client-config name="Standard-Client-Config"/&gt;
&lt;/subsystem&gt;</pre><section class="section" id="jax_ws_endpoint_configs"><div class="titlepage"><div><div><h3 class="title">3.4.1. Endpoint Configurations</h3></div></div></div><p>
					JBossWS enables extra setup configuration data to be predefined and associated with an endpoint implementation. Predefined endpoint configurations can be used for JAX-WS client and JAX-WS endpoint setup. Endpoint configurations can include JAX-WS handlers and key/value properties declarations. This feature provides a convenient way to add handlers to web service endpoints and to set key/value properties that control JBossWS and Apache CXF internals.
				</p><p>
					The <code class="literal">webservices</code> subsystem allows you to define named sets of endpoint configuration data. Each endpoint configuration must have a unique name within the subsystem. The <code class="literal">org.jboss.ws.api.annotation.EndpointConfig</code> annotation can then be used to assign an endpoint configuration to a JAX-WS implementation in a deployed application. See <a class="link" href="#ws_endpoint_assign_config" title="3.5. Assigning Client and Endpoint Configurations">Assigning a Configuration</a> for more information on assigning endpoint configurations.
				</p><p>
					There are two predefined endpoint configurations in the default JBoss EAP configuration:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							<code class="literal">Standard-Endpoint-Config</code> is the endpoint configuration used for any endpoint that does not have an explicitly-assigned endpoint configuration.
						</li><li class="listitem">
							<code class="literal">Recording-Endpoint-Config</code> is an example of custom endpoint configuration that includes a recording handler.
						</li></ul></div><h5 id="add_an_endpoint_configuration">Add an Endpoint Configuration</h5><p>
					You can add a new endpoint configuration using the management CLI.
				</p><pre class="screen">/subsystem=webservices/endpoint-config=My-Endpoint-Config:add</pre><h5 id="configure_an_endpoint_configuration">Configure an Endpoint Configuration</h5><p>
					You can add key/value property declarations for the endpoint configuration using the management CLI.
				</p><pre class="screen">/subsystem=webservices/endpoint-config=Standard-Endpoint-Config/property=<span class="emphasis"><em>PROPERTY_NAME</em></span>:add(value=<span class="emphasis"><em>PROPERTY_VALUE</em></span>)</pre><p>
					You can also configure <a class="link" href="#jax_ws_handler_chains" title="3.4.2. Handler Chains">handler chains</a> and <a class="link" href="#jax_ws_handlers" title="3.4.3. Handlers">handlers</a> for these endpoint configurations.
				</p><h5 id="remove_an_endpoint_configuration">Remove an Endpoint Configuration</h5><p>
					You can remove a endpoint configuration using the management CLI.
				</p><pre class="screen">/subsystem=webservices/endpoint-config=My-Endpoint-Config:remove</pre></section><section class="section" id="jax_ws_handler_chains"><div class="titlepage"><div><div><h3 class="title">3.4.2. Handler Chains</h3></div></div></div><p>
					Each endpoint configuration can be associated with <code class="literal">PRE</code> or <code class="literal">POST</code> handler chains. Each handler chain may include JAX-WS-compliant handlers to perform additional processing on messages. For outbound messages, <code class="literal">PRE</code> handler chain handlers are executed before any handler attached to the endpoints using standard JAX-WS means, such as the <code class="literal">@HandlerChain</code> annotation. <code class="literal">POST</code> handler chain handlers are executed after usual endpoint handlers. For inbound messages, the opposite applies.
				</p><div class="formalpara"><p class="title"><strong>Server Outbound Messages</strong></p><p>
						
<pre class="screen">Endpoint --&gt; PRE Handlers --&gt; Endpoint Handlers --&gt; POST Handlers --&gt; ... --&gt; Client</pre>

					</p></div><div class="formalpara"><p class="title"><strong>Server Inbound Messages</strong></p><p>
						
<pre class="screen">Client --&gt; ... --&gt; POST Handlers --&gt; Endpoint Handlers --&gt; PRE Handlers --&gt; Endpoint</pre>

					</p></div><h5 id="add_a_handler_chain">Add a Handler Chain</h5><p>
					You can add a <code class="literal">POST</code> handler chain to an endpoint configuration using the following management CLI command.
				</p><pre class="screen">/subsystem=webservices/endpoint-config=My-Endpoint-Config/post-handler-chain=my-post-handler-chain:add</pre><p>
					You can add a <code class="literal">PRE</code> handler chain to an endpoint configuration using the following management CLI command.
				</p><pre class="screen">/subsystem=webservices/endpoint-config=My-Endpoint-Config/pre-handler-chain=my-pre-handler-chain:add</pre><h5 id="configure_a_handler_chain">Configure a Handler Chain</h5><p>
					Use the <code class="literal">protocol-bindings</code> attribute to set which protocols trigger the handler chain to start.
				</p><pre class="screen">/subsystem=webservices/endpoint-config=My-Endpoint-Config/post-handler-chain=my-post-handler-chain:write-attribute(name=protocol-bindings,value=##SOAP11_HTTP)</pre><p>
					See the <a class="link" href="#jax_ws_handlers" title="3.4.3. Handlers">handlers</a> section for information on configuring handlers for a handler chain.
				</p><h5 id="remove_a_handler_chain">Remove a Handler Chain</h5><p>
					You can remove a handler chain using the management CLI.
				</p><pre class="screen">/subsystem=webservices/endpoint-config=My-Endpoint-Config/post-handler-chain=my-post-handler-chain:remove</pre></section><section class="section" id="jax_ws_handlers"><div class="titlepage"><div><div><h3 class="title">3.4.3. Handlers</h3></div></div></div><p>
					A JAX-WS handler is added to a handler chain and specifies the fully-qualified name of the handler class. When the endpoint is deployed, an instance of that class is created for each referencing deployment. Either the deployment class loader or the class loader for the <code class="literal">org.jboss.as.webservices.server.integration</code> module must be able to load the handler class.
				</p><p>
					See the <a class="link mimir-link-warn" href="https://access.redhat.com/webassets/avalon/d/jboss_enterprise_application_platform_continuous_delivery/18/javadocs/javax/xml/ws/handler/Handler.html" title="This content is not included in Mimir.">Handler</a> Javadocs for a listing of the available handlers.
				</p><h5 id="add_a_handler">Add a Handler</h5><p>
					You can add a handler to a handler chain using the following management CLI command. You must provide the class name of the handler.
				</p><pre class="screen">/subsystem=webservices/endpoint-config=My-Endpoint-Config/post-handler-chain=my-post-handler-chain/handler=my-handler:add(class="com.arjuna.webservices11.wsarj.handler.InstanceIdentifierInHandler")</pre><h5 id="configure_a_handler">Configure a Handler</h5><p>
					You can update the class for a handler using the management CLI.
				</p><pre class="screen">/subsystem=webservices/endpoint-config=My-Endpoint-Config/post-handler-chain=my-post-handler-chain/handler=my-handler:add(class="org.jboss.ws.common.invocation.RecordingServerHandler")</pre><h5 id="remove_a_handler">Remove a Handler</h5><p>
					You can remove a handler using the management CLI.
				</p><pre class="screen">/subsystem=webservices/endpoint-config=My-Endpoint-Config/post-handler-chain=my-post-handler-chain/handler=my-handler:</pre></section><section class="section" id="published_endpoint_addresses"><div class="titlepage"><div><div><h3 class="title">3.4.4. Published Endpoint Addresses</h3></div></div></div><p>
					The rewriting of the <code class="literal">&lt;soap:address&gt;</code> element of endpoints published in WSDL contracts is supported. This feature is useful for controlling the server address that is advertised to clients for each endpoint.
				</p><p>
					The following table lists the attributes that can be configured for this feature.
				</p><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 30%; " class="col_1"><!--Empty--></col><col style="width: 70%; " class="col_2"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139695805220368" scope="col">Name</th><th align="left" valign="top" id="idm139695805219280" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139695805220368"> <p>
									modify-wsdl-address
								</p>
								 </td><td align="left" valign="top" headers="idm139695805219280"> <p>
									This boolean enables and disables the address rewrite functionality.
								</p>
								 <p>
									When <code class="literal">modify-wsdl-address</code> is set to <code class="literal">true</code> and the content of <code class="literal">&lt;soap:address&gt;</code> is a valid URL, JBossWS rewrites the URL using the values of <code class="literal">wsdl-host</code> and <code class="literal">wsdl-port</code> or <code class="literal">wsdl-secure-port</code>.
								</p>
								 <p>
									When <code class="literal">modify-wsdl-address</code> is set to <code class="literal">false</code> and the content of <code class="literal">&lt;soap:address&gt;</code> is a valid URL, JBossWS does not rewrite the URL. The <code class="literal">&lt;soap:address&gt;</code> URL is used.
								</p>
								 <p>
									When the content of <code class="literal">&lt;soap:address&gt;</code> is not a valid URL, JBossWS rewrites it no matter what the setting of <code class="literal">modify-wsdl-address</code>. If <code class="literal">modify-wsdl-address</code> is set to <code class="literal">true</code> and <code class="literal">wsdl-host</code> is not defined or explicitly set to <code class="literal">jbossws.undefined.host</code>, the content of <code class="literal">&lt;soap:address&gt;</code> URL is used. JBossWS uses the requester’s host when rewriting the <code class="literal">&lt;soap:address&gt;</code>.
								</p>
								 <p>
									When <code class="literal">modify-wsdl-address</code> is not defined JBossWS uses a default value of <code class="literal">true</code>.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695805220368"> <p>
									wsdl-host
								</p>
								 </td><td align="left" valign="top" headers="idm139695805219280"> <p>
									The host name or IP address to be used for rewriting <code class="literal">&lt;soap:address&gt;</code>. If <code class="literal">wsdl-host</code> is set to <code class="literal">jbossws.undefined.host</code>, JBossWS uses the requester’s host when rewriting the <code class="literal">&lt;soap:address&gt;</code>. When <code class="literal">wsdl-host</code> is not defined JBossWS uses a default value of <code class="literal">jbossws.undefined.host</code>.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695805220368"> <p>
									wsdl-path-rewrite-rule
								</p>
								 </td><td align="left" valign="top" headers="idm139695805219280"> <p>
									This string defines a SED substitution command, for example <code class="literal">s/regexp/replacement/g</code>, that JBossWS executes against the path component of each <code class="literal">&lt;soap:address&gt;</code> URL published from the server. When <code class="literal">wsdl-path-rewrite-rule</code> is not defined, JBossWS retains the original path component of each <code class="literal">&lt;soap:address&gt;</code> URL. When <code class="literal">modify-wsdl-address</code> is set to <code class="literal">false</code> this element is ignored.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695805220368"> <p>
									wsdl-port
								</p>
								 </td><td align="left" valign="top" headers="idm139695805219280"> <p>
									Set this property to explicitly define the HTTP port that will be used for rewriting the SOAP address. Otherwise the HTTP port will be identified by querying the list of installed HTTP connectors.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695805220368"> <p>
									wsdl-secure-port
								</p>
								 </td><td align="left" valign="top" headers="idm139695805219280"> <p>
									Set this property to explicitly define the HTTPS port that will be used for rewriting the SOAP address. Otherwise the HTTPS port will be identified by querying the list of installed HTTPS connectors.
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139695805220368"> <p>
									wsdl-uri-scheme
								</p>
								 </td><td align="left" valign="top" headers="idm139695805219280"> <p>
									This property explicitly sets the URI scheme to use for rewriting <code class="literal">&lt;soap:address&gt;</code>. Valid values are <code class="literal">http</code> and <code class="literal">https</code>. This configuration overrides the scheme computed by processing the endpoint even if a transport guarantee is specified. The provided values for <code class="literal">wsdl-port</code> and <code class="literal">wsdl-secure-port</code>, or their default values, are used depending on the specified scheme.
								</p>
								 </td></tr></tbody></table></div><p>
					You can use the management CLI to update these attributes. For example:
				</p><pre class="screen">/subsystem=webservices:write-attribute(name=wsdl-uri-scheme, value=https)</pre></section><section class="section" id="runtime_information"><div class="titlepage"><div><div><h3 class="title">3.4.5. Viewing Runtime Information</h3></div></div></div><p>
					Each web service endpoint is exposed through the deployment that provides the endpoint implementation. Each endpoint can be queried as a deployment resource. Each web service endpoint specifies a web context and a WSDL URL. You can access this runtime information using the management CLI or the management console.
				</p><p>
					The following management CLI command shows the details of the <code class="literal">TestService</code> endpoint from the <code class="literal">jaxws-samples-handlerchain.war</code> deployment.
				</p><pre class="screen">/deployment="jaxws-samples-handlerchain.war"/subsystem=webservices/endpoint="jaxws-samples-handlerchain:TestService":read-resource(include-runtime=true)
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "average-processing-time" =&gt; 23L,
        "class" =&gt; "org.jboss.test.ws.jaxws.samples.handlerchain.EndpointImpl",
        "context" =&gt; "jaxws-samples-handlerchain",
        "fault-count" =&gt; 0L,
        "max-processing-time" =&gt; 23L,
        "min-processing-time" =&gt; 23L,
        "name" =&gt; "TestService",
        "request-count" =&gt; 1L,
        "response-count" =&gt; 1L,
        "total-processing-time" =&gt; 23L,
        "type" =&gt; "JAXWS_JSE",
        "wsdl-url" =&gt; "http://localhost:8080/jaxws-samples-handlerchain?wsdl"
    }
}</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						Using the <code class="literal">include-runtime=true</code> flag on the <code class="literal">read-resource</code> operation returns runtime statistics in the result. However, the collection of statistics for web service endpoints is disabled by default. You can enable statistics for web service endpoints using the following management CLI command.
					</p><pre class="screen">/subsystem=webservices:write-attribute(name=statistics-enabled,value=true)</pre></div></div><p>
					You can also view runtime information for web services endpoints from the <span class="strong strong"><strong>Runtime</strong></span> tab of the management console by selecting the applicable server, selecting <span class="strong strong"><strong>Webservices</strong></span>, then choosing the endpoint.
				</p></section></section><section class="section" id="ws_endpoint_assign_config"><div class="titlepage"><div><div><h2 class="title">3.5. Assigning Client and Endpoint Configurations</h2></div></div></div><p>
				Client and endpoint configurations can be assigned in the following ways:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Explicit assignment through annotations, for endpoints, or API programmatic usage, for clients.
					</li><li class="listitem">
						Automatic assignment of configurations from default descriptors.
					</li><li class="listitem">
						Automatic assignment of configurations from the container.
					</li></ul></div><section class="section" id="ws_endpoint_explict_config_assignment"><div class="titlepage"><div><div><h3 class="title">3.5.1. Explicit Configuration Assignment</h3></div></div></div><p>
					The explicit configuration assignment is meant for developers that know in advance their endpoint or client has to be set up according to a specified configuration. The configuration is coming from either a descriptor that is included in the application deployment, or is included in the <code class="literal">webservices</code> subsystem.
				</p><section class="section" id="ws_endpoint_config_deployment_desc"><div class="titlepage"><div><div><h4 class="title">3.5.1.1. Configuration Deployment Descriptor</h4></div></div></div><p>
						Java EE archives that can contain JAX-WS client and endpoint implementations may also contain predefined client and endpoint configuration declarations. All endpoint or client configuration definitions for a given archive must be provided in a single deployment descriptor file, which must be an implementation of the schema that can be found at <code class="literal">EAP_HOME/docs/schema/jbossws-jaxws-config_4_0.xsd</code>. Many endpoint or client configurations can be defined in the deployment descriptor file. Each configuration must have a name that is unique within the server on which the application is deployed. The configuration name cannot be referred to by endpoint or client implementations outside the application.
					</p><div class="formalpara"><p class="title"><strong>Example: Descriptor with Two Endpoint Configurations</strong></p><p>
							
<pre class="programlisting language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;jaxws-config xmlns="urn:jboss:jbossws-jaxws-config:4.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:javaee="http://java.sun.com/xml/ns/javaee"
  xsi:schemaLocation="urn:jboss:jbossws-jaxws-config:4.0 schema/jbossws-jaxws-config_4_0.xsd"&gt;
  &lt;endpoint-config&gt;
    &lt;config-name&gt;org.jboss.test.ws.jaxws.jbws3282.Endpoint4Impl&lt;/config-name&gt;
    &lt;pre-handler-chains&gt;
      &lt;javaee:handler-chain&gt;
        &lt;javaee:handler&gt;
          &lt;javaee:handler-name&gt;Log Handler&lt;/javaee:handler-name&gt;
          &lt;javaee:handler-class&gt;org.jboss.test.ws.jaxws.jbws3282.LogHandler&lt;/javaee:handler-class&gt;
        &lt;/javaee:handler&gt;
      &lt;/javaee:handler-chain&gt;
    &lt;/pre-handler-chains&gt;
    &lt;post-handler-chains&gt;
      &lt;javaee:handler-chain&gt;
        &lt;javaee:handler&gt;
          &lt;javaee:handler-name&gt;Routing Handler&lt;/javaee:handler-name&gt;
          &lt;javaee:handler-class&gt;org.jboss.test.ws.jaxws.jbws3282.RoutingHandler&lt;/javaee:handler-class&gt;
        &lt;/javaee:handler&gt;
      &lt;/javaee:handler-chain&gt;
    &lt;/post-handler-chains&gt;
  &lt;/endpoint-config&gt;
  &lt;endpoint-config&gt;
    &lt;config-name&gt;EP6-config&lt;/config-name&gt;
    &lt;post-handler-chains&gt;
      &lt;javaee:handler-chain&gt;
        &lt;javaee:handler&gt;
          &lt;javaee:handler-name&gt;Authorization Handler&lt;/javaee:handler-name&gt;
          &lt;javaee:handler-class&gt;org.jboss.test.ws.jaxws.jbws3282.AuthorizationHandler&lt;/javaee:handler-class&gt;
        &lt;/javaee:handler&gt;
      &lt;/javaee:handler-chain&gt;
    &lt;/post-handler-chains&gt;
  &lt;/endpoint-config&gt;
&lt;/jaxws-config&gt;</pre>

						</p></div><p>
						Similarly, a client configuration can be specified in descriptors, which is still implementing the schema mentioned above:
					</p><pre class="programlisting language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;jaxws-config xmlns="urn:jboss:jbossws-jaxws-config:4.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:javaee="http://java.sun.com/xml/ns/javaee"
  xsi:schemaLocation="urn:jboss:jbossws-jaxws-config:4.0 schema/jbossws-jaxws-config_4_0.xsd"&gt;
  &lt;client-config&gt;
    &lt;config-name&gt;Custom Client Config&lt;/config-name&gt;
    &lt;pre-handler-chains&gt;
      &lt;javaee:handler-chain&gt;
        &lt;javaee:handler&gt;
          &lt;javaee:handler-name&gt;Routing Handler&lt;/javaee:handler-name&gt;
          &lt;javaee:handler-class&gt;org.jboss.test.ws.jaxws.clientConfig.RoutingHandler&lt;/javaee:handler-class&gt;
        &lt;/javaee:handler&gt;
        &lt;javaee:handler&gt;
          &lt;javaee:handler-name&gt;Custom Handler&lt;/javaee:handler-name&gt;
          &lt;javaee:handler-class&gt;org.jboss.test.ws.jaxws.clientConfig.CustomHandler&lt;/javaee:handler-class&gt;
        &lt;/javaee:handler&gt;
      &lt;/javaee:handler-chain&gt;
    &lt;/pre-handler-chains&gt;
  &lt;/client-config&gt;
  &lt;client-config&gt;
    &lt;config-name&gt;Another Client Config&lt;/config-name&gt;
    &lt;post-handler-chains&gt;
      &lt;javaee:handler-chain&gt;
        &lt;javaee:handler&gt;
          &lt;javaee:handler-name&gt;Routing Handler&lt;/javaee:handler-name&gt;
          &lt;javaee:handler-class&gt;org.jboss.test.ws.jaxws.clientConfig.RoutingHandler&lt;/javaee:handler-class&gt;
        &lt;/javaee:handler&gt;
      &lt;/javaee:handler-chain&gt;
    &lt;/post-handler-chains&gt;
  &lt;/client-config&gt;
&lt;/jaxws-config&gt;</pre></section><section class="section" id="ws_endpoint_config_app_server"><div class="titlepage"><div><div><h4 class="title">3.5.1.2. Application Server Configuration</h4></div></div></div><p>
						JBoss EAP allows declaring JBossWS client and server predefined configurations in the <code class="literal">webservices</code> subsystem. As a result it is possible to declare server-wide handlers to be added to the chain of each endpoint or client assigned to a given configuration.
					</p><h6 id="standard_configuration">Standard Configuration</h6><p>
						Clients running in the same JBoss EAP instance, as well as endpoints, are assigned standard configurations by default. The defaults are used unless different a configuration is set. This enables administrators to tune the default handler chains for client and endpoint configurations. The names of the default client and endpoint configurations used in the <code class="literal">webservices</code> subsystem are <code class="literal">Standard-Client-Config</code> and <code class="literal">Standard-Endpoint-Config</code>.
					</p><h6 id="handlers_classloading">Handlers Classloading</h6><p>
						When setting a server-wide handler, the handler class needs to be available through each ws deployment classloader. As a result proper module dependencies may need to be specified in the deployments that are going to use a given predefined configuration. One way to ensure the proper module dependencies are specified in the deployment is to add a dependency to the module containing the handler class in one of the modules which are already automatically set as dependencies to any deployment, for instance <code class="literal">org.jboss.ws.spi</code>.
					</p><h6 id="example_configuration">Example Configuration</h6><div class="formalpara"><p class="title"><strong>Example: Default Subsystem Configuration</strong></p><p>
							
<pre class="programlisting language-xml">&lt;subsystem xmlns="urn:jboss:domain:webservices:2.0"&gt;
    &lt;!-- ... --&gt;
    &lt;endpoint-config name="Standard-Endpoint-Config"/&gt;
    &lt;endpoint-config name="Recording-Endpoint-Config"&gt;
        &lt;pre-handler-chain name="recording-handlers" protocol-bindings="##SOAP11_HTTP ##SOAP11_HTTP_MTOM ##SOAP12_HTTP ##SOAP12_HTTP_MTOM"&gt;
            &lt;handler name="RecordingHandler" class="org.jboss.ws.common.invocation.RecordingServerHandler"/&gt;
        &lt;/pre-handler-chain&gt;
    &lt;/endpoint-config&gt;
    &lt;client-config name="Standard-Client-Config"/&gt;
&lt;/subsystem&gt;</pre>

						</p></div><p>
						A configuration file for a deployment specific ws-security endpoint setup:
					</p><pre class="programlisting language-xml">&lt;jaxws-config xmlns="urn:jboss:jbossws-jaxws-config:4.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:javaee="http://java.sun.com/xml/ns/javaee" xsi:schemaLocation="urn:jboss:jbossws-jaxws-config:4.0 schema/jbossws-jaxws-config_4_0.xsd"&gt;
  &lt;endpoint-config&gt;
    &lt;config-name&gt;Custom WS-Security Endpoint&lt;/config-name&gt;
    &lt;property&gt;
      &lt;property-name&gt;ws-security.signature.properties&lt;/property-name&gt;
      &lt;property-value&gt;bob.properties&lt;/property-value&gt;
    &lt;/property&gt;
    &lt;property&gt;
      &lt;property-name&gt;ws-security.encryption.properties&lt;/property-name&gt;
      &lt;property-value&gt;bob.properties&lt;/property-value&gt;
    &lt;/property&gt;
    &lt;property&gt;
      &lt;property-name&gt;ws-security.signature.username&lt;/property-name&gt;
      &lt;property-value&gt;bob&lt;/property-value&gt;
    &lt;/property&gt;
    &lt;property&gt;
      &lt;property-name&gt;ws-security.encryption.username&lt;/property-name&gt;
      &lt;property-value&gt;alice&lt;/property-value&gt;
    &lt;/property&gt;
    &lt;property&gt;
      &lt;property-name&gt;ws-security.callback-handler&lt;/property-name&gt;
      &lt;property-value&gt;org.jboss.test.ws.jaxws.samples.wsse.policy.basic.KeystorePasswordCallback&lt;/property-value&gt;
    &lt;/property&gt;
  &lt;/endpoint-config&gt;
&lt;/jaxws-config&gt;</pre><p>
						JBoss EAP default configuration modified to default to SOAP messages schema-validation on:
					</p><pre class="programlisting language-xml">&lt;subsystem xmlns="urn:jboss:domain:webservices:2.0"&gt;
    &lt;!-- ... --&gt;
    &lt;endpoint-config name="Standard-Endpoint-Config"&gt;
        &lt;property name="schema-validation-enabled" value="true"/&gt;
    &lt;/endpoint-config&gt;
    &lt;!-- ... --&gt;
    &lt;client-config name="Standard-Client-Config"&gt;
        &lt;property name="schema-validation-enabled" value="true"/&gt;
    &lt;/client-config&gt;
&lt;/subsystem&gt;</pre></section><section class="section" id="ws_endpoint_config_annotation"><div class="titlepage"><div><div><h4 class="title">3.5.1.3. EndpointConfig Annotation</h4></div></div></div><p>
						Once a configuration is available to a given application, the <code class="literal">org.jboss.ws.api.annotation.EndpointConfig</code> annotation is used to assign an endpoint configuration to a JAX-WS endpoint implementation. When you assign a configuration that is defined in the <code class="literal">webservices</code> subsystem, you only need to specify the configuration name. When you assign a configuration that is defined in the application, you need to specify the relative path to the deployment descriptor and the configuration name.
					</p><div class="formalpara"><p class="title"><strong>Example: EndpointConfig Annotation</strong></p><p>
							
<pre class="programlisting language-java">@EndpointConfig(configFile = "WEB-INF/my-endpoint-config.xml", configName = "Custom WS-Security Endpoint")
public class ServiceImpl implements ServiceIface {
   public String sayHello() {
      return "Secure Hello World!";
   }
}</pre>

						</p></div></section><section class="section" id="ws_endpoint_config_feature"><div class="titlepage"><div><div><h4 class="title">3.5.1.4. JAX-WS Feature</h4></div></div></div><p>
						You can also use <code class="literal">org.jboss.ws.api.configuration.ClientConfigFeature</code> to set a configuration that is a JAX-WS Feature extension provided by JBossWS.
					</p><pre class="programlisting language-java">import org.jboss.ws.api.configuration.ClientConfigFeature;

Service service = Service.create(wsdlURL, serviceName);

Endpoint port = service.getPort(Endpoint.class, new ClientConfigFeature("META-INF/my-client-config.xml", "Custom Client Config"));
port.echo("Kermit");</pre><p>
						You can also set properties from the specified configuration by passing in <code class="literal">true</code> to the <code class="literal">ClientConfigFeature</code> constructor.
					</p><pre class="programlisting language-java">Endpoint port = service.getPort(Endpoint.class, new ClientConfigFeature("META-INF/my-client-config.xml", "Custom Client Config"), true);</pre><p>
						JBossWS parses the specified configuration file, after having resolved it as a resource using the current thread context class loader. The <code class="literal"><span class="emphasis"><em>EAP_HOME</em></span>/docs/schema/jbossws-jaxws-config_4_0.xsd</code> schema defines the descriptor contents and is included in the <code class="literal">jbossws-spi</code> artifact.
					</p><p>
						If you pass in <code class="literal">null</code> for the configuration file, the configuration will be read from the current container configurations, if available.
					</p><pre class="programlisting language-java">Endpoint port = service.getPort(Endpoint.class, new ClientConfigFeature(null, "Container Custom Client Config"));</pre></section><section class="section" id="ws_endpoint_explicit_setup_api"><div class="titlepage"><div><div><h4 class="title">3.5.1.5. Explicit Setup Through API</h4></div></div></div><p>
						Alternatively, the JBossWS API comes with facility classes that can be used for assigning configurations when building a client.
					</p><h6 id="handlers">Handlers</h6><p>
						JAX-WS handlers are read from client configurations as follows.
					</p><pre class="programlisting language-java">import org.jboss.ws.api.configuration.ClientConfigUtil;
import org.jboss.ws.api.configuration.ClientConfigurer;

Service service = Service.create(wsdlURL, serviceName);
Endpoint port = service.getPort(Endpoint.class);
BindingProvider bp = (BindingProvider)port;

ClientConfigurer configurer = ClientConfigUtil.resolveClientConfigurer();
configurer.setConfigHandlers(bp, "META-INF/my-client-config.xml", "Custom Client Config");
port.echo("Kermit");</pre><p>
						You can also use the <code class="literal">ClientConfigUtil</code> utility class to set up the handlers.
					</p><pre class="programlisting language-java">ClientConfigUtil.setConfigHandlers(bp, "META-INF/my-client-config.xml", "Custom Client Config");</pre><p>
						The default <code class="literal">ClientConfigurer</code> implementation parses the specified configuration file, after having resolved it as a resource using the current thread context class loader. The <code class="literal">EAP_HOME/docs/schema/jbossws-jaxws-config_4_0.xsd</code> schema defines the descriptor contents and is included in the <code class="literal">jbossws-spi</code> artifact.
					</p><p>
						If you pass in <code class="literal">null</code> for the configuration file, the configuration will be read from the current container configurations, if available.
					</p><pre class="programlisting language-java">ClientConfigurer configurer = ClientConfigUtil.resolveClientConfigurer();
configurer.setConfigHandlers(bp, null, "Container Custom Client Config");</pre><h6 id="properties">Properties</h6><p>
						Similarly, properties are read from client configurations as follows.
					</p><pre class="programlisting language-java">import org.jboss.ws.api.configuration.ClientConfigUtil;
import org.jboss.ws.api.configuration.ClientConfigurer;

Service service = Service.create(wsdlURL, serviceName);
Endpoint port = service.getPort(Endpoint.class);

ClientConfigUtil.setConfigProperties(port, "META-INF/my-client-config.xml", "Custom Client Config");
port.echo("Kermit");</pre><p>
						You can also use the <code class="literal">ClientConfigUtil</code> utility class to set up the properties.
					</p><pre class="programlisting language-java">ClientConfigurer configurer = ClientConfigUtil.resolveClientConfigurer();
configurer.setConfigProperties(port, "META-INF/my-client-config.xml", "Custom Client Config");</pre><p>
						The default <code class="literal">ClientConfigurer</code> implementation parses the specified configuration file, after having resolved it as a resource using the current thread context class loader. The <code class="literal">EAP_HOME/docs/schema/jbossws-jaxws-config_4_0.xsd</code> schema defines the descriptor contents and is included in the <code class="literal">jbossws-spi</code> artifact.
					</p><p>
						If you pass in <code class="literal">null</code> for the configuration file, the configuration will be read from the current container configurations, if available.
					</p><pre class="programlisting language-java">ClientConfigurer configurer = ClientConfigUtil.resolveClientConfigurer();
configurer.setConfigProperties(port, null, "Container Custom Client Config");</pre></section></section><section class="section" id="ws_endpoint_automatic_config_default_descriptors"><div class="titlepage"><div><div><h3 class="title">3.5.2. Automatic Configuration from Default Descriptors</h3></div></div></div><p>
					In some cases, the application developer might not be aware of the configuration that will need to be used for its client and endpoint implementation. In other cases, explicit usage of the JBossWS API might not be accepted because it is a compile-time dependency. To cope with such scenarios, JBossWS allows including default client, <code class="literal">jaxws-client-config.xml</code>, and endpoint, <code class="literal">jaxws-endpoint-config.xml</code>, descriptors within the application in its root directory. These are parsed for getting configurations whenever a configuration file name is not specified.
				</p><pre class="programlisting language-xml">&lt;config-file&gt;WEB-INF/jaxws-endpoint-config.xml&lt;/config-file&gt;</pre><p>
					If the configuration name is not specified, JBossWS automatically looks for a configuration named as:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							The fully qualified name (FQN) of the endpoint implementation class, in case of JAX-WS endpoints.
						</li><li class="listitem">
							The FQN of the service endpoint interface, in case of JAX-WS clients.
						</li></ul></div><p>
					No automatic configuration name is selected for <code class="literal">Dispatch</code> clients.
				</p><p>
					For example, an endpoint implementation class <code class="literal">org.foo.bar.EndpointImpl</code>, for which no predefined configuration is explicitly set, will cause JBossWS to look for a <code class="literal">org.foo.bar.EndpointImpl</code> named configuration within a <code class="literal">jaxws-endpoint-config.xml</code> descriptor in the root of the application deployment. Similarly, on the client side, a client proxy implementing <code class="literal">org.foo.bar.Endpoint</code> interface will have the setup read from a <code class="literal">org.foo.bar.Endpoint</code> named configuration in the <code class="literal">jaxws-client-config.xml</code> descriptor.
				</p></section><section class="section" id="ws_endpoint_automatic_config_assignemnt_container"><div class="titlepage"><div><div><h3 class="title">3.5.3. Automatic Configuration Assignment from Container</h3></div></div></div><p>
					JBossWS falls back to getting predefined configurations from the container whenever no explicit configuration has been provided and the default descriptors are either not available or do not contain relevant configurations. This behavior gives additional control on the JAX-WS client and endpoint setup to administrators since the container can be managed independently from the deployed applications.
				</p><p>
					JBossWS accesses the <code class="literal">webservices</code> subsystem for an explicitly named configuration. The default configuration names used are:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							The fully qualified name of the endpoint implementation class, in case of JAX-WS endpoints.
						</li><li class="listitem">
							The fully qualified name of the service endpoint interface, in case of JAX-WS clients.
						</li></ul></div><p>
					<code class="literal">Dispatch</code> clients are not automatically configured. If no configuration is found using names computed as above, the <code class="literal">Standard-Client-Config</code> and <code class="literal">Standard-Endpoint-Config</code> configurations are used for clients and endpoints respectively.
				</p></section></section><section class="section" id="setting_module_depencies_for_web_service_applications"><div class="titlepage"><div><div><h2 class="title">3.6. Setting Module Dependencies for Web Service Applications</h2></div></div></div><p>
				JBoss EAP web services are delivered as a set of modules and libraries, including the <code class="literal">org.jboss.as.webservices.*</code> and <code class="literal">org.jboss.ws.*</code> modules. You should not need to change these modules.
			</p><p>
				With JBoss EAP you cannot directly use JBossWS implementation classes unless you explicitly set a dependency to the corresponding module. You declare the module dependencies that you want to be added to the deployment.
			</p><p>
				The JBossWS APIs are available by default whenever the <code class="literal">webservices</code> subsystem is available. You can use them without creating an explicit dependencies declaration for those modules.
			</p><section class="section" id="using_manifest_mf"><div class="titlepage"><div><div><h3 class="title">3.6.1. Using MANIFEST.MF</h3></div></div></div><p>
					To configure deployment dependencies, add them to the <code class="literal">MANIFEST.MF</code> file. For example:
				</p><pre class="screen">Manifest-Version: 1.0
Dependencies: org.jboss.ws.cxf.jbossws-cxf-client services export,foo.bar</pre><p>
					This <code class="literal">MANIFEST.MF</code> file declares dependencies on the <code class="literal">org.jboss.ws.cxf.jbossws-cxf-client</code> and <code class="literal">foo.bar</code> modules. For more information on declaring dependencies in a <code class="literal">MANIFEST.MF</code> file, including the <code class="literal">export</code> and <code class="literal">services</code> options, see <a class="link" href="/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/development_guide/index/#add_dependency_manifest">Add a Dependency Configuration to MANIFEST.MF</a> in the JBoss EAP <span class="emphasis"><em>Development Guide</em></span>.
				</p><p>
					When using annotations on the endpoints and handlers, for example, Apache CXF endpoints and handlers, add the proper module dependency in your manifest file. If you skip this step, your annotations are not picked up and are completely, silently ignored.
				</p><section class="section" id="using_jaxb"><div class="titlepage"><div><div><h4 class="title">3.6.1.1. Using JAXB</h4></div></div></div><p>
						To successfully and directly use JAXB contexts in your client or endpoint running in-container, set up a JAXB implementation. For example, set the following dependency:
					</p><pre class="screen">Dependencies: com.sun.xml.bind services export</pre></section><section class="section" id="using_apache_cxf"><div class="titlepage"><div><div><h4 class="title">3.6.1.2. Using Apache CXF</h4></div></div></div><p>
						To use Apache CXF APIs and implementation classes, add a dependency to the <code class="literal">org.apache.cxf</code> (API) module or <code class="literal">org.apache.cxf.impl</code> (implementation) module. For example:
					</p><pre class="screen">Dependencies: org.apache.cxf services</pre><p>
						The dependency is purely Apache CXF without any JBossWS customizations or additional extensions. For this reason, a client-side aggregation module is available with all the web service dependencies that you might need.
					</p></section><section class="section" id="client_side_web_services_aggregation_module"><div class="titlepage"><div><div><h4 class="title">3.6.1.3. Client-side Web Services Aggregation Module</h4></div></div></div><p>
						When you want to use all of the web services features and functionality, you can set a dependency to the convenient client module. For example:
					</p><pre class="screen">Dependencies: org.jboss.ws.cxf.jbossws-cxf-client services</pre><p>
						The <code class="literal">services</code> option is required to enable all JBossWS features by loading JBossWS specific classes. The <code class="literal">services</code> option is almost always needed when declaring dependencies on the <code class="literal">org.jboss.ws.cxf.jbossws-cxf-client</code> and <code class="literal">org.apache.cxf</code> modules. The option affects the loading of classes through the <code class="literal">Service</code> API, which is what is used to wire most of the JBossWS components and the Apache CXF Bus extensions.
					</p></section><section class="section" id="annotation_scanning"><div class="titlepage"><div><div><h4 class="title">3.6.1.4. Annotation Scanning</h4></div></div></div><p>
						The application server uses an annotation index for detecting JAX-WS endpoints in user deployments. When declaring web service endpoints for a class that belongs to a different module, for instance referring to it in the <code class="literal">web.xml</code> descriptor, use an <code class="literal">annotations</code> type dependency. Without that dependency your endpoints are ignored as they do not appear as annotated classes to the <code class="literal">webservices</code> subsystem.
					</p><pre class="screen">Dependencies: my.org annotations</pre></section></section><section class="section" id="using_jboss_deployment_structure_xml"><div class="titlepage"><div><div><h3 class="title">3.6.2. Using jboss-deployment-structure.xml</h3></div></div></div><p>
					In some circumstances, the convenient approach of setting module dependencies in the <code class="literal">MANIFEST.MF</code> file might not work. For example, setting dependencies in the <code class="literal">MANIFEST.MF</code> file does not work when importing and exporting specific resources from a given module dependency. In these scenarios, add a <code class="literal">jboss-deployment-structure.xml</code> descriptor file to your deployment and set module dependencies in it.
				</p><p>
					For more information on using <code class="literal">jboss-deployment-structure.xml</code>, see <a class="link" href="/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/development_guide/index/#add_dependency_jboss_deployment_structure">Add a Dependency Configuration to the jboss-deployment-structure.xml</a> in the JBoss EAP <span class="emphasis"><em>Development Guide</em></span>.
				</p></section></section><section class="section" id="configuring_http_timeout"><div class="titlepage"><div><div><h2 class="title">3.7. Configuring HTTP Timeout</h2></div></div></div><p>
				The HTTP session timeout defines the period after which an HTTP session is considered to have become invalid because there was no activity within the specified period.
			</p><p>
				The HTTP session timeout can be configured, in order of precedence, in the following places:
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Application
					</p><p class="simpara">
						You can define the HTTP session timeout in the application’s <code class="literal">web.xml</code> configuration file by adding the following configuration to the file. This value is in minutes.
					</p><pre class="programlisting language-xml">&lt;session-config&gt;
  &lt;session-timeout&gt;30&lt;/session-timeout&gt;
&lt;/session-config&gt;</pre><p class="simpara">
						If you modified the WAR file, redeploy the application. If you exploded the WAR file, no further action is required because JBoss EAP automatically undeploys and redeploys the application.
					</p></li><li class="listitem"><p class="simpara">
						Server
					</p><p class="simpara">
						You can use the following management CLI command to set the default HTTP session timeout in the <code class="literal">undertow</code> subsystem. This value is in minutes.
					</p><pre class="screen">/subsystem=undertow/servlet-container=default:write-attribute(name=default-session-timeout,value=30)</pre></li><li class="listitem"><p class="simpara">
						Default
					</p><p class="simpara">
						The default HTTP session timeout is 30 minutes.
					</p></li></ol></div></section><section class="section" id="ws_sec_ws"><div class="titlepage"><div><div><h2 class="title">3.8. Securing JAX-WS Web Services</h2></div></div></div><p>
				WS-Security provides the means to secure your services beyond transport level protocols such as HTTPS. Through a number of standards, such as headers defined in the WS-Security standard, you can:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Pass authentication tokens between services.
					</li><li class="listitem">
						Encrypt messages or parts of messages.
					</li><li class="listitem">
						Sign messages.
					</li><li class="listitem">
						Timestamp messages.
					</li></ul></div><p>
				WS-Security makes use of public and private key cryptography. With public key cryptography, a user has a pair of public and private keys. These are generated using a large prime number and a key function.
			</p><p>
				The keys are related mathematically, but cannot be derived from one another. With these keys we can encrypt messages. For example, if Scott wants to send a message to Adam, he can encrypt a message using his public key. Adam can then decrypt this message using his private key. Only Adam can decrypt this message as he is the only one with the private key.
			</p><p>
				Messages can also be signed. This allows you to ensure the authenticity of the message. If Adam wants to send a message to Scott, and Scott wants to be sure that it is from Adam, Adam can sign the message using his private key. Scott can then verify that the message is from Adam by using his public key.
			</p><section class="section" id="ws_security_applying"><div class="titlepage"><div><div><h3 class="title">3.8.1. Applying Web Services Security (WS-Security)</h3></div></div></div><p>
					Web services support many real-world scenarios requiring WS-Security functionality. These scenarios include signature and encryption support through X509 certificates, authentication and authorization through username tokens, and all WS-Security configurations covered by the WS-SecurityPolicy specification.
				</p><p>
					For other WS-* features, the core of WS-Security functionality is provided through the Apache CXF engine. In addition, the JBossWS integration adds a few configuration enhancements to simplify the setup of WS-Security enabled endpoints.
				</p><section class="section" id="ws_security_cxf"><div class="titlepage"><div><div><h4 class="title">3.8.1.1. Apache CXF WS-Security Implementation</h4></div></div></div><p>
						Apache CXF features a WS-Security module that supports multiple configurations and is easily extendible.
					</p><p>
						The system is based on <span class="emphasis"><em>interceptors</em></span> that delegate to Apache WSS4J for the low-level security operations. Interceptors can be configured in different ways, either through Spring configuration files or directly using the Apache CXF client API.
					</p><p>
						Recent versions of Apache CXF introduced support for WS-SecurityPolicy, which aims at moving most of the security configuration into the service contract, through policies, so that clients can be easily configured almost completely automatically from that. This way users do not need to manually deal with configuring and installing the required interceptors; the Apache CXF WS-Policy engine internally takes care of that instead.
					</p></section><section class="section" id="ws_security_policy_support"><div class="titlepage"><div><div><h4 class="title">3.8.1.2. WS-Security Policy Support</h4></div></div></div><p>
						WS-SecurityPolicy describes the actions that are required to securely communicate with a service advertised in a given WSDL contract. The WSDL bindings and operations reference WS-Policy fragments with the security requirements to interact with the service. The WS-SecurityPolicy specification allows for specifying things such as asymmetric and symmetric keys, using transports (HTTPS) for encryption, which parts or headers to encrypt or sign, whether to sign then encrypt or encrypt then sign, whether to include timestamps, whether to use derived keys, or something else.
					</p><p>
						However some mandatory configuration elements are not covered by WS-SecurityPolicy because they are not meant to be public or part of the published endpoint contract. These include things such as keystore locations, and usernames and passwords. Apache CXF allows configuring these elements either through Spring XML descriptors or using the client API or annotations.
					</p><div class="table" id="idm139695808409600"><p class="title"><strong>Table 3.4. Supported Configuration Properties</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"><!--Empty--></col><col style="width: 50%; " class="col_2"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139695808404752" scope="col">Configuration property</th><th align="left" valign="top" id="idm139695808403664" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139695808404752"> <p>
										ws-security.username
									</p>
									 </td><td align="left" valign="top" headers="idm139695808403664"> <p>
										The username used for <code class="literal">UsernameToken</code> policy assertions.
									</p>
									 </td></tr><tr><td align="left" valign="top" headers="idm139695808404752"> <p>
										ws-security.password
									</p>
									 </td><td align="left" valign="top" headers="idm139695808403664"> <p>
										The password used for <code class="literal">UsernameToken</code> policy assertions. If not specified, the callback handler will be called.
									</p>
									 </td></tr><tr><td align="left" valign="top" headers="idm139695808404752"> <p>
										ws-security.callback-handler
									</p>
									 </td><td align="left" valign="top" headers="idm139695808403664"> <p>
										The WSS4J security <code class="literal">CallbackHandler</code> that will be used to retrieve passwords for keystores and <code class="literal">UsernameToken</code>.
									</p>
									 </td></tr><tr><td align="left" valign="top" headers="idm139695808404752"> <p>
										ws-security.signature.properties
									</p>
									 </td><td align="left" valign="top" headers="idm139695808403664"> <p>
										The properties file/object that contains the WSS4J properties for configuring the signature keystore and crypto objects.
									</p>
									 </td></tr><tr><td align="left" valign="top" headers="idm139695808404752"> <p>
										ws-security.encryption.properties
									</p>
									 </td><td align="left" valign="top" headers="idm139695808403664"> <p>
										The properties file/object that contains the WSS4J properties for configuring the encryption keystore and crypto objects.
									</p>
									 </td></tr><tr><td align="left" valign="top" headers="idm139695808404752"> <p>
										ws-security.signature.username
									</p>
									 </td><td align="left" valign="top" headers="idm139695808403664"> <p>
										The username or alias for the key in the signature keystore that will be used. If not specified, it uses the default alias set in the properties file. If that is also not set, and the keystore only contains a single key, that key will be used.
									</p>
									 </td></tr><tr><td align="left" valign="top" headers="idm139695808404752"> <p>
										ws-security.encryption.username
									</p>
									 </td><td align="left" valign="top" headers="idm139695808403664"> <p>
										The username or alias for the key in the encryption keystore that will be used. If not specified, it uses the default alias set in the properties file. If that is also not set, and the keystore only contains a single key, that key will be used. For the web service provider, the <code class="literal">useReqSigCert</code> keyword can be used to accept (encrypt) any client whose public key is in the service’s truststore (defined in <code class="literal">ws-security.encryption.properties</code>).
									</p>
									 </td></tr><tr><td align="left" valign="top" headers="idm139695808404752"> <p>
										ws-security.signature.crypto
									</p>
									 </td><td align="left" valign="top" headers="idm139695808403664"> <p>
										Instead of specifying the signature properties, this can point to the full WSS4J <code class="literal">Crypto</code> object. This can allow easier programmatic configuration of the crypto information.
									</p>
									 </td></tr><tr><td align="left" valign="top" headers="idm139695808404752"> <p>
										ws-security.encryption.crypto
									</p>
									 </td><td align="left" valign="top" headers="idm139695808403664"> <p>
										Instead of specifying the encryption properties, this can point to the full WSS4J <code class="literal">Crypto</code> object. This can allow easier programmatic configuration of the crypto information.
									</p>
									 </td></tr><tr><td align="left" valign="top" headers="idm139695808404752"> <p>
										ws-security.enable.streaming
									</p>
									 </td><td align="left" valign="top" headers="idm139695808403664"> <p>
										Enable streaming (StAX based) processing of WS-Security messages.
									</p>
									 </td></tr></tbody></table></div></div></section></section><section class="section" id="about_ws_trust"><div class="titlepage"><div><div><h3 class="title">3.8.2. WS-Trust</h3></div></div></div><p>
					WS-Trust is a web service specification that defines extensions to WS-Security. It is a general framework for implementing security in a distributed system. The standard is based on a centralized Security Token Service (STS), which is capable of authenticating clients and issuing tokens containing various types of authentication and authorization data. The specification describes a protocol used for issuance, exchange, and validation of security tokens. The following specifications play an important role in the WS-Trust architecture:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							WS-SecurityPolicy 1.2
						</li><li class="listitem">
							SAML 2.0
						</li><li class="listitem">
							Username Token Profile
						</li><li class="listitem">
							X.509 Token Profile
						</li><li class="listitem">
							SAML Token Profile
						</li><li class="listitem">
							Kerberos Token Profile
						</li></ul></div><p>
					The WS-Trust extensions address the needs of applications that span multiple domains and requires the sharing of security keys. This occurs by providing a standards-based trusted third party web service (STS) to broker trust relationships between a web service requester and a web service provider. This architecture also alleviates the pain of service updates that require credential changes by providing a common location for this information. The STS is the common access point from which both the requester and provider retrieves and verifies security tokens.
				</p><p>
					There are three main components of the WS-Trust specification:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							The Security Token Service (STS) for issuing, renewing, and validating security tokens.
						</li><li class="listitem">
							The message formats for security token requests and responses.
						</li><li class="listitem">
							The mechanisms for key exchange.
						</li></ul></div><p>
					The following section explains a basic WS-Trust scenario. For advanced scenarios, see <a class="link" href="#advanced_trust_scenarios" title="A.8. Advanced WS-Trust Scenarios">Advanced WS-Trust Scenarios</a>.
				</p><section class="section" id="ws_trust_scenario"><div class="titlepage"><div><div><h4 class="title">3.8.2.1. Scenario: Basic WS-Trust</h4></div></div></div><p>
						In this section we provide an example of a basic WS-Trust scenario. It comprises a web service requester (<code class="literal">ws-requester</code>), a web service provider (<code class="literal">ws-provider</code>), and a Security Token Service (STS).
					</p><p>
						The <code class="literal">ws-provider</code> requires SAML 2.0 token issued from a designated STS to be presented by the <code class="literal">ws-requester</code> using asymmetric binding. These communication requirements are declared in the WSDL of the <code class="literal">ws-provider</code>. STS requires <code class="literal">ws-requester</code> credentials to be provided in a WSS UsernameToken format request using symmetric binding. The response from STS is provided containing SAML 2.0 token. These communication requirements are declared in the WSDL of the STS.
					</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
								The <code class="literal">ws-requester</code> contacts the <code class="literal">ws-provider</code> and consumes its WSDL. On finding the security token issuer requirement, the <code class="literal">ws-requester</code> creates and configures the <code class="literal">STSClient</code> with the information required to generate a valid request.
							</li><li class="listitem">
								The <code class="literal">STSClient</code> contacts the STS and consumes its WSDL. The security policies are discovered. The <code class="literal">STSClient</code> creates and sends an authentication request with appropriate credentials.
							</li><li class="listitem">
								The STS verifies the credentials.
							</li><li class="listitem">
								In response, the STS issues a security token that provides proof that the <code class="literal">ws-requester</code> has authenticated with the STS.
							</li><li class="listitem">
								The <code class="literal">STSClient</code> presents a message with the security token to the <code class="literal">ws-provider</code>.
							</li><li class="listitem">
								The <code class="literal">ws-provider</code> verifies that the token was issued by the STS, and hence proves that the <code class="literal">ws-requester</code> has successfully authenticated with the STS.
							</li><li class="listitem">
								The <code class="literal">ws-provider</code> executes the requested service and returns the results to the <code class="literal">ws-requester</code>.
							</li></ol></div></section><section class="section" id="ws_trust_sts_apache_CXF_support"><div class="titlepage"><div><div><h4 class="title">3.8.2.2. Apache CXF Support</h4></div></div></div><p>
						Apache CXF is an open-source, fully-featured web services framework. The JBossWS open source project integrates the JBoss Web Services (JBossWS) stack with the Apache CXF project modules to provide WS-Trust and other JAX-WS functionality. This integration helps in easy deployment of Apache CXF STS implementations. The Apache CXF API also provides a <code class="literal">STSClient</code> utility to facilitate web service requester communication with its STS.
					</p></section></section><section class="section" id="about_sts"><div class="titlepage"><div><div><h3 class="title">3.8.3. Security Token Service (STS)</h3></div></div></div><p>
					The Security Token Service (STS) is the core of the WS-Trust specification. It is a standards-based mechanism for authentication and authorization. The STS is an implementation of the WS-Trust specification’s protocol for issuing, exchanging, and validating security tokens, based on token format, namespace, or trust boundaries. The STS is a web service that acts as a trusted third party to broker trust relationships between a web service requester and a web service provider. It is a common access point trusted by both requester and provider to provide interoperable security tokens. It removes the need for a direct relationship between the requestor and provider. The STS helps ensure interoperability across realms and between different platforms because it is a standards-based mechanism for authentication.
				</p><p>
					The STS’s WSDL contract defines how other applications and processes interact with it. In particular, the WSDL defines the WS-Trust and WS-Security policies that a requester must fulfill to successfully communicate with the STS’s endpoints. A web service requester consumes the STS’s WSDL and, with the aid of an <code class="literal">STSClient</code> utility, generates a message request compliant with the stated security policies and submits it to the STS endpoint. The STS validates the request and returns an appropriate response.
				</p><section class="section" id="setting_up_plink_sts_idp"><div class="titlepage"><div><div><h4 class="title">3.8.3.1. Configuring a PicketLink WS-Trust Security Token Service (STS)</h4></div></div></div><p>
						PicketLink STS provides options for building an alternative to the Apache CXF Security Token Service implementation. You can also use PicketLink to configure SAML SSO for web applications. For more details on configuring SAML SSO using PicketLink, see <a class="link mimir-link-warn" href="https://access.redhat.com/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/how_to_set_up_sso_with_saml_v2/" title="This content is not included in Mimir."><span class="emphasis"><em>How To Set Up SSO with SAML v2</em></span></a>.
					</p><p>
						To set up an application to serve as a PicketLink WS-Trust STS, the following steps must be performed:
					</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
								Create a security domain for the WS-Trust STS application.
							</li><li class="listitem">
								Configure the <code class="literal">web.xml</code> file for the WS-Trust STS application.
							</li><li class="listitem">
								Configure the authenticator for the WS-Trust STS application.
							</li><li class="listitem">
								Declare the necessary dependencies for the WS-Trust STS application.
							</li><li class="listitem">
								Configure the web-service portion of the WS-Trust STS application.
							</li><li class="listitem">
								Create and configure a <code class="literal">picketlink.xml</code> file for the WS-Trust STS application.
							</li></ol></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							The security domain should be created and configured before creating and deploying the application.
						</p></div></div><section class="section" id="create_a_security_domain_for_the_sts"><div class="titlepage"><div><div><h5 class="title">3.8.3.1.1. Create a Security Domain for the STS</h5></div></div></div><p>
							The STS handles authentication of a principal based on the credentials provided and issues the proper security token based on that result. This requires that an identity store be configured via a security domain. The only requirement around creating this security domain and identity store is that it has authentication and authorization mechanisms properly defined. This means that many different identity stores, for example properties files, database, and LDAP, and their associated login modules could be used to support an STS application. For more information on security domains, see the <span class="emphasis"><em>Security Domains</em></span> section of the <a class="link mimir-link-warn" href="https://access.redhat.com/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/security_architecture/#security_domains" title="This content is not included in Mimir.">JBoss EAP <span class="emphasis"><em>Security Architecture</em></span></a> documentation.
						</p><p>
							In the below example, a simple <code class="literal">UsersRoles</code> login module using properties files for an identity store is used.
						</p><div class="formalpara"><p class="title"><strong>CLI Commands for Creating a Security Domain</strong></p><p>
								
<pre class="screen">/subsystem=security/security-domain=sts:add(cache-type=default)</pre>

							</p></div><pre class="screen">/subsystem=security/security-domain=sts/authentication=classic:add</pre><pre class="screen">/subsystem=security/security-domain=sts/authentication=classic/login-module=UsersRoles:add(code=UsersRoles,flag=required,module-options=[usersProperties=${jboss.server.config.dir}/sts-users.properties,rolesProperties=${jboss.server.config.dir}/sts-roles.properties])</pre><pre class="screen">reload</pre><div class="formalpara"><p class="title"><strong>Resulting XML</strong></p><p>
								
<pre class="programlisting language-xml">&lt;security-domain name="sts" cache-type="default"&gt;
  &lt;authentication&gt;
    &lt;login-module code="UsersRoles" flag="required"&gt;
      &lt;module-option name="usersProperties" value="${jboss.server.config.dir}/sts-users.properties"/&gt;
      &lt;module-option name="rolesProperties" value="${jboss.server.config.dir}/sts-roles.properties"/&gt;
    &lt;/login-module&gt;
  &lt;/authentication&gt;
&lt;/security-domain&gt;</pre>

							</p></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								The management CLI commands shown assume that you are running a JBoss EAP standalone server. For more details on using the management CLI for a JBoss EAP managed domain, see the JBoss EAP <a class="link mimir-link-warn" href="https://access.redhat.com/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/management_cli_guide/" title="This content is not included in Mimir."><span class="emphasis"><em>Management CLI Guide</em></span></a>.
							</p></div></div><div class="formalpara"><p class="title"><strong>Property Files</strong></p><p>
								The <code class="literal">UsersRoles</code> login module utilizes properties files to store the user/password and user/role information. For more specifics of the <code class="literal">UsersRoles</code> module, please see the <a class="link mimir-link-warn" href="https://access.redhat.com/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/login_module_reference/#usersroles_login_module" title="This content is not included in Mimir.">JBoss EAP <span class="emphasis"><em>Login Module Reference</em></span></a>. In this example, the properties files contain the following:
							</p></div><div class="formalpara"><p class="title"><strong>Example: <code class="literal">sts-users.properties</code> File</strong></p><p>
								
<pre class="screen">Eric=samplePass
Alan=samplePass</pre>

							</p></div><div class="formalpara"><p class="title"><strong>Example: <code class="literal">sts-roles.properties</code> File</strong></p><p>
								
<pre class="screen">Eric=All
Alan=</pre>

							</p></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
								You also need to create a keystore for signing and encrypting the security tokens. This keystore will be used when configuring the <code class="literal">picketlink.xml</code> file.
							</p></div></div></section><section class="section" id="configure_the_web_xml_file_for_the_sts"><div class="titlepage"><div><div><h5 class="title">3.8.3.1.2. Configure the web.xml File for the STS</h5></div></div></div><p>
							The <code class="literal">web.xml</code> file for an STS should contain the following:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									A <code class="literal">&lt;servlet&gt;</code> to enable the STS functionality and a <code class="literal">&lt;servlet-mapping&gt;</code> to map its URL.
								</li><li class="listitem">
									A <code class="literal">&lt;security-constraint&gt;</code> with a <code class="literal">&lt;web-resource-collection&gt;</code> containing a <code class="literal">&lt;url-pattern&gt;</code> that maps to the URL pattern of the secured area. Optionally, <code class="literal">&lt;security-constraint&gt;</code> may also contain an <code class="literal">&lt;auth-constraint&gt;</code> stipulating the allowed roles.
								</li><li class="listitem">
									A <code class="literal">&lt;login-config&gt;</code> configured for BASIC authentication.
								</li><li class="listitem">
									If any roles were specified in the <code class="literal">&lt;auth-constraint&gt;</code>, those roles should be defined in a <code class="literal">&lt;security-role&gt;</code>.
								</li></ul></div><div class="formalpara"><p class="title"><strong>Example <code class="literal">web.xml</code> file:</strong></p><p>
								
<pre class="programlisting language-xml">&lt;web-app&gt;
  &lt;!-- Define STS servlet --&gt;
  &lt;servlet&gt;
    &lt;servlet-name&gt;STS-servlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;com.example.sts.PicketLinkSTService&lt;/servlet-class&gt;
  &lt;/servlet&gt;
  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;STS-servlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
  &lt;!-- Define a security constraint that requires the All role to access resources --&gt;
  &lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
      &lt;web-resource-name&gt;STS&lt;/web-resource-name&gt;
      &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
      &lt;role-name&gt;All&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
  &lt;/security-constraint&gt;
  &lt;!-- Define the Login Configuration for this Application --&gt;
  &lt;login-config&gt;
    &lt;auth-method&gt;BASIC&lt;/auth-method&gt;
    &lt;realm-name&gt;STS Realm&lt;/realm-name&gt;
  &lt;/login-config&gt;
  &lt;!-- Security roles referenced by this web application --&gt;
  &lt;security-role&gt;
    &lt;description&gt;The role that is required to log in to the IDP Application&lt;/description&gt;
    &lt;role-name&gt;All&lt;/role-name&gt;
  &lt;/security-role&gt;
&lt;/web-app&gt;</pre>

							</p></div></section><section class="section" id="configure_the_authenticator_for_the_sts"><div class="titlepage"><div><div><h5 class="title">3.8.3.1.3. Configure the Authenticator for the STS</h5></div></div></div><p>
							The authenticator is responsible for the authentication of users for issuing and validating security tokens. The authenticator is configured by defining the security domain to be used in authenticating and authorizing principals.
						</p><p>
							The <code class="literal">jboss-web.xml</code> file should have the following:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									A <code class="literal">&lt;security-domain&gt;</code> to specify which security domain to use for authentication and authorization.
								</li></ul></div><div class="formalpara"><p class="title"><strong>Example: <code class="literal">jboss-web.xml</code> File</strong></p><p>
								
<pre class="programlisting language-xml">&lt;jboss-web&gt;
  &lt;security-domain&gt;sts&lt;/security-domain&gt;
  &lt;context-root&gt;SecureTokenService&lt;/context-root&gt;
&lt;/jboss-web&gt;</pre>

							</p></div></section><section class="section" id="declare_the_necessary_dependencies_for_the_sts"><div class="titlepage"><div><div><h5 class="title">3.8.3.1.4. Declare the Necessary Dependencies for the STS</h5></div></div></div><p>
							The web application serving as the STS requires a dependency to be defined in the <code class="literal">jboss-deployment-structure.xml</code> file so that the <code class="literal">org.picketlink</code> classes can be located. As JBoss EAP provides all necessary <code class="literal">org.picketlink</code> and related classes, the application just needs to declare them as dependencies to use them.
						</p><div class="formalpara"><p class="title"><strong>Example: Using <code class="literal">jboss-deployment-structure.xml</code> to Declare Dependencies</strong></p><p>
								
<pre class="programlisting language-xml">&lt;jboss-deployment-structure&gt;
  &lt;deployment&gt;
    &lt;dependencies&gt;
      &lt;module name="org.picketlink"/&gt;
    &lt;/dependencies&gt;
  &lt;/deployment&gt;
&lt;/jboss-deployment-structure&gt;</pre>

							</p></div></section><section class="section" id="configure_the_web_service_portion_of_the_sts"><div class="titlepage"><div><div><h5 class="title">3.8.3.1.5. Configure the Web-Service Portion of the STS</h5></div></div></div><p>
							The web application serving as the STS requires that you define a web-service for clients to call to obtain their security tokens. This requires that you define in your WSDL a service name called <code class="literal">PicketLinkSTS</code>, and a port called <code class="literal">PicketLinkSTSPort</code>. You can, however, change the SOAP address to better reflect your target deployment environment.
						</p><div class="formalpara"><p class="title"><strong>Example: <code class="literal">PicketLinkSTS.wsdl</code> File</strong></p><p>
								
<pre class="programlisting language-xml">&lt;?xml version="1.0"?&gt;
&lt;wsdl:definitions name="PicketLinkSTS" targetNamespace="urn:picketlink:identity-federation:sts"
	xmlns:tns="urn:picketlink:identity-federation:sts"
	xmlns:xsd="http://www.w3.org/2001/XMLSchema"
	xmlns:wsdl="http://schemas.xmlsoap.org/wsdl/"
	xmlns:wsap10="http://www.w3.org/2006/05/addressing/wsdl"
	xmlns:soap12="http://schemas.xmlsoap.org/wsdl/soap12/"&gt;
  &lt;wsdl:types&gt;
    &lt;xs:schema targetNamespace="urn:picketlink:identity-federation:sts"
      xmlns:tns="urn:picketlink:identity-federation:sts"
      xmlns:xs="http://www.w3.org/2001/XMLSchema"
      version="1.0" elementFormDefault="qualified"&gt;
      &lt;xs:element name="MessageBody"&gt;
        &lt;xs:complexType&gt;
          &lt;xs:sequence&gt;
            &lt;xs:any minOccurs="0" maxOccurs="unbounded" namespace="##any"/&gt;
          &lt;/xs:sequence&gt;
        &lt;/xs:complexType&gt;
      &lt;/xs:element&gt;
    &lt;/xs:schema&gt;
  &lt;/wsdl:types&gt;
  &lt;wsdl:message name="RequestSecurityToken"&gt;
    &lt;wsdl:part name="rstMessage" element="tns:MessageBody"/&gt;
  &lt;/wsdl:message&gt;
  &lt;wsdl:message name="RequestSecurityTokenResponse"&gt;
    &lt;wsdl:part name="rstrMessage" element="tns:MessageBody"/&gt;
  &lt;/wsdl:message&gt;
  &lt;wsdl:portType name="SecureTokenService"&gt;
    &lt;wsdl:operation name="IssueToken"&gt;
      &lt;wsdl:input wsap10:Action="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/Issue" message="tns:RequestSecurityToken"/&gt;
      &lt;wsdl:output wsap10:Action="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RSTR/Issue" message="tns:RequestSecurityTokenResponse"/&gt;
    &lt;/wsdl:operation&gt;
  &lt;/wsdl:portType&gt;
  &lt;wsdl:binding name="STSBinding" type="tns:SecureTokenService"&gt;
    &lt;soap12:binding transport="http://schemas.xmlsoap.org/soap/http"/&gt;
    &lt;wsdl:operation name="IssueToken"&gt;
      &lt;soap12:operation soapAction="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/Issue" style="document"/&gt;
      &lt;wsdl:input&gt;
        &lt;soap12:body use="literal"/&gt;
      &lt;/wsdl:input&gt;
      &lt;wsdl:output&gt;
        &lt;soap12:body use="literal"/&gt;
      &lt;/wsdl:output&gt;
    &lt;/wsdl:operation&gt;
  &lt;/wsdl:binding&gt;
  &lt;wsdl:service name="PicketLinkSTS"&gt;
    &lt;wsdl:port name="PicketLinkSTSPort" binding="tns:STSBinding"&gt;
      &lt;soap12:address location="http://localhost:8080/SecureTokenService/PicketLinkSTS"/&gt;
    &lt;/wsdl:port&gt;
  &lt;/wsdl:service&gt;
&lt;/wsdl:definitions&gt;</pre>

							</p></div><p>
							In addition, you need a class for your web-service to use your WSDL:
						</p><div class="formalpara"><p class="title"><strong>Example: <code class="literal">PicketLinkSTS</code> Class</strong></p><p>
								
<pre class="programlisting language-java">@WebServiceProvider(serviceName = "PicketLinkSTS", portName = "PicketLinkSTSPort", targetNamespace = "urn:picketlink:identity-federation:sts", wsdlLocation = "WEB-INF/wsdl/PicketLinkSTS.wsdl")
@ServiceMode(value = Service.Mode.MESSAGE)
public class PicketLinkSTService extends PicketLinkSTS {
    private static Logger log = Logger.getLogger(PicketLinkSTService.class.getName());

    @Resource
    public void setWSC(WebServiceContext wctx) {
        log.debug("Setting WebServiceContext = " + wctx);
        this.context = wctx;
    }
}</pre>

							</p></div></section><section class="section" id="create_and_configure_a_picketlink_xml_file_for_the_sts"><div class="titlepage"><div><div><h5 class="title">3.8.3.1.6. Create and Configure a picketlink.xml File for the STS</h5></div></div></div><p>
							The <code class="literal">picketlink.xml</code> file is responsible for the behavior of the authenticator and is loaded at the application’s startup.
						</p><p>
							The JBoss EAP Security Token Service defines several interfaces that provide extension points. Implementations can be plugged in and the default values can be specified for some properties using configuration. Similar to the <a class="link mimir-link-warn" href="https://access.redhat.com/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/how_to_set_up_sso_with_saml_v2/#setting_up_idp" title="This content is not included in Mimir.">IDP</a> and <a class="link mimir-link-warn" href="https://access.redhat.com/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/how_to_set_up_sso_with_saml_v2/#setting_up_sp" title="This content is not included in Mimir.">SP</a> configuration in <a class="link mimir-link-warn" href="https://access.redhat.com/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/how_to_set_up_sso_with_saml_v2/" title="This content is not included in Mimir."><span class="emphasis"><em>How To Set Up SSO with SAML v2</em></span></a>, all STS configurations are specified in the <code class="literal">picketlink.xml</code> file of the deployed application. The following are the elements that can be configured in the <code class="literal">picketlink.xml</code> file.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								In the following text, a service provider refers to the web service that requires a security token to be presented by its clients.
							</p></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
									<code class="literal">&lt;PicketLinkSTS&gt;</code>: This is the root element. It defines some properties that allow the STS administrator to set the following properties:
								</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
											<code class="literal">STSName</code>: A string representing the name of the security token service. If not specified, the default <code class="literal">PicketLinkSTS</code> value is used.
										</li><li class="listitem">
											<code class="literal">TokenTimeout</code>: The token lifetime value in seconds. If not specified, the default value of <code class="literal">3600</code> (one hour) is used.
										</li><li class="listitem">
											<code class="literal">EncryptToken</code>: A boolean specifying whether issued tokens are to be encrypted or not. The default value is <code class="literal">false</code>.
										</li></ul></div></li><li class="listitem">
									<code class="literal">&lt;KeyProvider&gt;</code>: This element and all its subelements are used to configure the keystore that are used by PicketLink STS to sign and encrypt tokens. Properties like the keystore location, its password, and the signing (private key) alias and password are all configured in this section.
								</li><li class="listitem">
									<code class="literal">&lt;TokenProviders&gt;</code>: This section specifies the <code class="literal">TokenProvider</code> implementations that must be used to handle each type of security token. In the example we have two providers - one that handles tokens of type <code class="literal">SAMLV1.1</code> and one that handles tokens of type <code class="literal">SAMLV2.0</code>. The <code class="literal">WSTrustRequestHandler</code> calls the <code class="literal">getProviderForTokenType(String type)</code> method of <code class="literal">STSConfiguration</code> to obtain a reference to the appropriate <code class="literal">TokenProvider</code>.
								</li><li class="listitem">
									<code class="literal">&lt;ServiceProviders&gt;</code>: This section specifies the token types that must be used for each service provider, the web service that requires a security token. When a WS-Trust request does not contain the token type, the <code class="literal">WSTrustRequestHandler</code> must use the service provider endpoint to find out the type of the token that must be issued.
								</li></ul></div><div class="formalpara"><p class="title"><strong>Example: <code class="literal">picketlink.xml</code> Configuration File</strong></p><p>
								
<pre class="programlisting language-xml">&lt;!DOCTYPE PicketLinkSTS&gt;
&lt;PicketLinkSTS xmlns="urn:picketlink:federation:config:2.1"
               STSName="PicketLinkSTS" TokenTimeout="7200" EncryptToken="false"&gt;
    &lt;KeyProvider
            ClassName="org.picketlink.identity.federation.core.impl.KeyStoreKeyManager"&gt;
        &lt;Auth Key="KeyStoreURL" Value="sts_keystore.jks"/&gt;
        &lt;Auth Key="KeyStorePass" Value="testpass"/&gt;
        &lt;Auth Key="SigningKeyAlias" Value="sts"/&gt;
        &lt;Auth Key="SigningKeyPass" Value="keypass"/&gt;
        &lt;ValidatingAlias Key="http://services.testcorp.org/provider1"
                         Value="service1"/&gt;
    &lt;/KeyProvider&gt;
    &lt;TokenProviders&gt;
        &lt;TokenProvider
                ProviderClass="org.picketlink.identity.federation.core.wstrust.plugins.saml.SAML11TokenProvider"
                TokenType="http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV1.1"
                TokenElement="Assertion" TokenElementNS="urn:oasis:names:tc:SAML:1.0:assertion"/&gt;
        &lt;TokenProvider
                ProviderClass="org.picketlink.identity.federation.core.wstrust.plugins.saml.SAML20TokenProvider"
                TokenType="http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV2.0"
                TokenElement="Assertion" TokenElementNS="urn:oasis:names:tc:SAML:2.0:assertion"/&gt;
    &lt;/TokenProviders&gt;
    &lt;ServiceProviders&gt;
        &lt;ServiceProvider Endpoint="http://services.testcorp.org/provider1"
                         TokenType="http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV2.0"
                         TruststoreAlias="service1"/&gt;
    &lt;/ServiceProviders&gt;
&lt;/PicketLinkSTS&gt;</pre>

							</p></div><p>
							By default, the <code class="literal">picketlink.xml</code> file is located in the <code class="literal">WEB-INF/classes</code> directory of the STS web application. The PicketLink configuration file can also be loaded from the file system. To load the PicketLink configuration file from the file system, it must be named <code class="literal">picketlink-sts.xml</code> and be located in the <code class="literal">${user.home}/picketlink-store/sts/</code> directory.
						</p></section></section><section class="section" id="configure-sts-client-server"><div class="titlepage"><div><div><h4 class="title">3.8.3.2. Using a WS-Trust Security Token Service (STS) with a Client</h4></div></div></div><p>
						To configure a client to obtain a security token from the STS, you need to make use of the <code class="literal">org.picketlink.identity.federation.api.wstrust.WSTrustClient</code> class to connect to the STS and ask for a token to be issued.
					</p><p>
						First you need to instantiate the client:
					</p><div class="formalpara"><p class="title"><strong>Example: Creating a WSTrustClient</strong></p><p>
							
<pre class="programlisting language-java"> WSTrustClient client = new WSTrustClient("PicketLinkSTS", "PicketLinkSTSPort",
       "http://localhost:8080/SecureTokenService/PicketLinkSTS",
       new SecurityInfo(username, password));</pre>

						</p></div><p>
						Next you need to use the <code class="literal">WSTrustClient</code> to ask for a token, for example a SAML assertion, to be issued:
					</p><div class="formalpara"><p class="title"><strong>Example: Obtaining an Assertion</strong></p><p>
							
<pre class="programlisting language-java">org.w3c.dom.Element assertion = null;
try {
   assertion = client.issueToken(SAMLUtil.SAML2_TOKEN_TYPE);
} catch (WSTrustException wse) {
   System.out.println("Unable to issue assertion: " + wse.getMessage());
   wse.printStackTrace();
}</pre>

						</p></div><p>
						Once you have the assertion, there are two ways by which it can be included in and sent via the SOAP message:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								The client can push the SAML2 <code class="literal">Assertion</code> into the SOAP <code class="literal">MessageContext</code> under the key <code class="literal">org.picketlink.trust.saml.assertion</code>. For example:
							</p><pre class="programlisting language-java">bindingProvider.getRequestContext().put(SAML2Constants.SAML2_ASSERTION_PROPERTY, assertion);</pre></li><li class="listitem">
								The SAML2 <code class="literal">Assertion</code> is available as part of the JAAS subject on the security context. This can happen if there has been a JAAS interaction with the usage of PicketLink STS login modules.
							</li></ul></div></section><section class="section" id="sts-client-pools"><div class="titlepage"><div><div><h4 class="title">3.8.3.3. STS Client Pooling</h4></div></div></div><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
							The STS client pooling feature is <span class="emphasis"><em>NOT</em></span> supported in JBoss EAP.
						</p></div></div><p>
						STS client pooling is a feature that allows you to configure a pool of STS clients on the server, thereby eliminating a possible bottleneck of STS client creation. Client pooling can be used for login modules that need an STS client to obtain SAML tickets. These include:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<code class="literal">org.picketlink.identity.federation.core.wstrust.auth.STSIssuingLoginModule</code>
							</li><li class="listitem">
								<code class="literal">org.picketlink.identity.federation.core.wstrust.auth.STSValidatingLoginModule</code>
							</li><li class="listitem">
								<code class="literal">org.picketlink.trust.jbossws.jaas.JBWSTokenIssuingLoginModule</code>
							</li></ul></div><p>
						The default number of clients in the pool for each login module is configured using the <code class="literal">initialNumberOfClients</code> login module option.
					</p><p>
						The <code class="literal">org.picketlink.identity.federation.bindings.stspool.STSClientPoolFactory</code> class provides client pool functionality to applications.
					</p><h5 id="using_stsclientpoolfactory">Using STSClientPoolFactory</h5><p>
						STS clients are inserted into subpools using their <a class="link mimir-link-warn" href="http://docs.jboss.org/jbossas/javadoc/7.1.2.Final/org/picketlink/identity/federation/core/wstrust/class-use/STSClientConfig.html" title="Mimir does not include content from: docs.jboss.org">STSClientConfig</a> configuration as a key. To insert an STS client into a subpool, you need to obtain the <code class="literal">STSClientPool</code> instance and then initialize a subpool based on the configuration. Optionally, you can specify the initial number of STS clients when initializing the pool, or you can rely on the default number.
					</p><div class="formalpara"><p class="title"><strong>Example: Inserting an STS Client into a Subpool</strong></p><p>
							
<pre class="programlisting language-java">final STSClientPool pool = STSClientPoolFactory.getPoolInstance();
pool.createPool(20, stsClientConfig);
final STSClient client = pool.getClient(stsClientConfig);</pre>

						</p></div><p>
						When you are done with a client, you can return it to the pool by calling the <code class="literal">returnClient()</code> method.
					</p><div class="formalpara"><p class="title"><strong>Example: Returning an STS Client to the Subpool</strong></p><p>
							
<pre class="programlisting language-java">pool.returnClient();</pre>

						</p></div><div class="formalpara"><p class="title"><strong>Example: Checking If a Subpool Exists with a Given Configuration</strong></p><p>
							
<pre class="programlisting language-java">if (! pool.configExists(stsClientConfig) {
    pool.createPool(stsClientConfig);
}</pre>

						</p></div><p>
						If the <code class="literal">picketlink-federation</code> subsystem is enabled, all client pools created for a deployment are destroyed automatically during the undeploy process. To manually destroy a pool:
					</p><div class="formalpara"><p class="title"><strong>Example: Manually Destroying a Subpool</strong></p><p>
							
<pre class="programlisting language-java">pool.destroyPool(stsClientConfig);</pre>

						</p></div></section></section><section class="section" id="propagate_authenticated_identity_to_ejb_subsystem"><div class="titlepage"><div><div><h3 class="title">3.8.4. Propagating Authenticated Identity to the EJB Subsystem</h3></div></div></div><p>
					The <code class="literal">webservices</code> subsystem contains an adapter that allows you to configure an Elytron security domain to secure web service endpoints using either annotations or deployment descriptors.
				</p><p>
					When Elytron security is enabled, the JAAS subject or principal can be pushed to the Apache CXF endpoint’s <code class="literal">SecurityContext</code> to propagate the authenticated identity to the EJB container.
				</p><p>
					The following is an example of how to use an Apache CXF interceptor to propagate authenticated information to the EJB container.
				</p><pre class="programlisting language-java">public class PropagateSecurityInterceptor extends WSS4JInInterceptor {
    public PropagateSecurityInterceptor() {
      super();
      getAfter().add(PolicyBasedWSS4JInInterceptor.class.getName());
   }
   @Override
   public void handleMessage(SoapMessage message) throws Fault {
      ...
      final Endpoint endpoint = message.getExchange().get(Endpoint.class);
      final SecurityDomainContext securityDomainContext = endpoint.getSecurityDomainContext();
      //push subject principal retrieved from CXF to ElytronSecurityDomainContext
      securityDomainContext.pushSubjectContext(subject, principal, null)
      }
    }</pre></section></section><section class="section" id="jax_ws_logging"><div class="titlepage"><div><div><h2 class="title">3.9. JAX-WS Logging</h2></div></div></div><p>
				You can handle logging for inbound and outbound messages using <a class="link" href="#jax_ws_logging_handlers" title="3.9.1. Using JAX-WS Handlers">JAX-WS handlers</a> or <a class="link" href="#cxf_logging_interceptors" title="3.9.2. Using Apache CXF Logging Interceptors">Apache CXF logging interceptors</a>.
			</p><section class="section" id="jax_ws_logging_handlers"><div class="titlepage"><div><div><h3 class="title">3.9.1. Using JAX-WS Handlers</h3></div></div></div><p>
					You can configure a JAX-WS handler to log messages that are passed to it. This approach is portable as the handler can be added to the desired client and endpoints programatically by using the <code class="literal">@HandlerChain</code> JAX-WS annotation.
				</p><p>
					The predefined client and endpoint configuration mechanism allows you to add the logging handler to any client and endpoint combination, or to only some of the clients and endpoints. To add the logging handler to only some of the clients or endpoints, use the <code class="literal">@EndpointConfig</code> annotation and the JBossWS API.
				</p><p>
					The <code class="literal">org.jboss.ws.api.annotation.EndpointConfig</code> annotation is used to assign an endpoint configuration to a JAX-WS endpoint implementation. When assigning a configuration that is defined in the <code class="literal">webservices</code> subsystem, only the configuration name is specified. When assigning a configuration that is defined in the application, the relative path to the deployment descriptor and the configuration name must be specified.
				</p></section><section class="section" id="cxf_logging_interceptors"><div class="titlepage"><div><div><h3 class="title">3.9.2. Using Apache CXF Logging Interceptors</h3></div></div></div><p>
					Apache CXF also comes with logging interceptors that can be used to log messages to the console, client log files, or server log files. Those interceptors can be added to client, endpoint, and buses in multiple ways, including:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							System property
						</p><p class="simpara">
							Setting the <code class="literal">org.apache.cxf.logging.enabled</code> system property to <code class="literal">true</code> causes the logging interceptors to be added to any bus instance being created on the JVM. You can also set the system property to <code class="literal">pretty</code> to output nicely-formatted XML output. You can use the following management CLI command to set this system property.
						</p><pre class="screen">/system-property=org.apache.cxf.logging.enabled:add(value=true)</pre></li><li class="listitem"><p class="simpara">
							Manual interceptor addition
						</p><p class="simpara">
							Logging interceptors can be selectively added to endpoints using the Apache CXF annotations <code class="literal">@org.apache.cxf.interceptor.InInterceptors</code> and <code class="literal">@org.apache.cxf.interceptor.OutInterceptors</code>. The same outcome is achieved on the client side by programmatically adding new instances of the logging interceptors to the client or the bus.
						</p></li></ul></div></section></section><section class="section" id="enabling_web_services_addressing_ws_addressing"><div class="titlepage"><div><div><h2 class="title">3.10. Enabling Web Services Addressing (WS-Addressing)</h2></div></div></div><p>
				Web Services Addressing, or WS-Addressing, provides a transport-neutral mechanism to address web services and their associated messages. To enable WS-Addressing, you must add the <code class="literal">@Addressing</code> annotation to the web service endpoint and then configure the client to access it.
			</p><p>
				The following examples assume your application has an existing JAX-WS service and client configuration. See the <code class="literal">jaxws-addressing</code> quickstart that ships with JBoss EAP for a complete working example.
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Add the <code class="literal">@Addressing</code> annotation to the application’s JAX-WS endpoint code.
					</p><div class="formalpara"><p class="title"><strong>Example: JAX-WS Endpoint with @Addressing Annotation</strong></p><p>
							
<pre class="programlisting language-java">package org.jboss.quickstarts.ws.jaxws.samples.wsa;

import org.jboss.quickstarts.ws.jaxws.samples.wsa.ServiceIface;

import javax.jws.WebService;
import javax.xml.ws.soap.Addressing;

@WebService(
    portName = "AddressingServicePort",
    serviceName = "AddressingService",
    wsdlLocation = "WEB-INF/wsdl/AddressingService.wsdl",
    targetNamespace = "http://www.jboss.org/jbossws/ws-extensions/wsaddressing",
    endpointInterface = "org.jboss.quickstarts.ws.jaxws.samples.wsa.ServiceIface")
@Addressing(enabled = true, required = true)
public class ServiceImpl implements ServiceIface {
    public String sayHello() {
        return "Hello World!";
    }
}</pre>

						</p></div></li><li class="listitem"><p class="simpara">
						Update the JAX-WS client code to configure WS-Addressing.
					</p><div class="formalpara"><p class="title"><strong>Example: JAX-WS Client Configured for WS-Addressing</strong></p><p>
							
<pre class="programlisting language-java">package org.jboss.quickstarts.ws.jaxws.samples.wsa;

import java.net.URL;
import javax.xml.namespace.QName;
import javax.xml.ws.Service;
import javax.xml.ws.soap.AddressingFeature;

public final class AddressingClient {
    private static final String serviceURL =
        "http://localhost:8080/jaxws-addressing/AddressingService";

    public static void main(String[] args) throws Exception {
        // construct proxy
        QName serviceName =
            new QName("http://www.jboss.org/jbossws/ws-extensions/wsaddressing",
                "AddressingService");
        URL wsdlURL = new URL(serviceURL + "?wsdl");
        Service service = Service.create(wsdlURL, serviceName);
        org.jboss.quickstarts.ws.jaxws.samples.wsa.ServiceIface proxy =
            (org.jboss.quickstarts.ws.jaxws.samples.wsa.ServiceIface) service.getPort(org.jboss.quickstarts.ws.jaxws.samples.wsa.ServiceIface.class,
                new AddressingFeature());
        // invoke method
        System.out.println(proxy.sayHello());
    }
}</pre>

						</p></div></li></ol></div><p>
				The client and endpoint now communicate using WS-Addressing.
			</p></section><section class="section" id="ws_msging"><div class="titlepage"><div><div><h2 class="title">3.11. Enabling Web Services Reliable Messaging</h2></div></div></div><p>
				Web Services Reliable Messaging (WS-Reliable Messaging) is implemented internally in Apache CXF. A set of interceptors interacts with the low-level requirements of the reliable messaging protocol.
			</p><p>
				To enable WS-Reliable Messaging, complete one of the following steps:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Consume a WSDL contract that specifies proper WS-Reliable Messaging policies, assertions, or both.
					</li><li class="listitem">
						Manually add and configure the reliable messaging interceptors.
					</li><li class="listitem">
						Specify the reliable messaging policies in an optional CXF Spring XML descriptor.
					</li><li class="listitem">
						Specify the Apache CXF reliable messaging feature in an optional CXF Spring XML descriptor.
					</li></ul></div><p>
				The first approach, which is the only portable approach, relies on the Apache CXF WS-Policy engine. The other approaches, which are proprietary, allow for fine-grained configuration of the protocol aspects that are not covered by the WS-Reliable Messaging Policy.
			</p></section><section class="section" id="ws_policies"><div class="titlepage"><div><div><h2 class="title">3.12. Specifying Web Services Policies</h2></div></div></div><p>
				Web Services Policies (WS-Policy) rely on the Apache CXF WS-Policy framework. This framework is compliant with the following specifications:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<a class="link mimir-link-warn" href="http://www.w3.org/TR/2007/REC-ws-policy-20070904/" title="Mimir does not include content from: www.w3.org">Web Services Policy 1.5 - Framework</a>
					</li><li class="listitem">
						<a class="link mimir-link-warn" href="http://www.w3.org/TR/2007/REC-ws-policy-attach-20070904/" title="Mimir does not include content from: www.w3.org">Web Services Policy 1.5 - Attachment</a>
					</li></ul></div><p>
				You can work with the policies in different ways, including:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Add policy assertions to WSDL contracts and let the runtime consume the assertions and behave accordingly.
					</li><li class="listitem">
						Specify endpoint policy attachments using either CXF annotations or features.
					</li><li class="listitem">
						Use the Apache CXF policy framework to define custom assertions and complete other tasks.
					</li></ul></div></section><section class="section" id="cxf_integration"><div class="titlepage"><div><div><h2 class="title">3.13. Apache CXF Integration</h2></div></div></div><p>
				All JAX-WS functionality provided by JBossWS on top of JBoss EAP is currently served through a proper integration of the JBossWS stack with most of the Apache CXF project modules.
			</p><p>
				Apache CXF is an open source services framework. It allows building and developing services using front-end programming APIs, including JAX-WS, with services speaking a variety of protocols such as SOAP and XML/HTTP over a variety of transports such as HTTP and JMS.
			</p><p>
				The integration layer between JBossWS and Apache CXF is mainly meant for:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Allowing use of standard web services APIs, including JAX-WS, on JBoss EAP; this is performed internally leveraging Apache CXF without requiring the user to deal with it;
					</li><li class="listitem">
						Allowing use of Apache CXF advanced features, including WS-*, on top of JBoss EAP without requiring the user to deal with, set up, or care about the required integration steps for running in such a container.
					</li></ul></div><p>
				In support of those goals, the JBossWS integration with Apache CXF supports the JBossWS endpoint deployment mechanism and comes with many internal customizations on top of Apache CXF.
			</p><p>
				For more in-depth details on the Apache CXF architecture, refer to the <a class="link mimir-link-warn" href="http://cxf.apache.org/docs/index.html" title="Mimir does not include content from: cxf.apache.org">Apache CXF official documentation</a>.
			</p><section class="section" id="cxf_server_side_integration_customization"><div class="titlepage"><div><div><h3 class="title">3.13.1. Server-side Integration Customization</h3></div></div></div><p>
					The JBossWS server-side integration with Apache CXF takes care of internally creating proper Apache CXF structures for the provided web service deployment. If the deployment includes multiple endpoints, they will all exist within the same Apache CXF Bus, which is separate from other deployments' bus instances.
				</p><p>
					While JBossWS sets sensible defaults for most of the Apache CXF configuration options on the server side, users might want to fine-tune the Bus instance that is created for their deployment; a <code class="literal">jboss-webservices.xml</code> descriptor can be used for deployment-level customizations.
				</p><section class="section" id="cxf_deployment_descriptor_properties"><div class="titlepage"><div><div><h4 class="title">3.13.1.1. Deployment Descriptor Properties</h4></div></div></div><p>
						The <code class="literal">jboss-webservices.xml</code> descriptor can be used to provide property values.
					</p><pre class="programlisting language-xml">&lt;webservices xmlns="http://www.jboss.com/xml/ns/javaee" version="1.2"&gt;
  ...
  &lt;property&gt;
    &lt;name&gt;...&lt;/name&gt;
    &lt;value&gt;...&lt;/value&gt;
  &lt;/property&gt;
  ...
&lt;/webservices&gt;</pre><p>
						JBossWS integration with Apache CXF comes with a set of allowed property names to control Apache CXF internals.
					</p></section><section class="section" id="cxf_workqueue_configuration"><div class="titlepage"><div><div><h4 class="title">3.13.1.2. WorkQueue Configuration</h4></div></div></div><p>
						Apache CXF uses <code class="literal">WorkQueue</code> instances for dealing with some operations, for example <code class="literal">@Oneway</code> request processing. A <a class="link mimir-link-warn" href="http://cxf.apache.org/javadoc/latest-3.1.x/org/apache/cxf/workqueue/WorkQueueManager.html" title="Mimir does not include content from: cxf.apache.org"><code class="literal">WorkQueueManager</code></a> is installed in the Bus as an extension and allows for adding or removing queues as well as controlling the existing ones.
					</p><p>
						On the server side, queues can be provided by using the <code class="literal">cxf.queue.&lt;queue-name&gt;.*</code> properties in <code class="literal">jboss-webservices.xml</code>. For example, you can use the <code class="literal">cxf.queue.default.maxQueueSize</code> property to configure the maximum queue size of the default <code class="literal">WorkQueue</code>. At the deployment time, the JBossWS integration can add new instances of <a class="link mimir-link-warn" href="http://cxf.apache.org/javadoc/latest-3.1.x/org/apache/cxf/workqueue/AutomaticWorkQueueImpl.html" title="Mimir does not include content from: cxf.apache.org"><code class="literal">AutomaticWorkQueueImpl</code></a> to the currently configured <code class="literal">WorkQueueManager</code>. The properties below are used to fill in the <a class="link mimir-link-warn" href="http://cxf.apache.org/javadoc/latest-3.1.x/org/apache/cxf/workqueue/AutomaticWorkQueueImpl.html#AutomaticWorkQueueImpl(int,%20int,%20int,%20int,%20long,%20java.lang.String)" title="Mimir does not include content from: cxf.apache.org"><code class="literal">AutomaticWorkQueueImpl</code> constructor</a> parameters:
					</p><div class="table" id="idm139695810569824"><p class="title"><strong>Table 3.5. <code class="literal">AutomaticWorkQueueImpl</code> Constructor Properties</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 80%; " class="col_1"><!--Empty--></col><col style="width: 20%; " class="col_2"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139695810564672" scope="col">Property</th><th align="left" valign="top" id="idm139695810563584" scope="col">Default Value</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139695810564672"> <p>
										cxf.queue.&lt;queue-name&gt;.maxQueueSize
									</p>
									 </td><td align="left" valign="top" headers="idm139695810563584"> <p>
										256
									</p>
									 </td></tr><tr><td align="left" valign="top" headers="idm139695810564672"> <p>
										cxf.queue.&lt;queue-name&gt;.initialThreads
									</p>
									 </td><td align="left" valign="top" headers="idm139695810563584"> <p>
										0
									</p>
									 </td></tr><tr><td align="left" valign="top" headers="idm139695810564672"> <p>
										cxf.queue.&lt;queue-name&gt;.highWaterMark
									</p>
									 </td><td align="left" valign="top" headers="idm139695810563584"> <p>
										25
									</p>
									 </td></tr><tr><td align="left" valign="top" headers="idm139695810564672"> <p>
										cxf.queue.&lt;queue-name&gt;.lowWaterMark
									</p>
									 </td><td align="left" valign="top" headers="idm139695810563584"> <p>
										5
									</p>
									 </td></tr><tr><td align="left" valign="top" headers="idm139695810564672"> <p>
										cxf.queue.&lt;queue-name&gt;.dequeueTimeout
									</p>
									 </td><td align="left" valign="top" headers="idm139695810563584"> <p>
										120000
									</p>
									 </td></tr></tbody></table></div></div></section><section class="section" id="cxf_policy_alternative_selector"><div class="titlepage"><div><div><h4 class="title">3.13.1.3. Policy Alternative Selector</h4></div></div></div><p>
						The Apache CXF policy engine supports different strategies to deal with policy alternatives. JBossWS integration currently defaults to the <a class="link mimir-link-warn" href="http://cxf.apache.org/javadoc/latest-3.1.x/org/apache/cxf/ws/policy/selector/MaximalAlternativeSelector.html" title="Mimir does not include content from: cxf.apache.org"><code class="literal">MaximalAlternativeSelector</code></a>, but still allows for setting different selector implementation using the <code class="literal">cxf.policy.alternativeSelector</code> property in the <code class="literal">jboss-webservices.xml</code> file.
					</p></section><section class="section" id="cxf_mbean_management"><div class="titlepage"><div><div><h4 class="title">3.13.1.4. MBean Management</h4></div></div></div><p>
						Apache CXF allows you to manage its MBean objects that are installed into the JBoss EAP MBean server. You can enable this feature on a deployment basis through the <code class="literal">cxf.management.enabled</code> property in the <code class="literal">jboss-webservices.xml</code> file. You can also use the <code class="literal">cxf.management.installResponseTimeInterceptors</code> property to control installation of the CXF response time interceptors. These interceptors are added by default when enabling the MBean management, but it might not be required in some cases.
					</p><div class="formalpara"><p class="title"><strong>Example: MBean Management in the <code class="literal">jboss-webservices.xml</code> File</strong></p><p>
							
<pre class="programlisting language-xml">&lt;webservices xmlns="http://www.jboss.com/xml/ns/javaee" version="1.2"&gt;
  &lt;property&gt;
    &lt;name&gt;cxf.management.enabled&lt;/name&gt;
    &lt;value&gt;true&lt;/value&gt;
  &lt;/property&gt;
  &lt;property&gt;
    &lt;name&gt;cxf.management.installResponseTimeInterceptors&lt;/name&gt;
    &lt;value&gt;false&lt;/value&gt;
  &lt;/property&gt;
&lt;/webservices&gt;</pre>

						</p></div></section><section class="section" id="cxf_schema_validation"><div class="titlepage"><div><div><h4 class="title">3.13.1.5. Schema Validation</h4></div></div></div><p>
						Apache CXF includes a feature for validating incoming and outgoing SOAP messages on both the client and the server side. The validation is performed against the relevant schema in the endpoint WSDL contract (server side) or the WSDL contract used for building up the service proxy (client side).
					</p><p>
						You can enable schema validation in any of the following ways:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								In the JBoss EAP server configuration.
							</p><p class="simpara">
								For example, the management CLI command below enables schema validation for the default <code class="literal">Standard-Endpoint-Config</code> endpoint configuration.
							</p><pre class="screen">/subsystem=webservices/endpoint-config=Standard-Endpoint-Config/property=schema-validation-enabled:add(value=true)</pre></li><li class="listitem"><p class="simpara">
								In a predefined client or endpoint configuration file.
							</p><p class="simpara">
								You can associate any endpoint or client running in-container to a JBossWS <a class="link" href="#jax_ws_endpoint_configs" title="3.4.1. Endpoint Configurations">predefined configuration</a> by setting the <code class="literal">schema-validation-enabled</code> property to <code class="literal">true</code> in the referenced configuration file.
							</p></li><li class="listitem"><p class="simpara">
								Programmatically on the client side.
							</p><p class="simpara">
								On the client side, you can enable schema validation programmatically. For example:
							</p><pre class="programlisting language-java">((BindingProvider)proxy).getRequestContext().put("schema-validation-enabled", true);</pre></li><li class="listitem"><p class="simpara">
								Using the <code class="literal">@org.apache.cxf.annotations.SchemaValidation</code> annotation on the server side.
							</p><p class="simpara">
								On the server side, you can use the <code class="literal">@org.apache.cxf.annotations.SchemaValidation</code> annotation. For example:
							</p><pre class="programlisting language-java">import javax.jws.WebService;
import org.apache.cxf.annotations.SchemaValidation;

@WebService(...)
@SchemaValidation
public class ValidatingHelloImpl implements Hello {
   ...
}</pre></li></ul></div></section><section class="section" id="cxf-interceptors"><div class="titlepage"><div><div><h4 class="title">3.13.1.6. Apache CXF Interceptors</h4></div></div></div><p>
						The <code class="literal">jboss-webservices.xml</code> descriptor enables specifying the <code class="literal">cxf.interceptors.in</code> and <code class="literal">cxf.interceptors.out</code> properties. These properties allow you to attach the declaring interceptors to the <code class="literal">Bus</code> instance that is created for serving the deployment.
					</p><div class="formalpara"><p class="title"><strong>Example: <code class="literal">jboss-webservices.xml</code> File</strong></p><p>
							
<pre class="programlisting language-xml">&lt;?xml version="1.1" encoding="UTF-8"?&gt;
&lt;webservices
  xmlns="http://www.jboss.com/xml/ns/javaee"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  version="1.2"
  xsi:schemaLocation="http://www.jboss.com/xml/ns/javaee"&gt;

  &lt;property&gt;
    &lt;name&gt;cxf.interceptors.in&lt;/name&gt;
    &lt;value&gt;org.jboss.test.ws.jaxws.cxf.interceptors.BusInterceptor&lt;/value&gt;
  &lt;/property&gt;
  &lt;property&gt;
    &lt;name&gt;cxf.interceptors.out&lt;/name&gt;
    &lt;value&gt;org.jboss.test.ws.jaxws.cxf.interceptors.BusCounterInterceptor&lt;/value&gt;
  &lt;/property&gt;
&lt;/webservices&gt;</pre>

						</p></div><p>
						You can declare interceptors using one of the following approaches:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Annotation usage on endpoint classes, for example <code class="literal">@org.apache.cxf.interceptor.InInterceptor</code> or <code class="literal">@org.apache.cxf.interceptor.OutInterceptor</code>.
							</li><li class="listitem">
								Direct API usage on the client side through the <code class="literal">org.apache.cxf.interceptor.InterceptorProvider</code> interface.
							</li><li class="listitem">
								JBossWS descriptor usage.
							</li></ul></div><p>
						Because Spring integration is no longer supported in JBoss EAP, the JBossWS integration uses the <code class="literal">jaxws-endpoint-config.xml</code> descriptor file to avoid requiring modifications to the actual client or endpoint code. You can declare interceptors within predefined client and endpoint configurations by specifying a list of interceptor class names for the <code class="literal">cxf.interceptors.in</code> and <code class="literal">cxf.interceptors.out</code> properties.
					</p><div class="formalpara"><p class="title"><strong>Example: <code class="literal">jaxws-endpoint-config.xml</code> File</strong></p><p>
							
<pre class="programlisting language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;jaxws-config xmlns="urn:jboss:jbossws-jaxws-config:4.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:javaee="http://java.sun.com/xml/ns/javaee"
  xsi:schemaLocation="urn:jboss:jbossws-jaxws-config:4.0 schema/jbossws-jaxws-config_4_0.xsd"&gt;
  &lt;endpoint-config&gt;
    &lt;config-name&gt;org.jboss.test.ws.jaxws.cxf.interceptors.EndpointImpl&lt;/config-name&gt;
    &lt;property&gt;
      &lt;property-name&gt;cxf.interceptors.in&lt;/property-name&gt;
      &lt;property-value&gt;org.jboss.test.ws.jaxws.cxf.interceptors.EndpointInterceptor,org.jboss.test.ws.jaxws.cxf.interceptors.FooInterceptor&lt;/property-value&gt;
    &lt;/property&gt;
    &lt;property&gt;
      &lt;property-name&gt;cxf.interceptors.out&lt;/property-name&gt;
      &lt;property-value&gt;org.jboss.test.ws.jaxws.cxf.interceptors.EndpointCounterInterceptor&lt;/property-value&gt;
    &lt;/property&gt;
  &lt;/endpoint-config&gt;
&lt;/jaxws-config&gt;</pre>

						</p></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							A new instance of each specified interceptor class will be added to the client or endpoint to which the configuration is assigned. The interceptor classes must have a no-argument constructor.
						</p></div></div></section><section class="section" id="cxf_features"><div class="titlepage"><div><div><h4 class="title">3.13.1.7. Apache CXF Features</h4></div></div></div><p>
						The <code class="literal">jboss-webservices.xml</code> descriptor enables specifying the <code class="literal">cxf.features</code> property. This property allows you to declare features to be attached to any endpoint belonging to the <code class="literal">Bus</code> instance that is created for serving the deployment.
					</p><div class="formalpara"><p class="title"><strong>Example: <code class="literal">jboss-webservices.xml</code> File</strong></p><p>
							
<pre class="programlisting language-xml">&lt;?xml version="1.1" encoding="UTF-8"?&gt;
&lt;webservices
  xmlns="http://www.jboss.com/xml/ns/javaee"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  version="1.2"
  xsi:schemaLocation="http://www.jboss.com/xml/ns/javaee"&gt;

  &lt;property&gt;
    &lt;name&gt;cxf.features&lt;/name&gt;
    &lt;value&gt;org.apache.cxf.feature.FastInfosetFeature&lt;/value&gt;
  &lt;/property&gt;
&lt;/webservices&gt;</pre>

						</p></div><p>
						You can declare features using one of the following approaches:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Annotation usage on endpoint classes, for example <code class="literal">@org.apache.cxf.feature.Features</code>.
							</li><li class="listitem">
								Direct API usage on client side through extensions of the <code class="literal">org.apache.cxf.feature.AbstractFeature</code> class.
							</li><li class="listitem">
								JBossWS descriptor usage.
							</li></ul></div><p>
						Since Spring integration is no longer supported in JBoss EAP, the JBossWS integration adds an additional descriptor, a <code class="literal">jaxws-endpoint-config.xml</code> file-based approach to avoid requiring modifications to the actual client or endpoint code. You can declare features within predefined client and endpoint configurations by specifying a list of feature class names for the <code class="literal">cxf.features</code> property.
					</p><div class="formalpara"><p class="title"><strong>Example: <code class="literal">jaxws-endpoint-config.xml</code> File</strong></p><p>
							
<pre class="programlisting language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;jaxws-config xmlns="urn:jboss:jbossws-jaxws-config:4.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:javaee="http://java.sun.com/xml/ns/javaee"
  xsi:schemaLocation="urn:jboss:jbossws-jaxws-config:4.0 schema/jbossws-jaxws-config_4_0.xsd"&gt;
  &lt;endpoint-config&gt;
    &lt;config-name&gt;Custom FI Config&lt;/config-name&gt;
    &lt;property&gt;
      &lt;property-name&gt;cxf.features&lt;/property-name&gt;
      &lt;property-value&gt;org.apache.cxf.feature.FastInfosetFeature&lt;/property-value&gt;
    &lt;/property&gt;
  &lt;/endpoint-config&gt;
&lt;/jaxws-config&gt;</pre>

						</p></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							A new instance of each specified feature class will be added to the client or endpoint the configuration is assigned to. The feature classes must have a no-argument constructor.
						</p></div></div></section><section class="section" id="cxf_properties_driven_bean_creation"><div class="titlepage"><div><div><h4 class="title">3.13.1.8. Properties-Driven Bean Creation</h4></div></div></div><p>
						The <a class="link" href="#cxf-interceptors" title="3.13.1.6. Apache CXF Interceptors">Apache CXF Interceptors</a> and <a class="link" href="#cxf_features" title="3.13.1.7. Apache CXF Features">Apache CXF Features</a> sections explain how to declare CXF interceptors and features through properties either in a client or endpoint predefined configuration or in a <code class="literal">jboss-webservices.xml</code> descriptor. By only getting the feature or interceptor class name specified, the container tries to create a bean instance using the class default constructor. This sets a limitation on the feature or interceptor configuration, unless custom extensions of vanilla CXF classes are provided, with the default constructor setting properties before eventually using the super constructor.
					</p><p>
						To address this issue, JBossWS integration comes with a mechanism for configuring simple bean hierarchies when building them up from properties. Properties can have bean reference values, which are strings starting with <code class="literal">##</code>. Property reference keys are used to specify the bean class name and the value for each attribute.
					</p><p>
						So for instance, the following properties result in the stack installing two feature instances:
					</p><div class="informaltable"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"><!--Empty--></col><col style="width: 50%; " class="col_2"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139695806706928" scope="col">Key</th><th align="left" valign="top" id="idm139695806705840" scope="col">Value</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139695806706928"> <p>
										cxf.features
									</p>
									 </td><td align="left" valign="top" headers="idm139695806705840"> <p>
										##foo, ##bar
									</p>
									 </td></tr><tr><td align="left" valign="top" headers="idm139695806706928"> <p>
										##foo
									</p>
									 </td><td align="left" valign="top" headers="idm139695806705840"> <p>
										org.jboss.Foo
									</p>
									 </td></tr><tr><td align="left" valign="top" headers="idm139695806706928"> <p>
										##foo.par
									</p>
									 </td><td align="left" valign="top" headers="idm139695806705840"> <p>
										34
									</p>
									 </td></tr><tr><td align="left" valign="top" headers="idm139695806706928"> <p>
										##bar
									</p>
									 </td><td align="left" valign="top" headers="idm139695806705840"> <p>
										org.jboss.Bar
									</p>
									 </td></tr><tr><td align="left" valign="top" headers="idm139695806706928"> <p>
										##bar.color
									</p>
									 </td><td align="left" valign="top" headers="idm139695806705840"> <p>
										blue
									</p>
									 </td></tr></tbody></table></div><p>
						The same result can be created by the following code:
					</p><pre class="programlisting language-java">import org.Bar;
import org.Foo;
...
Foo foo = new Foo();
foo.setPar(34);
Bar bar = new Bar();
bar.setColor("blue");</pre><p>
						This mechanism assumes that the classes are valid beans with proper <code class="literal">getter()</code> and <code class="literal">setter()</code> methods. Value objects are cast to the correct primitive type by inspecting the class definition. Nested beans can also be configured.
					</p></section></section></section></section><section class="appendix" id="reference_material"><div class="titlepage"><div><div><h1 class="title">Appendix A. Reference Material</h1></div></div></div><section class="section" id="jax_rs_resteasy_annotations"><div class="titlepage"><div><div><h2 class="title">A.1. JAX-RS/RESTEasy Annotations</h2></div></div></div><div class="table" id="idm139695807133968"><p class="title"><strong>Table A.1. JAX-RS/RESTEasy Annotations</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"><!--Empty--></col><col style="width: 50%; " class="col_2"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139695807129120" scope="col">Annotation</th><th align="left" valign="top" id="idm139695807128032" scope="col">Usage</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								Cache
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								Set response <code class="literal">Cache-Control</code> header automatically.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								ClientInterceptor
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								Identifies an interceptor as a client-side interceptor.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								ContentEncoding
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								Meta annotation that specifies a <code class="literal">Content-Encoding</code> to be applied via the annotated annotation.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								Context
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								Allows you to specify instances of <code class="literal">javax.ws.rs.core.HttpHeaders</code>, <code class="literal">javax.ws.rs.core.UriInfo</code>, <code class="literal">javax.ws.rs.core.Request</code>, <code class="literal">javax.servlet.HttpServletRequest</code>, <code class="literal">javax.servlet.HttpServletResponse</code>, and <code class="literal">javax.ws.rs.core.SecurityContext</code> objects.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								CookieParam
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								Allows you to specify the value of a cookie or object representation of an HTTP request cookie into the method invocation.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								DecorateTypes
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								Must be placed on a <code class="literal">DecoratorProcessor</code> class to specify the supported types.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								Decorator
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								Meta-annotation to be placed on another annotation that triggers decoration.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								DefaultValue
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								Can be combined with the other <code class="literal">@*Param</code> annotations to define a default value when the HTTP request item does not exist.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								DELETE
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								An annotation that signifies that the method responds to HTTP <code class="literal">DELETE</code> requests.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								DoNotUseJAXBProvider
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								Put this on a class or parameter when you do not want the JAXB <code class="literal">MessageBodyReader</code>/<code class="literal">Writer</code> used but instead have a more specific provider you want to use to marshal the type.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								Encoded
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								Can be used on a class, method, or param. By default, inject <code class="literal">@PathParam</code> and <code class="literal">@QueryParams</code> are decoded. By adding the <code class="literal">@Encoded</code> annotation, the value of these params are provided in encoded form.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								Form
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								This can be used as a value object for incoming/outgoing request/responses.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								Formatted
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								Format XML output with indentations and newlines. This is a JAXB Decorator.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								GET
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								An annotation that signifies that the method responds to HTTP <code class="literal">GET</code> requests.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								IgnoreMediaTypes
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								Placed on a type, method, parameter, or field to tell JAXRS not to use JAXB provider for a certain media type
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								ImageWriterParams
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								An annotation that a resource class can use to pass parameters to the <code class="literal">IIOImageProvider</code>.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								Mapped
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								A <code class="literal">JSONConfig</code>.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								MultipartForm
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								This can be used as a value object for incoming/outgoing request/responses of the multipart/form-data MIME type.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								NoCache
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								Set <code class="literal">Cache-Control</code> response header of <code class="literal">nocache</code>.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								NoJackson
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								Placed on class, parameter, field or method when you do not want the Jackson provider to be triggered.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								PartType
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								Must be used in conjunction with Multipart providers when writing out a List or Map as a <code class="literal">multipart/*</code> type.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								Path
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								This must exist either in the class or resource method. If it exists in both, the relative path to the resource method is a concatenation of the class and method.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								PathParam
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								Allows you to map variable URI path fragments into a method call.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								POST
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								An annotation that signifies that the method responds to HTTP <code class="literal">POST</code> requests.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								Priority
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								An annotation to indicate what order a class should be used. Uses an integer parameter with a lower value signifying a higher priority.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								Provider
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								Marks a class to be discoverable as a <a class="link" href="#content_marshalling_and_providers" title="2.6. Content Marshalling and Providers">provider</a> by JAX-RS runtime during a provider scanning phase.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								PUT
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								An annotation that signifies that the method responds to HTTP <code class="literal">PUT</code> requests.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								QueryParam
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								Allows you to map URI query string parameter or URL form encoded parameter to the method invocation.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								ServerInterceptor
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								Identifies an interceptor as a server-side interceptor.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								StringParameterUnmarshallerBinder
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								Meta-annotation to be placed on another annotation that triggers a <code class="literal">StringParameterUnmarshaller</code> to be applied to a string-based annotation injector.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								Stylesheet
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								Specifies an XML stylesheet header.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								Wrapped
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								Put this on a method or parameter when you want to marshal or unmarshal a collection or array of JAXB objects.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								WrappedMap
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								Put this on a method or parameter when you want to marshal or unmarshal a map of JAXB objects.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								XmlHeader
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								Sets an XML header for the returned document.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								XmlNsMap
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								A <code class="literal">JSONToXml</code>.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807129120"> <p>
								XopWithMultipartRelated
							</p>
							 </td><td align="left" valign="top" headers="idm139695807128032"> <p>
								This annotation can be used to process/produce incoming/outgoing XOP messages (packaged as multipart/related) to/from JAXB annotated objects.
							</p>
							 </td></tr></tbody></table></div></div></section><section class="section" id="resteasy_configuration_parameters"><div class="titlepage"><div><div><h2 class="title">A.2. RESTEasy Configuration Parameters</h2></div></div></div><div class="table" id="idm139695804886368"><p class="title"><strong>Table A.2. Elements</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 40%; " class="col_1"><!--Empty--></col><col style="width: 20%; " class="col_2"><!--Empty--></col><col style="width: 40%; " class="col_3"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139695804880608" scope="col">Option Name</th><th align="left" valign="top" id="idm139695804879520" scope="col">Default Value</th><th align="left" valign="top" id="idm139695804878432" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139695804880608"> <p>
								resteasy.servlet.mapping.prefix
							</p>
							 </td><td align="left" valign="top" headers="idm139695804879520"> <p>
								No default
							</p>
							 </td><td align="left" valign="top" headers="idm139695804878432"> <p>
								If the URL-pattern for the Resteasy servlet-mapping is not <code class="literal">/*</code>.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695804880608"> <p>
								resteasy.scan
							</p>
							 </td><td align="left" valign="top" headers="idm139695804879520"> <p>
								false
							</p>
							 </td><td align="left" valign="top" headers="idm139695804878432"> <p>
								Automatically scan <code class="literal">WEB-INF/lib</code> JARs and <code class="literal">WEB-INF/classes</code> directory for both <code class="literal">@Provider</code> and JAX-RS resource classes (such as <code class="literal">@Path</code>, <code class="literal">@GET</code>, <code class="literal">@POST</code>) and register them.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695804880608"> <p>
								resteasy.scan.providers
							</p>
							 </td><td align="left" valign="top" headers="idm139695804879520"> <p>
								false
							</p>
							 </td><td align="left" valign="top" headers="idm139695804878432"> <p>
								Scan for <code class="literal">@Provider</code> classes and register them.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695804880608"> <p>
								resteasy.scan.resources
							</p>
							 </td><td align="left" valign="top" headers="idm139695804879520"> <p>
								false
							</p>
							 </td><td align="left" valign="top" headers="idm139695804878432"> <p>
								Scan for JAX-RS resource classes.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695804880608"> <p>
								resteasy.providers
							</p>
							 </td><td align="left" valign="top" headers="idm139695804879520"> <p>
								no default
							</p>
							 </td><td align="left" valign="top" headers="idm139695804878432"> <p>
								A comma delimited list of fully qualified <code class="literal">@Provider</code> class names you want to register.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695804880608"> <p>
								resteasy.use.builtin.providers
							</p>
							 </td><td align="left" valign="top" headers="idm139695804879520"> <p>
								true
							</p>
							 </td><td align="left" valign="top" headers="idm139695804878432"> <p>
								Whether or not to register default, built-in <code class="literal">@Provider</code> classes.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695804880608"> <p>
								resteasy.resources
							</p>
							 </td><td align="left" valign="top" headers="idm139695804879520"> <p>
								No default
							</p>
							 </td><td align="left" valign="top" headers="idm139695804878432"> <p>
								A comma delimited list of fully qualified JAX-RS resource class names you want to register.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695804880608"> <p>
								resteasy.jndi.resources
							</p>
							 </td><td align="left" valign="top" headers="idm139695804879520"> <p>
								No default
							</p>
							 </td><td align="left" valign="top" headers="idm139695804878432"> <p>
								A comma delimited list of JNDI names which reference objects you want to register as JAX-RS resources.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695804880608"> <p>
								javax.ws.rs.Application
							</p>
							 </td><td align="left" valign="top" headers="idm139695804879520"> <p>
								No default
							</p>
							 </td><td align="left" valign="top" headers="idm139695804878432"> <p>
								Fully qualified name of <code class="literal">Application</code> class to bootstrap in a spec portable way.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695804880608"> <p>
								resteasy.media.type.mappings
							</p>
							 </td><td align="left" valign="top" headers="idm139695804879520"> <p>
								No default
							</p>
							 </td><td align="left" valign="top" headers="idm139695804878432"> <p>
								Replaces the need for an <code class="literal">Accept</code> header by mapping file name extensions (like <code class="literal">.xml</code> or <code class="literal">.txt</code>) to a media type. Used when the client is unable to use a <code class="literal">Accept</code> header to choose a representation (i.e. a browser). You configure this in the <code class="literal">WEB-INF/web.xml</code> file using the <code class="literal">resteasy.media.type.mappings</code> and <code class="literal">resteasy.language.mappings</code>.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695804880608"> <p>
								resteasy.language.mappings
							</p>
							 </td><td align="left" valign="top" headers="idm139695804879520"> <p>
								No default
							</p>
							 </td><td align="left" valign="top" headers="idm139695804878432"> <p>
								Replaces the need for an <code class="literal">Accept-Language</code> header by mapping file name extensions (like <code class="literal">.en</code> or <code class="literal">.fr</code>) to a language. Used when the client is unable to use a <code class="literal">Accept-Language</code> header to choose a language (i.e. a browser).
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695804880608"> <p>
								resteasy.document.expand.entity.references
							</p>
							 </td><td align="left" valign="top" headers="idm139695804879520"> <p>
								false
							</p>
							 </td><td align="left" valign="top" headers="idm139695804878432"> <p>
								Whether to expand external entities or replace them with an empty string. In JBoss EAP, this parameter defaults to <code class="literal">false</code>, so it replaces them with an empty string.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695804880608"> <p>
								resteasy.document.secure.processing.feature
							</p>
							 </td><td align="left" valign="top" headers="idm139695804879520"> <p>
								true
							</p>
							 </td><td align="left" valign="top" headers="idm139695804878432"> <p>
								Impose security constraints in processing <code class="literal">org.w3c.dom.Document</code> documents and JAXB object representations.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695804880608"> <p>
								resteasy.document.secure.disableDTDs
							</p>
							 </td><td align="left" valign="top" headers="idm139695804879520"> <p>
								true
							</p>
							 </td><td align="left" valign="top" headers="idm139695804878432"> <p>
								Prohibit DTDs in <code class="literal">org.w3c.dom.Document</code> documents and JAXB object representations.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695804880608"> <p>
								resteasy.wider.request.matching
							</p>
							 </td><td align="left" valign="top" headers="idm139695804879520"> <p>
								true
							</p>
							 </td><td align="left" valign="top" headers="idm139695804878432"> <p>
								Turn off class-level expression filtering as defined in the JAX-RS specification and instead match based on the full expression of each JAX-RS method.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695804880608"> <p>
								resteasy.use.container.form.params
							</p>
							 </td><td align="left" valign="top" headers="idm139695804879520"> <p>
								true
							</p>
							 </td><td align="left" valign="top" headers="idm139695804878432"> <p>
								Use the <code class="literal">HttpServletRequest.getParameterMap()</code> method to obtain form parameters. Use this switch if you are calling this method within a servlet filter or consuming the input stream within the filter.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695804880608"> <p>
								resteasy.add.charset
							</p>
							 </td><td align="left" valign="top" headers="idm139695804879520"> <p>
								true
							</p>
							 </td><td align="left" valign="top" headers="idm139695804878432"> <p>
								If a resource method returns a <code class="literal">text/*</code> or <code class="literal">application/xml*</code> media type without an explicit charset, RESTEasy adds <code class="literal">charset=UTF-8</code> to the returned content-type header. Note that the charset defaults to UTF-8 in this case, independent of the setting of this parameter.
							</p>
							 </td></tr></tbody></table></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					These parameters are configured in the <code class="literal">WEB-INF/web.xml</code> file.
				</p></div></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					In a Servlet 3.0 container, the <code class="literal">resteasy.scan.*</code> configurations in the <code class="literal">web.xml</code> file are ignored, and all JAX-RS annotated components will be automatically scanned.
				</p></div></div><p>
				For example, <code class="literal">javax.ws.rs.Application</code> parameter is configured within <code class="literal">init-param</code> of the servlet configuration:
			</p><pre class="programlisting language-xml">&lt;servlet&gt;
    &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.jboss.resteasy.plugins.server.servlet.HttpServletDispatcher&lt;/servlet-class&gt;
    &lt;init-param&gt;
        &lt;param-name&gt;javax.ws.rs.Application&lt;/param-name&gt;
        &lt;param-value&gt;org.jboss.resteasy.utils.TestApplication&lt;/param-value&gt;
    &lt;/init-param&gt;
&lt;/servlet&gt;</pre><p>
				For example, <code class="literal">resteasy.document.expand.entity.references</code> is configured within <code class="literal">context-param</code>:
			</p><pre class="programlisting language-xml">&lt;context-param&gt;
    &lt;param-name&gt;resteasy.document.expand.entity.references&lt;/param-name&gt;
    &lt;param-value&gt;true&lt;/param-value&gt;
&lt;/context-param&gt;</pre><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
					Changing the default values of the following RESTEasy parameters may cause RESTEasy applications to be potentially vulnerable against XXE attacks:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							resteasy.document.expand.entity.references
						</li><li class="listitem">
							resteasy.document.secure.processing.feature
						</li><li class="listitem">
							resteasy.document.secure.disableDTDs
						</li></ul></div></div></div></section><section class="section" id="resteasy_javascript_api_parameters"><div class="titlepage"><div><div><h2 class="title">A.3. RESTEasy JavaScript API Parameters</h2></div></div></div><div class="table" id="idm139695809493968"><p class="title"><strong>Table A.3. Parameter Properties</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 30%; " class="col_1"><!--Empty--></col><col style="width: 20%; " class="col_2"><!--Empty--></col><col style="width: 50%; " class="col_3"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139695809488208" scope="col">Property</th><th align="left" valign="top" id="idm139695809487120" scope="col">Default Value</th><th align="left" valign="top" id="idm139695809486032" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139695809488208"> <p>
								$entity
							</p>
							 </td><td align="left" valign="top" headers="idm139695809487120"> </td><td align="left" valign="top" headers="idm139695809486032"> <p>
								The entity to send as a <code class="literal">PUT</code>, <code class="literal">POST</code> request.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695809488208"> <p>
								$contentType
							</p>
							 </td><td align="left" valign="top" headers="idm139695809487120"> </td><td align="left" valign="top" headers="idm139695809486032"> <p>
								The MIME type of the body entity sent as the <code class="literal">Content-Type</code> header. Determined by the <code class="literal">@Consumes</code> annotation.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695809488208"> <p>
								$accepts
							</p>
							 </td><td align="left" valign="top" headers="idm139695809487120"> <p>
								*/*
							</p>
							 </td><td align="left" valign="top" headers="idm139695809486032"> <p>
								The accepted MIME types sent as the <code class="literal">Accept</code> header. Determined by the <code class="literal">@Provides</code> annotation.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695809488208"> <p>
								$callback
							</p>
							 </td><td align="left" valign="top" headers="idm139695809487120"> </td><td align="left" valign="top" headers="idm139695809486032"> <p>
								Set to a function (<code class="literal">httpCode</code>, <code class="literal">xmlHttpRequest</code>, <code class="literal">value</code>) for an asynchronous call. If not present, the call will be synchronous and return the value.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695809488208"> <p>
								$apiURL
							</p>
							 </td><td align="left" valign="top" headers="idm139695809487120"> </td><td align="left" valign="top" headers="idm139695809486032"> <p>
								Set to the base URI of the JAX-RS endpoint, not including the last slash.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695809488208"> <p>
								$username
							</p>
							 </td><td align="left" valign="top" headers="idm139695809487120"> </td><td align="left" valign="top" headers="idm139695809486032"> <p>
								If username and password are set, they will be used for credentials for the request.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695809488208"> <p>
								$password
							</p>
							 </td><td align="left" valign="top" headers="idm139695809487120"> </td><td align="left" valign="top" headers="idm139695809486032"> <p>
								If username and password are set, they will be used for credentials for the request.
							</p>
							 </td></tr></tbody></table></div></div></section><section class="section" id="rest_request_class_members"><div class="titlepage"><div><div><h2 class="title">A.4. REST.Request Class Members</h2></div></div></div><div class="table" id="idm139695804794416"><p class="title"><strong>Table A.4. REST.Request Class</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"><!--Empty--></col><col style="width: 50%; " class="col_2"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139695804789584" scope="col">Member</th><th align="left" valign="top" id="idm139695804788496" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139695804789584"> <p>
								execute(callback)
							</p>
							 </td><td align="left" valign="top" headers="idm139695804788496"> <p>
								Executes the request with all the information set in the current object. The value is passed to the optional argument callback, not returned.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695804789584"> <p>
								setAccepts(acceptHeader)
							</p>
							 </td><td align="left" valign="top" headers="idm139695804788496"> <p>
								Sets the <code class="literal">Accept</code> request header. Defaults to <code class="literal">*/*</code>.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695804789584"> <p>
								setCredentials(username, password)
							</p>
							 </td><td align="left" valign="top" headers="idm139695804788496"> <p>
								Sets the request credentials.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695804789584"> <p>
								setEntity(entity)
							</p>
							 </td><td align="left" valign="top" headers="idm139695804788496"> <p>
								Sets the request entity.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695804789584"> <p>
								setContentType(contentTypeHeader)
							</p>
							 </td><td align="left" valign="top" headers="idm139695804788496"> <p>
								Sets the <code class="literal">Content-Type</code> request header.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695804789584"> <p>
								setURI(uri)
							</p>
							 </td><td align="left" valign="top" headers="idm139695804788496"> <p>
								Sets the request URI. This should be an absolute URI.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695804789584"> <p>
								setMethod(method)
							</p>
							 </td><td align="left" valign="top" headers="idm139695804788496"> <p>
								Sets the request method. Defaults to <code class="literal">GET</code>.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695804789584"> <p>
								setAsync(async)
							</p>
							 </td><td align="left" valign="top" headers="idm139695804788496"> <p>
								Controls whether the request should be asynchronous. Defaults to <code class="literal">true</code>.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695804789584"> <p>
								addCookie(name, value)
							</p>
							 </td><td align="left" valign="top" headers="idm139695804788496"> <p>
								Sets the given cookie in the current document when executing the request. This will be persistent in the browser.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695804789584"> <p>
								addQueryParameter(name, value)
							</p>
							 </td><td align="left" valign="top" headers="idm139695804788496"> <p>
								Adds a query parameter to the URI query part.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695804789584"> <p>
								addMatrixParameter(name, value)
							</p>
							 </td><td align="left" valign="top" headers="idm139695804788496"> <p>
								Adds a matrix parameter (path parameter) to the last path segment of the request URI.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695804789584"> <p>
								addHeader(name, value)
							</p>
							 </td><td align="left" valign="top" headers="idm139695804788496"> <p>
								Adds a request header.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695804789584"> <p>
								addForm(name, value)
							</p>
							 </td><td align="left" valign="top" headers="idm139695804788496"> <p>
								Adds a form.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695804789584"> <p>
								addFormParameter(name, value)
							</p>
							 </td><td align="left" valign="top" headers="idm139695804788496"> <p>
								Adds a form parameter.
							</p>
							 </td></tr></tbody></table></div></div></section><section class="section" id="Asynchronous_Job_Service_Configuration_Parameters"><div class="titlepage"><div><div><h2 class="title">A.5. RESTEasy Asynchronous Job Service Configuration Parameters</h2></div></div></div><p>
				The table below details the configurable <code class="literal">context-params</code> for the Asynchronous Job Service. These parameters can be configured in the <code class="literal">web.xml</code> file.
			</p><div class="table" id="idm139695805453808"><p class="title"><strong>Table A.5. Configuration Parameters</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"><!--Empty--></col><col style="width: 50%; " class="col_2"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139695805448960" scope="col">Parameter</th><th align="left" valign="top" id="idm139695805447872" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139695805448960"> <p>
								resteasy.async.job.service.max.job.results
							</p>
							 </td><td align="left" valign="top" headers="idm139695805447872"> <p>
								Number of job results that can be held in the memory at any one time. Default value is <code class="literal">100</code>.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695805448960"> <p>
								resteasy.async.job.service.max.wait
							</p>
							 </td><td align="left" valign="top" headers="idm139695805447872"> <p>
								Maximum wait time on a job when a client is querying for it. Default value is <code class="literal">300000</code>.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695805448960"> <p>
								resteasy.async.job.service.thread.pool.size
							</p>
							 </td><td align="left" valign="top" headers="idm139695805447872"> <p>
								Thread pool size of the background threads that run the job. Default value is <code class="literal">100</code>.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695805448960"> <p>
								resteasy.async.job.service.base.path
							</p>
							 </td><td align="left" valign="top" headers="idm139695805447872"> <p>
								Sets the base path for the job URIs. Default value is <code class="literal">/asynch/jobs</code>.
							</p>
							 </td></tr></tbody></table></div></div><pre class="programlisting language-xml">&lt;web-app&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;resteasy.async.job.service.enabled&lt;/param-name&gt;
        &lt;param-value&gt;true&lt;/param-value&gt;
    &lt;/context-param&gt;

    &lt;context-param&gt;
        &lt;param-name&gt;resteasy.async.job.service.max.job.results&lt;/param-name&gt;
        &lt;param-value&gt;100&lt;/param-value&gt;
    &lt;/context-param&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;resteasy.async.job.service.max.wait&lt;/param-name&gt;
        &lt;param-value&gt;300000&lt;/param-value&gt;
    &lt;/context-param&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;resteasy.async.job.service.thread.pool.size&lt;/param-name&gt;
        &lt;param-value&gt;100&lt;/param-value&gt;
    &lt;/context-param&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;resteasy.async.job.service.base.path&lt;/param-name&gt;
        &lt;param-value&gt;/asynch/jobs&lt;/param-value&gt;
    &lt;/context-param&gt;

    &lt;listener&gt;
        &lt;listener-class&gt;
            org.jboss.resteasy.plugins.server.servlet.ResteasyBootstrap
        &lt;/listener-class&gt;
    &lt;/listener&gt;

    &lt;servlet&gt;
        &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
        &lt;servlet-class&gt;
            org.jboss.resteasy.plugins.server.servlet.HttpServletDispatcher
        &lt;/servlet-class&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;Resteasy&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

&lt;/web-app&gt;</pre></section><section class="section" id="jax_ws_tools"><div class="titlepage"><div><div><h2 class="title">A.6. JAX-WS Tools</h2></div></div></div><h4 id="wsconsume_tool">wsconsume</h4><p>
				<code class="literal">wsconsume</code> is a command-line tool provided with JBoss EAP that consumes a WSDL and produces portable JAX-WS service and client artifacts.
			</p><h5 id="usage_2">Usage</h5><p>
				The <code class="literal">wsconsume</code> tool is located in the <code class="literal">EAP_HOME/bin</code> directory and uses the following syntax.
			</p><pre class="screen">EAP_HOME/bin/wsconsume.sh [options] &lt;wsdl-url&gt;</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Use the <code class="literal">wsconsume.bat</code> script for Windows.
				</p></div></div><p>
				Example usage:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Generate Java class files from the <code class="literal">Example.wsdl</code> WSDL file
					</p><pre class="screen">EAP_HOME/bin/wsconsume.sh Example.wsdl</pre></li><li class="listitem"><p class="simpara">
						Generate Java source and class files from the <code class="literal">Example.wsdl</code> WSDL file
					</p><pre class="screen">EAP_HOME/bin/wsconsume.sh -k Example.wsdl</pre></li><li class="listitem"><p class="simpara">
						Generate Java source and class files in the <code class="literal">my.org</code> package from the <code class="literal">Example.wsdl</code> WSDL file
					</p><pre class="screen">EAP_HOME/bin/wsconsume.sh -k -p my.org Example.wsdl</pre></li><li class="listitem"><p class="simpara">
						Generate Java source and class files using multiple binding files
					</p><pre class="screen">EAP_HOME/bin/wsconsume.sh -k -b schema-binding1.xsd -b schema-binding2.xsd Example.wsdl</pre></li></ul></div><p>
				Use the <code class="literal">--help</code> argument or see the below table for a listing of all available <code class="literal">wsconsume</code> options.
			</p><div class="table" id="idm139695808699456"><p class="title"><strong>Table A.6. wsconsume Options</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 30%; " class="col_1"><!--Empty--></col><col style="width: 70%; " class="col_2"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139695808693888" scope="col">Option</th><th align="left" valign="top" id="idm139695808692800" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139695808693888"> <p>
								-a, --additionalHeaders
							</p>
							 </td><td align="left" valign="top" headers="idm139695808692800"> <p>
								Enable processing of implicit SOAP headers.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695808693888"> <p>
								-b, --binding=&lt;file&gt;
							</p>
							 </td><td align="left" valign="top" headers="idm139695808692800"> <p>
								One or more JAX-WS or JAXB binding files.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695808693888"> <p>
								-c --catalog=&lt;file&gt;
							</p>
							 </td><td align="left" valign="top" headers="idm139695808692800"> <p>
								Oasis XML Catalog file for entity resolution.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695808693888"> <p>
								-d --encoding=&lt;charset&gt;
							</p>
							 </td><td align="left" valign="top" headers="idm139695808692800"> <p>
								The charset encoding to use for generated sources.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695808693888"> <p>
								-e, --extension
							</p>
							 </td><td align="left" valign="top" headers="idm139695808692800"> <p>
								Enable SOAP 1.2 binding extension.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695808693888"> <p>
								-h, --help
							</p>
							 </td><td align="left" valign="top" headers="idm139695808692800"> <p>
								Show this help message.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695808693888"> <p>
								-j --clientjar=&lt;name&gt;
							</p>
							 </td><td align="left" valign="top" headers="idm139695808692800"> <p>
								Create a JAR file of the generated artifacts for calling the web. service
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695808693888"> <p>
								-k, --keep
							</p>
							 </td><td align="left" valign="top" headers="idm139695808692800"> <p>
								Keep/Generate Java source.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695808693888"> <p>
								-l, --load-consumer
							</p>
							 </td><td align="left" valign="top" headers="idm139695808692800"> <p>
								Load the consumer and exit (debug utility).
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695808693888"> <p>
								-n, --nocompile
							</p>
							 </td><td align="left" valign="top" headers="idm139695808692800"> <p>
								Do not compile generated sources.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695808693888"> <p>
								-o, --output=&lt;directory&gt;
							</p>
							 </td><td align="left" valign="top" headers="idm139695808692800"> <p>
								The directory to put generated artifacts.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695808693888"> <p>
								-p --package=&lt;name&gt;
							</p>
							 </td><td align="left" valign="top" headers="idm139695808692800"> <p>
								The target package for generated source.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695808693888"> <p>
								-q, --quiet
							</p>
							 </td><td align="left" valign="top" headers="idm139695808692800"> <p>
								Be somewhat more quiet.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695808693888"> <p>
								-s, --source=&lt;directory&gt;
							</p>
							 </td><td align="left" valign="top" headers="idm139695808692800"> <p>
								The directory to put Java source.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695808693888"> <p>
								-t, --target=&lt;2.1|2.2&gt;
							</p>
							 </td><td align="left" valign="top" headers="idm139695808692800"> <p>
								The JAX-WS specification target.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695808693888"> <p>
								-v, --verbose
							</p>
							 </td><td align="left" valign="top" headers="idm139695808692800"> <p>
								Show full exception stack traces.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695808693888"> <p>
								-w --wsdlLocation=&lt;loc&gt;
							</p>
							 </td><td align="left" valign="top" headers="idm139695808692800"> <p>
								Value to use for <code class="literal">@WebService.wsdlLocation</code>.
							</p>
							 </td></tr></tbody></table></div></div><h4 id="wsprovide_tool">wsprovide</h4><p>
				<code class="literal">wsprovide</code> is a command-line tool provided with JBoss EAP that generates portable JAX-WS artifacts for a service endpoint implementation. It also has the option to generate a WSDL file.
			</p><h5 id="usage_3">Usage</h5><p>
				The <code class="literal">wsprovide</code> tool is located in the <code class="literal">EAP_HOME/bin</code> directory and uses the following syntax.
			</p><pre class="screen">EAP_HOME/bin/wsprovide.sh [options] &lt;endpoint class name&gt;</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Use the <code class="literal">wsprovide.bat</code> script for Windows.
				</p></div></div><p>
				Example usage:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Generate wrapper classes for portable artifacts in the <code class="literal">output</code> directory.
					</p><pre class="screen">EAP_HOME/bin/wsprovide.sh -o output my.package.MyEndpoint</pre></li><li class="listitem"><p class="simpara">
						Generate wrapper classes and WSDL in the <code class="literal">output</code> directory.
					</p><pre class="screen">EAP_HOME/bin/wsprovide.sh -o output -w my.package.MyEndpoint</pre></li><li class="listitem"><p class="simpara">
						Generate wrapper classes in the <code class="literal">output</code> directory for an endpoint that references other JARs.
					</p><pre class="screen">EAP_HOME/bin/wsprovide.sh -o output -c myapplication1.jar:myapplication2.jar my.org.MyEndpoint</pre></li></ul></div><p>
				Use the <code class="literal">--help</code> argument or see the below table for a listing of all available <code class="literal">wsprovide</code> options.
			</p><div class="table" id="idm139695807963408"><p class="title"><strong>Table A.7. wsprovide Options</strong></p><div class="table-contents"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 30%; " class="col_1"><!--Empty--></col><col style="width: 70%; " class="col_2"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139695807957840" scope="col">Option</th><th align="left" valign="top" id="idm139695807956752" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139695807957840"> <p>
								-a, --address=&lt;address&gt;
							</p>
							 </td><td align="left" valign="top" headers="idm139695807956752"> <p>
								The generated port soap:address in WSDL.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807957840"> <p>
								-c, --classpath=&lt;path&gt;
							</p>
							 </td><td align="left" valign="top" headers="idm139695807956752"> <p>
								The classpath that contains the endpoint.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807957840"> <p>
								-e, --extension
							</p>
							 </td><td align="left" valign="top" headers="idm139695807956752"> <p>
								Enable SOAP 1.2 binding extension.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807957840"> <p>
								-h, --help
							</p>
							 </td><td align="left" valign="top" headers="idm139695807956752"> <p>
								Show this help message.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807957840"> <p>
								-k, --keep
							</p>
							 </td><td align="left" valign="top" headers="idm139695807956752"> <p>
								Keep/Generate Java source.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807957840"> <p>
								-l, --load-provider
							</p>
							 </td><td align="left" valign="top" headers="idm139695807956752"> <p>
								Load the provider and exit (debug utility).
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807957840"> <p>
								-o, --output=&lt;directory&gt;
							</p>
							 </td><td align="left" valign="top" headers="idm139695807956752"> <p>
								The directory to put generated artifacts.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807957840"> <p>
								-q, --quiet
							</p>
							 </td><td align="left" valign="top" headers="idm139695807956752"> <p>
								Be somewhat more quiet.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807957840"> <p>
								-r, --resource=&lt;directory&gt;
							</p>
							 </td><td align="left" valign="top" headers="idm139695807956752"> <p>
								The directory to put resource artifacts.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807957840"> <p>
								-s, --source=&lt;directory&gt;
							</p>
							 </td><td align="left" valign="top" headers="idm139695807956752"> <p>
								The directory to put Java source.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807957840"> <p>
								-t, --show-traces
							</p>
							 </td><td align="left" valign="top" headers="idm139695807956752"> <p>
								Show full exception stack traces.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139695807957840"> <p>
								-w, --wsdl
							</p>
							 </td><td align="left" valign="top" headers="idm139695807956752"> <p>
								Enable WSDL file generation.
							</p>
							 </td></tr></tbody></table></div></div></section><section class="section" id="jax_ws_common_api_reference"><div class="titlepage"><div><div><h2 class="title">A.7. JAX-WS Common API Reference</h2></div></div></div><p>
				Several JAX-WS development concepts are shared between web service endpoints and clients. These include the handler framework, message context, and fault handling.
			</p><h4 id="handler_framework">Handler Framework</h4><p>
				The handler framework is implemented by a JAX-WS protocol binding in the runtime of the client and the endpoint, which is the server component. Proxies and <code class="literal">Dispatch</code> instances, known collectively as binding providers, each use protocol bindings to bind their abstract functionality to specific protocols.
			</p><p>
				Client and server-side handlers are organized into an ordered list known as a handler chain. The handlers within a handler chain are invoked each time a message is sent or received. Inbound messages are processed by handlers before the binding provider processes them. Outbound messages are processed by handlers after the binding provider processes them.
			</p><p>
				Handlers are invoked with a message context which provides methods to access and modify inbound and outbound messages and to manage a set of properties. Message context properties facilitate communication between individual handlers, as well as between handlers and client and service implementations. Different types of handlers are invoked with different types of message contexts.
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Logical Handler</span></dt><dd>
							Logical handlers only operate on message context properties and message payloads. Logical handlers are protocol-independent and cannot affect protocol-specific parts of a message. Logical handlers implement interface <code class="literal">javax.xml.ws.handler.LogicalHandler</code>.
						</dd><dt><span class="term">Protocol Handler</span></dt><dd>
							Protocol handlers operate on message context properties and protocol-specific messages. Protocol handlers are specific to a particular protocol and may access and change protocol-specific aspects of a message. Protocol handlers implement any interface derived from <code class="literal">javax.xml.ws.handler.Handler</code>, except <code class="literal">javax.xml.ws.handler.LogicalHandler</code>.
						</dd><dt><span class="term">Service Endpoint Handler</span></dt><dd><p class="simpara">
							On a service endpoint, handlers are defined using the <code class="literal">@HandlerChain</code> annotation. The location of the handler chain file can be either an absolute <code class="literal">java.net.URL</code> in <code class="literal">externalForm</code> or a relative path from the source file or class file.
						</p><pre class="programlisting language-java">@WebService
@HandlerChain(file = "jaxws-server-source-handlers.xml")
public class SOAPEndpointSourceImpl {
   ...
}</pre></dd><dt><span class="term">Service Client Handler</span></dt><dd><p class="simpara">
							On a JAX-WS client, handlers are defined either by using the <code class="literal">@HandlerChain</code> annotation, as in service endpoints, or dynamically, using the JAX-WS API.
						</p><pre class="programlisting language-java">Service service = Service.create(wsdlURL, serviceName);
Endpoint port = (Endpoint)service.getPort(Endpoint.class);

BindingProvider bindingProvider = (BindingProvider)port;
List&lt;Handler&gt; handlerChain = new ArrayList&lt;Handler&gt;();
handlerChain.add(new LogHandler());
handlerChain.add(new AuthorizationHandler());
handlerChain.add(new RoutingHandler());
bindingProvider.getBinding().setHandlerChain(handlerChain);</pre><p class="simpara">
							The call to the <code class="literal">setHandlerChain</code> method is required.
						</p></dd></dl></div><h4 id="message_context">Message Context</h4><p>
				The <code class="literal">MessageContext</code> interface is the super interface for all JAX-WS message contexts. It extends <code class="literal">Map&lt;String,Object&gt;</code> with additional methods and constants to manage a set of properties that enable handlers in a handler chain to share processing related state. For example, a handler may use the <code class="literal">put</code> method to insert a property into the message context. One or more other handlers in the handler chain may subsequently obtain the message using the <code class="literal">get</code> method.
			</p><p>
				Properties are scoped as either <code class="literal">APPLICATION</code> or <code class="literal">HANDLER</code>. All properties are available to all handlers for an instance of a message exchange pattern (MEP) of a particular endpoint. For instance, if a logical handler puts a property into the message context, that property is also available to any protocol handlers in the chain during the execution of an MEP instance.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					An asynchronous Message Exchange Pattern (MEP) allows for sending and receiving messages asynchronously at the HTTP connection level. You can enable it by setting additional properties in the request context.
				</p></div></div><p>
				Properties scoped at the <code class="literal">APPLICATION</code> level are also made available to client applications and service endpoint implementations. The <code class="literal">defaultscope</code> for a property is <code class="literal">HANDLER</code>.
			</p><p>
				Logical and SOAP messages use different contexts.
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Logical Message Context</span></dt><dd>
							When logical handlers are invoked, they receive a message context of type <code class="literal">LogicalMessageContext</code>. <code class="literal">LogicalMessageContext</code> extends <code class="literal">MessageContext</code> with methods which obtain and modify the message payload. It does not provide access to the protocol-specific aspects of a message. A protocol binding defines which components of a message are available through a logical message context. A logical handler deployed in a SOAP binding can access the contents of the SOAP body but not the SOAP headers. On the other hand, the XML/HTTP binding defines that a logical handler can access the entire XML payload of a message.
						</dd><dt><span class="term">SOAP Message Context</span></dt><dd>
							When SOAP handlers are invoked, they receive a <code class="literal">SOAPMessageContext</code>. <code class="literal">SOAPMessageContext</code> extends <code class="literal">MessageContext</code> with methods which obtain and modify the SOAP message payload.
						</dd></dl></div><h4 id="fault_handling">Fault Handling</h4><p>
				An application may throw a <code class="literal">SOAPFaultException</code> or an application-specific user exception. In the case of the latter, the required fault wrapper beans are generated at runtime if they are not already part of the deployment.
			</p><pre class="programlisting language-java">public void throwSoapFaultException() {
   SOAPFactory factory = SOAPFactory.newInstance();
   SOAPFault fault = factory.createFault("this is a fault string!", new QName("http://foo", "FooCode"));
   fault.setFaultActor("mr.actor");
   fault.addDetail().addChildElement("test");
   throw new SOAPFaultException(fault);
}</pre><pre class="programlisting language-java">public void throwApplicationException() throws UserException {
   throw new UserException("validation", 123, "Some validation error");
}</pre><h4 id="jax_ws_annotations">JAX-WS Annotations</h4><p>
				The annotations available by the JAX-WS API are defined in <a class="link mimir-link-warn" href="http://www.jcp.org/en/jsr/detail?id=224" title="Mimir does not include content from: www.jcp.org">JSR-224</a>. These annotations are in the <code class="literal">javax.xml.ws</code> package.
			</p><p>
				The annotations available by the JWS API are defined in <a class="link mimir-link-warn" href="http://www.jcp.org/en/jsr/detail?id=181" title="Mimir does not include content from: www.jcp.org">JSR-181</a>. These annotations are in the <code class="literal">javax.jws</code> package.
			</p></section><section class="section" id="advanced_trust_scenarios"><div class="titlepage"><div><div><h2 class="title">A.8. Advanced WS-Trust Scenarios</h2></div></div></div><section class="section" id="SAML_holder_of_key_assertion_scenario"><div class="titlepage"><div><div><h3 class="title">A.8.1. Scenario: SAML Holder-Of-Key Assertion Scenario</h3></div></div></div><p>
					WS-Trust helps in managing software security tokens. A SAML assertion is a type of security token. In the Holder-Of-Key method, STS creates a SAML token containing the client’s public key and signs the SAML token with its private key. The client includes the SAML token and signs the outgoing soap envelope to the web service with its private key. The web service validates the SOAP message and SAML token.
				</p><p>
					Implementation of this scenario requires the following:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							SAML tokens with a Holder-Of-Key subject confirmation method must be protected so the token cannot be snooped. In most cases, a Holder-Of-Key token combined with HTTPS is sufficient to prevent getting possession of the token. This means the security policy uses a <code class="literal">sp:TransportBinding</code> and <code class="literal">sp:HttpsToken</code>.
						</li><li class="listitem">
							A Holder-Of-Key token has no encryption or signing keys associated with it, therefore a <code class="literal">sp:IssuedToken</code> of <code class="literal">SymmetricKey</code> or <code class="literal">PublicKey</code> keyType should be used with a <code class="literal">sp:SignedEndorsingSupportingTokens</code>.
						</li></ul></div><section class="section" id="SAML_holder_of_key_assertion_scenario_WSP"><div class="titlepage"><div><div><h4 class="title">A.8.1.1. Web Service Provider</h4></div></div></div><p>
						This section lists the web service elements for the SAML Holder-Of-Key scenario. The components include:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<a class="link" href="#SAML_holder_of_key_assertion_scenario_WSP_WSDL" title="A.8.1.1.1. Web Service Provider WSDL">Web Service Provider WSDL</a>
							</li><li class="listitem">
								<a class="link" href="#SAML_holder_of_key_assertion_scenario_WSP_SSL_conf" title="A.8.1.1.2. SSL Configuration">SSL Configuration</a>
							</li><li class="listitem">
								<a class="link" href="#SAML_holder_of_key_assertion_scenario_WSP_interface" title="A.8.1.1.3. Web Service Provider Interface">Web Service Provider Interface</a>
							</li><li class="listitem">
								<a class="link" href="#SAML_holder_of_key_assertion_scenario_WSP_implementation" title="A.8.1.1.4. Web Service Provider Implementation">Web Service Provider Implementation</a>
							</li><li class="listitem">
								<a class="link" href="#SAML_holder_of_key_assertion_scenario_WSP_crypto_prop_keystore_files" title="A.8.1.1.5. Crypto Properties and Keystore Files">Crypto Properties and Keystore Files</a>
							</li><li class="listitem">
								<a class="link" href="#SAML_holder_of_key_assertion_scenario_WSP_manifest" title="A.8.1.1.6. Default MANIFEST.MF">Default MANIFEST.MF</a>
							</li></ul></div><section class="section" id="SAML_holder_of_key_assertion_scenario_WSP_WSDL"><div class="titlepage"><div><div><h5 class="title">A.8.1.1.1. Web Service Provider WSDL</h5></div></div></div><p>
							The Web Service Provider is a contract-first endpoint. All WS-trust and security policies for it are declared in the <code class="literal">HolderOfKeyService.wsdl</code> WSDL. For this scenario, a <code class="literal">ws-requester</code> is required to provide a SAML 2.0 token of <code class="literal">SymmetricKey</code> keyType, issued from a designated STS. The STS address is provided in the WSDL. A transport binding policy is used. The token is declared to be signed and endorsed, <code class="literal">sp:SignedEndorsingSupportingTokens</code>.
						</p><p>
							A detailed explanation of the security settings are provided in the comments in the following listing:
						</p><pre class="programlisting language-xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;definitions targetNamespace="http://www.jboss.org/jbossws/ws-extensions/holderofkeywssecuritypolicy"
             name="HolderOfKeyService"
        xmlns:tns="http://www.jboss.org/jbossws/ws-extensions/holderofkeywssecuritypolicy"
        xmlns:xsd="http://www.w3.org/2001/XMLSchema"
        xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/"
        xmlns="http://schemas.xmlsoap.org/wsdl/"
        xmlns:wsp="http://www.w3.org/ns/ws-policy"
        xmlns:wsam="http://www.w3.org/2007/05/addressing/metadata"
    xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"
    xmlns:wsaws="http://www.w3.org/2005/08/addressing"
    xmlns:wsx="http://schemas.xmlsoap.org/ws/2004/09/mex"
    xmlns:sp="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702"
    xmlns:t="http://docs.oasis-open.org/ws-sx/ws-trust/200512"&gt;

  &lt;types&gt;
    &lt;xsd:schema&gt;
      &lt;xsd:import namespace="http://www.jboss.org/jbossws/ws-extensions/holderofkeywssecuritypolicy"
                  schemaLocation="HolderOfKeyService_schema1.xsd"/&gt;
    &lt;/xsd:schema&gt;
  &lt;/types&gt;
  &lt;message name="sayHello"&gt;
    &lt;part name="parameters" element="tns:sayHello"/&gt;
  &lt;/message&gt;
  &lt;message name="sayHelloResponse"&gt;
    &lt;part name="parameters" element="tns:sayHelloResponse"/&gt;
  &lt;/message&gt;
  &lt;portType name="HolderOfKeyIface"&gt;
    &lt;operation name="sayHello"&gt;
      &lt;input message="tns:sayHello"/&gt;
      &lt;output message="tns:sayHelloResponse"/&gt;
    &lt;/operation&gt;
  &lt;/portType&gt;
&lt;!--
        The wsp:PolicyReference binds the security requirements on all the endpoints.
        The wsp:Policy wsu:Id="#TransportSAML2HolderOfKeyPolicy" element is defined later in this file.
--&gt;
  &lt;binding name="HolderOfKeyServicePortBinding" type="tns:HolderOfKeyIface"&gt;
    &lt;wsp:PolicyReference URI="#TransportSAML2HolderOfKeyPolicy" /&gt;
    &lt;soap:binding transport="http://schemas.xmlsoap.org/soap/http" style="document"/&gt;
    &lt;operation name="sayHello"&gt;
      &lt;soap:operation soapAction=""/&gt;
      &lt;input&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/input&gt;
      &lt;output&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/output&gt;
    &lt;/operation&gt;
  &lt;/binding&gt;
&lt;!--
  The soap:address has been defined to use JBoss's https port, 8443.  This is
  set in conjunction with the sp:TransportBinding policy for https.
--&gt;
  &lt;service name="HolderOfKeyService"&gt;
    &lt;port name="HolderOfKeyServicePort" binding="tns:HolderOfKeyServicePortBinding"&gt;
      &lt;soap:address location="https://@jboss.bind.address@:8443/jaxws-samples-wsse-policy-trust-holderofkey/HolderOfKeyService"/&gt;
    &lt;/port&gt;
  &lt;/service&gt;


  &lt;wsp:Policy wsu:Id="TransportSAML2HolderOfKeyPolicy"&gt;
    &lt;wsp:ExactlyOne&gt;
      &lt;wsp:All&gt;
  &lt;!--
        The wsam:Addressing element, indicates that the endpoints of this
        web service MUST conform to the WS-Addressing specification.  The
        attribute wsp:Optional="false" enforces this assertion.
  --&gt;
        &lt;wsam:Addressing wsp:Optional="false"&gt;
          &lt;wsp:Policy /&gt;
        &lt;/wsam:Addressing&gt;
&lt;!--
  The sp:TransportBinding element indicates that security is provided by the
  message exchange transport medium, https.  WS-Security policy specification
  defines the sp:HttpsToken for use in exchanging messages transmitted over HTTPS.
--&gt;
          &lt;sp:TransportBinding
            xmlns:sp="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702"&gt;
            &lt;wsp:Policy&gt;
              &lt;sp:TransportToken&gt;
                &lt;wsp:Policy&gt;
                  &lt;sp:HttpsToken&gt;
                    &lt;wsp:Policy/&gt;
                  &lt;/sp:HttpsToken&gt;
                &lt;/wsp:Policy&gt;
              &lt;/sp:TransportToken&gt;
&lt;!--
     The sp:AlgorithmSuite element, requires the TripleDes algorithm suite
     be used in performing cryptographic operations.
--&gt;
              &lt;sp:AlgorithmSuite&gt;
                &lt;wsp:Policy&gt;
                  &lt;sp:TripleDes /&gt;
                &lt;/wsp:Policy&gt;
              &lt;/sp:AlgorithmSuite&gt;
&lt;!--
     The sp:Layout element,  indicates the layout rules to apply when adding
     items to the security header.  The sp:Lax sub-element indicates items
     are added to the security header in any order that conforms to
     WSS: SOAP Message Security.
--&gt;
              &lt;sp:Layout&gt;
                &lt;wsp:Policy&gt;
                  &lt;sp:Lax /&gt;
                &lt;/wsp:Policy&gt;
              &lt;/sp:Layout&gt;
              &lt;sp:IncludeTimestamp /&gt;
            &lt;/wsp:Policy&gt;
          &lt;/sp:TransportBinding&gt;

&lt;!--
  The sp:SignedEndorsingSupportingTokens, when transport level security level is
  used there will be no message signature and the signature generated by the
  supporting token will sign the Timestamp.
--&gt;
        &lt;sp:SignedEndorsingSupportingTokens
          xmlns:sp="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702"&gt;
          &lt;wsp:Policy&gt;
&lt;!--
  The sp:IssuedToken element asserts that a SAML 2.0 security token of type
  Bearer is expected from the STS.  The
  sp:IncludeToken="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient"&gt;
  attribute instructs the runtime to include the initiator's public key
  with every message sent to the recipient.

  The sp:RequestSecurityTokenTemplate element directs that all of the
  children of this element will be copied directly into the body of the
  RequestSecurityToken (RST) message that is sent to the STS when the
  initiator asks the STS to issue a token.
--&gt;
            &lt;sp:IssuedToken
              sp:IncludeToken="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient"&gt;
              &lt;sp:RequestSecurityTokenTemplate&gt;
                &lt;t:TokenType&gt;http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV2.0&lt;/t:TokenType&gt;
 &lt;!--
   KeyType of "SymmetricKey", the client must prove to the WS service that it
   possesses a particular symmetric session key.
 --&gt;
                &lt;t:KeyType&gt;http://docs.oasis-open.org/ws-sx/ws-trust/200512/SymmetricKey&lt;/t:KeyType&gt;
              &lt;/sp:RequestSecurityTokenTemplate&gt;
              &lt;wsp:Policy&gt;
                &lt;sp:RequireInternalReference /&gt;
              &lt;/wsp:Policy&gt;
&lt;!--
  The sp:Issuer element defines the STS's address and endpoint information
  This information is used by the STSClient.
--&gt;
              &lt;sp:Issuer&gt;
                &lt;wsaws:Address&gt;http://@jboss.bind.address@:8080/jaxws-samples-wsse-policy-trust-sts-holderofkey/SecurityTokenService&lt;/wsaws:Address&gt;
                &lt;wsaws:Metadata
                  xmlns:wsdli="http://www.w3.org/2006/01/wsdl-instance"
                  wsdli:wsdlLocation="http://@jboss.bind.address@:8080/jaxws-samples-wsse-policy-trust-sts-holderofkey/SecurityTokenService?wsdl"&gt;
                  &lt;wsaw:ServiceName
                    xmlns:wsaw="http://www.w3.org/2006/05/addressing/wsdl"
                    xmlns:stsns="http://docs.oasis-open.org/ws-sx/ws-trust/200512/"
                    EndpointName="UT_Port"&gt;stsns:SecurityTokenService&lt;/wsaw:ServiceName&gt;
                &lt;/wsaws:Metadata&gt;
              &lt;/sp:Issuer&gt;

            &lt;/sp:IssuedToken&gt;
          &lt;/wsp:Policy&gt;
        &lt;/sp:SignedEndorsingSupportingTokens&gt;
&lt;!--
    The sp:Wss11 element declares WSS: SOAP Message Security 1.1 options
    to be supported by the STS.  These particular elements generally refer
    to how keys are referenced within the SOAP envelope.  These are normally handled by Apache CXF.
--&gt;
        &lt;sp:Wss11&gt;
          &lt;wsp:Policy&gt;
            &lt;sp:MustSupportRefIssuerSerial /&gt;
            &lt;sp:MustSupportRefThumbprint /&gt;
            &lt;sp:MustSupportRefEncryptedKey /&gt;
          &lt;/wsp:Policy&gt;
        &lt;/sp:Wss11&gt;
&lt;!--
    The sp:Trust13 element declares controls for WS-Trust 1.3 options.
    They are policy assertions related to exchanges specifically with
    client and server challenges and entropy behaviors.  Again these are
    normally handled by Apache CXF.
--&gt;
        &lt;sp:Trust13&gt;
          &lt;wsp:Policy&gt;
            &lt;sp:MustSupportIssuedTokens /&gt;
            &lt;sp:RequireClientEntropy /&gt;
            &lt;sp:RequireServerEntropy /&gt;
          &lt;/wsp:Policy&gt;
        &lt;/sp:Trust13&gt;
      &lt;/wsp:All&gt;
    &lt;/wsp:ExactlyOne&gt;
  &lt;/wsp:Policy&gt;

&lt;/definitions&gt;</pre></section><section class="section" id="SAML_holder_of_key_assertion_scenario_WSP_SSL_conf"><div class="titlepage"><div><div><h5 class="title">A.8.1.1.2. SSL Configuration</h5></div></div></div><p>
							This web service uses HTTPS, therefore the JBoss EAP server must be configured to provide SSL/TLS support in the <code class="literal">undertow</code> subsystem.
						</p><p>
							For information on how to configure HTTPS for web applications, see <a class="link mimir-link-warn" href="https://access.redhat.com/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/how_to_configure_server_security/#configure_one_way_and_two_way_ssl_tls_for_application" title="This content is not included in Mimir.">Configure One-way and Two-way SSL/TLS for Applications</a> in <span class="emphasis"><em>How to Configure Server Security</em></span>.
						</p></section><section class="section" id="SAML_holder_of_key_assertion_scenario_WSP_interface"><div class="titlepage"><div><div><h5 class="title">A.8.1.1.3. Web Service Provider Interface</h5></div></div></div><p>
							The web service provider interface <code class="literal">HolderOfKeyIface</code> class is a simple web service definition.
						</p><pre class="programlisting language-java">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.holderofkey;

import javax.jws.WebMethod;
import javax.jws.WebService;

@WebService
(
   targetNamespace = "http://www.jboss.org/jbossws/ws-extensions/holderofkeywssecuritypolicy"
)
public interface HolderOfKeyIface {
   @WebMethod
   String sayHello();
}</pre></section><section class="section" id="SAML_holder_of_key_assertion_scenario_WSP_implementation"><div class="titlepage"><div><div><h5 class="title">A.8.1.1.4. Web Service Provider Implementation</h5></div></div></div><p>
							The web service provider implementation <code class="literal">HolderOfKeyImpl</code> class is a simple POJO. It uses the standard <code class="literal">WebService</code> annotation to define the service endpoint. In addition there are two Apache CXF annotations, <code class="literal">EndpointProperties</code> and <code class="literal">EndpointProperty</code> used for configuring the endpoint for the Apache CXF runtime. These annotations come from the Apache WSS4J project, which provides a Java implementation of the primary WS-Security standards for web services. These annotations programmatically add properties to the endpoint. With plain Apache CXF, these properties are often set using the <code class="literal">&lt;jaxws:properties&gt;</code> element on the <code class="literal">&lt;jaxws:endpoint&gt;</code> element in the Spring configuration. These annotations allow the properties to be configured in the code.
						</p><p>
							WSS4J uses the Crypto interface to get keys and certificates for signature creation/verification, as asserted by the WSDL for this service. The WSS4J configuration information provided by <code class="literal">HolderOfKeyImpl</code> is for Crypto’s Merlin implementation.
						</p><p>
							The first <code class="literal">EndpointProperty</code> statement in the listing disables ensurance of compliance with the Basic Security Profile 1.1. The next <code class="literal">EndpointProperty</code> statements declares the Java properties file that contains the (Merlin) Crypto configuration information. The last <code class="literal">EndpointProperty</code> statement declares the <code class="literal">STSHolderOfKeyCallbackHandler</code> implementation class. It is used to obtain the user’s password for the certificates in the keystore file.
						</p><pre class="programlisting language-java">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.holderofkey;

import org.apache.cxf.annotations.EndpointProperties;
import org.apache.cxf.annotations.EndpointProperty;

import javax.jws.WebService;

@WebService
   (
      portName = "HolderOfKeyServicePort",
      serviceName = "HolderOfKeyService",
      wsdlLocation = "WEB-INF/wsdl/HolderOfKeyService.wsdl",
      targetNamespace = "http://www.jboss.org/jbossws/ws-extensions/holderofkeywssecuritypolicy",
      endpointInterface = "org.jboss.test.ws.jaxws.samples.wsse.policy.trust.holderofkey.HolderOfKeyIface"
   )
@EndpointProperties(value = {
   @EndpointProperty(key = "ws-security.is-bsp-compliant", value = "false"),
   @EndpointProperty(key = "ws-security.signature.properties", value = "serviceKeystore.properties"),
   @EndpointProperty(key = "ws-security.callback-handler", value = "org.jboss.test.ws.jaxws.samples.wsse.policy.trust.holderofkey.HolderOfKeyCallbackHandler")
})
public class HolderOfKeyImpl implements HolderOfKeyIface {
   public String sayHello() {
      return "Holder-Of-Key WS-Trust Hello World!";
   }
}</pre></section><section class="section" id="SAML_holder_of_key_assertion_scenario_WSP_crypto_prop_keystore_files"><div class="titlepage"><div><div><h5 class="title">A.8.1.1.5. Crypto Properties and Keystore Files</h5></div></div></div><p>
							WSS4J’s Crypto implementation is loaded and configured using a Java properties file that contains Crypto configuration data. The file contains implementation-specific properties such as a keystore location, password, default alias and so on. This application uses the Merlin implementation. The <code class="literal">serviceKeystore.properties</code> file contains this information.
						</p><p>
							The <code class="literal">servicestore.jks</code> file is a Java KeyStore (JKS) repository. It contains self-signed certificates for <code class="literal">myservicekey</code> and <code class="literal">mystskey</code>.
						</p><pre class="screen">org.apache.ws.security.crypto.provider=org.apache.ws.security.components.crypto.Merlin
org.apache.ws.security.crypto.merlin.keystore.type=jks
org.apache.ws.security.crypto.merlin.keystore.password=sspass
org.apache.ws.security.crypto.merlin.keystore.alias=myservicekey
org.apache.ws.security.crypto.merlin.keystore.file=servicestore.jks</pre></section><section class="section" id="SAML_holder_of_key_assertion_scenario_WSP_manifest"><div class="titlepage"><div><div><h5 class="title">A.8.1.1.6. Default MANIFEST.MF</h5></div></div></div><p>
							This application requires access to JBossWS and Apache CXF APIs provided in the <code class="literal">org.jboss.ws.cxf.jbossws-cxf-client</code> module. The dependency statement directs the server to provide them at deployment.
						</p><pre class="screen">Manifest-Version: 1.0
Dependencies: org.jboss.ws.cxf.jbossws-cxf-client</pre></section></section></section><section class="section" id="scenario_saml_bearer_assertion"><div class="titlepage"><div><div><h3 class="title">A.8.2. Scenario: SAML Bearer Assertion</h3></div></div></div><p>
					WS-Trust manages software security tokens. A SAML assertion is a type of security token. In the SAML Bearer scenario, the service provider automatically trusts that the incoming SOAP request came from the subject defined in the SAML token after the service verifies the token’s signature.
				</p><p>
					Implementation of this scenario has the following requirements.
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							SAML tokens with a <code class="literal">Bearer</code> subject confirmation method must be protected so the token can not be snooped. In most cases, a bearer token combined with HTTPS is sufficient to prevent "a man in the middle" getting possession of the token. This means a security policy that uses a <code class="literal">sp:TransportBinding</code> and <code class="literal">sp:HttpsToken</code>.
						</li><li class="listitem">
							A bearer token has no encryption or signing keys associated with it, therefore a <code class="literal">sp:IssuedToken</code> of <code class="literal">bearer</code> keyType should be used with a <code class="literal">sp:SupportingToken</code> or a <code class="literal">sp:SignedSupportingTokens</code>.
						</li></ul></div><section class="section" id="SAML_bearer_assertion_scenario_WSP"><div class="titlepage"><div><div><h4 class="title">A.8.2.1. Web Service Provider</h4></div></div></div><p>
						This section examines the web service elements for the SAML Bearer scenario. The components include:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<a class="link" href="#SAML_bearer_assertion_scenario_WSP_wsdl" title="A.8.2.1.1. Bearer Web Service Provider WSDL">Bearer Web Service Provider WSDL</a>
							</li><li class="listitem">
								<a class="link" href="#SAML_bearer_assertion_scenario_WSP_ssl_conf" title="A.8.2.1.2. SSL Configuration">SSL Configuration</a>
							</li><li class="listitem">
								<a class="link" href="#SAML_bearer_assertion_scenario_WSP_interface" title="A.8.2.1.3. Bearer Web Service Providers Interface">Bearer Web Service Provider Interface</a>
							</li><li class="listitem">
								<a class="link" href="#SAML_bearer_assertion_scenario_WSP_implementation" title="A.8.2.1.4. Bearer Web Service Providers Implementation">Bearer Web Service Provider Implementation</a>
							</li><li class="listitem">
								<a class="link" href="#SAML_bearer_assertion_scenario_WSP_crypto_prop_keystore_files" title="A.8.2.1.5. Crypto Properties and Keystore Files">Crypto Properties and Keystore Files</a>
							</li><li class="listitem">
								<a class="link" href="#SAML_bearer_assertion_scenario_WSP_manifest" title="A.8.2.1.6. Default MANIFEST.MF">Default MANIFEST.MF</a>
							</li></ul></div><section class="section" id="SAML_bearer_assertion_scenario_WSP_wsdl"><div class="titlepage"><div><div><h5 class="title">A.8.2.1.1. Bearer Web Service Provider WSDL</h5></div></div></div><p>
							The web service provider is a contract-first endpoint. All the WS-trust and security policies for it are declared in the <code class="literal">BearerService.wsdl</code> WSDL. For this scenario, a <code class="literal">ws-requester</code> is required to provide a SAML 2.0 Bearer token issued from a designated STS. The address of the STS is provided in the WSDL. HTTPS, a <code class="literal">TransportBinding</code> and <code class="literal">HttpsToken</code> policy are used to protect the SOAP body of messages that are sent between <code class="literal">ws-requester</code> and <code class="literal">ws-provider</code>. The security settings details are provided as comments in the following listing.
						</p><pre class="programlisting language-xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;definitions targetNamespace="http://www.jboss.org/jbossws/ws-extensions/bearerwssecuritypolicy"
             name="BearerService"
             xmlns:tns="http://www.jboss.org/jbossws/ws-extensions/bearerwssecuritypolicy"
             xmlns:xsd="http://www.w3.org/2001/XMLSchema"
             xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/"
             xmlns="http://schemas.xmlsoap.org/wsdl/"
             xmlns:wsp="http://www.w3.org/ns/ws-policy"
             xmlns:wsam="http://www.w3.org/2007/05/addressing/metadata"
             xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"
             xmlns:wsaws="http://www.w3.org/2005/08/addressing"
             xmlns:wsx="http://schemas.xmlsoap.org/ws/2004/09/mex"
             xmlns:sp="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702"
             xmlns:t="http://docs.oasis-open.org/ws-sx/ws-trust/200512"&gt;

  &lt;types&gt;
    &lt;xsd:schema&gt;
      &lt;xsd:import namespace="http://www.jboss.org/jbossws/ws-extensions/bearerwssecuritypolicy"
                  schemaLocation="BearerService_schema1.xsd"/&gt;
    &lt;/xsd:schema&gt;
  &lt;/types&gt;
  &lt;message name="sayHello"&gt;
    &lt;part name="parameters" element="tns:sayHello"/&gt;
  &lt;/message&gt;
  &lt;message name="sayHelloResponse"&gt;
    &lt;part name="parameters" element="tns:sayHelloResponse"/&gt;
  &lt;/message&gt;
  &lt;portType name="BearerIface"&gt;
    &lt;operation name="sayHello"&gt;
      &lt;input message="tns:sayHello"/&gt;
      &lt;output message="tns:sayHelloResponse"/&gt;
    &lt;/operation&gt;
  &lt;/portType&gt;

&lt;!--
        The wsp:PolicyReference binds the security requirments on all the endpoints.
        The wsp:Policy wsu:Id="#TransportSAML2BearerPolicy" element is defined later in this file.
--&gt;
  &lt;binding name="BearerServicePortBinding" type="tns:BearerIface"&gt;
    &lt;wsp:PolicyReference URI="#TransportSAML2BearerPolicy" /&gt;
    &lt;soap:binding transport="http://schemas.xmlsoap.org/soap/http" style="document"/&gt;
    &lt;operation name="sayHello"&gt;
      &lt;soap:operation soapAction=""/&gt;
      &lt;input&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/input&gt;
      &lt;output&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/output&gt;
    &lt;/operation&gt;
  &lt;/binding&gt;

&lt;!--
  The soap:address has been defined to use JBoss's https port, 8443.  This is
  set in conjunction with the sp:TransportBinding policy for https.
--&gt;
  &lt;service name="BearerService"&gt;
    &lt;port name="BearerServicePort" binding="tns:BearerServicePortBinding"&gt;
      &lt;soap:address location="https://@jboss.bind.address@:8443/jaxws-samples-wsse-policy-trust-bearer/BearerService"/&gt;
    &lt;/port&gt;
  &lt;/service&gt;


  &lt;wsp:Policy wsu:Id="TransportSAML2BearerPolicy"&gt;
    &lt;wsp:ExactlyOne&gt;
      &lt;wsp:All&gt;
  &lt;!--
        The wsam:Addressing element, indicates that the endpoints of this
        web service MUST conform to the WS-Addressing specification.  The
        attribute wsp:Optional="false" enforces this assertion.
  --&gt;
        &lt;wsam:Addressing wsp:Optional="false"&gt;
          &lt;wsp:Policy /&gt;
        &lt;/wsam:Addressing&gt;

&lt;!--
  The sp:TransportBinding element indicates that security is provided by the
  message exchange transport medium, https.  WS-Security policy specification
  defines the sp:HttpsToken for use in exchanging messages transmitted over HTTPS.
--&gt;
        &lt;sp:TransportBinding
          xmlns:sp="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702"&gt;
          &lt;wsp:Policy&gt;
            &lt;sp:TransportToken&gt;
              &lt;wsp:Policy&gt;
                &lt;sp:HttpsToken&gt;
                  &lt;wsp:Policy/&gt;
                &lt;/sp:HttpsToken&gt;
              &lt;/wsp:Policy&gt;
            &lt;/sp:TransportToken&gt;
&lt;!--
     The sp:AlgorithmSuite element, requires the TripleDes algorithm suite
     be used in performing cryptographic operations.
--&gt;
            &lt;sp:AlgorithmSuite&gt;
              &lt;wsp:Policy&gt;
                &lt;sp:TripleDes /&gt;
              &lt;/wsp:Policy&gt;
            &lt;/sp:AlgorithmSuite&gt;
&lt;!--
     The sp:Layout element,  indicates the layout rules to apply when adding
     items to the security header.  The sp:Lax sub-element indicates items
     are added to the security header in any order that conforms to
     WSS: SOAP Message Security.
--&gt;
            &lt;sp:Layout&gt;
              &lt;wsp:Policy&gt;
                &lt;sp:Lax /&gt;
              &lt;/wsp:Policy&gt;
            &lt;/sp:Layout&gt;
            &lt;sp:IncludeTimestamp /&gt;
          &lt;/wsp:Policy&gt;
        &lt;/sp:TransportBinding&gt;

&lt;!--
  The sp:SignedSupportingTokens element causes the supporting tokens
  to be signed using the primary token that is used to sign the message.
--&gt;
        &lt;sp:SignedSupportingTokens
          xmlns:sp="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702"&gt;
          &lt;wsp:Policy&gt;
&lt;!--
  The sp:IssuedToken element asserts that a SAML 2.0 security token of type
  Bearer is expected from the STS.  The
  sp:IncludeToken="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient"&gt;
  attribute instructs the runtime to include the initiator's public key
  with every message sent to the recipient.

  The sp:RequestSecurityTokenTemplate element directs that all of the
  children of this element will be copied directly into the body of the
  RequestSecurityToken (RST) message that is sent to the STS when the
  initiator asks the STS to issue a token.
--&gt;
            &lt;sp:IssuedToken
              sp:IncludeToken="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient"&gt;
              &lt;sp:RequestSecurityTokenTemplate&gt;
                &lt;t:TokenType&gt;http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV2.0&lt;/t:TokenType&gt;
                &lt;t:KeyType&gt;http://docs.oasis-open.org/ws-sx/ws-trust/200512/Bearer&lt;/t:KeyType&gt;
              &lt;/sp:RequestSecurityTokenTemplate&gt;
              &lt;wsp:Policy&gt;
                &lt;sp:RequireInternalReference /&gt;
              &lt;/wsp:Policy&gt;
&lt;!--
  The sp:Issuer element defines the STS's address and endpoint information
  This information is used by the STSClient.
--&gt;
              &lt;sp:Issuer&gt;
                &lt;wsaws:Address&gt;http://@jboss.bind.address@:8080/jaxws-samples-wsse-policy-trust-sts-bearer/SecurityTokenService&lt;/wsaws:Address&gt;
                &lt;wsaws:Metadata
                  xmlns:wsdli="http://www.w3.org/2006/01/wsdl-instance"
                  wsdli:wsdlLocation="http://@jboss.bind.address@:8080/jaxws-samples-wsse-policy-trust-sts-bearer/SecurityTokenService?wsdl"&gt;
                  &lt;wsaw:ServiceName
                    xmlns:wsaw="http://www.w3.org/2006/05/addressing/wsdl"
                    xmlns:stsns="http://docs.oasis-open.org/ws-sx/ws-trust/200512/"
                    EndpointName="UT_Port"&gt;stsns:SecurityTokenService&lt;/wsaw:ServiceName&gt;
                &lt;/wsaws:Metadata&gt;
              &lt;/sp:Issuer&gt;

            &lt;/sp:IssuedToken&gt;
          &lt;/wsp:Policy&gt;
        &lt;/sp:SignedSupportingTokens&gt;
&lt;!--
    The sp:Wss11 element declares WSS: SOAP Message Security 1.1 options
    to be supported by the STS.  These particular elements generally refer
    to how keys are referenced within the SOAP envelope.  These are normally handled by Apache CXF.
--&gt;
        &lt;sp:Wss11&gt;
          &lt;wsp:Policy&gt;
            &lt;sp:MustSupportRefIssuerSerial /&gt;
            &lt;sp:MustSupportRefThumbprint /&gt;
            &lt;sp:MustSupportRefEncryptedKey /&gt;
          &lt;/wsp:Policy&gt;
        &lt;/sp:Wss11&gt;
&lt;!--
    The sp:Trust13 element declares controls for WS-Trust 1.3 options.
    They are policy assertions related to exchanges specifically with
    client and server challenges and entropy behaviors.  Again these are
    normally handled by Apache CXF.
--&gt;
        &lt;sp:Trust13&gt;
          &lt;wsp:Policy&gt;
            &lt;sp:MustSupportIssuedTokens /&gt;
            &lt;sp:RequireClientEntropy /&gt;
            &lt;sp:RequireServerEntropy /&gt;
          &lt;/wsp:Policy&gt;
        &lt;/sp:Trust13&gt;
      &lt;/wsp:All&gt;
    &lt;/wsp:ExactlyOne&gt;
  &lt;/wsp:Policy&gt;

&lt;/definitions&gt;</pre></section><section class="section" id="SAML_bearer_assertion_scenario_WSP_ssl_conf"><div class="titlepage"><div><div><h5 class="title">A.8.2.1.2. SSL Configuration</h5></div></div></div><p>
							This web service is using HTTPS, therefore the JBoss EAP server must be configured to provide SSL support in the <code class="literal">undertow</code> subsystem.
						</p><p>
							For information on how to configure HTTPS for web applications, see <a class="link mimir-link-warn" href="https://access.redhat.com/documentation/en-us/jboss_enterprise_application_platform_continuous_delivery/18/html-single/how_to_configure_server_security/#configure_one_way_and_two_way_ssl_tls_for_application" title="This content is not included in Mimir.">Configure One-way and Two-way SSL/TLS for Applications</a> in <span class="emphasis"><em>How to Configure Server Security</em></span>.
						</p></section><section class="section" id="SAML_bearer_assertion_scenario_WSP_interface"><div class="titlepage"><div><div><h5 class="title">A.8.2.1.3. Bearer Web Service Providers Interface</h5></div></div></div><p>
							The <code class="literal">BearerIface</code> Bearer Web Service Provider Interface class is a simple web service definition.
						</p><pre class="programlisting language-java">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.bearer;

import javax.jws.WebMethod;
import javax.jws.WebService;

@WebService
(
   targetNamespace = "http://www.jboss.org/jbossws/ws-extensions/bearerwssecuritypolicy"
)
public interface BearerIface {
   @WebMethod
   String sayHello();
}</pre></section><section class="section" id="SAML_bearer_assertion_scenario_WSP_implementation"><div class="titlepage"><div><div><h5 class="title">A.8.2.1.4. Bearer Web Service Providers Implementation</h5></div></div></div><p>
							The <code class="literal">BearerImpl</code> Web Service Provider Implementation class is a simple POJO. It uses the standard <code class="literal">WebService</code> annotation to define the service endpoint. In addition there are two Apache CXF annotations, <code class="literal">EndpointProperties</code> and <code class="literal">EndpointProperty</code> used for configuring the endpoint for the Apache CXF runtime. These annotations come from the Apache WSS4J project, which provides a Java implementation of the primary WS-Security standards for web services. These annotations are programmatically adding properties to the endpoint. With plain Apache CXF, these properties are often set using the <code class="literal">&lt;jaxws:properties&gt;</code> element on the <code class="literal">&lt;jaxws:endpoint&gt;</code> element in the Spring configuration. These annotations allow the properties to be configured in the code.
						</p><p>
							WSS4J uses the Crypto interface to get keys and certificates for signature creation/verification, as asserted by the WSDL for this service. The WSS4J configuration information being provided by <code class="literal">BearerImpl</code> is for Crypto’s Merlin implementation.
						</p><p>
							Because the web service provider automatically trusts that the incoming SOAP request that came from the subject defined in the SAML token, it is not required for a Crypto <code class="literal">CallbackHandler</code> class or a signature username, unlike in prior examples. However, in order to verify the message signature, the Java properties file that contains the (Merlin) Crypto configuration information is still required.
						</p><pre class="programlisting language-java">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.bearer;

import org.apache.cxf.annotations.EndpointProperties;
import org.apache.cxf.annotations.EndpointProperty;

import javax.jws.WebService;

@WebService
(
   portName = "BearerServicePort",
   serviceName = "BearerService",
   wsdlLocation = "WEB-INF/wsdl/BearerService.wsdl",
   targetNamespace = "http://www.jboss.org/jbossws/ws-extensions/bearerwssecuritypolicy",
   endpointInterface = "org.jboss.test.ws.jaxws.samples.wsse.policy.trust.bearer.BearerIface"
)
@EndpointProperties(value = {
   @EndpointProperty(key = "ws-security.signature.properties", value = "serviceKeystore.properties")
})
public class BearerImpl implements BearerIface {
   public String sayHello() {
      return "Bearer WS-Trust Hello World!";
   }
}</pre></section><section class="section" id="SAML_bearer_assertion_scenario_WSP_crypto_prop_keystore_files"><div class="titlepage"><div><div><h5 class="title">A.8.2.1.5. Crypto Properties and Keystore Files</h5></div></div></div><p>
							WSS4J’s Crypto implementation is loaded and configured using a Java properties file that contains Crypto configuration data. The file contains implementation-specific properties such as a keystore location, password, default alias and so on. This application is using the Merlin implementation. The <code class="literal">serviceKeystore.properties</code> file contains this information.
						</p><p>
							The <code class="literal">servicestore.jks</code> file is a Java KeyStore (JKS) repository. It contains self-signed certificates for <code class="literal">myservicekey</code> and <code class="literal">mystskey</code>.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								Self-signed certificates are not appropriate for production use.
							</p></div></div><pre class="screen">org.apache.ws.security.crypto.provider=org.apache.ws.security.components.crypto.Merlin
org.apache.ws.security.crypto.merlin.keystore.type=jks
org.apache.ws.security.crypto.merlin.keystore.password=sspass
org.apache.ws.security.crypto.merlin.keystore.alias=myservicekey
org.apache.ws.security.crypto.merlin.keystore.file=servicestore.jks</pre></section><section class="section" id="SAML_bearer_assertion_scenario_WSP_manifest"><div class="titlepage"><div><div><h5 class="title">A.8.2.1.6. Default MANIFEST.MF</h5></div></div></div><p>
							When deployed, this application requires access to the JBossWS and Apache CXF APIs provided in module <code class="literal">org.jboss.ws.cxf.jbossws-cxf-client</code>. The dependency statement directs the server to provide them at deployment.
						</p><pre class="screen">Manifest-Version: 1.0
Dependencies: org.jboss.ws.cxf.jbossws-cxf-client</pre></section></section><section class="section" id="SAML_bearer_assertion_scenario_STS"><div class="titlepage"><div><div><h4 class="title">A.8.2.2. Bearer Security Token Service</h4></div></div></div><p>
						This section lists the crucial elements in providing the Security Token Service functionality for providing a SAML Bearer token. The components include:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<a class="link" href="#SAML_bearer_assertion_scenario_STS_security_domain" title="A.8.2.2.1. Security Domain">Security Domain</a>
							</li><li class="listitem">
								<a class="link" href="#SAML_bearer_assertion_scenario_STS_sts_wsdl" title="A.8.2.2.2. STS WSDL">STS WSDL</a>
							</li><li class="listitem">
								<a class="link" href="#SAML_bearer_assertion_scenario_STS_implementation" title="A.8.2.2.3. STS Implementation Class">STS Implementation Class</a>
							</li><li class="listitem">
								<a class="link" href="#SAML_bearer_assertion_scenario_STS_STSBearerCallbackHandler" title="A.8.2.2.4. STSBearerCallbackHandler Class">STSBearerCallbackHandler Class</a>
							</li><li class="listitem">
								<a class="link" href="#SAML_bearer_assertion_scenario_STS_crypto_prop_keystore_files" title="A.8.2.2.5. Crypto Properties and Keystore Files">Crypto Properties and Keystore Files</a>
							</li><li class="listitem">
								<a class="link" href="#SAML_bearer_assertion_scenario_STS_manifest" title="A.8.2.2.6. Default MANIFEST.MF">Default MANIFEST.MF</a>
							</li></ul></div><section class="section" id="SAML_bearer_assertion_scenario_STS_security_domain"><div class="titlepage"><div><div><h5 class="title">A.8.2.2.1. Security Domain</h5></div></div></div><p>
							STS requires a JBoss security domain be configured. The <code class="literal">jboss-web.xml</code> descriptor declares a named security domain,<code class="literal">JBossWS-trust-sts</code> to be used by this service for authentication. This security domain requires two properties files and the addition of a security domain declaration in the JBoss EAP server configuration file.
						</p><p>
							For this scenario the domain needs to contain user <code class="literal">alice</code>, password <code class="literal">clarinet</code>, and role <code class="literal">friend</code>. Refer to the following listings for <code class="literal">jbossws-users.properties</code> and <code class="literal">jbossws-roles.properties</code>. In addition, the following XML must be added to the JBoss <code class="literal">security</code> subsystem in the server configuration file.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								Replace "SOME_PATH" with appropriate information.
							</p></div></div><pre class="programlisting language-xml">&lt;security-domain name="JBossWS-trust-sts"&gt;
  &lt;authentication&gt;
    &lt;login-module code="UsersRoles" flag="required"&gt;
      &lt;module-option name="usersProperties" value="/<span class="emphasis"><em>SOME_PATH</em></span>/jbossws-users.properties"/&gt;
      &lt;module-option name="unauthenticatedIdentity" value="anonymous"/&gt;
      &lt;module-option name="rolesProperties" value="/<span class="emphasis"><em>SOME_PATH</em></span>/jbossws-roles.properties"/&gt;
    &lt;/login-module&gt;
  &lt;/authentication&gt;
&lt;/security-domain&gt;</pre><div class="formalpara"><p class="title"><strong>Example: <code class="literal">.jboss-web.xml</code> File</strong></p><p>
								
<pre class="programlisting language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE jboss-web PUBLIC "-//JBoss//DTD Web Application 2.4//EN" "&gt;
&lt;jboss-web&gt;
  &lt;security-domain&gt;java:/jaas/JBossWS-trust-sts&lt;/security-domain&gt;
&lt;/jboss-web&gt;</pre>

							</p></div><div class="formalpara"><p class="title"><strong>Example: <code class="literal">.jbossws-users.properties</code> File</strong></p><p>
								
<pre class="screen"># A sample users.properties file for use with the UsersRolesLoginModule
alice=clarinet</pre>

							</p></div><div class="formalpara"><p class="title"><strong>Example: <code class="literal">jbossws-roles.properties</code> File</strong></p><p>
								
<pre class="screen"># A sample roles.properties file for use with the UsersRolesLoginModule
alice=friend</pre>

							</p></div></section><section class="section" id="SAML_bearer_assertion_scenario_STS_sts_wsdl"><div class="titlepage"><div><div><h5 class="title">A.8.2.2.2. STS WSDL</h5></div></div></div><pre class="programlisting language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;wsdl:definitions
  targetNamespace="http://docs.oasis-open.org/ws-sx/ws-trust/200512/"
  xmlns:tns="http://docs.oasis-open.org/ws-sx/ws-trust/200512/"
  xmlns:wstrust="http://docs.oasis-open.org/ws-sx/ws-trust/200512/"
  xmlns:wsdl="http://schemas.xmlsoap.org/wsdl/"
  xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/"
  xmlns:wsap10="http://www.w3.org/2006/05/addressing/wsdl"
  xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"
  xmlns:wsp="http://www.w3.org/ns/ws-policy"
  xmlns:wst="http://docs.oasis-open.org/ws-sx/ws-trust/200512"
  xmlns:xs="http://www.w3.org/2001/XMLSchema"
  xmlns:wsam="http://www.w3.org/2007/05/addressing/metadata"&gt;

  &lt;wsdl:types&gt;
    &lt;xs:schema elementFormDefault="qualified"
               targetNamespace='http://docs.oasis-open.org/ws-sx/ws-trust/200512'&gt;

      &lt;xs:element name='RequestSecurityToken'
                  type='wst:AbstractRequestSecurityTokenType'/&gt;
      &lt;xs:element name='RequestSecurityTokenResponse'
                  type='wst:AbstractRequestSecurityTokenType'/&gt;

      &lt;xs:complexType name='AbstractRequestSecurityTokenType'&gt;
        &lt;xs:sequence&gt;
          &lt;xs:any namespace='##any' processContents='lax' minOccurs='0'
                  maxOccurs='unbounded'/&gt;
        &lt;/xs:sequence&gt;
        &lt;xs:attribute name='Context' type='xs:anyURI' use='optional'/&gt;
        &lt;xs:anyAttribute namespace='##other' processContents='lax'/&gt;
      &lt;/xs:complexType&gt;
      &lt;xs:element name='RequestSecurityTokenCollection'
                  type='wst:RequestSecurityTokenCollectionType'/&gt;
      &lt;xs:complexType name='RequestSecurityTokenCollectionType'&gt;
        &lt;xs:sequence&gt;
          &lt;xs:element name='RequestSecurityToken'
                      type='wst:AbstractRequestSecurityTokenType' minOccurs='2'
                      maxOccurs='unbounded'/&gt;
        &lt;/xs:sequence&gt;
      &lt;/xs:complexType&gt;

      &lt;xs:element name='RequestSecurityTokenResponseCollection'
                  type='wst:RequestSecurityTokenResponseCollectionType'/&gt;
      &lt;xs:complexType name='RequestSecurityTokenResponseCollectionType'&gt;
        &lt;xs:sequence&gt;
          &lt;xs:element ref='wst:RequestSecurityTokenResponse' minOccurs='1'
                      maxOccurs='unbounded'/&gt;
        &lt;/xs:sequence&gt;
        &lt;xs:anyAttribute namespace='##other' processContents='lax'/&gt;
      &lt;/xs:complexType&gt;

    &lt;/xs:schema&gt;
  &lt;/wsdl:types&gt;

  &lt;!-- WS-Trust defines the following GEDs --&gt;
  &lt;wsdl:message name="RequestSecurityTokenMsg"&gt;
    &lt;wsdl:part name="request" element="wst:RequestSecurityToken"/&gt;
  &lt;/wsdl:message&gt;
  &lt;wsdl:message name="RequestSecurityTokenResponseMsg"&gt;
    &lt;wsdl:part name="response"
               element="wst:RequestSecurityTokenResponse"/&gt;
  &lt;/wsdl:message&gt;
  &lt;wsdl:message name="RequestSecurityTokenCollectionMsg"&gt;
    &lt;wsdl:part name="requestCollection"
               element="wst:RequestSecurityTokenCollection"/&gt;
  &lt;/wsdl:message&gt;
  &lt;wsdl:message name="RequestSecurityTokenResponseCollectionMsg"&gt;
    &lt;wsdl:part name="responseCollection"
               element="wst:RequestSecurityTokenResponseCollection"/&gt;
  &lt;/wsdl:message&gt;

  &lt;!-- This portType an example of a Requestor (or other) endpoint that
  Accepts SOAP-based challenges from a Security Token Service --&gt;
  &lt;wsdl:portType name="WSSecurityRequestor"&gt;
    &lt;wsdl:operation name="Challenge"&gt;
      &lt;wsdl:input message="tns:RequestSecurityTokenResponseMsg"/&gt;
      &lt;wsdl:output message="tns:RequestSecurityTokenResponseMsg"/&gt;
    &lt;/wsdl:operation&gt;
  &lt;/wsdl:portType&gt;

  &lt;!-- This portType is an example of an STS supporting full protocol --&gt;
  &lt;!--
      The wsdl:portType and data types are XML elements defined by the
      WS_Trust specification.  The wsdl:portType defines the endpoints
      supported in the STS implementation.  This WSDL defines all operations
      that an STS implementation can support.
  --&gt;
  &lt;wsdl:portType name="STS"&gt;
    &lt;wsdl:operation name="Cancel"&gt;
      &lt;wsdl:input
        wsam:Action="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/Cancel"
        message="tns:RequestSecurityTokenMsg"/&gt;
      &lt;wsdl:output
        wsam:Action="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RSTR/CancelFinal"
        message="tns:RequestSecurityTokenResponseMsg"/&gt;
    &lt;/wsdl:operation&gt;
    &lt;wsdl:operation name="Issue"&gt;
      &lt;wsdl:input
        wsam:Action="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/Issue"
        message="tns:RequestSecurityTokenMsg"/&gt;
      &lt;wsdl:output
        wsam:Action="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RSTRC/IssueFinal"
        message="tns:RequestSecurityTokenResponseCollectionMsg"/&gt;
    &lt;/wsdl:operation&gt;
    &lt;wsdl:operation name="Renew"&gt;
      &lt;wsdl:input
        wsam:Action="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/Renew"
        message="tns:RequestSecurityTokenMsg"/&gt;
      &lt;wsdl:output
        wsam:Action="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RSTR/RenewFinal"
        message="tns:RequestSecurityTokenResponseMsg"/&gt;
    &lt;/wsdl:operation&gt;
    &lt;wsdl:operation name="Validate"&gt;
      &lt;wsdl:input
        wsam:Action="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/Validate"
        message="tns:RequestSecurityTokenMsg"/&gt;
      &lt;wsdl:output
        wsam:Action="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RSTR/ValidateFinal"
        message="tns:RequestSecurityTokenResponseMsg"/&gt;
    &lt;/wsdl:operation&gt;
    &lt;wsdl:operation name="KeyExchangeToken"&gt;
      &lt;wsdl:input
        wsam:Action="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/KET"
        message="tns:RequestSecurityTokenMsg"/&gt;
      &lt;wsdl:output
        wsam:Action="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RSTR/KETFinal"
        message="tns:RequestSecurityTokenResponseMsg"/&gt;
    &lt;/wsdl:operation&gt;
    &lt;wsdl:operation name="RequestCollection"&gt;
      &lt;wsdl:input message="tns:RequestSecurityTokenCollectionMsg"/&gt;
      &lt;wsdl:output message="tns:RequestSecurityTokenResponseCollectionMsg"/&gt;
    &lt;/wsdl:operation&gt;
  &lt;/wsdl:portType&gt;

  &lt;!-- This portType is an example of an endpoint that accepts
  Unsolicited RequestSecurityTokenResponse messages --&gt;
  &lt;wsdl:portType name="SecurityTokenResponseService"&gt;
    &lt;wsdl:operation name="RequestSecurityTokenResponse"&gt;
      &lt;wsdl:input message="tns:RequestSecurityTokenResponseMsg"/&gt;
    &lt;/wsdl:operation&gt;
  &lt;/wsdl:portType&gt;

  &lt;!--
      The wsp:PolicyReference binds the security requirments on all the STS endpoints.
      The wsp:Policy wsu:Id="UT_policy" element is later in this file.
  --&gt;
  &lt;wsdl:binding name="UT_Binding" type="wstrust:STS"&gt;
    &lt;wsp:PolicyReference URI="#UT_policy"/&gt;
    &lt;soap:binding style="document"
                  transport="http://schemas.xmlsoap.org/soap/http"/&gt;
    &lt;wsdl:operation name="Issue"&gt;
      &lt;soap:operation
        soapAction="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/Issue"/&gt;
      &lt;wsdl:input&gt;
        &lt;wsp:PolicyReference
          URI="#Input_policy"/&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/wsdl:input&gt;
      &lt;wsdl:output&gt;
        &lt;wsp:PolicyReference
          URI="#Output_policy"/&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/wsdl:output&gt;
    &lt;/wsdl:operation&gt;
    &lt;wsdl:operation name="Validate"&gt;
      &lt;soap:operation
        soapAction="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/Validate"/&gt;
      &lt;wsdl:input&gt;
        &lt;wsp:PolicyReference
          URI="#Input_policy"/&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/wsdl:input&gt;
      &lt;wsdl:output&gt;
        &lt;wsp:PolicyReference
          URI="#Output_policy"/&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/wsdl:output&gt;
    &lt;/wsdl:operation&gt;
    &lt;wsdl:operation name="Cancel"&gt;
      &lt;soap:operation
        soapAction="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/Cancel"/&gt;
      &lt;wsdl:input&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/wsdl:input&gt;
      &lt;wsdl:output&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/wsdl:output&gt;
    &lt;/wsdl:operation&gt;
    &lt;wsdl:operation name="Renew"&gt;
      &lt;soap:operation
        soapAction="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/Renew"/&gt;
      &lt;wsdl:input&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/wsdl:input&gt;
      &lt;wsdl:output&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/wsdl:output&gt;
    &lt;/wsdl:operation&gt;
    &lt;wsdl:operation name="KeyExchangeToken"&gt;
      &lt;soap:operation
        soapAction="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/KeyExchangeToken"/&gt;
      &lt;wsdl:input&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/wsdl:input&gt;
      &lt;wsdl:output&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/wsdl:output&gt;
    &lt;/wsdl:operation&gt;
    &lt;wsdl:operation name="RequestCollection"&gt;
      &lt;soap:operation
        soapAction="http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/RequestCollection"/&gt;
      &lt;wsdl:input&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/wsdl:input&gt;
      &lt;wsdl:output&gt;
        &lt;soap:body use="literal"/&gt;
      &lt;/wsdl:output&gt;
    &lt;/wsdl:operation&gt;
  &lt;/wsdl:binding&gt;

  &lt;wsdl:service name="SecurityTokenService"&gt;
    &lt;wsdl:port name="UT_Port" binding="tns:UT_Binding"&gt;
      &lt;soap:address location="http://localhost:8080/SecurityTokenService/UT"/&gt;
    &lt;/wsdl:port&gt;
  &lt;/wsdl:service&gt;


  &lt;wsp:Policy wsu:Id="UT_policy"&gt;
    &lt;wsp:ExactlyOne&gt;
      &lt;wsp:All&gt;
        &lt;!--
            The sp:UsingAddressing element, indicates that the endpoints of this
            web service conforms to the WS-Addressing specification.  More detail
            can be found here: [http://www.w3.org/TR/2006/CR-ws-addr-wsdl-20060529]
        --&gt;
        &lt;wsap10:UsingAddressing/&gt;
        &lt;!--
            The sp:SymmetricBinding element indicates that security is provided
            at the SOAP layer and any initiator must authenticate itself by providing
            WSS UsernameToken credentials.
        --&gt;
        &lt;sp:SymmetricBinding
          xmlns:sp="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702"&gt;
          &lt;wsp:Policy&gt;
            &lt;!--
                In a symmetric binding, the keys used for encrypting and signing in both
                directions are derived from a single key, the one specified by the
                sp:ProtectionToken element.  The sp:X509Token sub-element declares this
                key to be a X.509 certificate and the
                IncludeToken="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never"
                attribute adds the requirement that the token MUST NOT be included in
                any messages sent between the initiator and the recipient; rather, an
                external reference to the token should be used.  Lastly the WssX509V3Token10
                sub-element declares that the Username token presented by the initiator
                should be compliant with Web Services Security UsernameToken Profile
                1.0 specification. [ http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0.pdf ]
            --&gt;
            &lt;sp:ProtectionToken&gt;
              &lt;wsp:Policy&gt;
                &lt;sp:X509Token
                  sp:IncludeToken="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/Never"&gt;
                  &lt;wsp:Policy&gt;
                    &lt;sp:RequireDerivedKeys/&gt;
                    &lt;sp:RequireThumbprintReference/&gt;
                    &lt;sp:WssX509V3Token10/&gt;
                  &lt;/wsp:Policy&gt;
                &lt;/sp:X509Token&gt;
              &lt;/wsp:Policy&gt;
            &lt;/sp:ProtectionToken&gt;
            &lt;!--
                The sp:AlgorithmSuite element, requires the Basic256 algorithm suite
                be used in performing cryptographic operations.
            --&gt;
            &lt;sp:AlgorithmSuite&gt;
              &lt;wsp:Policy&gt;
                &lt;sp:Basic256/&gt;
              &lt;/wsp:Policy&gt;
            &lt;/sp:AlgorithmSuite&gt;
            &lt;!--
                The sp:Layout element,  indicates the layout rules to apply when adding
                items to the security header.  The sp:Lax sub-element indicates items
                are added to the security header in any order that conforms to
                WSS: SOAP Message Security.
            --&gt;
            &lt;sp:Layout&gt;
              &lt;wsp:Policy&gt;
                &lt;sp:Lax/&gt;
              &lt;/wsp:Policy&gt;
            &lt;/sp:Layout&gt;
            &lt;sp:IncludeTimestamp/&gt;
            &lt;sp:EncryptSignature/&gt;
            &lt;sp:OnlySignEntireHeadersAndBody/&gt;
          &lt;/wsp:Policy&gt;
        &lt;/sp:SymmetricBinding&gt;

        &lt;!--
            The sp:SignedSupportingTokens element declares that the security header
            of messages must contain a sp:UsernameToken and the token must be signed.
            The attribute IncludeToken="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient"
            on sp:UsernameToken indicates that the token MUST be included in all
            messages sent from initiator to the recipient and that the token MUST
            NOT be included in messages sent from the recipient to the initiator.
            And finally the element sp:WssUsernameToken10 is a policy assertion
            indicating the Username token should be as defined in  Web Services
            Security UsernameToken Profile 1.0
        --&gt;
        &lt;sp:SignedSupportingTokens
          xmlns:sp="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702"&gt;
          &lt;wsp:Policy&gt;
            &lt;sp:UsernameToken
              sp:IncludeToken="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/IncludeToken/AlwaysToRecipient"&gt;
              &lt;wsp:Policy&gt;
                &lt;sp:WssUsernameToken10/&gt;
              &lt;/wsp:Policy&gt;
            &lt;/sp:UsernameToken&gt;
          &lt;/wsp:Policy&gt;
        &lt;/sp:SignedSupportingTokens&gt;
        &lt;!--
            The sp:Wss11 element declares WSS: SOAP Message Security 1.1 options
            to be supported by the STS.  These particular elements generally refer
            to how keys are referenced within the SOAP envelope.  These are normally
            handled by Apache CXF.
        --&gt;
        &lt;sp:Wss11
          xmlns:sp="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702"&gt;
          &lt;wsp:Policy&gt;
            &lt;sp:MustSupportRefKeyIdentifier/&gt;
            &lt;sp:MustSupportRefIssuerSerial/&gt;
            &lt;sp:MustSupportRefThumbprint/&gt;
            &lt;sp:MustSupportRefEncryptedKey/&gt;
          &lt;/wsp:Policy&gt;
        &lt;/sp:Wss11&gt;
        &lt;!--
            The sp:Trust13 element declares controls for WS-Trust 1.3 options.
            They are policy assertions related to exchanges specifically with
            client and server challenges and entropy behaviors.  Again these are
            normally handled by Apache CXF.
        --&gt;
        &lt;sp:Trust13
          xmlns:sp="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702"&gt;
          &lt;wsp:Policy&gt;
            &lt;sp:MustSupportIssuedTokens/&gt;
            &lt;sp:RequireClientEntropy/&gt;
            &lt;sp:RequireServerEntropy/&gt;
          &lt;/wsp:Policy&gt;
        &lt;/sp:Trust13&gt;
      &lt;/wsp:All&gt;
    &lt;/wsp:ExactlyOne&gt;
  &lt;/wsp:Policy&gt;

  &lt;wsp:Policy wsu:Id="Input_policy"&gt;
    &lt;wsp:ExactlyOne&gt;
      &lt;wsp:All&gt;
        &lt;sp:SignedParts
          xmlns:sp="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702"&gt;
          &lt;sp:Body/&gt;
          &lt;sp:Header Name="To"
                     Namespace="http://www.w3.org/2005/08/addressing"/&gt;
          &lt;sp:Header Name="From"
                     Namespace="http://www.w3.org/2005/08/addressing"/&gt;
          &lt;sp:Header Name="FaultTo"
                     Namespace="http://www.w3.org/2005/08/addressing"/&gt;
          &lt;sp:Header Name="ReplyTo"
                     Namespace="http://www.w3.org/2005/08/addressing"/&gt;
          &lt;sp:Header Name="MessageID"
                     Namespace="http://www.w3.org/2005/08/addressing"/&gt;
          &lt;sp:Header Name="RelatesTo"
                     Namespace="http://www.w3.org/2005/08/addressing"/&gt;
          &lt;sp:Header Name="Action"
                     Namespace="http://www.w3.org/2005/08/addressing"/&gt;
        &lt;/sp:SignedParts&gt;
      &lt;/wsp:All&gt;
    &lt;/wsp:ExactlyOne&gt;
  &lt;/wsp:Policy&gt;

  &lt;wsp:Policy wsu:Id="Output_policy"&gt;
    &lt;wsp:ExactlyOne&gt;
      &lt;wsp:All&gt;
        &lt;sp:SignedParts
          xmlns:sp="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702"&gt;
          &lt;sp:Body/&gt;
          &lt;sp:Header Name="To"
                     Namespace="http://www.w3.org/2005/08/addressing"/&gt;
          &lt;sp:Header Name="From"
                     Namespace="http://www.w3.org/2005/08/addressing"/&gt;
          &lt;sp:Header Name="FaultTo"
                     Namespace="http://www.w3.org/2005/08/addressing"/&gt;
          &lt;sp:Header Name="ReplyTo"
                     Namespace="http://www.w3.org/2005/08/addressing"/&gt;
          &lt;sp:Header Name="MessageID"
                     Namespace="http://www.w3.org/2005/08/addressing"/&gt;
          &lt;sp:Header Name="RelatesTo"
                     Namespace="http://www.w3.org/2005/08/addressing"/&gt;
          &lt;sp:Header Name="Action"
                     Namespace="http://www.w3.org/2005/08/addressing"/&gt;
        &lt;/sp:SignedParts&gt;
      &lt;/wsp:All&gt;
    &lt;/wsp:ExactlyOne&gt;
  &lt;/wsp:Policy&gt;

&lt;/wsdl:definitions&gt;</pre></section><section class="section" id="SAML_bearer_assertion_scenario_STS_implementation"><div class="titlepage"><div><div><h5 class="title">A.8.2.2.3. STS Implementation Class</h5></div></div></div><p>
							The Apache CXF’s STS, <code class="literal">SecurityTokenServiceProvider</code>, is a web service provider that is compliant with the protocols and functionality defined by the WS-Trust specification. It has a modular architecture and its components are configurable or replaceable. There are optional features that are enabled by implementing and configuring plugins. You can customize your own STS by extending from <code class="literal">SecurityTokenServiceProvider</code> and overriding the default settings.
						</p><p>
							The <code class="literal">SampleSTSBearer</code> STS implementation class is a POJO that extends from <code class="literal">SecurityTokenServiceProvider</code>.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								The <code class="literal">SampleSTSBearer</code> class is defined with a <code class="literal">WebServiceProvider</code> annotation and not a <code class="literal">WebService</code> annotation. This annotation defines the service as a <code class="literal">Provider</code>-based endpoint, it supports a messaging-oriented approach to web services. In particular, it signals that the exchanged messages will be XML documents. <code class="literal">SecurityTokenServiceProvider</code> is an implementation of the <code class="literal">javax.xml.ws.Provider</code> interface. In comparison the <code class="literal">WebService</code> annotation defines a service endpoint interface-based endpoint, which supports message exchange using SOAP envelopes.
							</p></div></div><p>
							As done in the <code class="literal">BearerImpl</code> class, the WSS4J annotations <code class="literal">EndpointProperties</code> and <code class="literal">EndpointProperty</code> provide endpoint configuration for the Apache CXF runtime. The first <code class="literal">EndpointProperty</code> statement in the listing is declaring the user’s name to use for the message signature. It is used as the alias name in the keystore to get the user’s certificate and private key for signature. The next two <code class="literal">EndpointProperty</code> statements declare the Java properties file that contains the (Merlin) Crypto configuration information. In this case both for signing and encrypting the messages. WSS4J reads this file and required information for message handling. The last <code class="literal">EndpointProperty</code> statement declares the <code class="literal">STSBearerCallbackHandler</code> implementation class. It is used to obtain the user’s password for the certificates in the keystore file.
						</p><p>
							In this implementation we are customizing the operations of token issuance, token validation, and their static properties.
						</p><p>
							<code class="literal">StaticSTSProperties</code> is used to set select properties for configuring resources in STS. This may seem like duplication of the settings made with the WSS4J annotations. The values are the same but the underlaying structures being set are different, thus this information must be declared in both places.
						</p><p>
							The <code class="literal">setIssuer</code> setting is important because it uniquely identifies the issuing STS. The issuer string is embedded in issued tokens and, when validating tokens, the STS checks the issuer string value. Consequently, it is important to use the issuer string in a consistent way, so that the STS can recognize the tokens that are issued.
						</p><p>
							The <code class="literal">setEndpoints</code> call allows the declaration of a set of allowed token recipients by address. The addresses are specified as reg-ex patterns.
						</p><p>
							<code class="literal">TokenIssueOperation</code> has a modular structure. This allows custom behaviors to be injected into the processing of messages. In this case we are overriding the <code class="literal">SecurityTokenServiceProvider</code> default behavior and performing SAML token processing. Apache CXF provides an implementation of a <code class="literal">SAMLTokenProvider</code>, which can be used rather than creating one.
						</p><pre class="programlisting language-java">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.stsbearer;

import org.apache.cxf.annotations.EndpointProperties;
import org.apache.cxf.annotations.EndpointProperty;
import org.apache.cxf.sts.StaticSTSProperties;
import org.apache.cxf.sts.operation.TokenIssueOperation;
import org.apache.cxf.sts.service.ServiceMBean;
import org.apache.cxf.sts.service.StaticService;
import org.apache.cxf.sts.token.provider.SAMLTokenProvider;
import org.apache.cxf.ws.security.sts.provider.SecurityTokenServiceProvider;

import javax.xml.ws.WebServiceProvider;
import java.util.Arrays;
import java.util.LinkedList;
import java.util.List;

@WebServiceProvider(serviceName = "SecurityTokenService",
      portName = "UT_Port",
      targetNamespace = "http://docs.oasis-open.org/ws-sx/ws-trust/200512/",
      wsdlLocation = "WEB-INF/wsdl/bearer-ws-trust-1.4-service.wsdl")
//dependency on org.apache.cxf module or on module that exports org.apache.cxf (e.g. org.jboss.ws.cxf.jbossws-cxf-client) is needed, otherwise Apache CXF annotations are ignored
@EndpointProperties(value = {
      @EndpointProperty(key = "ws-security.signature.username", value = "mystskey"),
      @EndpointProperty(key = "ws-security.signature.properties", value = "stsKeystore.properties"),
      @EndpointProperty(key = "ws-security.callback-handler", value = "org.jboss.test.ws.jaxws.samples.wsse.policy.trust.stsbearer.STSBearerCallbackHandler")
})
public class SampleSTSBearer extends SecurityTokenServiceProvider {

   public SampleSTSBearer() throws Exception {
      super();

      StaticSTSProperties props = new StaticSTSProperties();
      props.setSignatureCryptoProperties("stsKeystore.properties");
      props.setSignatureUsername("mystskey");
      props.setCallbackHandlerClass(STSBearerCallbackHandler.class.getName());
      props.setEncryptionCryptoProperties("stsKeystore.properties");
      props.setEncryptionUsername("myservicekey");
      props.setIssuer("DoubleItSTSIssuer");

      List&lt;ServiceMBean&gt; services = new LinkedList&lt;ServiceMBean&gt;();
      StaticService service = new StaticService();
      service.setEndpoints(Arrays.asList(
         "https://localhost:(\\d)*/jaxws-samples-wsse-policy-trust-bearer/BearerService",
         "https://\\[::1\\]:(\\d)*/jaxws-samples-wsse-policy-trust-bearer/BearerService",
         "https://\\[0:0:0:0:0:0:0:1\\]:(\\d)*/jaxws-samples-wsse-policy-trust-bearer/BearerService"
      ));
      services.add(service);

      TokenIssueOperation issueOperation = new TokenIssueOperation();
      issueOperation.getTokenProviders().add(new SAMLTokenProvider());
      issueOperation.setServices(services);
      issueOperation.setStsProperties(props);
      this.setIssueOperation(issueOperation);
   }
}</pre></section><section class="section" id="SAML_bearer_assertion_scenario_STS_STSBearerCallbackHandler"><div class="titlepage"><div><div><h5 class="title">A.8.2.2.4. STSBearerCallbackHandler Class</h5></div></div></div><p>
							<code class="literal">STSBearerCallbackHandler</code> is a callback handler for the WSS4J Crypto API. It is used to obtain the password for the private key in the keystore. This class enables Apache CXF to retrieve the password of the user name to use for the message signature.
						</p><pre class="programlisting language-java">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.stsbearer;

import org.jboss.wsf.stack.cxf.extensions.security.PasswordCallbackHandler;

import java.util.HashMap;
import java.util.Map;

public class STSBearerCallbackHandler extends PasswordCallbackHandler {
   public STSBearerCallbackHandler() {
      super(getInitMap());
   }

   private static Map&lt;String, String&gt; getInitMap() {
      Map&lt;String, String&gt; passwords = new HashMap&lt;String, String&gt;();
      passwords.put("mystskey", "stskpass");
      passwords.put("alice", "clarinet");
      return passwords;
   }
}</pre></section><section class="section" id="SAML_bearer_assertion_scenario_STS_crypto_prop_keystore_files"><div class="titlepage"><div><div><h5 class="title">A.8.2.2.5. Crypto Properties and Keystore Files</h5></div></div></div><p>
							WSS4J’s Crypto implementation is loaded and configured using a Java properties file that contains Crypto configuration data. The file contains implementation-specific properties such as a keystore location, password, default alias and so on. This application is using the Merlin implementation. The <code class="literal">stsKeystore.properties</code> file contains this information.
						</p><p>
							The <code class="literal">servicestore.jks</code> file is a Java KeyStore (JKS) repository. It contains self-signed certificates for <code class="literal">myservicekey</code> and <code class="literal">mystskey</code>.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								Self-signed certificates are not appropriate for production use.
							</p></div></div><pre class="programlisting language-java">org.apache.ws.security.crypto.provider=org.apache.ws.security.components.crypto.Merlin
org.apache.ws.security.crypto.merlin.keystore.type=jks
org.apache.ws.security.crypto.merlin.keystore.password=stsspass
org.apache.ws.security.crypto.merlin.keystore.file=stsstore.jks</pre></section><section class="section" id="SAML_bearer_assertion_scenario_STS_manifest"><div class="titlepage"><div><div><h5 class="title">A.8.2.2.6. Default MANIFEST.MF</h5></div></div></div><p>
							This application requires access to the JBossWS and Apache CXF APIs provided in the <code class="literal">org.jboss.ws.cxf.jbossws-cxf-client</code> module. The <code class="literal">org.jboss.ws.cxf.sts</code> module is also needed to build the STS configuration in the <code class="literal">SampleSTS</code> constructor. The dependency statement directs the server to provide them at deployment.
						</p><pre class="screen">Manifest-Version: 1.0
Dependencies: org.jboss.ws.cxf.jbossws-cxf-client,org.jboss.ws.cxf.sts</pre></section></section><section class="section" id="SAML_bearer_assertion_scenario_WSR"><div class="titlepage"><div><div><h4 class="title">A.8.2.3. Web Service Requester</h4></div></div></div><p>
						This section provides the details of crucial elements in calling a web service that implements endpoint security as described in the SAML Bearer scenario. The components that will be discussed include:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<a class="link" href="#SAML_bearer_assertion_scenario_WSR_implementation" title="A.8.2.3.1. Web Service Requester Implementation">Web Service Requester Implementation</a>
							</li><li class="listitem">
								<a class="link" href="#SAML_bearer_assertion_scenario_WSR_ClientCallbackHandler" title="A.8.2.3.2. ClientCallbackHandler">ClientCallbackHandler</a>
							</li><li class="listitem">
								<a class="link" href="#SAML_bearer_assertion_scenario_WSR_crypto_prop_keystore_files" title="A.8.2.3.3. Crypto Properties and Keystore Files">Crypto Properties and Keystore Files</a>
							</li></ul></div><section class="section" id="SAML_bearer_assertion_scenario_WSR_implementation"><div class="titlepage"><div><div><h5 class="title">A.8.2.3.1. Web Service Requester Implementation</h5></div></div></div><p>
							The <code class="literal">ws-requester</code>, the client, uses standard procedures for creating a reference to the web service. To address the endpoint security requirements, the web service’s "Request Context" is configured with the information required for message generation. In addition, the <code class="literal">STSClient</code> that communicates with the STS is configured with similar values.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								The key strings ending with a <code class="literal">.it</code> suffix flags these settings as belonging to the <code class="literal">STSClient</code>. The internal Apache CXF code assigns this information to the <code class="literal">STSClient</code> that is auto-generated for this service call.
							</p></div></div><p>
							There is an alternate method of setting up the <code class="literal">STSCLient</code>. The user may provide their own instance of the <code class="literal">STSClient</code>. The Apache CXF code uses this object and does not auto-generate one. When providing the <code class="literal">STSClient</code> in this way, the user must provide a <code class="literal">org.apache.cxf.Bus</code> for it and the configuration keys must not have the <code class="literal">.it</code> suffix. This is used in the <a class="link" href="#ActAs_ws_trust_scenario_WSP_ActAsCallbackHandler" title="A.8.4.1.4. ActAsCallbackHandler Class">ActAs</a> and <a class="link" href="#OnBehalfOf_ws_trust_scenario_WSR_implementation" title="A.8.3.2.1. OnBehalfOf Web Service Requester Implementation Class">OnBehalfOf</a> examples.
						</p><pre class="programlisting language-java">String serviceURL = "https://" + getServerHost() + ":8443/jaxws-samples-wsse-policy-trust-bearer/BearerService";

final QName serviceName = new QName("http://www.jboss.org/jbossws/ws-extensions/bearerwssecuritypolicy", "BearerService");
Service service = Service.create(new URL(serviceURL + "?wsdl"), serviceName);
BearerIface proxy = (BearerIface) service.getPort(BearerIface.class);

Map&lt;String, Object&gt; ctx = ((BindingProvider)proxy).getRequestContext();

// set the security related configuration information for the service "request"
ctx.put(SecurityConstants.CALLBACK_HANDLER, new ClientCallbackHandler());
ctx.put(SecurityConstants.SIGNATURE_PROPERTIES,
  Thread.currentThread().getContextClassLoader().getResource(
  "META-INF/clientKeystore.properties"));
ctx.put(SecurityConstants.ENCRYPT_PROPERTIES,
  Thread.currentThread().getContextClassLoader().getResource(
  "META-INF/clientKeystore.properties"));
ctx.put(SecurityConstants.SIGNATURE_USERNAME, "myclientkey");
ctx.put(SecurityConstants.ENCRYPT_USERNAME, "myservicekey");

//-- Configuration settings that will be transfered to the STSClient
// "alice" is the name provided for the WSS Username. Her password will
// be retreived from the ClientCallbackHander by the STSClient.
ctx.put(SecurityConstants.USERNAME + ".it", "alice");
ctx.put(SecurityConstants.CALLBACK_HANDLER + ".it", new ClientCallbackHandler());
ctx.put(SecurityConstants.ENCRYPT_PROPERTIES + ".it",
  Thread.currentThread().getContextClassLoader().getResource(
  "META-INF/clientKeystore.properties"));
ctx.put(SecurityConstants.ENCRYPT_USERNAME + ".it", "mystskey");
ctx.put(SecurityConstants.STS_TOKEN_USERNAME + ".it", "myclientkey");
ctx.put(SecurityConstants.STS_TOKEN_PROPERTIES + ".it",
  Thread.currentThread().getContextClassLoader().getResource(
  "META-INF/clientKeystore.properties"));
ctx.put(SecurityConstants.STS_TOKEN_USE_CERT_FOR_KEYINFO + ".it", "true");

proxy.sayHello();</pre></section><section class="section" id="SAML_bearer_assertion_scenario_WSR_ClientCallbackHandler"><div class="titlepage"><div><div><h5 class="title">A.8.2.3.2. ClientCallbackHandler</h5></div></div></div><p>
							<code class="literal">ClientCallbackHandler</code> is a callback handler for the WSS4J Crypto API. It is used to obtain the password for the private key in the keystore. This class enables Apache CXF to retrieve the password of the user name to use for the message signature.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								The user <code class="literal">alice</code> and password have been provided here. This information is not in the (JKS) keystore but provided in the security domain. It is declared in <code class="literal">jbossws-users.properties</code> file.
							</p></div></div><pre class="programlisting language-java">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.shared;

import java.io.IOException;
import javax.security.auth.callback.Callback;
import javax.security.auth.callback.CallbackHandler;
import javax.security.auth.callback.UnsupportedCallbackException;
import org.apache.ws.security.WSPasswordCallback;

public class ClientCallbackHandler implements CallbackHandler {

    public void handle(Callback[] callbacks) throws IOException,
            UnsupportedCallbackException {
        for (int i = 0; i &lt; callbacks.length; i++) {
            if (callbacks[i] instanceof WSPasswordCallback) {
                WSPasswordCallback pc = (WSPasswordCallback) callbacks[i];
                if ("myclientkey".equals(pc.getIdentifier())) {
                    pc.setPassword("ckpass");
                    break;
                } else if ("alice".equals(pc.getIdentifier())) {
                    pc.setPassword("clarinet");
                    break;
                } else if ("bob".equals(pc.getIdentifier())) {
                    pc.setPassword("trombone");
                    break;
                } else if ("myservicekey".equals(pc.getIdentifier())) {  // rls test  added for bearer test
                   pc.setPassword("skpass");
                   break;
                }
            }
        }
    }
}</pre></section><section class="section" id="SAML_bearer_assertion_scenario_WSR_crypto_prop_keystore_files"><div class="titlepage"><div><div><h5 class="title">A.8.2.3.3. Crypto Properties and Keystore Files</h5></div></div></div><p>
							WSS4J’s Crypto implementation is loaded and configured using a Java properties file that contains Crypto configuration data. The file contains implementation-specific properties such as a keystore location, password, default alias and so on. This application is using the Merlin implementation. The <code class="literal">clientKeystore.properties</code> file contains this information.
						</p><p>
							The <code class="literal">clientstore.jks</code> file is a Java KeyStore (JKS) repository. It contains self-signed certificates for <code class="literal">myservicekey</code> and <code class="literal">mystskey</code>.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								Self-signed certificates are not appropriate for production use.
							</p></div></div><pre class="screen">org.apache.ws.security.crypto.provider=org.apache.ws.security.components.crypto.Merlin
org.apache.ws.security.crypto.merlin.keystore.type=jks
org.apache.ws.security.crypto.merlin.keystore.password=cspass
org.apache.ws.security.crypto.merlin.keystore.alias=myclientkey
org.apache.ws.security.crypto.merlin.keystore.file=META-INF/clientstore.jks</pre></section></section></section><section class="section" id="scenario_onbehalfof_ws_trust"><div class="titlepage"><div><div><h3 class="title">A.8.3. Scenario: OnBehalfOf WS-Trust</h3></div></div></div><p>
					The <code class="literal">OnBehalfOf</code> feature is used in scenarios that use the proxy pattern. In such scenarios, the client cannot access the STS directly, instead it communicates through a proxy gateway. The proxy gateway authenticates the caller and puts information about the caller into the <code class="literal">OnBehalfOf</code> element of the <code class="literal">RequestSecurityToken</code> (RST) sent to the real STS for processing. The resulting token contains only claims related to the client of the proxy, making the proxy completely transparent to the receiver of the issued token.
				</p><p>
					<code class="literal">OnBehalfOf</code> is nothing more than a new sub-element in the RST. It provides additional information about the original caller when a token is negotiated with the STS. The <code class="literal">OnBehalfOf</code> element usually takes the form of a token with identity claims such as name, role, and authorization code, for the client to access the service.
				</p><p>
					The <code class="literal">OnBehalfOf</code> scenario is an extension of the basic WS-Trust scenario. In this example the <code class="literal">OnBehalfOf</code> service calls the <code class="literal">ws-service</code> on behalf of a user. There are only a couple of additions to the basic scenario’s code. An <code class="literal">OnBehalfOf</code> web service provider and callback handler have been added. The <code class="literal">OnBehalfOf</code> web services' WSDL imposes the same security policies as the <code class="literal">ws-provider</code>. <code class="literal">UsernameTokenCallbackHandler</code> is a utility shared with <code class="literal">ActAs</code>. It generates the content for the <code class="literal">OnBehalfOf</code> element. Lastly, there are code additions in the STS that both <code class="literal">OnBehalfOf</code> and <code class="literal">ActAs</code> share in common.
				</p><section class="section" id="OnBehalfOf_ws_trust_scenario_WSP"><div class="titlepage"><div><div><h4 class="title">A.8.3.1. Web Service Provider</h4></div></div></div><p>
						This section provides the web service elements from the basic WS-Trust scenario that have been updated to address the requirements of the <code class="literal">OnBehalfOf</code> example. The components include:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<a class="link" href="#OnBehalfOf_ws_trust_scenario_WSP_wsdl" title="A.8.3.1.1. Web Service Provider WSDL">Web Service Provider WSDL</a>
							</li><li class="listitem">
								<a class="link" href="#OnBehalfOf_ws_trust_scenario_WSP_interface" title="A.8.3.1.2. Web Service Provider Interface">Web Service Provider Interface</a>
							</li><li class="listitem">
								<a class="link" href="#OnBehalfOf_ws_trust_scenario_WSP_implementation" title="A.8.3.1.3. Web Service Provider Implementation">Web Service Provider Implementation</a>
							</li><li class="listitem">
								<a class="link" href="#OnBehalfOf_ws_trust_scenario_WSP_OnBehalfOfCallbackHandler" title="A.8.3.1.4. OnBehalfOfCallbackHandler Class">OnBehalfOfCallbackHandler Class</a>
							</li></ul></div><section class="section" id="OnBehalfOf_ws_trust_scenario_WSP_wsdl"><div class="titlepage"><div><div><h5 class="title">A.8.3.1.1. Web Service Provider WSDL</h5></div></div></div><p>
							The <code class="literal">OnBehalfOf</code> web service provider’s WSDL is a clone of the <code class="literal">ws-provider’s</code> WSDL. The <code class="literal">wsp:Policy</code> section is the same. There are updates to the service endpoint, <code class="literal">targetNamespace</code>, <code class="literal">portType</code>, <code class="literal">binding</code> name, and <code class="literal">service</code>.
						</p><pre class="programlisting language-xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;definitions targetNamespace="http://www.jboss.org/jbossws/ws-extensions/onbehalfofwssecuritypolicy" name="OnBehalfOfService"
             xmlns:tns="http://www.jboss.org/jbossws/ws-extensions/onbehalfofwssecuritypolicy"
             xmlns:xsd="http://www.w3.org/2001/XMLSchema"
             xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/"
             xmlns="http://schemas.xmlsoap.org/wsdl/"
             xmlns:wsp="http://www.w3.org/ns/ws-policy"
             xmlns:wsam="http://www.w3.org/2007/05/addressing/metadata"
             xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"
             xmlns:wsaws="http://www.w3.org/2005/08/addressing"
             xmlns:sp="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702"
             xmlns:t="http://docs.oasis-open.org/ws-sx/ws-trust/200512"&gt;
    &lt;types&gt;
        &lt;xsd:schema&gt;
            &lt;xsd:import namespace="http://www.jboss.org/jbossws/ws-extensions/onbehalfofwssecuritypolicy"
                  schemaLocation="OnBehalfOfService_schema1.xsd"/&gt;
        &lt;/xsd:schema&gt;
    &lt;/types&gt;
    &lt;message name="sayHello"&gt;
        &lt;part name="parameters" element="tns:sayHello"/&gt;
    &lt;/message&gt;
    &lt;message name="sayHelloResponse"&gt;
        &lt;part name="parameters" element="tns:sayHelloResponse"/&gt;
    &lt;/message&gt;
    &lt;portType name="OnBehalfOfServiceIface"&gt;
        &lt;operation name="sayHello"&gt;
            &lt;input message="tns:sayHello"/&gt;
            &lt;output message="tns:sayHelloResponse"/&gt;
        &lt;/operation&gt;
    &lt;/portType&gt;
    &lt;binding name="OnBehalfOfServicePortBinding" type="tns:OnBehalfOfServiceIface"&gt;
        &lt;wsp:PolicyReference URI="#AsymmetricSAML2Policy" /&gt;
        &lt;soap:binding transport="http://schemas.xmlsoap.org/soap/http" style="document"/&gt;
        &lt;operation name="sayHello"&gt;
            &lt;soap:operation soapAction=""/&gt;
            &lt;input&gt;
                &lt;soap:body use="literal"/&gt;
                &lt;wsp:PolicyReference URI="#Input_Policy" /&gt;
            &lt;/input&gt;
            &lt;output&gt;
                &lt;soap:body use="literal"/&gt;
                &lt;wsp:PolicyReference URI="#Output_Policy" /&gt;
            &lt;/output&gt;
        &lt;/operation&gt;
    &lt;/binding&gt;
    &lt;service name="OnBehalfOfService"&gt;
        &lt;port name="OnBehalfOfServicePort" binding="tns:OnBehalfOfServicePortBinding"&gt;
            &lt;soap:address location="http://@jboss.bind.address@:8080/jaxws-samples-wsse-policy-trust-onbehalfof/OnBehalfOfService"/&gt;
        &lt;/port&gt;
    &lt;/service&gt;
&lt;/definitions&gt;</pre></section><section class="section" id="OnBehalfOf_ws_trust_scenario_WSP_interface"><div class="titlepage"><div><div><h5 class="title">A.8.3.1.2. Web Service Provider Interface</h5></div></div></div><p>
							The <code class="literal">OnBehalfOfServiceIface</code> web service provider interface class is a simple web service definition.
						</p><pre class="programlisting language-java">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.onbehalfof;

import javax.jws.WebMethod;
import javax.jws.WebService;

@WebService
(
   targetNamespace = "http://www.jboss.org/jbossws/ws-extensions/onbehalfofwssecuritypolicy"
)
public interface OnBehalfOfServiceIface {
   @WebMethod
   String sayHello();
}</pre></section><section class="section" id="OnBehalfOf_ws_trust_scenario_WSP_implementation"><div class="titlepage"><div><div><h5 class="title">A.8.3.1.3. Web Service Provider Implementation</h5></div></div></div><p>
							The <code class="literal">OnBehalfOfServiceImpl</code> web service provider implementation class is a simple POJO. It uses the standard <code class="literal">WebService</code> annotation to define the service endpoint and two Apache WSS4J annotations, <code class="literal">EndpointProperties</code> and <code class="literal">EndpointProperty</code> used for configuring the endpoint for the Apache CXF runtime. The WSS4J configuration information provided is for WSS4J’s Crypto Merlin implementation.
						</p><p>
							<code class="literal">OnBehalfOfServiceImpl</code> calls the <code class="literal">ServiceImpl</code> acting on behalf of the user. The <code class="literal">setupService</code> method performs the required configuration setup.
						</p><pre class="programlisting language-java">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.onbehalfof;

import org.apache.cxf.Bus;
import org.apache.cxf.BusFactory;
import org.apache.cxf.annotations.EndpointProperties;
import org.apache.cxf.annotations.EndpointProperty;
import org.apache.cxf.ws.security.SecurityConstants;
import org.apache.cxf.ws.security.trust.STSClient;
import org.jboss.test.ws.jaxws.samples.wsse.policy.trust.service.ServiceIface;
import org.jboss.test.ws.jaxws.samples.wsse.policy.trust.shared.WSTrustAppUtils;

import javax.jws.WebService;
import javax.xml.namespace.QName;
import javax.xml.ws.BindingProvider;
import javax.xml.ws.Service;
import java.net.*;
import java.util.Map;

@WebService
(
   portName = "OnBehalfOfServicePort",
   serviceName = "OnBehalfOfService",
   wsdlLocation = "WEB-INF/wsdl/OnBehalfOfService.wsdl",
   targetNamespace = "http://www.jboss.org/jbossws/ws-extensions/onbehalfofwssecuritypolicy",
   endpointInterface = "org.jboss.test.ws.jaxws.samples.wsse.policy.trust.onbehalfof.OnBehalfOfServiceIface"
)

@EndpointProperties(value = {
      @EndpointProperty(key = "ws-security.signature.username", value = "myactaskey"),
      @EndpointProperty(key = "ws-security.signature.properties", value =  "actasKeystore.properties"),
      @EndpointProperty(key = "ws-security.encryption.properties", value = "actasKeystore.properties"),
      @EndpointProperty(key = "ws-security.callback-handler", value = "org.jboss.test.ws.jaxws.samples.wsse.policy.trust.onbehalfof.OnBehalfOfCallbackHandler")
})

public class OnBehalfOfServiceImpl implements OnBehalfOfServiceIface {
   public String sayHello() {
      try {

         ServiceIface proxy = setupService();
         return "OnBehalfOf " + proxy.sayHello();

      } catch (MalformedURLException e) {
         e.printStackTrace();
      }
      return null;
   }

   /**
    *
    * @return
    * @throws MalformedURLException
    */
   private  ServiceIface setupService()throws MalformedURLException {
      ServiceIface proxy = null;
      Bus bus = BusFactory.newInstance().createBus();

      try {
         BusFactory.setThreadDefaultBus(bus);

         final String serviceURL = "http://" + WSTrustAppUtils.getServerHost() + ":8080/jaxws-samples-wsse-policy-trust/SecurityService";
         final QName serviceName = new QName("http://www.jboss.org/jbossws/ws-extensions/wssecuritypolicy", "SecurityService");
         final URL wsdlURL = new URL(serviceURL + "?wsdl");
         Service service = Service.create(wsdlURL, serviceName);
         proxy = (ServiceIface) service.getPort(ServiceIface.class);

         Map&lt;String, Object&gt; ctx = ((BindingProvider) proxy).getRequestContext();
         ctx.put(SecurityConstants.CALLBACK_HANDLER, new OnBehalfOfCallbackHandler());

         ctx.put(SecurityConstants.SIGNATURE_PROPERTIES,
            Thread.currentThread().getContextClassLoader().getResource(
            "actasKeystore.properties" ));
         ctx.put(SecurityConstants.SIGNATURE_USERNAME, "myactaskey" );
         ctx.put(SecurityConstants.ENCRYPT_PROPERTIES,
            Thread.currentThread().getContextClassLoader().getResource(
            "../../META-INF/clientKeystore.properties" ));
         ctx.put(SecurityConstants.ENCRYPT_USERNAME, "myservicekey");

         STSClient stsClient = new STSClient(bus);
         Map&lt;String, Object&gt; props = stsClient.getProperties();
         props.put(SecurityConstants.USERNAME, "bob");
         props.put(SecurityConstants.ENCRYPT_USERNAME, "mystskey");
         props.put(SecurityConstants.STS_TOKEN_USERNAME, "myactaskey" );
         props.put(SecurityConstants.STS_TOKEN_PROPERTIES,
            Thread.currentThread().getContextClassLoader().getResource(
            "actasKeystore.properties" ));
         props.put(SecurityConstants.STS_TOKEN_USE_CERT_FOR_KEYINFO, "true");

         ctx.put(SecurityConstants.STS_CLIENT, stsClient);

      } finally {
         bus.shutdown(true);
      }

      return proxy;
   }

}</pre></section><section class="section" id="OnBehalfOf_ws_trust_scenario_WSP_OnBehalfOfCallbackHandler"><div class="titlepage"><div><div><h5 class="title">A.8.3.1.4. OnBehalfOfCallbackHandler Class</h5></div></div></div><p>
							The <code class="literal">OnBehalfOfCallbackHandler</code> is a callback handler for the WSS4J Crypto API. It is used to obtain the password for the private key in the keystore. This class enables Apache CXF to retrieve the password of the user name to use for the message signature. This class has been updated to return the passwords for this service, <code class="literal">myactaskey</code> and the <code class="literal">OnBehalfOf</code> user, <code class="literal">alice</code>.
						</p><pre class="programlisting language-java">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.onbehalfof;

import org.jboss.wsf.stack.cxf.extensions.security.PasswordCallbackHandler;
import java.util.HashMap;
import java.util.Map;

public class OnBehalfOfCallbackHandler extends PasswordCallbackHandler {

   public OnBehalfOfCallbackHandler() {
      super(getInitMap());
   }

   private static Map&lt;String, String&gt; getInitMap() {
      Map&lt;String, String&gt; passwords = new HashMap&lt;String, String&gt;();
      passwords.put("myactaskey", "aspass");
      passwords.put("alice", "clarinet");
      passwords.put("bob", "trombone");
      return passwords;
   }

}</pre></section></section><section class="section" id="OnBehalfOf_ws_trust_scenario_WSR"><div class="titlepage"><div><div><h4 class="title">A.8.3.2. Web Service Requester</h4></div></div></div><p>
						This section provides details of the <code class="literal">ws-requester</code> elements from the basic WS-Trust scenario that have been updated to address the requirements of the <code class="literal">OnBehalfOf</code> example. The component is:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<a class="link" href="#OnBehalfOf_ws_trust_scenario_WSR_implementation" title="A.8.3.2.1. OnBehalfOf Web Service Requester Implementation Class">OnBehalfOf Web Service Requester Implementation Class</a>
							</li></ul></div><section class="section" id="OnBehalfOf_ws_trust_scenario_WSR_implementation"><div class="titlepage"><div><div><h5 class="title">A.8.3.2.1. OnBehalfOf Web Service Requester Implementation Class</h5></div></div></div><p>
							The <code class="literal">OnBehalfOf</code> <code class="literal">ws-requester</code>, the client, uses standard procedures for creating a reference to the web service in the first four lines. To address the endpoint security requirements, the web service’s request context is configured using the <code class="literal">BindingProvider</code>. Information needed in the message generation is provided through it. The <code class="literal">OnBehalfOf</code> user, <code class="literal">alice</code>, is declared in this section and the <code class="literal">callbackHandler</code>, <code class="literal">UsernameTokenCallbackHandler</code> is provided to the <code class="literal">STSClient</code> for generation of the contents for the <code class="literal">OnBehalfOf</code> message element. In this example an <code class="literal">STSClient</code> object is created and provided to the proxy’s request context. The alternative is to provide keys tagged with the <code class="literal">.it</code> suffix as done in the Basic Scenario client. The use of <code class="literal">OnBehalfOf</code> is configured by the <code class="literal">stsClient.setOnBehalfOf</code> call method. The alternative is to use the key <code class="literal">SecurityConstants.STS_TOKEN_ON_BEHALF_OF</code> and a value in the properties map.
						</p><pre class="programlisting language-java">final QName serviceName = new QName("http://www.jboss.org/jbossws/ws-extensions/onbehalfofwssecuritypolicy", "OnBehalfOfService");
final URL wsdlURL = new URL(serviceURL + "?wsdl");
Service service = Service.create(wsdlURL, serviceName);
OnBehalfOfServiceIface proxy = (OnBehalfOfServiceIface) service.getPort(OnBehalfOfServiceIface.class);


Bus bus = BusFactory.newInstance().createBus();
try {

    BusFactory.setThreadDefaultBus(bus);

    Map&lt;String, Object&gt; ctx = proxy.getRequestContext();

    ctx.put(SecurityConstants.CALLBACK_HANDLER, new ClientCallbackHandler());
    ctx.put(SecurityConstants.ENCRYPT_PROPERTIES,
        Thread.currentThread().getContextClassLoader().getResource(
        "META-INF/clientKeystore.properties"));
    ctx.put(SecurityConstants.ENCRYPT_USERNAME, "myactaskey");
    ctx.put(SecurityConstants.SIGNATURE_PROPERTIES,
        Thread.currentThread().getContextClassLoader().getResource(
        "META-INF/clientKeystore.properties"));
    ctx.put(SecurityConstants.SIGNATURE_USERNAME, "myclientkey");

    // user and password OnBehalfOf user
    // UsernameTokenCallbackHandler will extract this information when called
    ctx.put(SecurityConstants.USERNAME,"alice");
    ctx.put(SecurityConstants.PASSWORD, "clarinet");

    STSClient stsClient = new STSClient(bus);

    // Providing the STSClient the mechanism to create the claims contents for OnBehalfOf
    stsClient.setOnBehalfOf(new UsernameTokenCallbackHandler());

    Map&lt;String, Object&gt; props = stsClient.getProperties();
    props.put(SecurityConstants.CALLBACK_HANDLER, new ClientCallbackHandler());
    props.put(SecurityConstants.ENCRYPT_PROPERTIES,
        Thread.currentThread().getContextClassLoader().getResource(
        "META-INF/clientKeystore.properties"));
    props.put(SecurityConstants.ENCRYPT_USERNAME, "mystskey");
    props.put(SecurityConstants.STS_TOKEN_USERNAME, "myclientkey");
    props.put(SecurityConstants.STS_TOKEN_PROPERTIES,
        Thread.currentThread().getContextClassLoader().getResource(
        "META-INF/clientKeystore.properties"));
    props.put(SecurityConstants.STS_TOKEN_USE_CERT_FOR_KEYINFO, "true");

    ctx.put(SecurityConstants.STS_CLIENT, stsClient);

} finally {
    bus.shutdown(true);
}
proxy.sayHello();</pre></section></section></section><section class="section" id="ActAs_ws_trust_scenario"><div class="titlepage"><div><div><h3 class="title">A.8.4. Scenario: ActAs WS-Trust</h3></div></div></div><p>
					The <code class="literal">ActAs</code> feature is used in scenarios that require composite delegation. It is commonly used in multi-tiered systems where an application calls a service on behalf of a logged in user, or a service calls another service on behalf of the original caller.
				</p><p>
					<code class="literal">ActAs</code> is nothing more than a new sub-element in the <code class="literal">RequestSecurityToken</code> (RST). It provides additional information about the original caller when a token is negotiated with the STS. The <code class="literal">ActAs</code> element usually takes the form of a token with identity claims such as name, role, and authorization code, for the client to access the service.
				</p><p>
					The <code class="literal">ActAs</code> scenario is an extension of the basic WS-Trust scenario. In this example the <code class="literal">ActAs</code> service calls the <code class="literal">ws-service</code> on behalf of a user. There are only a couple of additions to the basic scenario’s code. An <code class="literal">ActAs</code> web service provider and callback handler have been added. The <code class="literal">ActAs</code> web services' WSDL imposes the same security policies as the <code class="literal">ws-provider</code>. <code class="literal">UsernameTokenCallbackHandler</code> is a new utility that generates the content for the <code class="literal">ActAs</code> element. Lastly, there are a couple of code additions in the STS to support the <code class="literal">ActAs</code> request.
				</p><section class="section" id="ActAs_ws_trust_scenario_WSP"><div class="titlepage"><div><div><h4 class="title">A.8.4.1. Web Service Provider</h4></div></div></div><p>
						This section provides details about the web service elements from the basic WS-Trust scenario that have been changed to address the needs of the <code class="literal">ActAs</code> example. The components include:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<a class="link" href="#ActAs_ws_trust_scenario_WSP_wsdl" title="A.8.4.1.1. Web Service Provider WSDL">ActAs Web Service Provider WSDL</a>
							</li><li class="listitem">
								<a class="link" href="#ActAs_ws_trust_scenario_WSP_interface" title="A.8.4.1.2. Web Service Provider Interface">ActAs Web Service Provider Interface</a>
							</li><li class="listitem">
								<a class="link" href="#ActAs_ws_trust_scenario_WSP_implementation" title="A.8.4.1.3. Web Service Provider Implementation">ActAs Web Service Provider Implementation</a>
							</li><li class="listitem">
								<a class="link" href="#ActAs_ws_trust_scenario_WSP_ActAsCallbackHandler" title="A.8.4.1.4. ActAsCallbackHandler Class">ActAsCallbackHandler Class</a>
							</li><li class="listitem">
								<a class="link" href="#ActAs_ws_trust_scenario_WSP_UsernameTokenCallbackHandler" title="A.8.4.1.5. UsernameTokenCallbackHandler">UsernameTokenCallbackHandler</a>
							</li><li class="listitem">
								<a class="link" href="#ActAs_ws_trust_scenario_WSP_crypto_prop_keystore_files" title="A.8.4.1.6. Crypto properties and keystore files">Crypto properties and Keystore Files</a>
							</li><li class="listitem">
								<a class="link" href="#ActAs_ws_trust_scenario_WSP_manifest" title="A.8.4.1.7. Default MANIFEST.MF">Default MANIFEST.MF</a>
							</li></ul></div><section class="section" id="ActAs_ws_trust_scenario_WSP_wsdl"><div class="titlepage"><div><div><h5 class="title">A.8.4.1.1. Web Service Provider WSDL</h5></div></div></div><p>
							The <code class="literal">ActAs</code> web service provider’s WSDL is a clone of the <code class="literal">ws-provider’s</code> WSDL. The <code class="literal">wsp:Policy</code> section is the same. There are changes to the service endpoint, <code class="literal">targetNamespace</code>, <code class="literal">portType</code>, <code class="literal">binding</code> name, and <code class="literal">service</code>.
						</p><pre class="programlisting language-xml">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;definitions targetNamespace="http://www.jboss.org/jbossws/ws-extensions/actaswssecuritypolicy" name="ActAsService"
             xmlns:tns="http://www.jboss.org/jbossws/ws-extensions/actaswssecuritypolicy"
             xmlns:xsd="http://www.w3.org/2001/XMLSchema"
             xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/"
             xmlns="http://schemas.xmlsoap.org/wsdl/"
             xmlns:wsp="http://www.w3.org/ns/ws-policy"
             xmlns:wsam="http://www.w3.org/2007/05/addressing/metadata"
             xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"
             xmlns:wsaws="http://www.w3.org/2005/08/addressing"
             xmlns:sp="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702"
             xmlns:t="http://docs.oasis-open.org/ws-sx/ws-trust/200512"&gt;
    &lt;types&gt;
        &lt;xsd:schema&gt;
            &lt;xsd:import namespace="http://www.jboss.org/jbossws/ws-extensions/actaswssecuritypolicy"
                    schemaLocation="ActAsService_schema1.xsd"/&gt;
        &lt;/xsd:schema&gt;
    &lt;/types&gt;
    &lt;message name="sayHello"&gt;
        &lt;part name="parameters" element="tns:sayHello"/&gt;
    &lt;/message&gt;
    &lt;message name="sayHelloResponse"&gt;
        &lt;part name="parameters" element="tns:sayHelloResponse"/&gt;
    &lt;/message&gt;
    &lt;portType name="ActAsServiceIface"&gt;
        &lt;operation name="sayHello"&gt;
            &lt;input message="tns:sayHello"/&gt;
            &lt;output message="tns:sayHelloResponse"/&gt;
        &lt;/operation&gt;
    &lt;/portType&gt;
    &lt;binding name="ActAsServicePortBinding" type="tns:ActAsServiceIface"&gt;
        &lt;wsp:PolicyReference URI="#AsymmetricSAML2Policy" /&gt;
        &lt;soap:binding transport="http://schemas.xmlsoap.org/soap/http" style="document"/&gt;
        &lt;operation name="sayHello"&gt;
            &lt;soap:operation soapAction=""/&gt;
            &lt;input&gt;
                &lt;soap:body use="literal"/&gt;
                &lt;wsp:PolicyReference URI="#Input_Policy" /&gt;
            &lt;/input&gt;
            &lt;output&gt;
                &lt;soap:body use="literal"/&gt;
                &lt;wsp:PolicyReference URI="#Output_Policy" /&gt;
            &lt;/output&gt;
        &lt;/operation&gt;
    &lt;/binding&gt;
    &lt;service name="ActAsService"&gt;
        &lt;port name="ActAsServicePort" binding="tns:ActAsServicePortBinding"&gt;
            &lt;soap:address location="http://@jboss.bind.address@:8080/jaxws-samples-wsse-policy-trust-actas/ActAsService"/&gt;
        &lt;/port&gt;
    &lt;/service&gt;

&lt;/definitions&gt;</pre></section><section class="section" id="ActAs_ws_trust_scenario_WSP_interface"><div class="titlepage"><div><div><h5 class="title">A.8.4.1.2. Web Service Provider Interface</h5></div></div></div><p>
							The <code class="literal">ActAsServiceIface</code> web service provider interface class is a simple web service definition.
						</p><pre class="programlisting language-java">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.actas;

import javax.jws.WebMethod;
import javax.jws.WebService;

@WebService
(
   targetNamespace = "http://www.jboss.org/jbossws/ws-extensions/actaswssecuritypolicy"
)
public interface ActAsServiceIface {
   @WebMethod
   String sayHello();
}</pre></section><section class="section" id="ActAs_ws_trust_scenario_WSP_implementation"><div class="titlepage"><div><div><h5 class="title">A.8.4.1.3. Web Service Provider Implementation</h5></div></div></div><p>
							The <code class="literal">ActAsServiceImpl</code> web service provider implementation class is a simple POJO. It uses the standard <code class="literal">WebService</code> annotation to define the service endpoint and two Apache WSS4J annotations, <code class="literal">EndpointProperties</code>, and <code class="literal">EndpointProperty</code>, used for configuring the endpoint for the Apache CXF runtime. The WSS4J configuration information provided is for WSS4J’s Crypto Merlin implementation.
						</p><p>
							<code class="literal">ActAsServiceImpl</code> is calling <code class="literal">ServiceImpl</code> acting on behalf of the user. The <code class="literal">setupService</code> method performs the required configuration setup.
						</p><pre class="programlisting language-java">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.actas;

import org.apache.cxf.Bus;
import org.apache.cxf.BusFactory;
import org.apache.cxf.annotations.EndpointProperties;
import org.apache.cxf.annotations.EndpointProperty;
import org.apache.cxf.ws.security.SecurityConstants;
import org.apache.cxf.ws.security.trust.STSClient;
import org.jboss.test.ws.jaxws.samples.wsse.policy.trust.service.ServiceIface;
import org.jboss.test.ws.jaxws.samples.wsse.policy.trust.shared.WSTrustAppUtils;

import javax.jws.WebService;
import javax.xml.namespace.QName;
import javax.xml.ws.BindingProvider;
import javax.xml.ws.Service;
import java.net.MalformedURLException;
import java.net.URL;
import java.util.Map;

@WebService
(
   portName = "ActAsServicePort",
   serviceName = "ActAsService",
   wsdlLocation = "WEB-INF/wsdl/ActAsService.wsdl",
   targetNamespace = "http://www.jboss.org/jbossws/ws-extensions/actaswssecuritypolicy",
   endpointInterface = "org.jboss.test.ws.jaxws.samples.wsse.policy.trust.actas.ActAsServiceIface"
)

@EndpointProperties(value = {
      @EndpointProperty(key = "ws-security.signature.username", value = "myactaskey"),
      @EndpointProperty(key = "ws-security.signature.properties", value =  "actasKeystore.properties"),
      @EndpointProperty(key = "ws-security.encryption.properties", value = "actasKeystore.properties"),
      @EndpointProperty(key = "ws-security.callback-handler", value = "org.jboss.test.ws.jaxws.samples.wsse.policy.trust.actas.ActAsCallbackHandler")
})

public class ActAsServiceImpl implements ActAsServiceIface {
   public String sayHello() {
      try {
         ServiceIface proxy = setupService();
         return "ActAs " + proxy.sayHello();
      } catch (MalformedURLException e) {
         e.printStackTrace();
      }
      return null;
   }

   private  ServiceIface setupService()throws MalformedURLException {
      ServiceIface proxy = null;
      Bus bus = BusFactory.newInstance().createBus();

      try {
         BusFactory.setThreadDefaultBus(bus);

         final String serviceURL = "http://" + WSTrustAppUtils.getServerHost() + ":8080/jaxws-samples-wsse-policy-trust/SecurityService";
         final QName serviceName = new QName("http://www.jboss.org/jbossws/ws-extensions/wssecuritypolicy", "SecurityService");
         final URL wsdlURL = new URL(serviceURL + "?wsdl");
         Service service = Service.create(wsdlURL, serviceName);
         proxy = (ServiceIface) service.getPort(ServiceIface.class);

         Map&lt;String, Object&gt; ctx = ((BindingProvider) proxy).getRequestContext();
         ctx.put(SecurityConstants.CALLBACK_HANDLER, new ActAsCallbackHandler());

         ctx.put(SecurityConstants.SIGNATURE_PROPERTIES,
            Thread.currentThread().getContextClassLoader().getResource("actasKeystore.properties" ));
         ctx.put(SecurityConstants.SIGNATURE_USERNAME, "myactaskey" );
         ctx.put(SecurityConstants.ENCRYPT_PROPERTIES,
            Thread.currentThread().getContextClassLoader().getResource("../../META-INF/clientKeystore.properties" ));
         ctx.put(SecurityConstants.ENCRYPT_USERNAME, "myservicekey");

         STSClient stsClient = new STSClient(bus);
         Map&lt;String, Object&gt; props = stsClient.getProperties();
         props.put(SecurityConstants.USERNAME, "alice");
         props.put(SecurityConstants.ENCRYPT_USERNAME, "mystskey");
         props.put(SecurityConstants.STS_TOKEN_USERNAME, "myactaskey" );
         props.put(SecurityConstants.STS_TOKEN_PROPERTIES,
            Thread.currentThread().getContextClassLoader().getResource("actasKeystore.properties" ));
         props.put(SecurityConstants.STS_TOKEN_USE_CERT_FOR_KEYINFO, "true");

         ctx.put(SecurityConstants.STS_CLIENT, stsClient);

      } finally {
         bus.shutdown(true);
      }

      return proxy;
   }

}</pre></section><section class="section" id="ActAs_ws_trust_scenario_WSP_ActAsCallbackHandler"><div class="titlepage"><div><div><h5 class="title">A.8.4.1.4. ActAsCallbackHandler Class</h5></div></div></div><p>
							<code class="literal">ActAsCallbackHandler</code> is a callback handler for the WSS4J Crypto API. It is used to obtain the password for the private key in the keystore. This class enables Apache CXF to retrieve the password of the user name to use for the message signature. This class has been updated to return the passwords for this service, <code class="literal">myactaskey</code> and the <code class="literal">ActAs</code> user, <code class="literal">alice</code>.
						</p><pre class="programlisting language-java">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.actas;

import org.jboss.wsf.stack.cxf.extensions.security.PasswordCallbackHandler;
import java.util.HashMap;
import java.util.Map;

public class ActAsCallbackHandler extends PasswordCallbackHandler {

   public ActAsCallbackHandler() {
      super(getInitMap());
   }

   private static Map&lt;String, String&gt; getInitMap() {
      Map&lt;String, String&gt; passwords = new HashMap&lt;String, String&gt;();
      passwords.put("myactaskey", "aspass");
      passwords.put("alice", "clarinet");
      return passwords;
   }
}</pre></section><section class="section" id="ActAs_ws_trust_scenario_WSP_UsernameTokenCallbackHandler"><div class="titlepage"><div><div><h5 class="title">A.8.4.1.5. UsernameTokenCallbackHandler</h5></div></div></div><p>
							The <code class="literal">ActAs</code> and <code class="literal">OnBeholdOf</code> sub-elements of the <code class="literal">RequestSecurityToken</code> have to be defined as WSSE <code class="literal">UsernameTokens</code>. This utility generates the properly formatted element.
						</p><pre class="programlisting language-java">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.shared;

import org.apache.cxf.helpers.DOMUtils;
import org.apache.cxf.message.Message;
import org.apache.cxf.ws.security.SecurityConstants;
import org.apache.cxf.ws.security.trust.delegation.DelegationCallback;
import org.apache.ws.security.WSConstants;
import org.apache.ws.security.message.token.UsernameToken;
import org.w3c.dom.Document;
import org.w3c.dom.Node;
import org.w3c.dom.Element;
import org.w3c.dom.ls.DOMImplementationLS;
import org.w3c.dom.ls.LSSerializer;

import javax.security.auth.callback.Callback;
import javax.security.auth.callback.CallbackHandler;
import javax.security.auth.callback.UnsupportedCallbackException;
import java.io.IOException;
import java.util.Map;

/**
* A utility to provide the 3 different input parameter types for jaxws property
* "ws-security.sts.token.act-as" and "ws-security.sts.token.on-behalf-of".
* This implementation obtains a username and password via the jaxws property
* "ws-security.username" and "ws-security.password" respectively, as defined
* in SecurityConstants.  It creates a wss UsernameToken to be used as the
* delegation token.
*/

public class UsernameTokenCallbackHandler implements CallbackHandler {

   public void handle(Callback[] callbacks)
      throws IOException, UnsupportedCallbackException {
      for (int i = 0; i &lt; callbacks.length; i++) {
         if (callbacks[i] instanceof DelegationCallback) {
            DelegationCallback callback = (DelegationCallback) callbacks[i];
            Message message = callback.getCurrentMessage();

            String username =
               (String)message.getContextualProperty(SecurityConstants.USERNAME);
            String password =
               (String)message.getContextualProperty(SecurityConstants.PASSWORD);
            if (username != null) {
               Node contentNode = message.getContent(Node.class);
               Document doc = null;
               if (contentNode != null) {
                  doc = contentNode.getOwnerDocument();
               } else {
                  doc = DOMUtils.createDocument();
               }
               UsernameToken usernameToken = createWSSEUsernameToken(username,password, doc);
               callback.setToken(usernameToken.getElement());
            }
         } else {
            throw new UnsupportedCallbackException(callbacks[i], "Unrecognized Callback");
         }
      }
   }

   /**
    * Provide UsernameToken as a string.
    * @param ctx
    * @return
    */
   public String getUsernameTokenString(Map&lt;String, Object&gt; ctx){
      Document doc = DOMUtils.createDocument();
      String result = null;
      String username = (String)ctx.get(SecurityConstants.USERNAME);
      String password = (String)ctx.get(SecurityConstants.PASSWORD);
      if (username != null) {
         UsernameToken usernameToken = createWSSEUsernameToken(username,password, doc);
         result = toString(usernameToken.getElement().getFirstChild().getParentNode());
      }
      return result;
   }

   /**
    *
    * @param username
    * @param password
    * @return
    */
   public String getUsernameTokenString(String username, String password){
      Document doc = DOMUtils.createDocument();
      String result = null;
      if (username != null) {
         UsernameToken usernameToken = createWSSEUsernameToken(username,password, doc);
         result = toString(usernameToken.getElement().getFirstChild().getParentNode());
      }
      return result;
   }

   /**
    * Provide UsernameToken as a DOM Element.
    * @param ctx
    * @return
    */
   public Element getUsernameTokenElement(Map&lt;String, Object&gt; ctx){
      Document doc = DOMUtils.createDocument();
      Element result = null;
      UsernameToken usernameToken = null;
         String username = (String)ctx.get(SecurityConstants.USERNAME);
      String password = (String)ctx.get(SecurityConstants.PASSWORD);
      if (username != null) {
         usernameToken = createWSSEUsernameToken(username,password, doc);
         result = usernameToken.getElement();
      }
      return result;
   }

   /**
    *
    * @param username
    * @param password
    * @return
    */
   public Element getUsernameTokenElement(String username, String password){
      Document doc = DOMUtils.createDocument();
      Element result = null;
      UsernameToken usernameToken = null;
      if (username != null) {
         usernameToken = createWSSEUsernameToken(username,password, doc);
         result = usernameToken.getElement();
      }
      return result;
   }

   private UsernameToken createWSSEUsernameToken(String username, String password, Document doc) {

      UsernameToken usernameToken = new UsernameToken(true, doc,
         (password == null)? null: WSConstants.PASSWORD_TEXT);
      usernameToken.setName(username);
      usernameToken.addWSUNamespace();
      usernameToken.addWSSENamespace();
      usernameToken.setID("id-" + username);

      if (password != null){
         usernameToken.setPassword(password);
      }

      return usernameToken;
   }


   private String toString(Node node) {
      String str = null;

      if (node != null) {
         DOMImplementationLS lsImpl = (DOMImplementationLS)
            node.getOwnerDocument().getImplementation().getFeature("LS", "3.0");
         LSSerializer serializer = lsImpl.createLSSerializer();
         serializer.getDomConfig().setParameter("xml-declaration", false); //by default its true, so set it to false to get String without xml-declaration
         str = serializer.writeToString(node);
      }
      return str;
   }

}</pre></section><section class="section" id="ActAs_ws_trust_scenario_WSP_crypto_prop_keystore_files"><div class="titlepage"><div><div><h5 class="title">A.8.4.1.6. Crypto properties and keystore files</h5></div></div></div><p>
							The <code class="literal">ActAs</code> service must provide its own credentials. The requisite <code class="literal">actasKeystore.properties</code> properties file and <code class="literal">actasstore.jks</code> keystore are created.
						</p><pre class="screen">org.apache.ws.security.crypto.provider=org.apache.ws.security.components.crypto.Merlin
org.apache.ws.security.crypto.merlin.keystore.type=jks
org.apache.ws.security.crypto.merlin.keystore.password=aapass
org.apache.ws.security.crypto.merlin.keystore.alias=myactaskey
org.apache.ws.security.crypto.merlin.keystore.file=actasstore.jks</pre></section><section class="section" id="ActAs_ws_trust_scenario_WSP_manifest"><div class="titlepage"><div><div><h5 class="title">A.8.4.1.7. Default MANIFEST.MF</h5></div></div></div><p>
							This application requires access to the JBossWS and Apache CXF APIs provided in the <code class="literal">org.jboss.ws.cxf.jbossws-cxf-client</code> module. The <code class="literal">org.jboss.ws.cxf.sts</code> module is also needed in handling the <code class="literal">ActAs</code> and <code class="literal">OnBehalfOf</code> extensions. The dependency statement directs the server to provide them at deployment.
						</p><pre class="screen">Manifest-Version: 1.0
Dependencies: org.jboss.ws.cxf.jbossws-cxf-client, org.jboss.ws.cxf.sts</pre></section></section><section class="section" id="ActAs_ws_trust_scenario_STS"><div class="titlepage"><div><div><h4 class="title">A.8.4.2. Security Token Service</h4></div></div></div><p>
						This section provides the details of the STS elements from the basic WS-Trust scenario that have been changed to address the needs of the <code class="literal">ActAs</code> example. The components include:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<a class="link" href="#ActAs_ws_trust_scenario_STS_implementation" title="A.8.4.2.1. STS Implementation Class">STS Implementation Class</a>
							</li><li class="listitem">
								<a class="link" href="#ActAs_ws_trust_scenario_STS_STSCallbackHandler" title="A.8.4.2.2. STSCallbackHandler Class">STSCallbackHandler Class</a>
							</li></ul></div><section class="section" id="ActAs_ws_trust_scenario_STS_implementation"><div class="titlepage"><div><div><h5 class="title">A.8.4.2.1. STS Implementation Class</h5></div></div></div><p>
							The declaration of the set of allowed token recipients by address has been extended to accept <code class="literal">ActAs</code> addresses and <code class="literal">OnBehalfOf</code> addresses. The addresses are specified as reg-ex patterns.
						</p><p>
							The <code class="literal">TokenIssueOperation</code> requires the <code class="literal">UsernameTokenValidator</code> class to be provided to validate the contents of the <code class="literal">OnBehalfOf</code>, and the <code class="literal">UsernameTokenDelegationHandler</code> class to be provided to process the token delegation request of the <code class="literal">ActAs</code> on <code class="literal">OnBehalfOf</code> user.
						</p><pre class="programlisting language-java">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.sts;

import java.util.Arrays;
import java.util.LinkedList;
import java.util.List;

import javax.xml.ws.WebServiceProvider;

import org.apache.cxf.annotations.EndpointProperties;
import org.apache.cxf.annotations.EndpointProperty;
import org.apache.cxf.interceptor.InInterceptors;
import org.apache.cxf.sts.StaticSTSProperties;
import org.apache.cxf.sts.operation.TokenIssueOperation;
import org.apache.cxf.sts.operation.TokenValidateOperation;
import org.apache.cxf.sts.service.ServiceMBean;
import org.apache.cxf.sts.service.StaticService;
import org.apache.cxf.sts.token.delegation.UsernameTokenDelegationHandler;
import org.apache.cxf.sts.token.provider.SAMLTokenProvider;
import org.apache.cxf.sts.token.validator.SAMLTokenValidator;
import org.apache.cxf.sts.token.validator.UsernameTokenValidator;
import org.apache.cxf.ws.security.sts.provider.SecurityTokenServiceProvider;

@WebServiceProvider(serviceName = "SecurityTokenService",
      portName = "UT_Port",
      targetNamespace = "http://docs.oasis-open.org/ws-sx/ws-trust/200512/",
      wsdlLocation = "WEB-INF/wsdl/ws-trust-1.4-service.wsdl")
//dependency on org.apache.cxf module or on module that exports org.apache.cxf (e.g. org.jboss.ws.cxf.jbossws-cxf-client) is needed, otherwise Apache CXF annotations are ignored
@EndpointProperties(value = {
      @EndpointProperty(key = "ws-security.signature.username", value = "mystskey"),
      @EndpointProperty(key = "ws-security.signature.properties", value = "stsKeystore.properties"),
      @EndpointProperty(key = "ws-security.callback-handler", value = "org.jboss.test.ws.jaxws.samples.wsse.policy.trust.sts.STSCallbackHandler"),
      @EndpointProperty(key = "ws-security.validate.token", value = "false") //to let the JAAS integration deal with validation through the interceptor below
})
@InInterceptors(interceptors = {"org.jboss.wsf.stack.cxf.security.authentication.SubjectCreatingPolicyInterceptor"})
public class SampleSTS extends SecurityTokenServiceProvider {
   public SampleSTS() throws Exception {
      super();

      StaticSTSProperties props = new StaticSTSProperties();
      props.setSignatureCryptoProperties("stsKeystore.properties");
      props.setSignatureUsername("mystskey");
      props.setCallbackHandlerClass(STSCallbackHandler.class.getName());
      props.setIssuer("DoubleItSTSIssuer");

      List&lt;ServiceMBean&gt; services = new LinkedList&lt;ServiceMBean&gt;();
      StaticService service = new StaticService();
      service.setEndpoints(Arrays.asList(
         "http://localhost:(\\d)*/jaxws-samples-wsse-policy-trust/SecurityService",
         "http://\\[::1\\]:(\\d)*/jaxws-samples-wsse-policy-trust/SecurityService",
         "http://\\[0:0:0:0:0:0:0:1\\]:(\\d)*/jaxws-samples-wsse-policy-trust/SecurityService",

         "http://localhost:(\\d)*/jaxws-samples-wsse-policy-trust-actas/ActAsService",
         "http://\\[::1\\]:(\\d)*/jaxws-samples-wsse-policy-trust-actas/ActAsService",
         "http://\\[0:0:0:0:0:0:0:1\\]:(\\d)*/jaxws-samples-wsse-policy-trust-actas/ActAsService",

         "http://localhost:(\\d)*/jaxws-samples-wsse-policy-trust-onbehalfof/OnBehalfOfService",
         "http://\\[::1\\]:(\\d)*/jaxws-samples-wsse-policy-trust-onbehalfof/OnBehalfOfService",
         "http://\\[0:0:0:0:0:0:0:1\\]:(\\d)*/jaxws-samples-wsse-policy-trust-onbehalfof/OnBehalfOfService"
      ));
      services.add(service);

      TokenIssueOperation issueOperation = new TokenIssueOperation();
      issueOperation.setServices(services);
      issueOperation.getTokenProviders().add(new SAMLTokenProvider());
      // required for OnBehalfOf
      issueOperation.getTokenValidators().add(new UsernameTokenValidator());
      // added for OnBehalfOf and ActAs
      issueOperation.getDelegationHandlers().add(new UsernameTokenDelegationHandler());
      issueOperation.setStsProperties(props);

      TokenValidateOperation validateOperation = new TokenValidateOperation();
      validateOperation.getTokenValidators().add(new SAMLTokenValidator());
      validateOperation.setStsProperties(props);

      this.setIssueOperation(issueOperation);
      this.setValidateOperation(validateOperation);
   }
}</pre></section><section class="section" id="ActAs_ws_trust_scenario_STS_STSCallbackHandler"><div class="titlepage"><div><div><h5 class="title">A.8.4.2.2. STSCallbackHandler Class</h5></div></div></div><p>
							The user, <code class="literal">alice</code>, and corresponding password was required to be added for the <code class="literal">ActAs</code> example.
						</p><pre class="programlisting language-java">package org.jboss.test.ws.jaxws.samples.wsse.policy.trust.sts;

import java.util.HashMap;
import java.util.Map;

import org.jboss.wsf.stack.cxf.extensions.security.PasswordCallbackHandler;

public class STSCallbackHandler extends PasswordCallbackHandler {
   public STSCallbackHandler() {
      super(getInitMap());
   }

   private static Map&lt;String, String&gt; getInitMap() {
      Map&lt;String, String&gt; passwords = new HashMap&lt;String, String&gt;();
      passwords.put("mystskey", "stskpass");
      passwords.put("alice", "clarinet");
      return passwords;
   }
}</pre></section><section class="section" id="ActAs_ws_trust_scenario_WSR"><div class="titlepage"><div><div><h5 class="title">A.8.4.2.3. Web Service Requester</h5></div></div></div><p>
							This section provides the details of the <code class="literal">ws-requester</code> elements from the basic WS-Trust scenario that have been changed to address the requirements of the <code class="literal">ActAs</code> example. The component is:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									<a class="link" href="#ActAs_ws_trust_scenario_WSR_implementation" title="A.8.4.2.4. Web Service Requester Implementation Class">ActAs Web Service Requester Implementation Class</a>
								</li></ul></div></section><section class="section" id="ActAs_ws_trust_scenario_WSR_implementation"><div class="titlepage"><div><div><h5 class="title">A.8.4.2.4. Web Service Requester Implementation Class</h5></div></div></div><p>
							The <code class="literal">ActAs</code> <code class="literal">ws-requester</code>, the client, uses standard procedures for creating a reference to the web service in the first four lines. To address the endpoint security requirements, the web service’s request context is configured using <code class="literal">BindingProvider</code> to provide information required for message generation. The <code class="literal">ActAs</code> user, <code class="literal">myactaskey</code>, is declared in this section and <code class="literal">UsernameTokenCallbackHandler</code> is used to provide the contents of the <code class="literal">ActAs</code> element to the <code class="literal">STSClient</code>. In this example an <code class="literal">STSClient</code> object is created and provided to the proxy’s request context. The alternative is to provide keys tagged with the <code class="literal">.it</code> suffix as was done in the Basic Scenario client. The use of <code class="literal">ActAs</code> is configured through the properties map using the <code class="literal">SecurityConstants.STS_TOKEN_ACT_AS</code> key. The alternative is to use the <code class="literal">STSClient.setActAs</code> method.
						</p><pre class="programlisting language-java">final QName serviceName = new QName("http://www.jboss.org/jbossws/ws-extensions/actaswssecuritypolicy", "ActAsService");
final URL wsdlURL = new URL(serviceURL + "?wsdl");
Service service = Service.create(wsdlURL, serviceName);
ActAsServiceIface proxy = (ActAsServiceIface) service.getPort(ActAsServiceIface.class);

Bus bus = BusFactory.newInstance().createBus();
try {
    BusFactory.setThreadDefaultBus(bus);

    Map&lt;String, Object&gt; ctx = proxy.getRequestContext();

    ctx.put(SecurityConstants.CALLBACK_HANDLER, new ClientCallbackHandler());
    ctx.put(SecurityConstants.ENCRYPT_PROPERTIES,
        Thread.currentThread().getContextClassLoader().getResource(
        "META-INF/clientKeystore.properties"));
    ctx.put(SecurityConstants.ENCRYPT_USERNAME, "myactaskey");
    ctx.put(SecurityConstants.SIGNATURE_PROPERTIES,
        Thread.currentThread().getContextClassLoader().getResource(
        "META-INF/clientKeystore.properties"));
    ctx.put(SecurityConstants.SIGNATURE_USERNAME, "myclientkey");

    // Generate the ActAs element contents and pass to the STSClient as a string
    UsernameTokenCallbackHandler ch = new UsernameTokenCallbackHandler();
    String str = ch.getUsernameTokenString("alice","clarinet");
    ctx.put(SecurityConstants.STS_TOKEN_ACT_AS, str);

    STSClient stsClient = new STSClient(bus);
    Map&lt;String, Object&gt; props = stsClient.getProperties();
    props.put(SecurityConstants.USERNAME, "bob");
    props.put(SecurityConstants.CALLBACK_HANDLER, new ClientCallbackHandler());
    props.put(SecurityConstants.ENCRYPT_PROPERTIES,
        Thread.currentThread().getContextClassLoader().getResource(
        "META-INF/clientKeystore.properties"));
    props.put(SecurityConstants.ENCRYPT_USERNAME, "mystskey");
    props.put(SecurityConstants.STS_TOKEN_USERNAME, "myclientkey");
    props.put(SecurityConstants.STS_TOKEN_PROPERTIES,
        Thread.currentThread().getContextClassLoader().getResource(
        "META-INF/clientKeystore.properties"));
    props.put(SecurityConstants.STS_TOKEN_USE_CERT_FOR_KEYINFO, "true");

    ctx.put(SecurityConstants.STS_CLIENT, stsClient);
} finally {
    bus.shutdown(true);
}
proxy.sayHello();</pre><p>
							<br/><br/><br/><br/>
						</p><p>
							<span class="emphasis"><em><span class="right right">Revised on 2019-12-05 13:41:47 UTC</span></em></span>
						</p></section></section></section></section></section><div><div xml:lang="en-US" class="legalnotice" id="idm139695810578400"><h1 class="legalnotice">Legal Notice</h1><div class="para">
		Copyright <span class="trademark"><!--Empty--></span>© 2019 Red Hat, Inc.
	</div><div class="para">
		The text of and illustrations in this document are licensed by Red Hat under a Creative Commons Attribution–Share Alike 3.0 Unported license ("CC-BY-SA"). An explanation of CC-BY-SA is available at <a class="uri mimir-link-warn" href="http://creativecommons.org/licenses/by-sa/3.0/" title="Mimir does not include content from: creativecommons.org">http://creativecommons.org/licenses/by-sa/3.0/</a>. In accordance with CC-BY-SA, if you distribute this document or an adaptation of it, you must provide the URL for the original version.
	</div><div class="para">
		Red Hat, as the licensor of this document, waives the right to enforce, and agrees not to assert, Section 4d of CC-BY-SA to the fullest extent permitted by applicable law.
	</div><div class="para">
		Red Hat, Red Hat Enterprise Linux, the Shadowman logo, the Red Hat logo, JBoss, OpenShift, Fedora, the Infinity logo, and RHCE are trademarks of Red Hat, Inc., registered in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Linux</span>® is the registered trademark of Linus Torvalds in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Java</span>® is a registered trademark of Oracle and/or its affiliates.
	</div><div class="para">
		<span class="trademark">XFS</span>® is a trademark of Silicon Graphics International Corp. or its subsidiaries in the United States and/or other countries.
	</div><div class="para">
		<span class="trademark">MySQL</span>® is a registered trademark of MySQL AB in the United States, the European Union and other countries.
	</div><div class="para">
		<span class="trademark">Node.js</span>® is an official trademark of Joyent. Red Hat is not formally related to or endorsed by the official Joyent Node.js open source or commercial project.
	</div><div class="para">
		The <span class="trademark">OpenStack</span>® Word Mark and OpenStack logo are either registered trademarks/service marks or trademarks/service marks of the OpenStack Foundation, in the United States and other countries and are used with the OpenStack Foundation's permission. We are not affiliated with, endorsed or sponsored by the OpenStack Foundation, or the OpenStack community.
	</div><div class="para">
		All other trademarks are the property of their respective owners.
	</div></div></div></div></body>

        
        
    </div>
    

</div> 


                            </bdo>
                        </main>
                    </div>
                </main>
            </div>
        
            <!--#include virtual="/includes/footer/index.html" -->
        </div>
    </body>
</html>
