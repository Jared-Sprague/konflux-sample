<!DOCTYPE html>
<html>
    <head>
        
        <link rel="stylesheet" type="text/css" media="screen" href="/mimir/styles/mimir.min.css">
        




    <link rel="stylesheet" type="text/css" media="screen" href="/sites/dxp-docs/files/css/css_87GMcmxT1ib8ziQiU2KUAnTDFtZQV6iP-KGslA9LigM.css" />

    <link rel="stylesheet" type="text/css" media="screen" href="/sites/dxp-docs/files/css/css_Bwzy34i9pSdDlzGALvqVwG4fpgGp08KLMAkClGNY9M4.css" />



<link rel="stylesheet" type="text/css" media="screen" href="/mimir/styles/mimir-doc-toc.min.css" />



        
        <!--#include virtual="/includes/head/index.html" -->

        
        <title>
Red Hat Ansible Automation Platform from GCP Marketplace Guide - Ansible on Clouds 2.x
</title>
        
<meta name="product" content="Ansible on Clouds" />
<meta name="documentation_version" content="2.x" />
<meta name="documentKind" content="documentation" />
<meta name="portal_content_subtype" content="title" />
<meta name="lastModifiedDate" content="2024-08-20T18:05:18.000Z" />


        
            
        
        
            
                
                
                <!-- mimir_solr_yesindex -->
                <meta name="mimir_solr_yesindex" content="true" />
            
        
    </head>

    <body class="mimir-body">

        
        

        
        <div id="page-wrap" class="page-wrap">
            <div id="pers-top-page-wrap" class="top-page-wrap pers-loader-bg">
                <div id="hero-bg-top-left" class="summit-bg-shapes"></div>
                <div id="hero-bg-top-right" class="summit-bg-shapes"></div>

                <header class="masthead" id="masthead">

                    
                    <!--#include virtual="/includes/header/index.html" -->

                    
                    
                    
                        
                    
                    
                        <div class="breadcrumbs">
                            <div id="breadcrumbs" class="container">
                                
                                <a href="/">Home</a>
                                
                                <a href="/products/">Product Documentation</a>
                                
                                <a href="/documentation/en-us/ansible_on_clouds/2.4/">Ansible on Clouds</a>
                                
                                <a href="/documentation/en-us/ansible_on_clouds/2.x/">2.x</a>
                                
                                
                                Red Hat Ansible Automation Platform from GCP Marketplace Guide
                                
                            </div>
                        </div>
                    
                </header>

                <main id="cp-main" class="portal-content-area">
                    <div id="cp-content" class="main-content">
                        
                        <main class="container mimir-docs">
                            
                            <bdo>
                                

<script type="module" src="/mimir/scripts/mimir-doc-toc.min.js"></script>






<div class="docs-grid">

    <nav id="mimir-doc-toc" class="mimir-doc-toc">
      <div class="mimir-doc-toc-inner">
          <!-- single-page -->
        
            
              <ol>
                <li>
                        
                        <a href="#">Red Hat Ansible Automation Platform from GCP Marketplace Guide</a>
                    </li><li>
                        <a href="#making-open-source-more-inclusive">
                            Making open source more inclusive
                        </a>
                    </li><li>
                        <a href="#providing-feedback">
                            Providing feedback on Red Hat documentation
                        </a>
                    </li><li>
                        <a href="#assembly-intro-to-aap-on-gcp">
                            1. Introduction
                        </a><ol>
                <li>
                        <a href="#con-gcp-application-architecture">
                            1.1. Application architecture
                        </a>
                    </li><li>
                        <a href="#service_descriptions">
                            1.2. Service descriptions
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#assembly-gcp-install">
                            2. Installation
                        </a><ol>
                <li>
                        <a href="#ref-gcp-install-prerequisites">
                            2.1. Prerequisites
                        </a>
                    </li><li>
                        <a href="#con-gcp-create-project">
                            2.2. Create a project
                        </a><ol>
                <li>
                        <a href="#con-gcp-required-apis">
                            2.2.1. Required APIs
                        </a>
                    </li><li>
                        <a href="#con-gcp-service-account">
                            2.2.2. Create a service account
                        </a>
                    </li><li>
                        <a href="#ref-gcp-install-permissions">
                            2.2.3. Policies and permissions
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#con-gcp-application-deploy">
                            2.3. Application deployment
                        </a><ol>
                <li>
                        <a href="#proc-gcp-deploy-with-new-vpc">
                            2.3.1. Deploying an application with a new VPC
                        </a>
                    </li><li>
                        <a href="#proc-gcp-deploy-with-existing-vpc">
                            2.3.2. Deploying an application with an existing VPC
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#con-gcp-get-deployment-info">
                            2.4. Deployment information
                        </a><ol>
                <li>
                        <a href="#proc-gcp-retrieve-admin-password">
                            2.4.1. Retrieving the administration password
                        </a>
                    </li><li>
                        <a href="#proc-gcp-retrieve-lb-addresses">
                            2.4.2. Retrieving the load balancer addresses
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#con-gcp-setup-at-deployment-time">
                            2.5. Setting up monitoring and logging at deployment time
                        </a>
                    </li><li>
                        <a href="#proc-gcp-deploying-extension-nodes">
                            2.6. Deploying an extension node
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#assembly-gcp-deploying-extension-nodes">
                            3. Deploying extension nodes
                        </a><ol>
                <li>
                        <a href="#ref-gcp-decide-offer-type">
                            3.1. Deciding the offer type
                        </a>
                    </li><li>
                        <a href="#ref-gcp-permissions-to-manage-nodes_gcp-extension-nodes">
                            3.2. IAM minimum permissions
                        </a>
                    </li><li>
                        <a href="#con-gcp-pull-deploy-container-image">
                            3.3. Pulling the ansible-on-clouds-ops container image
                        </a>
                    </li><li>
                        <a href="#proc-gcp-generate-add-data-files">
                            3.4. Generating data files by running the ansible-on-clouds-ops container
                        </a>
                    </li><li>
                        <a href="#proc-aws-update-data-file">
                            3.5. Populate the data file
                        </a>
                    </li><li>
                        <a href="#proc-gcp-deploying-add-extension-nodes">
                            3.6. Deploying the extension node
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#assembly-gcp-removing-extension-nodes">
                            4. Removing extension nodes
                        </a><ol>
                <li>
                        <a href="#con-gcp-pull-remove-container-image">
                            4.1. Pulling the ansible-on-clouds-ops container image
                        </a>
                    </li><li>
                        <a href="#proc-gcp-generate-remove-data-files">
                            4.2. Generating data files by running the ansible-on-clouds-ops container
                        </a>
                    </li><li>
                        <a href="#proc-gcp-update-remove-data-file">
                            4.3. Populate the data file
                        </a>
                    </li><li>
                        <a href="#proc-gcp-removing-extension-nodes">
                            4.4. Running the ansible-on-clouds-ops container to remove the extension nodes
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#assembly-gcp-networking-access">
                            5. Networking and application access
                        </a><ol>
                <li>
                        <a href="#ref-gcp-networking-options">
                            5.1. Networking options
                        </a>
                    </li><li>
                        <a href="#con-gcp-network-peering-options">
                            5.2. Network peering options
                        </a>
                    </li><li>
                        <a href="#proc-gcp-vpc-peering">
                            5.3. VPC peering
                        </a>
                    </li><li>
                        <a href="#proc-gcp-external-load-balancer">
                            5.4. Using an external load balancer
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#assembly-gcp-additional-configs">
                            6. Additional configurations
                        </a><ol>
                <li>
                        <a href="#proc-gcp-additional-configs-update-admin-password">
                            6.1. Changing the default administrator password
                        </a>
                    </li><li>
                        <a href="#proc-gcp-additional-configs-replace-tls-certificate">
                            6.2. Replacing automation controller and automation hub VM instances SSL/TLS certificate and key
                        </a>
                    </li><li>
                        <a href="#proc-gcp-secure-communication-SSL">
                            6.3. Securing internal communication with SSL
                        </a>
                    </li><li>
                        <a href="#ref-gcp-security-considerations">
                            6.4. Security considerations
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#ap-command-generator">
                            7. The command generator
                        </a><ol>
                <li>
                        <a href="#proc-aap-pull-command-container-image">
                            7.1. Pulling the ansible-on-clouds-ops container image
                        </a>
                    </li><li>
                        <a href="#proc-aap-list-available-playbooks">
                            7.2. Listing the available playbooks
                        </a>
                    </li><li>
                        <a href="#proc-aap-generate-command-data-file">
                            7.3. Generating the data file
                        </a>
                    </li><li>
                        <a href="#proc-aap-populate-command-data-file">
                            7.4. Populating the data file
                        </a>
                    </li><li>
                        <a href="#proc-aap-run-generated-command">
                            7.5. Running the generated command
                        </a>
                    </li><li>
                        <a href="#ref-aap-using-playbooks">
                            7.6. Using the playbooks
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#assembly-gcp-automation-workloads">
                            8. Automation workloads
                        </a><ol>
                <li>
                        <a href="#ref-gcp-automation-performance">
                            8.1. Automation performance
                        </a>
                    </li><li>
                        <a href="#ref-gcp-deployment-scaling">
                            8.2. Deployment scaling
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#assembly-gcp-monitoring-logging">
                            9. Monitoring and logging
                        </a><ol>
                <li>
                        <a href="#con-gcp-setup-after-deployment">
                            9.1. Setting up monitoring and logging after deployment
                        </a><ol>
                <li>
                        <a href="#ref-gcp-iam-logging-monitoring-minimum-permissions">
                            9.1.1. Required permissions
                        </a>
                    </li><li>
                        <a href="#con-gcp-use-container-image">
                            9.1.2. Pulling the ansible-on-clouds-ops container image
                        </a>
                    </li><li>
                        <a href="#proc-gcp-generate-variables">
                            9.1.3. Generating data files by running the ansible-on-clouds-ops container
                        </a>
                    </li><li>
                        <a href="#proc-gcp-set-monitoring-logging-yml">
                            9.1.4. Updating the data file
                        </a>
                    </li><li>
                        <a href="#proc-gcp-generate-playbook">
                            9.1.5. Generating the playbook
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#con-gcp-customize-monitoring-logging">
                            9.2. Customizing monitoring and logging
                        </a><ol>
                <li>
                        <a href="#ref-gcp-ansible-podman-config">
                            9.2.1. Ansible and podman configuration
                        </a>
                    </li><li>
                        <a href="#ref-gcp-configure-google-cloud-ops-agent">
                            9.2.2. Google cloud ops agent configuration
                        </a>
                    </li>
            </ol>
                    </li>
            </ol>
                    </li><li>
                        <a href="#assembly-aap-gcp-backup-and-recovery">
                            10. Backup and Restore
                        </a><ol>
                <li>
                        <a href="#con-gcp-backup-process">
                            10.1. The Backup Process
                        </a><ol>
                <li>
                        <a href="#pulling_the_ansible_on_clouds_ops_container_image">
                            10.1.1. Pulling the ansible-on-clouds-ops container image
                        </a>
                    </li><li>
                        <a href="#ref-gcp-iam-backup-minimum-permissions">
                            10.1.2. Required permissions
                        </a>
                    </li><li>
                        <a href="#proc-gcp-setup-environment_backup">
                            10.1.3. Setting up the environment
                        </a>
                    </li><li>
                        <a href="#proc-gcp-backup-requirements">
                            10.1.4. Backup requirements
                        </a>
                    </li><li>
                        <a href="#proc-gcp-create-data-file">
                            10.1.5. Creating the backup data file
                        </a>
                    </li><li>
                        <a href="#ref-gcp-populate-backup-file">
                            10.1.6. Parameters in the backup.yml file
                        </a>
                    </li><li>
                        <a href="#proc-gcp-run-backup-playbook">
                            10.1.7. Running the backup playbook
                        </a>
                    </li><li>
                        <a href="#proc-gcp-listing-backups-playbook">
                            10.1.8. List backups
                        </a>
                    </li><li>
                        <a href="#proc-gcp-deleting-backups-playbook">
                            10.1.9. Delete backups
                        </a>
                    </li><li>
                        <a href="#proc-gcp-deleting-backups-troubleshooting-playbook">
                            10.1.10. Fixing a failed backup deletion
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#con-gcp-restore-process">
                            10.2. Restore Process
                        </a><ol>
                <li>
                        <a href="#proc-gcp-restore-pull-container-image_restore">
                            10.2.1. Pulling the ansible-on-clouds-ops container image
                        </a>
                    </li><li>
                        <a href="#proc-gcp-setup-environment_restore">
                            10.2.2. Setting up the environment
                        </a>
                    </li><li>
                        <a href="#ref-aws-iam-restore-minimum-permissions">
                            10.2.3. Required permissions
                        </a>
                    </li><li>
                        <a href="#proc-gcp-generate-restore-yml-file">
                            10.2.4. Generating the restore.yml file
                        </a>
                    </li><li>
                        <a href="#ref-gcp-populate-restore-file">
                            10.2.5. Parameters of the restore.yml file
                        </a>
                    </li><li>
                        <a href="#ref-gcp-run-restore-command">
                            10.2.6. Running the restore command
                        </a>
                    </li><li>
                        <a href="#ref-failed-to-restore">
                            10.2.7. Failure to restore
                        </a>
                    </li>
            </ol>
                    </li>
            </ol>
                    </li><li>
                        <a href="#assembly-gcp-upgrade">
                            11. Upgrading
                        </a><ol>
                <li>
                        <a href="#con-gcp-upgrade-backup-process">
                            11.1. Backup before upgrade
                        </a>
                    </li><li>
                        <a href="#con-gcp-upgrade-upgrading">
                            11.2. Upgrade Ansible Automation Platform
                        </a><ol>
                <li>
                        <a href="#proc-gcp-upgrade-pull-container-image">
                            11.2.1. Pulling the ansible-on-clouds-ops container image
                        </a>
                    </li><li>
                        <a href="#ref-aws-iam-upgrade-minimum-permissions">
                            11.2.2. Required permissions
                        </a>
                    </li><li>
                        <a href="#proc-gcp-generate-upgrade-data-file">
                            11.2.3. Generating the data file
                        </a>
                    </li><li>
                        <a href="#ref-gcp-update-upgrade-data-file">
                            11.2.4. Updating the data file
                        </a>
                    </li><li>
                        <a href="#proc-gcp-running-upgrade">
                            11.2.5. Running the upgrade playbook
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#con-gcp-upgrade-restore-from-stack">
                            11.3. Restore from backup
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#assembly-gcp-uninstall">
                            12. Uninstalling
                        </a><ol>
                <li>
                        <a href="#proc-gcp-delete-extension-nodes">
                            12.1. Removing extension nodes
                        </a>
                    </li><li>
                        <a href="#proc-gcp-uninstall-application-uninstall">
                            12.2. Uninstalling Ansible Automation Platform
                        </a>
                    </li><li>
                        <a href="#con-gcp-uninstall-postupgrade">
                            12.3. Removing upgrade resources
                        </a><ol>
                <li>
                        <a href="#proc-gcp-delete-upgrade-secrets">
                            12.3.1. Removing the secrets
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#con-aws-uninstall-postbackups">
                            12.4. Removing backup resources
                        </a><ol>
                <li>
                        <a href="#proc-gcp-delete-backup-leftovers">
                            12.4.1. Removing the filestore
                        </a>
                    </li><li>
                        <a href="#proc-gcp-delete-object-storage">
                            12.4.2. Removing the storage bucket
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#con-aws-uninstall-other">
                            12.5. Removing remaining resources
                        </a><ol>
                <li>
                        <a href="#proc-gcp-delete-service-account">
                            12.5.1. Removing the service account
                        </a>
                    </li>
            </ol>
                    </li>
            </ol>
                    </li><li>
                        <a href="#assembly-gcp-tech-notes">
                            13. Technical Notes
                        </a><ol>
                <li>
                        <a href="#tech-note-gcp-upgrade-logging-and-monitoring">
                            13.1. Upgrade - logging and monitoring
                        </a>
                    </li><li>
                        <a href="#con-tech-note-linux-files-owned-by-root">
                            13.2. Command generator - Linux files owned by root
                        </a>
                    </li><li>
                        <a href="#tech-note-gcp-upgrade">
                            13.3. Upgrade note
                        </a>
                    </li><li>
                        <a href="#tech-note-gcp-controller-api">
                            13.4. Ansible Automation Platform Controller API
                        </a>
                    </li><li>
                        <a href="#tech-note-gcp-remove-extension-node">
                            13.5. Remove extension node note
                        </a>
                    </li><li>
                        <a href="#tech-note-gcp-secrets-update">
                            13.6. Secrets Update
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#assembly-gcp-support">
                            14. Support
                        </a><ol>
                <li>
                        <a href="#ref-gcp-supported-changes">
                            14.1. Supported infrastructure configuration changes
                        </a>
                    </li><li>
                        <a href="#ref-gcp-vm-image-packages">
                            14.2. VM Image packages
                        </a>
                    </li>
            </ol>
                    </li><li>
                        <a href="#assembly-appendix-aap-release-notes">
                            A. Release notes for Ansible on Clouds 2.4
                        </a>
                    </li><li>
                        <a href="#idm139690691414528">
                            Legal Notice
                        </a>
                    </li>
            </ol>
            
        
      </div>
    </nav>

    
    <div class="pvof-doc__wrapper" id="doc-wrapper">
        <section class="mimir-doc-title" id="mimir-doc--red_hat_ansible_automation_platform_from_gcp_marketplace_guide">
            <h1 class="title">Red Hat Ansible Automation Platform from GCP Marketplace Guide</h1>
        </section>
        <body><div xml:lang="en-US" class="book" id="idm139690714777488"><div class="titlepage"><div><div class="producttitle"><span class="productname">Ansible on Clouds</span> <span class="productnumber">2.x</span></div><div><h2 class="subtitle">Install and configure Red Hat Ansible Automation Platform from GCP Marketplace</h2></div><div><div xml:lang="en-US" class="authorgroup"><span class="orgname">Red Hat Customer Content Services </span></div></div><div><a href="#idm139690691414528">Legal Notice</a></div><div><div class="abstract"><p class="title"><strong>Abstract</strong></p>
			Thank you for your interest in Red Hat Ansible Automation Platform from GCP Marketplace. Ansible Automation Platform is a commercial offering that helps teams manage complex multi-tier deployments by adding control, knowledge, and delegation to Ansible-powered environments. This guide helps you to understand the installation and use of Ansible Automation Platform from GCP Marketplace.
		</div></div></div><hr/></div><section class="preface Role ARG Spec" id="making-open-source-more-inclusive"><div class="titlepage"><div><div><h1 class="title">Making open source more inclusive</h1></div></div></div><p class="Role ARG Spec Role ARG Spec">
			Red Hat is committed to replacing problematic language in our code, documentation, and web properties. We are beginning with these four terms: master, slave, blacklist, and whitelist. Because of the enormity of this endeavor, these changes will be implemented gradually over several upcoming releases. For more details, see <a class="link mimir-link-warn" href="https://www.redhat.com/en/blog/making-open-source-more-inclusive-eradicating-problematic-language" title="Mimir does not include content from: www.redhat.com">our CTO Chris Wright’s message</a>.
		</p></section><section class="preface Role ARG Spec" id="providing-feedback"><div class="titlepage"><div><div><h1 class="title">Providing feedback on Red Hat documentation</h1></div></div></div><p class="Role ARG Spec Role ARG Spec">
			If you have a suggestion to improve this documentation, or find an error, you can contact technical support at <a class="link" href="/">https://access.redhat.com</a> to open a request.
		</p><div class="admonition important Role ARG Spec"><div class="admonition_header">Important</div><div><p class="Role ARG Spec Role ARG Spec">
				<span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Disclaimer</span></strong></span>: Links contained in this document to external websites are provided for convenience only. Red Hat has not reviewed the links and is not responsible for the content or its availability. The inclusion of any link to an external website does not imply endorsement by Red Hat of the website or their entities, products or services. You agree that Red Hat is not responsible or liable for any loss or expenses that may result due to your use of (or reliance on) the external site or content.
			</p></div></div></section><section class="chapter Role ARG Spec" id="assembly-intro-to-aap-on-gcp"><div class="titlepage"><div><div><h1 class="title">Chapter 1. Introduction</h1></div></div></div><p class="Role ARG Spec Role ARG Spec">
			Ansible Automation Platform from GCP Marketplace is an offering that you can deploy from the <a class="link mimir-link-warn" href="https://console.cloud.google.com/marketplace" title="Mimir does not include content from: console.cloud.google.com">GCP Marketplace</a> portal. Ansible Automation Platform from GCP Marketplace provides access to a library of Ansible content collections, and is integrated with key GCP services, so you can start automating the deployment, configuration, and management of infrastructure and applications quickly.
		</p><p class="Role ARG Spec Role ARG Spec">
			The following Red Hat Ansible Automation Platform components are available on Ansible Automation Platform from GCP Marketplace:
		</p><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
					<a class="link mimir-link-warn" href="https://www.ansible.com/products/controller" title="Mimir does not include content from: www.ansible.com">Automation controller</a>
				</li><li class="listitem">
					<a class="link mimir-link-warn" href="https://docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/2.2/html/getting_started_with_automation_hub/pr01" title="This content is not included in Mimir.">Ansible automation hub</a>
				</li><li class="listitem">
					<a class="link mimir-link-warn" href="https://docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/2.1/html-single/managing_containers_in_private_automation_hub/index" title="This content is not included in Mimir.">Private automation hub</a>
				</li><li class="listitem">
					<a class="link mimir-link-warn" href="https://docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/2.2/html-single/publishing_proprietary_content_collections_in_automation_hub/index" title="This content is not included in Mimir.">Ansible Content Collections</a>
				</li><li class="listitem">
					<a class="link mimir-link-warn" href="https://docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/2.2/html-single/creating_and_consuming_execution_environments/index" title="This content is not included in Mimir.">Automation execution environments</a>
				</li><li class="listitem">
					<a class="link mimir-link-warn" href="https://www.ansible.com/products/automation-platform" title="Mimir does not include content from: www.ansible.com">Ansible content tools, including access to Red Hat Insights for Red Hat Ansible Automation Platform</a>
				</li></ul></div><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
				Automation mesh is not available on Ansible Automation Platform from GCP Marketplace at this time.
			</p></div></div><section class="section Role ARG Spec" id="con-gcp-application-architecture"><div class="titlepage"><div><div><h2 class="title">1.1. Application architecture</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				Red Hat Ansible Automation Platform from GCP Marketplace is installed into infrastructure resources running within your GCP account.
			</p><p class="Role ARG Spec Role ARG Spec">
				There are four virtual machines included in this product listing. Three n2-standard-2 virtual machines make up the permanent compute components of the solution. Additionally, a single ephemeral e2-medium instance is used to run Red Hat Ansible Automation Platform and Google Cloud deployment workloads. This virtual machine is only used during deployment and then is permanently removed from the solution. The infrastructure cost for the ephemeral VM is charged at the hourly rate during the periiod that the VM exists, usually less than an hour.
			</p><div class="informalfigure"><div class="mediaobject"><img src="/webassets/avalon/d/Ansible_on_Clouds-2.x-Red_Hat_Ansible_Automation_Platform_from_GCP_Marketplace_Guide-en-US/images/749b60f1ed53f00d4c95989a322ddd0c/GCP-existing-deployment.png" alt="GCP existing deployment architecture" /></div></div><p class="Role ARG Spec Role ARG Spec">
				Ansible Automation Platform from GCP Marketplace is designed to be private, with no public access allowed by default.
			</p><p class="Role ARG Spec Role ARG Spec">
				This requires customers to expose the deployed <span class="emphasis"><em><span class="Role ARG Spec Role ARG Spec">Internal Load Balancers</span></em></span> (ILBs) themselves pursuant to their own network requirements and security practices. Some potential ways to expose the ILBs include VPC Peering, Transit Gateway, VPN, External Load Balancers, amongst others.
			</p><p class="Role ARG Spec Role ARG Spec">
				All cloud infrastructure components are deployed in a <span class="emphasis"><em><span class="Role ARG Spec Role ARG Spec">Virtual Private Cloud</span></em></span> (VPC).
			</p><p class="Role ARG Spec Role ARG Spec">
				Customers can choose between deploying into an existing VPC, or to have the product deploy a new VPC for them. All VM instances and Cloud infrastructure have private IP addresses (allocation determined by the VPC and subnetworks specified at deployment time) by default.
			</p><p class="Role ARG Spec Role ARG Spec">
				All internal traffic is encrypted using self-signed certificates generated at deployment time (external traffic can also be encrypted by deploying your own certificate on the Internal Load Balancers deployed by the product).
			</p><p class="Role ARG Spec Role ARG Spec">
				The Ansible Automation Platform software runs as containers on the deployed VM instances.
			</p><p class="Role ARG Spec Role ARG Spec">
				<span class="emphasis"><em><span class="Role ARG Spec Role ARG Spec">Managed instance groups</span></em></span> (MIGs) manage VM instance lifecycles and monitor the health of each service running on the VM instances, automatically cycling the VM instances down and replacing them with new VM instances if the health check fails to respond, ensuring that the Ansible Automation Platform services stays up and available to process requests.
			</p><p class="Role ARG Spec Role ARG Spec">
				The VM instances run a customized <span class="emphasis"><em><span class="Role ARG Spec Role ARG Spec">RedHat Enterprise Linux</span></em></span> (RHEL) Google Cloud Machine Image as their base image. This Google Cloud Machine Image is preloaded with all the required container images and packages to run the Ansible Automation Platform (automation hub, automation controller, and Execution Node components).
			</p><p class="Role ARG Spec Role ARG Spec">
				A shared Google File Store (GFS) volume is mounted into each VM instance provisioned by the product and is used for shared access to common files and resources.
			</p><p class="Role ARG Spec Role ARG Spec">
				A Google Cloud SQL Service is provisioned by the product at deployment time and contains databases for both the automation controller and automation hub.
			</p><div class="informalfigure"><div class="mediaobject"><img src="/webassets/avalon/d/Ansible_on_Clouds-2.x-Red_Hat_Ansible_Automation_Platform_from_GCP_Marketplace_Guide-en-US/images/0b7f0082d6806ce5668344273eee8da2/GCP-full-deployment.png" alt="GCP full deployment architecture" /></div></div><p class="Role ARG Spec Role ARG Spec">
				The Foundation product includes two Execution Nodes running on the same VM instances as the automation controller components (this is called a Hybrid Node configuration in Ansible Automation Platform). Additional Execution Node offerings can be purchased to increase the scale (total number of managed nodes) the Ansible Automation Platform deployment is licensed to automate. When deploying the Execution Node offerings into an existing Ansible Automation Platform Foundation deployment, additional Execution Node VM instances can be deployed and automatically connected to the automation controller of the Foundation deployment where they immediately begin processing automation tasks.
			</p><p class="Role ARG Spec Role ARG Spec">
				Ansible Automation Platform components are run as containers using the Podman container runtime on the VM instances. The Podman runtime configuration is managed as a system service using <code class="literal Role ARG Spec">systemd</code> to ensure uptime and availability, and restarting any failed containers automatically.
			</p><p class="Role ARG Spec Role ARG Spec">
				SELinux is enabled on the VM instances and is supported down to the container level.
			</p><p class="Role ARG Spec Role ARG Spec">
				Additional operational automations are provided by the offering, available as a separate docker container for download from registry.redhat.io. These additional operational automations include backup, restore, and upgrade.
			</p><p class="Role ARG Spec Role ARG Spec">
				Any <span class="emphasis"><em><span class="Role ARG Spec Role ARG Spec">Common Vulnerabilities and Exposures</span></em></span> (CVEs) found in the RHEL OS base image, the Ansible Automation Platform containers, or any included packages are addressed during upgrade of the Ansible Automation Platform offering by swapping out the base RHEL Google Cloud Machine Image with a newer version including all required software, packages, and containers.
			</p><p class="Role ARG Spec Role ARG Spec">
				This is done automatically for you through the use of the included upgrade automation.
			</p><p class="Role ARG Spec Role ARG Spec">
				Customers can take advantage of these operational automations to simplify the operational readiness of Ansible Automation Platform within their own corporate standards freeing themselves up to focus on developing Ansible Automation to manage their own infrastructure and applications rather than spending time developing automations to manage Ansible Automation Platform.
			</p></section><section class="section Role ARG Spec" id="service_descriptions"><div class="titlepage"><div><div><h2 class="title">1.2. Service descriptions</h2></div></div></div><div class="informaltable"><table class="lt-4-cols lt-7-rows Role ARG Spec"><colgroup><col style="width: 50%; " class="col_1"><!--Empty--></col><col style="width: 50%; " class="col_2"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139690701395760" scope="col">Service Name</th><th align="left" valign="top" id="idm139690701394672" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139690701395760"> <p>
								Compute Engine
							</p>
							 </td><td align="left" valign="top" headers="idm139690701394672"> <p>
								GCP VM compute platform
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139690701395760"> <p>
								Cloud SQL
							</p>
							 </td><td align="left" valign="top" headers="idm139690701394672"> <p>
								GCP database service
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139690701395760"> <p>
								Filestore
							</p>
							 </td><td align="left" valign="top" headers="idm139690701394672"> <p>
								GCP file storage service
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139690701395760"> <p>
								Virtual Private Cloud (VPC)
							</p>
							 </td><td align="left" valign="top" headers="idm139690701394672"> <p>
								GCP networking service
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139690701395760"> <p>
								Cloud Monitoring
							</p>
							 </td><td align="left" valign="top" headers="idm139690701394672"> <p>
								GCP metrics collector
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139690701395760"> <p>
								Cloud Logging
							</p>
							 </td><td align="left" valign="top" headers="idm139690701394672"> <p>
								GCP log management Service
							</p>
							 </td></tr></tbody></table></div></section></section><section class="chapter Role ARG Spec" id="assembly-gcp-install"><div class="titlepage"><div><div><h1 class="title">Chapter 2. Installation</h1></div></div></div><section class="section Role ARG Spec" id="ref-gcp-install-prerequisites"><div class="titlepage"><div><div><h2 class="title">2.1. Prerequisites</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				Before you can install and register Ansible Automation Platform, you must be familiar with GCP including how services operate, how data is stored, and any privacy implications that may exist by using these services. You must also set up an account with <span class="emphasis"><em><span class="Role ARG Spec Role ARG Spec">Google Cloud Platform</span></em></span> (GCP).
			</p><p class="Role ARG Spec Role ARG Spec">
				You must have a working knowledge of the following aspects of Google Cloud Platform:
			</p><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
						Deploying solutions from the GCP Marketplace
					</li><li class="listitem">
						Compute engine <span class="emphasis"><em><span class="Role ARG Spec Role ARG Spec">Virtual machine</span></em></span> (VM) instances
					</li><li class="listitem">
						Cloud SQL for PostgreSQL
					</li><li class="listitem">
						Filestore
					</li><li class="listitem"><p class="simpara">
						GPC <span class="emphasis"><em><span class="Role ARG Spec Role ARG Spec">Virtual Private Clouds</span></em></span> (VPCs)
					</p><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="circle"><li class="listitem">
								Subnets
							</li><li class="listitem">
								Route Tables
							</li><li class="listitem">
								Load Balancers
							</li></ul></div></li><li class="listitem"><p class="simpara">
						Network Design
					</p><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="circle"><li class="listitem">
								Hub-and-spoke networking designs
							</li><li class="listitem">
								VPC Peering
							</li><li class="listitem">
								<span class="emphasis"><em><span class="Role ARG Spec Role ARG Spec">Class Inter-Domain Routing</span></em></span> (CIDR) blocks
							</li><li class="listitem">
								Transit routing
							</li></ul></div></li><li class="listitem"><p class="simpara">
						GCP Cloud monitoring
					</p><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="circle"><li class="listitem">
								GCP Ops agent
							</li></ul></div></li><li class="listitem">
						SSH
					</li></ul></div><p class="Role ARG Spec Role ARG Spec">
				For more information about Google Cloud Platform and terminology, see the <a class="link mimir-link-warn" href="https://cloud.google.com//" title="Mimir does not include content from: cloud.google.com">GCP product documentation</a>.
			</p></section><section class="section Role ARG Spec" id="con-gcp-create-project"><div class="titlepage"><div><div><h2 class="title">2.2. Create a project</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				To install Ansible Automation Platform, you must create a project in your Google Cloud Platform account to host the application if you do not already have one. See <a class="link mimir-link-warn" href="https://cloud.google.com/resource-manager/docs/creating-managing-projects" title="Mimir does not include content from: cloud.google.com">Creating and managing projects</a> in the GCP documentation.
			</p><section class="section Role ARG Spec" id="con-gcp-required-apis"><div class="titlepage"><div><div><h3 class="title">2.2.1. Required APIs</h3></div></div></div><p class="Role ARG Spec Role ARG Spec">
					Your Google Cloud Platform (GCP) project requires access to several API services to complete Ansible Automation Platform installation. On marketplace deployment, the process automatically attempts to enable the following APIs.
				</p><p class="Role ARG Spec Role ARG Spec">
					If you prefer, you can enable the APIs ahead of time to ensure they are permitted by your organization.
				</p><div class="informaltable"><table class="lt-4-cols lt-7-rows Role ARG Spec"><colgroup><col style="width: 50%; " class="col_1"><!--Empty--></col><col style="width: 50%; " class="col_2"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139690699797072" scope="col">API Service</th><th align="left" valign="top" id="idm139690699795984" scope="col">Console service name</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139690699797072"> <p>
									Compute Engine API
								</p>
								 </td><td align="left" valign="top" headers="idm139690699795984"> <p>
									<code class="literal Role ARG Spec">compute.googleapis.com</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139690699797072"> <p>
									Google Cloud APIs
								</p>
								 </td><td align="left" valign="top" headers="idm139690699795984"> <p>
									<code class="literal Role ARG Spec">cloudapis.googleapis.com</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139690699797072"> <p>
									Identity and Access Management (IAM) API
								</p>
								 </td><td align="left" valign="top" headers="idm139690699795984"> <p>
									<code class="literal Role ARG Spec">iam.googleapis.com</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139690699797072"> <p>
									Cloud SQL Admin API
								</p>
								 </td><td align="left" valign="top" headers="idm139690699795984"> <p>
									<code class="literal Role ARG Spec">sql-component.googleapis.com</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139690699797072"> <p>
									Cloud Logging API
								</p>
								 </td><td align="left" valign="top" headers="idm139690699795984"> <p>
									<code class="literal Role ARG Spec">logging.googleapis.com</code>
								</p>
								 <p>
									See <a class="link" href="#assembly-gcp-monitoring-logging" title="Chapter 9. Monitoring and logging">Monitoring and logging</a>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139690699797072"> <p>
									Cloud Monitoring API
								</p>
								 </td><td align="left" valign="top" headers="idm139690699795984"> <p>
									<code class="literal Role ARG Spec">monitoring.googleapis.com</code>
								</p>
								 <p>
									See <a class="link" href="#assembly-gcp-monitoring-logging" title="Chapter 9. Monitoring and logging">Monitoring and logging</a>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139690699797072"> <p>
									Cloud Resource Manager API
								</p>
								 </td><td align="left" valign="top" headers="idm139690699795984"> <p>
									<code class="literal Role ARG Spec">cloudresourcemanager.googleapis.com</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139690699797072"> <p>
									Cloud Identity-Aware Proxy API
								</p>
								 </td><td align="left" valign="top" headers="idm139690699795984"> <p>
									<code class="literal Role ARG Spec">iap.googleapis.com</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139690699797072"> <p>
									Secret Manager API
								</p>
								 </td><td align="left" valign="top" headers="idm139690699795984"> <p>
									<code class="literal Role ARG Spec">secretmanager.googleapis.com</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139690699797072"> <p>
									Service Networking API
								</p>
								 </td><td align="left" valign="top" headers="idm139690699795984"> <p>
									<code class="literal Role ARG Spec">servicenetworking.googleapis.com</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139690699797072"> <p>
									Service Usage API
								</p>
								 </td><td align="left" valign="top" headers="idm139690699795984"> <p>
									<code class="literal Role ARG Spec">serviceusage.googleapis.com</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139690699797072"> <p>
									OS Config API
								</p>
								 </td><td align="left" valign="top" headers="idm139690699795984"> <p>
									<code class="literal Role ARG Spec">osconfig.googleapis.com</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139690699797072"> <p>
									Cloud Runtime Configuration API
								</p>
								 </td><td align="left" valign="top" headers="idm139690699795984"> <p>
									<code class="literal Role ARG Spec">runtimeconfig.googleapis.com</code>
								</p>
								 </td></tr><tr><td align="left" valign="top" headers="idm139690699797072"> <p>
									Cloud Filestore API
								</p>
								 </td><td align="left" valign="top" headers="idm139690699795984"> <p>
									<code class="literal Role ARG Spec">file.googleapis.com</code>
								</p>
								 </td></tr></tbody></table></div></section><section class="section Role ARG Spec" id="con-gcp-service-account"><div class="titlepage"><div><div><h3 class="title">2.2.2. Create a service account</h3></div></div></div><p class="Role ARG Spec Role ARG Spec">
					You must have a service account to set up Ansible Automation Platform from GCP Marketplace. This account is used to install and configure the application and remains associated with the Ansible Automation Platform virtual machines. You can use an existing service account with the required roles, or the Ansible Automation Platform deployment can create one with the required roles on your behalf. If you use an existing account, or <a class="link mimir-link-warn" href="https://cloud.google.com/iam/docs/creating-managing-service-accounts#creating" title="Mimir does not include content from: cloud.google.com">create a service account</a> in advance, it must have the following roles:
				</p><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
							Editor
						</li><li class="listitem">
							Logs Writer
						</li><li class="listitem">
							Cloud SQL Client
						</li><li class="listitem">
							Cloud SQL Instance User
						</li><li class="listitem">
							Secret Manager Secret Accessor
						</li><li class="listitem">
							Compute Network Admin
						</li></ul></div><p class="Role ARG Spec Role ARG Spec">
					See <a class="link mimir-link-warn" href="https://cloud.google.com/iam/docs/granting-changing-revoking-access#single-role" title="Mimir does not include content from: cloud.google.com">Grant a single role</a> for steps to add the required roles to your existing service account.
				</p><p class="Role ARG Spec Role ARG Spec">
					The Compute Network Administrator role is only required at the time of deployment to configure the application properly. When installation and configuration are complete, this role can be removed from the service account, which remains configured on the Ansible Automation Platform Virtual Machines.
				</p></section><section class="section Role ARG Spec" id="ref-gcp-install-permissions"><div class="titlepage"><div><div><h3 class="title">2.2.3. Policies and permissions</h3></div></div></div><p class="Role ARG Spec Role ARG Spec">
					Your GCP account must have the following <span class="emphasis"><em><span class="Role ARG Spec Role ARG Spec">Identity and Access Management</span></em></span> (IAM) permissions to successfully create and manage Ansible Automation Platform deployments as well as the resources described in <a class="link" href="#con-gcp-application-architecture" title="1.1. Application architecture">Application architecture</a>.
				</p><p class="Role ARG Spec Role ARG Spec">
					Your GCP account must also be licensed to deploy Ansible Automation Platform from GCP Marketplace.
				</p><p class="Role ARG Spec Role ARG Spec">
					The application can fail to deploy if your IAM policies restrict deployment and management of these resources.
				</p><p class="Role ARG Spec Role ARG Spec">
					The application has two deployment options:
				</p><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
							Create a deployment with a new VPC.
						</li><li class="listitem">
							Create a deployment using an existing VPC.
						</li></ul></div><p class="Role ARG Spec Role ARG Spec">
					Both options require the same minimum permissions
				</p><pre class="literallayout Role ARG Spec">Cloud SQL Client
Cloud SQL Instance User
Compute Network Admin
Editor
Logs Writer
Secret Manager Secret Accessor</pre></section></section><section class="section Role ARG Spec" id="con-gcp-application-deploy"><div class="titlepage"><div><div><h2 class="title">2.3. Application deployment</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				To launch your offer on the Google Cloud Console, navigate to the marketplace and search for <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Red Hat Ansible Automation Platform 2 - Up to 100 Managed Nodes</span></strong></span>. After selecting this offer click <span class="guibutton">Launch</span>.
			</p><p class="Role ARG Spec Role ARG Spec">
				There are four virtual machines included in this product listing. Three n2-standard-2 virtual machines make up the permanent compute components of the solution. Additionally, a single ephemeral e2-medium instance is used to run Red Hat Ansible Automation Platform and Google Cloud deployment workloads. This virtual machine is only used during deployment and then is permanently removed from the solution. The infrastructure cost for the ephemeral VM is charged at the hourly rate during the periiod that the VM exists, usually less than an hour.
			</p><div class="admonition important Role ARG Spec"><div class="admonition_header">Important</div><div><p class="Role ARG Spec Role ARG Spec">
					A temporary yet necessary constraint has been placed on the length of deployment names. This is due to GCP’s naming scheme for internal components that make up an Ansible Automation Platform deployment. Component names based on this naming scheme can get too long and often break naming constraints imposed by other services, creating deployment errors.
				</p><p class="Role ARG Spec Role ARG Spec">
					The length of the name of your deployment, plus the length of your GCP project name must be less than 35 characters and the length of the deployment name must be less than 30 characters.
				</p><p class="Role ARG Spec Role ARG Spec">
					The calculation below will help you find the maximum length of the name of an Ansible Automation Platform deployment in your project.
				</p><p class="Role ARG Spec Role ARG Spec">
					length of deployment name &lt; = (minimum between 30 and 35) - length(gcp project name)
				</p></div></div><p class="Role ARG Spec Role ARG Spec">
				There are two methods for deploying the application:
			</p><section class="section Role ARG Spec" id="proc-gcp-deploy-with-new-vpc"><div class="titlepage"><div><div><h3 class="title">2.3.1. Deploying an application with a new VPC</h3></div></div></div><p class="Role ARG Spec Role ARG Spec">
					This procedure creates a new VPC network and deploys the application in the created VPC.
				</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
						The process of deploying the application using a new VPC has been deprecated, and the functionality will be removed from Ansible Automation Platform from GCP Marketplace in a future release.
					</p></div></div><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem">
							In the Deployment page, select the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Service Usage API</span></strong></span> link below the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Confirm Service Usage API is enabled</span></strong></span> checkbox.
						</li><li class="listitem">
							In the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">API/Service Details</span></strong></span> tab, ensure that the API is enabled, then return to the Deployment page.
						</li><li class="listitem">
							Check the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Confirm Service Usage API</span></strong></span> is enabled checkbox.
						</li><li class="listitem">
							Select or create a <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Service Account</span></strong></span>. For further information see <a class="link" href="/documentation/en-us/ansible_on_clouds/2.x/html-single/red_hat_ansible_automation_platform_from_gcp_marketplace_guide/index/#con-gcp-service-account">Your service account</a>.
						</li><li class="listitem">
							In the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Region</span></strong></span> field, select the region where you want the application deployed.
						</li><li class="listitem">
							In the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Zone</span></strong></span> field, select the zone where you want the Filestore deployed. The zone must be in the Region you selected.
						</li><li class="listitem">
							In the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Observability</span></strong></span> section, you can enable logging and metrics to be sent to Cloud Logging and Cloud Monitoring. See <a class="link mimir-link-warn" href="https://cloud.google.com/stackdriver/pricing" title="Mimir does not include content from: cloud.google.com">Operations Suite Pricing</a> for the financial cost of enabling these services. See <a class="link" href="#assembly-gcp-monitoring-logging" title="Chapter 9. Monitoring and logging">Monitoring and logging</a> for more information on configuring this feature.
						</li><li class="listitem">
							In the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Network Selection</span></strong></span> section, select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">New network</span></strong></span>. The Networking section provides defaults for all of the network ranges used in the deployment. If you want to modify these values, see <a class="link" href="#ref-gcp-networking-options" title="5.1. Networking options">Networking Options</a>.
						</li><li class="listitem">
							Optional: In the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Additional Labels</span></strong></span> section, provide any additional label key and value pairs to be added to the GCP resources that are part of the deployment. Valid keys and values must meet GCP label requirements. For a <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">key</span></strong></span>, only hyphens, underscores, lowercase characters and numbers are permitted. A <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">key</span></strong></span> must start with a lowercase character. For a <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">value</span></strong></span>, only hyphens, underscores, lowercase characters and numbers are permitted.
						</li><li class="listitem">
							Click <span class="guibutton">DEPLOY</span>.
						</li><li class="listitem">
							The Deployment Manager displays the running deployment.
						</li><li class="listitem">
							The application begins provisioning. It can take some time for the infrastructure and application to fully provision.
						</li></ol></div><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
						You will see a warning on the deployment
					</p><pre class="screen Role ARG Spec Role ARG Spec">This deployment has resources from the Runtime Configurator service, which is in Beta</pre><p class="Role ARG Spec Role ARG Spec">
						This warning is expected and is not a cause for concern.
					</p></div></div><p class="Role ARG Spec Role ARG Spec">
					If you want to modify your network ranges post deployment, your current deployment must be deleted, then follow the instructions in <a class="link" href="#proc-gcp-deploy-with-existing-vpc" title="2.3.2. Deploying an application with an existing VPC">Deploying an application with an existing VPC</a>.
				</p></section><section class="section Role ARG Spec" id="proc-gcp-deploy-with-existing-vpc"><div class="titlepage"><div><div><h3 class="title">2.3.2. Deploying an application with an existing VPC</h3></div></div></div><p class="Role ARG Spec Role ARG Spec">
					The following procedure uses an existing VPC network to deploy an application.
				</p><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem">
							In the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Deployment</span></strong></span> page, select the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Service Usage API</span></strong></span> link below the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Confirm Service Usage API is enabled</span></strong></span> checkbox.
						</li><li class="listitem">
							In the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">API/Service Details</span></strong></span> tab, ensure that the API is enabled, then return to the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Deployment</span></strong></span> page.
						</li><li class="listitem">
							Check the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Confirm Service Usage API</span></strong></span> is enabled checkbox.
						</li><li class="listitem">
							Select or create a <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Service Account</span></strong></span>. For further information, see <a class="link" href="#con-gcp-service-account" title="2.2.2. Create a service account">Your service account</a>.
						</li><li class="listitem">
							In the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Region</span></strong></span> field, select the region where you want the application deployed.
						</li><li class="listitem">
							In the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Zone</span></strong></span> field, select the zone where you want the Filestore deployed. The zone must be in the Region you selected.
						</li><li class="listitem">
							In the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Observability</span></strong></span> section, you can enable logging and metrics to be sent to Cloud Logging and Cloud Monitoring. See <a class="link mimir-link-warn" href="https://cloud.google.com/stackdriver/pricing" title="Mimir does not include content from: cloud.google.com">Operations Suite Pricing</a> for the financial cost of enabling these services. See <a class="link" href="#assembly-gcp-monitoring-logging" title="Chapter 9. Monitoring and logging">Monitoring and logging</a> for more information on configuring this feature.
						</li><li class="listitem">
							In the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Network Selection</span></strong></span> section, select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Existing network</span></strong></span>.
						</li><li class="listitem"><p class="simpara">
							In the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Existing Network</span></strong></span> section, provide your existing VPC network name, existing subnet name and existing proxy subnet name.
						</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
								The existing proxy subnet must be of type <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Regional Managed Proxy</span></strong></span>, which is the reserved proxy-only subnet for load balancing.
							</p></div></div><p class="Role ARG Spec Role ARG Spec">
							Select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">cloud NAT router</span></strong></span> to create a <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">NAT router</span></strong></span> in your VPC network.
						</p></li><li class="listitem">
							The <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Networking section</span></strong></span> provides defaults for all of the network ranges used in the deployment. Provide these values based on your existing network configuration. If you want to modify these values, see <a class="link" href="#ref-gcp-networking-options" title="5.1. Networking options">Networking Options</a>
						</li><li class="listitem">
							Optional: In the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Additional Labels</span></strong></span> section, provide any additional label key and value pairs to be added to the GCP resources that are part of the deployment. Valid keys and values must meet GCP label requirements. For a <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">key</span></strong></span>, only hyphens, underscores, lowercase characters and numbers are permitted. A <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">key</span></strong></span> must start with a lowercase character. For a <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">value</span></strong></span>, only hyphens, underscores, lowercase characters and numbers are permitted.
						</li><li class="listitem">
							Click <span class="guibutton">DEPLOY</span>.
						</li><li class="listitem">
							The <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Deployment Manager</span></strong></span> displays the running deployment.
						</li><li class="listitem"><p class="simpara">
							The application begins provisioning. It can take some time for the infrastructure and application to fully provision.
						</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
								You will see a warning on the deployment.
							</p><pre class="screen Role ARG Spec Role ARG Spec">This deployment has resources from the Runtime Configurator service, which is in Beta.</pre><p class="Role ARG Spec Role ARG Spec">
								This warning is expected and is not a cause for concern.
							</p></div></div></li></ol></div></section></section><section class="section Role ARG Spec" id="con-gcp-get-deployment-info"><div class="titlepage"><div><div><h2 class="title">2.4. Deployment information</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				After deploying Ansible Automation Platform, use the following procedures to retrieve information about your deployment.
			</p><section class="section Role ARG Spec" id="proc-gcp-retrieve-admin-password"><div class="titlepage"><div><div><h3 class="title">2.4.1. Retrieving the administration password</h3></div></div></div><p class="Role ARG Spec Role ARG Spec">
					Use the following procedure to retrieve the administration password.
				</p><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem">
							In the GCP UI, select the main menu.
						</li><li class="listitem">
							Select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Security</span></strong></span>. If you do not see <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Security</span></strong></span>, select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">View All Products</span></strong></span>.
						</li><li class="listitem">
							Select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Secret Manager</span></strong></span>.
						</li><li class="listitem">
							Filter with the name of the deployment. The secret name format is <code class="literal Role ARG Spec">&lt;DeploymentName&gt;-aap-admin</code>.
						</li><li class="listitem">
							Click on the secret name of the deployment
						</li><li class="listitem">
							Click the <span class="guibutton">More Actions</span> icon <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">⋮</span></strong></span> on the line of the deployment.
						</li><li class="listitem">
							Select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">View secret value</span></strong></span>. The administration password is displayed.
						</li></ol></div></section><section class="section Role ARG Spec" id="proc-gcp-retrieve-lb-addresses"><div class="titlepage"><div><div><h3 class="title">2.4.2. Retrieving the load balancer addresses</h3></div></div></div><p class="Role ARG Spec Role ARG Spec">
					Use the following procedure to retrieve the controller and hub IP address.
				</p><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem">
							In the GCP UI, select the main menu.
						</li><li class="listitem">
							Select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Deployment Manager</span></strong></span>.
						</li><li class="listitem">
							Select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Deployments</span></strong></span>.
						</li><li class="listitem">
							Select the deployment name.
						</li><li class="listitem">
							Select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">View Details</span></strong></span>.
						</li><li class="listitem">
							In the right pane, under <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Deployment properties</span></strong></span>, find the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Layout</span></strong></span> line.
						</li><li class="listitem">
							Select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">View</span></strong></span>. The <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Outputs:</span></strong></span> section shows the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">finalValue</span></strong></span> for the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">name</span></strong></span> controllerIp and hubIp.
						</li></ol></div></section></section><section class="section Role ARG Spec" id="con-gcp-setup-at-deployment-time"><div class="titlepage"><div><div><h2 class="title">2.5. Setting up monitoring and logging at deployment time</h2></div></div></div><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem">
						In the GCP UI, navigate to <span class="guimenu">Observability</span>.
					</li><li class="listitem"><p class="simpara">
						Check the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Connect Logging</span></strong></span> and <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Connect Metrics</span></strong></span> checkboxes.
					</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
							These checkboxes are only available in the foundation deployment.
						</p></div></div></li></ol></div></section><section class="section Role ARG Spec" id="proc-gcp-deploying-extension-nodes"><div class="titlepage"><div><div><h2 class="title">2.6. Deploying an extension node</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				You configure extension nodes after you have purchased and launched an extension from the public or private offer.
			</p><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem">
						In the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Deployment name</span></strong></span> field, enter a sufficiently short name as described in <a class="link" href="#con-gcp-application-deploy" title="2.3. Application deployment">Application deployment</a>.
					</li><li class="listitem">
						For the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Service Account</span></strong></span>, select the service account used with your Red Hat Ansible Automation Platform with up to 100 Managed Nodes deployment.
					</li><li class="listitem">
						In the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Region</span></strong></span> field, select the region where you want the application deployed.
					</li><li class="listitem">
						In the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Zone</span></strong></span> field, select a zone in the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Region</span></strong></span> you selected when deploying your foundational offer. This field is only used to filter the Network list.
					</li><li class="listitem"><p class="simpara">
						In the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Main Deployment Name</span></strong></span> field, enter the foundation deployment name for which you are deploying an extension.
					</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
							<span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Main Deployment Name</span></strong></span> is a required field.
						</p></div></div></li><li class="listitem">
						In the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Networking</span></strong></span> section, expand the default option.
					</li><li class="listitem">
						In the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Network</span></strong></span> field, select the existing foundation network ending with <code class="literal Role ARG Spec">-aap-net</code>.
					</li><li class="listitem"><p class="simpara">
						In the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Subnetwork</span></strong></span> field, select the existing foundation subnetwork ending with <code class="literal Role ARG Spec">-aap-subnet</code>.
					</p><div class="admonition important Role ARG Spec"><div class="admonition_header">Important</div><div><p class="Role ARG Spec Role ARG Spec">
							Do not select the subnet ending with <code class="literal Role ARG Spec">-aap-proxy-subnet</code>.
						</p></div></div><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
							In case of an error stating <code class="literal Role ARG Spec">Make sure all fields are correct to continue</code> and <code class="literal Role ARG Spec">You must select a Network</code>. Reselect the values from the menu and click <span class="guibutton">Done</span>.
						</p></div></div></li><li class="listitem">
						Ensure <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Extend Ansible Automation Platform deployment in selected VPC</span></strong></span> is checked.
					</li><li class="listitem">
						Click <span class="guibutton">DEPLOY</span>.
					</li><li class="listitem">
						The Deployment Manager displays the running deployment.
					</li></ol></div><p class="Role ARG Spec Role ARG Spec">
				The extension begins provisioning.
			</p><p class="Role ARG Spec Role ARG Spec">
				It can take some time for the infrastructure and extension to fully provision.
			</p></section></section><section class="chapter Role ARG Spec" id="assembly-gcp-deploying-extension-nodes"><div class="titlepage"><div><div><h1 class="title">Chapter 3. Deploying extension nodes</h1></div></div></div><p class="Role ARG Spec Role ARG Spec">
			The foundation deployment is deployed with two automation controller nodes and one automation hub node by default. You can add execution nodes to scale out Ansible Automation Platform from GCP Marketplace. Extension node offers can be mixed and matched together to scale up and out the Ansible Automation Platform deployment.
		</p><p class="Role ARG Spec Role ARG Spec">
			You must create a backup of the Ansible Automation Platform deployment before deploying new extension nodes.
		</p><p class="Role ARG Spec Role ARG Spec">
			The procedure contains the following steps:
		</p><div class="orderedlist Role ARG Spec"><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem">
					Decide the offer type for the extension nodes.
				</li><li class="listitem">
					Ensure the minimum permissions are met to manage extension nodes.
				</li><li class="listitem">
					Pull the <code class="literal Role ARG Spec">ansible-on-clouds-ops</code> container image.
				</li><li class="listitem">
					Generate data files by running the <code class="literal Role ARG Spec">ansible-on-clouds-ops</code> container.
				</li><li class="listitem">
					Populate the data file.
				</li><li class="listitem">
					Run the <code class="literal Role ARG Spec">ansible-on-clouds-ops</code> container to deploy extension nodes.
				</li></ol></div><div class="itemizedlist Role ARG Spec"><p class="title"><strong>Prerequisite</strong></p><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
					A Linux or macOS system (where the ansible-on-clouds-ops container image will run).
				</li><li class="listitem">
					Docker
				</li></ul></div><section class="section Role ARG Spec" id="ref-gcp-decide-offer-type"><div class="titlepage"><div><div><h2 class="title">3.1. Deciding the offer type</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				The following table lists the offer types and the corresponding GCP instance types. Depending on the workload needs, you can choose a more suitable offer type for the extension nodes.
			</p><div class="informaltable"><table class="lt-4-cols lt-7-rows Role ARG Spec"><colgroup><col style="width: 50%; " class="col_1"><!--Empty--></col><col style="width: 50%; " class="col_2"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139690691945328" scope="col">Offer Type (nodes)</th><th align="left" valign="top" id="idm139690691944240" scope="col">GCP Instance Type</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139690691945328"> <p>
								100
							</p>
							 </td><td align="left" valign="top" headers="idm139690691944240"> <p>
								n2-standard-2
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139690691945328"> <p>
								200
							</p>
							 </td><td align="left" valign="top" headers="idm139690691944240"> <p>
								n2-standard-4
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139690691945328"> <p>
								400
							</p>
							 </td><td align="left" valign="top" headers="idm139690691944240"> <p>
								n2-standard-8
							</p>
							 </td></tr></tbody></table></div><p class="Role ARG Spec Role ARG Spec">
				Extension node offers can be mixed and matched together to scale the Ansible Automation Platform deployment up.
			</p></section><section class="section Role ARG Spec" id="ref-gcp-permissions-to-manage-nodes_gcp-extension-nodes"><div class="titlepage"><div><div><h2 class="title">3.2. IAM minimum permissions</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				Your GCP account must have the following <span class="emphasis"><em><span class="Role ARG Spec Role ARG Spec">Identity and Access Management</span></em></span> (IAM) permissions to successfully create and manage extension nodes on Ansible Automation Platform.
			</p><p class="Role ARG Spec Role ARG Spec">
				Your GCP account must also be licensed to deploy extension node offers for Ansible Automation Platform from GCP Marketplace.
			</p><pre class="literallayout Role ARG Spec">Minimum Permissions -

Cloud SQL Client
Cloud SQL Instance User
Editor
Logs Writer
Secret Manager Secret Accessor
IAP-secured Tunnel User</pre></section><section class="section Role ARG Spec" id="con-gcp-pull-deploy-container-image"><div class="titlepage"><div><div><h2 class="title">3.3. Pulling the ansible-on-clouds-ops container image</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				Pull the Docker image for the Ansible on Clouds operational container with the same tag as the version you are deploying to. If you are unsure of the version you have deployed, see <a class="link" href="#ref-aap-using-playbooks" title="7.6. Using the playbooks">Command Generator</a> and playbook <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">gcp_get_aoc_version</span></strong></span> for more information on finding the current version of Ansible on Clouds deployment.
			</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
					Before pulling the docker image, make sure you are logged in to registry.redhat.io using docker. Use the following command to login to registry.redhat.io.
				</p><pre class="literallayout Role ARG Spec">$ docker login registry.redhat.io</pre><p class="Role ARG Spec Role ARG Spec">
					For more information about registry login, read <a class="link mimir-link-warn" href="https://access.redhat.com/RegistryAuthentication" title="This content is not included in Mimir.">Registry Authentication</a>
				</p></div></div><p class="Role ARG Spec Role ARG Spec">
				For example, if your foundation deployment version is 2.4.20240215-00, you must pull the operational image with tag 2.4.20240215 to deploy extension nodes to the foundation deployment.
			</p><p class="Role ARG Spec Role ARG Spec">
				Use the following commands:
			</p><pre class="literallayout Role ARG Spec">$ export IMAGE=registry.redhat.io/ansible-on-clouds/ansible-on-clouds-ops-rhel9:2.4.20240215
$ docker pull $IMAGE --platform=linux/amd64</pre><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
					If your foundation deployment version is not 2.4.20240215-00, refer to the tables on the <a class="link" href="/documentation/en-us/ansible_on_clouds/2.x/html-single/red_hat_ansible_automation_platform_from_gcp_release_notes/index/#assembly-gcp-release-notes-24">Released versions</a> page for a matching deployment version, in the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Ansible on Clouds version</span></strong></span> column. Find the corresponding operational image to use, in the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Ansible-on-clouds-ops container image</span></strong></span> column, for the IMAGE environment variable.
				</p></div></div></section><section class="section Role ARG Spec" id="proc-gcp-generate-add-data-files"><div class="titlepage"><div><div><h2 class="title">3.4. Generating data files by running the ansible-on-clouds-ops container</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				The following commands generate the required data file. These commands create a directory, and an empty data template that, when populated, is used during the deployment of the extension nodes.
			</p><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem"><p class="simpara">
						Create a folder to hold the configuration files.
					</p><pre class="literallayout Role ARG Spec">$ mkdir command_generator_data</pre></li><li class="listitem"><p class="simpara">
						Populate the <code class="literal Role ARG Spec">command_generator_data</code> folder with the configuration file template.
					</p><pre class="literallayout Role ARG Spec">$ docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE \
command_generator_vars gcp_add_extension_nodes \
--output-data-file /data/extra_vars.yml</pre></li><li class="listitem"><p class="simpara">
						These commands create a <code class="literal Role ARG Spec">command_generator_data/extra_vars.yml</code> template file. This template file resembles the following:
					</p><pre class="literallayout Role ARG Spec">gcp_add_extension_nodes:
  cloud_credentials_path:
  deployment_name:
  extra_vars:
    gcp_compute_region:
    gcp_extension_node_subscription:
    gcp_instance_group_name:
    gcp_instance_template_name:
    gcp_offer_type:</pre></li></ol></div></section><section class="section Role ARG Spec" id="proc-aws-update-data-file"><div class="titlepage"><div><div><h2 class="title">3.5. Populate the data file</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				You must populate the data file before triggering the operation. The variables listed in the data file are defined below.
			</p><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
						<code class="literal Role ARG Spec">cloud_credentials_path</code> is the path for your Google Cloud service account credentials file. This must be an absolute path.
					</li><li class="listitem">
						<code class="literal Role ARG Spec">deployment_name</code> is the name of the AAP deployment manager deployment for which you want to create an extension node.
					</li><li class="listitem">
						<code class="literal Role ARG Spec">gcp_instance_group_name</code> is the name of the GCP instance group to create for the extension nodes.
					</li><li class="listitem">
						<code class="literal Role ARG Spec">gcp_instance_template_name</code> is the name of the GCP instance template to create.
					</li><li class="listitem">
						<code class="literal Role ARG Spec">gcp_offer_type</code> is the offer type of the extension node. This must be 100, 200 or 400.
					</li><li class="listitem">
						<code class="literal Role ARG Spec">gcp_compute_region</code> is the GCP region where the foundation deployment is deployed. This can be retrieved by checking the Deployments configuration in <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Deployment Manager</span></strong></span>.
					</li><li class="listitem">
						<code class="literal Role ARG Spec">gcp_extension_node_subscription</code> is the flag to confirm whether extension node subscription is purchased. Must be <code class="literal Role ARG Spec">true</code> or <code class="literal Role ARG Spec">false</code>.
					</li></ul></div></section><section class="section Role ARG Spec" id="proc-gcp-deploying-add-extension-nodes"><div class="titlepage"><div><div><h2 class="title">3.6. Deploying the extension node</h2></div></div></div><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem"><p class="simpara">
						To deploy the extension nodes, run the command generator to generate the CLI command.
					</p><pre class="literallayout Role ARG Spec">$ docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE command_generator --data-file /data/extra_vars.yml</pre><p class="Role ARG Spec Role ARG Spec">
						Provides the following command:
					</p><pre class="literallayout Role ARG Spec">-----------------------------------------------
Command to run playbook:

docker run --rm --env PLATFORM=GCP -v &lt;/path/to/gcp/service-account.json&gt;:/home/runner/.gcp/credentials:ro /
--env ANSIBLE_CONFIG=../gcp-ansible.cfg --env DEPLOYMENT_NAME=&lt;deployment_name&gt; /
--env GENERATE_INVENTORY=true  $IMAGE redhat.ansible_on_clouds.gcp_add_extension_nodes /
-e 'gcp_deployment_name=&lt;deployment_name&gt; gcp_service_account_credentials_json_path=/home/runner/.gcp/credentials  gcp_compute_region=&lt;region&gt; gcp_instance_template_name=&lt;instance_template_name&gt; /
gcp_instance_group_name=&lt;instance_group_name&gt; gcp_offer_type=100 gcp_extension_node_subscription=True'
===============================================</pre></li><li class="listitem"><p class="simpara">
						Run the supplied command to add the extension nodes.
					</p><pre class="literallayout Role ARG Spec">$ docker run --rm --env PLATFORM=GCP -v &lt;/path/to/gcp/service-account.json&gt;:/home/runner/.gcp/credentials:ro /
--env ANSIBLE_CONFIG=../gcp-ansible.cfg --env DEPLOYMENT_NAME=leena1 /
--env GENERATE_INVENTORY=true  $IMAGE redhat.ansible_on_clouds.gcp_add_extension_nodes /
-e 'gcp_deployment_name=&lt;deployment_name&gt; gcp_service_account_credentials_json_path=/home/runner/.gcp/credentials  gcp_compute_region=&lt;region&gt; gcp_instance_template_name=&lt;instance_template_name&gt; /
gcp_instance_group_name=&lt;instance_group_name&gt; gcp_offer_type=100 gcp_extension_node_subscription=True'</pre></li><li class="listitem"><p class="simpara">
						When the playbook has finished running, the output resembles the following:
					</p><pre class="literallayout Role ARG Spec">TASK [redhat.ansible_on_clouds.standalone_gcp_add_extension_nodes : [deploy_extension_nodes] Extension node created] ***
ok: [localhost] =&gt; {
    "msg": "Extension node is created for deployment test-ext1."
}

PLAY RECAP *********************************************************************
localhost                  : ok=39   changed=5    unreachable=0    failed=0    skipped=6    rescued=0    ignored=0</pre></li></ol></div></section></section><section class="chapter Role ARG Spec" id="assembly-gcp-removing-extension-nodes"><div class="titlepage"><div><div><h1 class="title">Chapter 4. Removing extension nodes</h1></div></div></div><p class="Role ARG Spec Role ARG Spec">
			You must create a backup of the Ansible Automation Platform deployment before removing extension nodes.
		</p><p class="Role ARG Spec Role ARG Spec">
			Follow these steps to remove execution nodes from your Ansible Automation Platform from GCP Marketplace environment.
		</p><div class="itemizedlist Role ARG Spec"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
					Linux or macOS system (where the <code class="literal Role ARG Spec">ansible-on-clouds-ops</code> container image will run)
				</li><li class="listitem">
					Docker
				</li></ul></div><div class="orderedlist Role ARG Spec"><p class="title"><strong>Steps</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem">
					Pull the <code class="literal Role ARG Spec">ansible-on-clouds-ops</code> container image.
				</li><li class="listitem">
					Generate data files by running the ansible-on-clouds-ops container.
				</li><li class="listitem">
					Update the data file.
				</li><li class="listitem">
					Run the <code class="literal Role ARG Spec">ansible-on-clouds-ops</code> container to remove the extension nodes.
				</li></ol></div><section class="section Role ARG Spec" id="con-gcp-pull-remove-container-image"><div class="titlepage"><div><div><h2 class="title">4.1. Pulling the ansible-on-clouds-ops container image</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				Pull the Docker image for the Ansible on Clouds operational container with the same tag as your foundation deployment. If you are unsure of the version you have deployed, see <a class="link" href="#ref-aap-using-playbooks" title="7.6. Using the playbooks">Command Generator</a> and playbook <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">gcp_get_aoc_version</span></strong></span> for more information on finding the current version of Ansible on Clouds deployment.
			</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
					Before pulling the docker image, make sure you are logged in to registry.redhat.io using docker. Use the following command to login to registry.redhat.io.
				</p><pre class="literallayout Role ARG Spec">$ docker login registry.redhat.io</pre><p class="Role ARG Spec Role ARG Spec">
					For more information about registry login, read <a class="link mimir-link-warn" href="https://access.redhat.com/RegistryAuthentication" title="This content is not included in Mimir.">Registry Authentication</a>
				</p></div></div><p class="Role ARG Spec Role ARG Spec">
				For example, if your foundation deployment version is 2.4.20240215-00, you must pull the operational image with tag 2.4.20240215 to deploy extension nodes to the foundation deployment.
			</p><p class="Role ARG Spec Role ARG Spec">
				Use the following commands:
			</p><pre class="literallayout Role ARG Spec">$ export IMAGE=registry.redhat.io/ansible-on-clouds/ansible-on-clouds-ops-rhel9:2.4.20240215
$ docker pull $IMAGE --platform=linux/amd64</pre><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
					If your foundation deployment version is not 2.4.20240215-00, refer to the tables on the <a class="link" href="/documentation/en-us/ansible_on_clouds/2.x/html-single/red_hat_ansible_automation_platform_from_gcp_release_notes/index/#assembly-gcp-release-notes-24">Released versions</a> page for a matching deployment version, in the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Ansible on Clouds version</span></strong></span> column. Find the corresponding operational image to use, in the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Ansible-on-clouds-ops container image</span></strong></span> column, for the IMAGE environment variable.
				</p></div></div></section><section class="section Role ARG Spec" id="proc-gcp-generate-remove-data-files"><div class="titlepage"><div><div><h2 class="title">4.2. Generating data files by running the ansible-on-clouds-ops container</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				The following commands generate the required data file. These commands create a directory, and an empty data template that, when populated, is used during the upgrade.
			</p><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem"><p class="simpara">
						Create a folder to hold the configuration files.
					</p><pre class="screen Role ARG Spec Role ARG Spec">$ mkdir command_generator_data</pre></li><li class="listitem"><p class="simpara">
						Populate the <code class="literal Role ARG Spec">$(pwd)/command_generator_data</code> folder with the configuration file template.
					</p><pre class="screen Role ARG Spec Role ARG Spec">$ docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE \
command_generator_vars gcp_remove_extension_nodes \
--output-data-file /data/extra_vars.yml</pre></li></ol></div><p class="Role ARG Spec Role ARG Spec">
				When you have run these commands, a <code class="literal Role ARG Spec">command_generator_data/extra_vars.yml</code> template file is created. This template file resembles the following:
			</p><pre class="screen Role ARG Spec Role ARG Spec">gcp_add_extension_nodes:
  cloud_credentials_path:
  deployment_name:
  extra_vars:
    gcp_compute_region:
    gcp_instance_group_name:
    gcp_instance_template_name:</pre></section><section class="section Role ARG Spec" id="proc-gcp-update-remove-data-file"><div class="titlepage"><div><div><h2 class="title">4.3. Populate the data file</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				You must populate the data file before triggering the operation. The variables listed in the data file are defined below.
			</p><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
						<code class="literal Role ARG Spec">cloud_credentials_path</code> is the path for your Google Cloud service account credentials file. This must be an absolute path.
					</li><li class="listitem">
						<code class="literal Role ARG Spec">deployment_name</code> is the name of the deployment for which you want to create an extension node.
					</li><li class="listitem">
						<code class="literal Role ARG Spec">gcp_instance_group_name</code> is the name of the GCP instance group to create for the extension nodes.
					</li><li class="listitem">
						<code class="literal Role ARG Spec">gcp_instance_template_name</code> is the name of the GCP instance template to create.
					</li><li class="listitem">
						<code class="literal Role ARG Spec">gcp_compute_region</code> is the GCP region where the foundation deployment is deployed. This can be retrieved by checking the Deployments config in Deployment Manager.
					</li></ul></div></section><section class="section Role ARG Spec" id="proc-gcp-removing-extension-nodes"><div class="titlepage"><div><div><h2 class="title">4.4. Running the ansible-on-clouds-ops container to remove the extension nodes</h2></div></div></div><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem"><p class="simpara">
						To remove a set of extension nodes, run the command generator to generate the CLI command.
					</p><pre class="literallayout Role ARG Spec">$ docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE command_generator --data-file /data/extra_vars.yml</pre><p class="Role ARG Spec Role ARG Spec">
						The command generator output provides the following command:
					</p><pre class="literallayout Role ARG Spec">d-----------------------------------------------
Command to run playbook:

docker run --rm --env PLATFORM=GCP -v &lt;/path/to/gcp/service-account.json&gt;:/home/runner/.gcp/credentials:ro \
--env ANSIBLE_CONFIG=../gcp-ansible.cfg --env DEPLOYMENT_NAME=&lt;deployment_name&gt; \
--env GENERATE_INVENTORY=true $IMAGE redhat.ansible_on_clouds.gcp_remove_extension_nodes \
-e 'gcp_deployment_name=&lt;deployment_name&gt; gcp_service_account_credentials_json_path=/home/runner/.gcp/credentials  gcp_compute_region=&lt;region&gt; gcp_instance_template_name=&lt;instance_template_name&gt; \
gcp_instance_group_name=&lt;instance_group_name&gt;'
===============================================</pre></li><li class="listitem"><p class="simpara">
						Run the supplied command to remove a set of extension nodes.
					</p><pre class="literallayout Role ARG Spec">$ docker run --rm --env PLATFORM=GCP -v &lt;/path/to/gcp/service-account.json&gt;:/home/runner/.gcp/credentials:ro \
--env ANSIBLE_CONFIG=../gcp-ansible.cfg --env DEPLOYMENT_NAME=&lt;deployment_name&gt; \
--env GENERATE_INVENTORY=true  $IMAGE redhat.ansible_on_clouds.gcp_remove_extension_nodes \
-e 'gcp_deployment_name=&lt;deployment_name&gt; gcp_service_account_credentials_json_path=/home/runner/.gcp/credentials  gcp_compute_region=&lt;region&gt; gcp_instance_template_name=&lt;instance_template_name&gt; \
gcp_instance_group_name=&lt;instance_group_name&gt;'</pre></li></ol></div><p class="Role ARG Spec Role ARG Spec">
				If there are no errors, the extension node is removed successfully.
			</p></section></section><section class="chapter Role ARG Spec" id="assembly-gcp-networking-access"><div class="titlepage"><div><div><h1 class="title">Chapter 5. Networking and application access</h1></div></div></div><p class="Role ARG Spec Role ARG Spec">
			When Ansible Automation Platform from GCP Marketplace is deployed, it is installed into an isolated VPC and cannot be accessed. The following instructions describe how to connect the VPC used by Ansible Automation Platform from GCP Marketplace to your existing GCP network. When connected, you must determine how your users connect to Ansible Automation Platform.
		</p><p class="Role ARG Spec Role ARG Spec">
			There are many ways to enable this connectivity such as VPNs, Google Cloud Interconnect, or bastion servers for private network access. You can also expose the platform with public internet access using GCP services such as a Load Balancer.
		</p><p class="Role ARG Spec Role ARG Spec">
			How your organization configures application access on GCP is outside the scope of Red Hat’s guidelines and support for Ansible Automation Platform from GCP Marketplace. For further information, see <a class="link mimir-link-warn" href="https://cloud.google.com/solutions/connecting-securely#external" title="Mimir does not include content from: cloud.google.com">Securely connecting to VMs</a> for guidelines on these topics.
		</p><section class="section Role ARG Spec" id="ref-gcp-networking-options"><div class="titlepage"><div><div><h2 class="title">5.1. Networking options</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				The network topology of Ansible Automation Platform from GCP Marketplace includes several configurable network segments that can be changed to fit into your organization’s network requirements.
			</p><p class="Role ARG Spec Role ARG Spec">
				The deployment creates a new VPC and subnet that are not accessible from the public internet, or by using an existing VPC network. You must provide access to the application as described in <a class="link" href="#assembly-gcp-networking-access" title="Chapter 5. Networking and application access">Networking and Application Access</a>.
			</p><p class="Role ARG Spec Role ARG Spec">
				Consider your existing network configurations when specifying the following network ranges below. Ensure that each range does not overlap with any other specified here, and does not overlap with existing ranges in your network. Each range should exist within a private network class.
			</p><div class="Role ARG Spec Role ARG Spec"><p class="title"><strong><span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Application Subnet Range</span></strong></span></strong></p><p>
					The network CIDR defining the subnet range used by the custom VPC deployed by the offering. Must be a minimum <code class="literal Role ARG Spec">/24</code> segment and must be in the private network range (192.168 or 10.0).
				</p></div><p class="Role ARG Spec Role ARG Spec">
				Default: 192.168.240.0/24
			</p><div class="Role ARG Spec Role ARG Spec"><p class="title"><strong><span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Cloud SQL Peering Network Range</span></strong></span></strong></p><p>
					The network CIDR defines the network segment used to peer the GCP CloudSQL network with the application subnet deployed by the offering. Must be a <code class="literal Role ARG Spec">/24</code> segment. The <code class="literal Role ARG Spec">/24</code> segment range is a requirement of GCP CloudSQL network peering configuration.
				</p></div><p class="Role ARG Spec Role ARG Spec">
				Default: 192.168.241.0/24
			</p><div class="Role ARG Spec Role ARG Spec"><p class="title"><strong><span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Filestore Peering Network Range</span></strong></span></strong></p><p>
					Ansible Automation Platform from GCP Marketplace uses GCP Filestore service to share configuration files between multiple automation controller and automation hub VMs provisioned as part of the deployment. This network CIDR range defines the peer network that is used by the offering to peer between the GCP Filestore network and the custom VPC application subnet of the offering. Must be a minimum <code class="literal Role ARG Spec">/29</code> segment.
				</p></div><p class="Role ARG Spec Role ARG Spec">
				Default: 192.168.243.0/29
			</p><div class="Role ARG Spec Role ARG Spec"><p class="title"><strong><span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Load Balancer Proxy Subnet Range</span></strong></span></strong></p><p>
					Ansible Automation Platform from GCP Marketplace is deployed using GCP’s native cloud capabilities to provide a scalable and reliable installation. As part of the Ansible Automation Platform from GCP Marketplace deployment topology two load balancers are deployed in front of the automation hub and automation controller VMs. All traffic is directed at these load balancers and is proxied to the available backend VMs. The deployment takes advantage of GCP’s native load balancing support enabling the customer to add additional ports (https) to the load balancers to capture and forward requests onto the backend VMs. This also provides request balancing and session tracking for better reliability. As part of the load balancer deployment, GCP requires creation of a special proxy network where GCP natively handles the redirection of requests to the backend VMs. This special proxy network is not used within Ansible Automation Platform from GCP Marketplace for any other purpose than GCP’s load balancer’s proxy network requirement. A <code class="literal Role ARG Spec">/24</code> segment is required.
				</p></div><p class="Role ARG Spec Role ARG Spec">
				Default: 192.168.242.0/24
			</p><div class="Role ARG Spec Role ARG Spec"><p class="title"><strong><span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Controller Internal Load Balancer IP Address</span></strong></span></strong></p><p>
					This is the static IP Address assigned to the automation controller Load Balancer. This address must be within the Application Subnet Range segment.
				</p></div><p class="Role ARG Spec Role ARG Spec">
				Default: 192.168.240.20
			</p><div class="Role ARG Spec Role ARG Spec"><p class="title"><strong><span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Hub Internal Load Balancer IP Address</span></strong></span></strong></p><p>
					This is the static IP Address assigned to the automation hub Load Balancer. This address must be within the Application Subnet Range segment.
				</p></div><p class="Role ARG Spec Role ARG Spec">
				Default: 192.168.240.21
			</p></section><section class="section Role ARG Spec" id="con-gcp-network-peering-options"><div class="titlepage"><div><div><h2 class="title">5.2. Network peering options</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				Many networking configurations to access the platform are possible, but the following configurations have been validated to work with Ansible Automation Platform from GCP Marketplace.
			</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
					While every effort has been made to align with Google Cloud Platform’s documentation for this content, there may be a drift in accuracy over time. Use <a class="link mimir-link-warn" href="https://cloud.google.com/vpc/docs/vpc-peering" title="Mimir does not include content from: cloud.google.com">GCP documentation</a> as the source of information regarding networking topics for GCP.
				</p></div></div></section><section class="section Role ARG Spec" id="proc-gcp-vpc-peering"><div class="titlepage"><div><div><h2 class="title">5.3. VPC peering</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				<a class="link mimir-link-warn" href="https://cloud.google.com/vpc/docs/vpc-peering" title="Mimir does not include content from: cloud.google.com">VPC Peering</a> is required for Ansible Automation Platform to access resources that reside on private VPCs or where transit routing between Google Cloud Platform and your on-premises network(s) exists. It offers the ability to directly connect different networks within your GCP infrastructure. VPCs are individually connected to one another with no other routing hops between them. VPC deployments omit access from the public internet by default.
			</p><p class="Role ARG Spec Role ARG Spec">
				This is also the deployment model for the GCP architecture used by Ansible Automation Platform from GCP Marketplace.
			</p><p class="Role ARG Spec Role ARG Spec">
				This is a simple peering model and is useful when connecting several networks.
			</p><p class="Role ARG Spec Role ARG Spec">
				Complex peering can be configured, but routing can become more complex over time.
			</p><p class="Role ARG Spec Role ARG Spec">
				When VPC peering and routing are configured, you can access Ansible Automation Platform through a VM on a connected VPC subnet, or directly if your organization has a transit routing setup between GCP and your local networks.
			</p><p class="Role ARG Spec Role ARG Spec">
				When two or more networks are peered, <a class="link mimir-link-warn" href="https://cloud.google.com/vpc/docs/vpc-peering#key_properties" title="Mimir does not include content from: cloud.google.com">Google performs automated actions</a> to assist with routing, but can perform routable updates to enable traffic flow within your GCP infrastructure.
			</p><div class="Role ARG Spec Role ARG Spec"><p class="title"><strong>Prerequisites</strong></p><p>
					Before using VPC peering to connect any VPC, you must ensure that there is no network address space overlap between the networks that you intend to route traffic between your VPCs and Ansible Automation Platform from GCP Marketplace’s VPC address space. The GCP Portal should prevent peering if this is attempted.
				</p></div><p class="Role ARG Spec Role ARG Spec">
				Configure VPC peering with Ansible Automation Platform with the following procedure.
			</p><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem">
						In the GCP Portal, navigate to <span class="guimenu">VPC Network</span>.
					</li><li class="listitem">
						In the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">VPC menu</span></strong></span>, select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">VPC Network Peering</span></strong></span>.
					</li><li class="listitem">
						Click <span class="guibutton">Create peering connection</span>.
					</li><li class="listitem">
						Click <span class="guibutton">CONTINUE</span>.
					</li><li class="listitem">
						In the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Name</span></strong></span> field, enter the name of the peering connection that you need.
					</li><li class="listitem">
						In the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Your VPC Network</span></strong></span> field, select the first VPC that you plan to peer.
					</li><li class="listitem"><p class="simpara">
						In the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Peered VPC Network</span></strong></span> field, select the second VPC to peer. This must be the Ansible Automation Platform from GCP Marketplace VPC.
					</p><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
								Subnet routes between these two networks are created by default. Therefore, access to Ansible Automation Platform can occur from VMs that reside on the peered VPC. However, if you have more complex routing, such as a hub-and-spoke network model, then other routes must be created.
							</li><li class="listitem">
								Select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Exchange custom routes</span></strong></span> and <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Exchange subnet routes with public IP</span></strong></span> carefully. Google provides explanations what each fields does. Your selection affects how traffic flows through your VPCs. Normally, these checkboxes configure routing between the newly peered networks and other networks through the route table exchange and enable network traffic to traverse multiple networks (transit routing).
							</li></ul></div></li><li class="listitem">
						Click <span class="guibutton">Create</span>.
					</li></ol></div><p class="Role ARG Spec Role ARG Spec">
				For additional information on routing tables, firewalls and other networking components regarding VPC Peering, see the <a class="link mimir-link-warn" href="https://cloud.google.com/vpc/docs" title="Mimir does not include content from: cloud.google.com">GCP documentation</a>.
			</p></section><section class="section Role ARG Spec" id="proc-gcp-external-load-balancer"><div class="titlepage"><div><div><h2 class="title">5.4. Using an external load balancer</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				It is possible to expose Ansible automation controller and Ansible private automation hub to the public internet if you want users to have access to the platform from any internet connected machine.
			</p><p class="Role ARG Spec Role ARG Spec">
				This is not recommended as a best practice for security reasons.
			</p><p class="Role ARG Spec Role ARG Spec">
				However this implementation can be secured with different GCP tools. This section describes how to connect a load balancer that faces the public internet, but it does not include steps to harden access through Google’s security products. Only use this approach if you intend to protect the public endpoints with <a class="link mimir-link-warn" href="https://cloud.google.com/armor/" title="Mimir does not include content from: cloud.google.com">Google Cloud Armor</a> or similar product(s).
			</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
					Ansible Automation Platform from GCP Marketplace is deployed with two <span class="emphasis"><em><span class="Role ARG Spec Role ARG Spec">internal</span></em></span> application load balancers. These load balancers direct traffic within local VPCs and must remain part of the deployment even if you configure public load balancers.
				</p></div></div><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem">
						Select the main menu from the top left.
					</li><li class="listitem">
						Select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Network Services</span></strong></span>. If you do not see <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Network Services</span></strong></span>, then select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">View All Products</span></strong></span>.
					</li><li class="listitem">
						Select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Load Balancing</span></strong></span>.
					</li><li class="listitem">
						In the top menu, select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">CREATE LOAD BALANCER</span></strong></span>.
					</li><li class="listitem">
						Select the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Application Load Balancer (HTTP/S)</span></strong></span> tile and click <span class="guibutton">START CONFIGURATION</span>.
					</li><li class="listitem">
						Select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">From Internet to my VMs or serverless services</span></strong></span> and <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Global external Application Load Balancer</span></strong></span>.
					</li><li class="listitem">
						Click <span class="guibutton">CONTINUE</span>.
					</li><li class="listitem">
						Give your load balancer a name, for example, <code class="literal Role ARG Spec">&lt;DeploymentName&gt;-aap-&lt;cntrlr/hub&gt;-ext-lb</code>
					</li><li class="listitem">
						Ensure that <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Frontend</span></strong></span> configuration is selected at the left of the screen.
					</li><li class="listitem"><p class="simpara">
						On the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Frontend</span></strong></span> configuration page, complete the following fields:
					</p><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
								<span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Protocol</span></strong></span>: HTTPS.
							</li><li class="listitem">
								<span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Port</span></strong></span>: 443.
							</li><li class="listitem">
								<span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">IP Address</span></strong></span>: Select an existing IP address or create a new one.
							</li><li class="listitem">
								<span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Certificate</span></strong></span>: You can use your own SSL Certificate or use a Google managed certificate.
							</li><li class="listitem"><p class="simpara">
								<span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">SSL Policy</span></strong></span>: GCP default, or another configured policy.
							</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
									For more information, see <a class="link mimir-link-warn" href="https://cloud.google.com/load-balancing/docs/ssl-certificates" title="Mimir does not include content from: cloud.google.com">SSL Certificates</a>
								</p></div></div></li></ul></div></li><li class="listitem">
						Click <span class="guibutton">DONE</span>.
					</li><li class="listitem">
						Select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Backend configuration</span></strong></span> from the menu on the left.
					</li><li class="listitem">
						Click the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Backend services &amp; backend buckets</span></strong></span> drop-down.
					</li><li class="listitem"><p class="simpara">
						Click <span class="guibutton">CREATE A BACKEND SERVICE</span>.
					</p><div class="orderedlist Role ARG Spec"><ol class="orderedlist Role ARG Spec" type="a"><li class="listitem">
								Give your backend service a name, for example, <code class="literal Role ARG Spec">&lt;DeploymentName&gt;-aap-&lt;cntrlr/hub&gt;-ext-lb-bknd-svc</code>
							</li><li class="listitem">
								Set <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Backend type</span></strong></span> to <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Instance group</span></strong></span>.
							</li><li class="listitem">
								Set <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Protocol</span></strong></span> to <code class="literal Role ARG Spec">HTTPS</code> and <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Named Port</span></strong></span> to <code class="literal Role ARG Spec">https</code>.
							</li><li class="listitem">
								Change <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Timeout</span></strong></span> to <code class="literal Role ARG Spec">86400</code>.
							</li><li class="listitem"><p class="simpara">
								Scroll down to the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Backends</span></strong></span> section and in the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">New backend</span></strong></span> field, select the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Instance group</span></strong></span> drop-down. Select the correct instance group.
							</p><p class="Role ARG Spec Role ARG Spec">
								For the automation controller load balancer, the correct instance group has the suffix <code class="literal Role ARG Spec">-aap-cntrlr-igm</code>.
							</p><p class="Role ARG Spec Role ARG Spec">
								For the automation hub load balancer, the correct instance group has the suffix <code class="literal Role ARG Spec">-aap-hub-igm</code>.
							</p></li><li class="listitem">
								In the resulting dialog box, select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">USE EXISTING PORT NAME</span></strong></span>.
							</li><li class="listitem">
								Set <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Balancing mode</span></strong></span> to <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Rate</span></strong></span>.
							</li><li class="listitem">
								Set <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Maximum RPS</span></strong></span> to 300.
							</li><li class="listitem">
								Scroll down until you see <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Cloud CDN</span></strong></span>. Unselect the checkbox for <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Cloud CDN</span></strong></span>.
							</li><li class="listitem">
								Scroll down until you see a text box showing <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Health check</span></strong></span>.
							</li><li class="listitem">
								Select the drop-down menu and click <span class="guibutton">CREATE A HEALTH CHECK</span>.
							</li><li class="listitem">
								Enter a name for your health check, for example, <code class="literal Role ARG Spec">&lt;DeploymentName&gt;-aap-&lt;cntrlr/hub&gt;-ext-lb-hc</code>
							</li><li class="listitem"><p class="simpara">
								For automation controller, use the following health check settings
							</p><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
										In the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Health Check</span></strong></span> dialog box, set <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Protocol</span></strong></span> to <code class="literal Role ARG Spec">HTTPS</code>, and <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Port</span></strong></span> to <code class="literal Role ARG Spec">8052</code>.
									</li><li class="listitem">
										Set <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Request</span></strong></span> to <code class="literal Role ARG Spec">/api/v2/ping/</code>.
									</li></ul></div></li><li class="listitem"><p class="simpara">
								For automation hub, use the following health check settings
							</p><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
										In the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Health Check</span></strong></span> dialog box, set <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Protocol</span></strong></span> to <code class="literal Role ARG Spec">HTTPS</code>, and <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Port</span></strong></span> to <code class="literal Role ARG Spec">8080</code>.
									</li><li class="listitem">
										Set <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Request</span></strong></span> to <code class="literal Role ARG Spec">/api/galaxy/pulp/api/v3/status/</code>.
									</li></ul></div></li><li class="listitem">
								Scroll down to <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Health criteria</span></strong></span> section.
							</li><li class="listitem">
								In the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Check interval</span></strong></span> field, enter the value 15.
							</li><li class="listitem">
								In the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Timeout</span></strong></span> field, enter the value 10.
							</li><li class="listitem">
								In the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Healthy threshold</span></strong></span> field, enter the value 2.
							</li><li class="listitem">
								In the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Unhealthy threshold</span></strong></span> field, enter the value 10.
							</li><li class="listitem"><p class="simpara">
								Click <span class="guibutton">SAVE</span>.
							</p><p class="Role ARG Spec Role ARG Spec">
								This returns you to the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Backend services &amp; backend buckets</span></strong></span> window.
							</p></li><li class="listitem"><p class="simpara">
								Click <span class="guibutton">CREATE</span>.
							</p><p class="Role ARG Spec Role ARG Spec">
								This returns you to <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Backend configuration</span></strong></span> section.
							</p></li><li class="listitem">
								Click <span class="guibutton">OK</span>.
							</li><li class="listitem">
								Click <span class="guibutton">CREATE</span> to create the load balancer for the automation controller or automation hub UI. This will take a few minutes to complete.
							</li></ol></div></li><li class="listitem">
						A load balancer has now been created.
					</li><li class="listitem">
						Configure the DNS record for the domain that you used in your SSL certificate to point to the IP address of the load balancer.
					</li></ol></div><p class="Role ARG Spec Role ARG Spec">
				At this point you should have accesss to the Ansible Automation Platform automation controller UI. You can log in after you retrieve the administration password.
			</p><p class="Role ARG Spec Role ARG Spec">
				Repeat the same process for private automation hub. The process is identical except for selecting the instance group <code class="literal Role ARG Spec">-aap-hub-igm</code> during backend configuration.
			</p></section></section><section class="chapter Role ARG Spec" id="assembly-gcp-additional-configs"><div class="titlepage"><div><div><h1 class="title">Chapter 6. Additional configurations</h1></div></div></div><p class="Role ARG Spec Role ARG Spec">
			The following chapter describes Ansible Automation Platform configuration steps that you can perform once your deployment is complete on GCP.
		</p><section class="section Role ARG Spec" id="proc-gcp-additional-configs-update-admin-password"><div class="titlepage"><div><div><h2 class="title">6.1. Changing the default administrator password</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				The default administrator password for Ansible Automation Platform is generated randomly when Ansible Automation Platform from GCP Marketplace is deployed. Follow these steps to change the administrator password for both automation controller and automation hub.
			</p><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem"><p class="simpara">
						Navigate to the GCP Secrets Manager Console.
					</p><div class="orderedlist Role ARG Spec"><ol class="orderedlist Role ARG Spec" type="a"><li class="listitem">
								Locate and open the secret for the Ansible Automation Platform deployment with the name <code class="literal Role ARG Spec"><span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">&lt;deployment_name&gt;</span></strong></span>-aap-admin</code>.
							</li><li class="listitem">
								Select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">NEW VERSION</span></strong></span> to add a new version.
							</li><li class="listitem">
								Enter a password secret value.
							</li><li class="listitem">
								Check <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Disable all past versions</span></strong></span> checkbox.
							</li><li class="listitem">
								Click <span class="guibutton">ADD NEW VERSION</span>.
							</li></ol></div></li><li class="listitem"><p class="simpara">
						Change the running Ansible Automation Platform VM instances to use the new administrator password.
					</p><div class="orderedlist Role ARG Spec"><ol class="orderedlist Role ARG Spec" type="a"><li class="listitem">
								Navigate to the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">GCP VM Instances</span></strong></span> console.
							</li><li class="listitem">
								Identify and delete one automation controller VM instance and one automation hub VM instance for the Ansible Automation Platform deployment.
							</li><li class="listitem">
								Wait for the automation controller and automation hub Instance groups to create new VM instances.
							</li></ol></div></li><li class="listitem">
						The new administrator password can be used when the new automation controller and automation hub VM instances reach a <span class="emphasis"><em><span class="Role ARG Spec Role ARG Spec">Running</span></em></span> Instance State.
					</li></ol></div></section><section class="section Role ARG Spec" id="proc-gcp-additional-configs-replace-tls-certificate"><div class="titlepage"><div><div><h2 class="title">6.2. Replacing automation controller and automation hub VM instances SSL/TLS certificate and key</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				By default, VM instances are secured with a self-signed SSL/TLS certificate with a validity period of ten years. When the certificate expires or you want VM instances to use your own certificate, you are required to replace the SSL/TLS certificate and key.
			</p><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem"><p class="simpara">
						Navigate to the GCP Secrets Manager Console.
					</p><div class="orderedlist Role ARG Spec"><ol class="orderedlist Role ARG Spec" type="a"><li class="listitem">
								Locate and open the secret for the Ansible Automation Platform deployment with the name <code class="literal Role ARG Spec"><span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">&lt;deployment_name&gt;</span></strong></span>-pulp_cert</code>.
							</li><li class="listitem">
								Select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">NEW VERSION</span></strong></span> to add a new version.
							</li><li class="listitem">
								Enter new SSL/TLS certificate value.
							</li><li class="listitem">
								Check <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Disable all past versions</span></strong></span> checkbox.
							</li><li class="listitem">
								Click <span class="guibutton">ADD NEW VERSION</span>.
							</li></ol></div></li><li class="listitem"><p class="simpara">
						Navigate to the GCP Secrets Manager Console.
					</p><div class="orderedlist Role ARG Spec"><ol class="orderedlist Role ARG Spec" type="a"><li class="listitem">
								Locate and open the secret for the Ansible Automation Platform deployment with the name <code class="literal Role ARG Spec"><span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">&lt;deployment_name&gt;</span></strong></span>-pulp_key</code>.
							</li><li class="listitem">
								Select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">NEW VERSION</span></strong></span> to add a new version.
							</li><li class="listitem">
								Enter new SSL/TLS key value.
							</li><li class="listitem">
								Check <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Disable all past versions</span></strong></span> checkbox.
							</li><li class="listitem">
								Click <span class="guibutton">ADD NEW VERSION</span>.
							</li></ol></div></li><li class="listitem"><p class="simpara">
						Change the running Ansible Automation Platform VM instances to use the new SSL/TLS certificate and key.
					</p><div class="orderedlist Role ARG Spec"><ol class="orderedlist Role ARG Spec" type="a"><li class="listitem">
								Navigate to the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">GCP VM Instances</span></strong></span> console.
							</li><li class="listitem">
								Identify and delete all automation controller and automation hub VM instances for the Ansible Automation Platform deployment.
							</li><li class="listitem">
								Wait for the automation controller and automation hub Instance groups to create new VM instances.
							</li></ol></div></li><li class="listitem">
						The new certificate is in use when the new automation controller and automation hub VM instances reach a <span class="emphasis"><em><span class="Role ARG Spec Role ARG Spec">Running</span></em></span> Instance State.
					</li></ol></div></section><section class="section Role ARG Spec" id="proc-gcp-secure-communication-SSL"><div class="titlepage"><div><div><h2 class="title">6.3. Securing internal communication with SSL</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				Ansible Automation Platform from GCP Marketplace is deployed with two <span class="emphasis"><em><span class="Role ARG Spec Role ARG Spec">internal</span></em></span> application load balancers, one each in front of the hub and controller instances. These internal load balancers must be configured with SSL certificates after deployment completes.
			</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
					Securing traffic through these internal load balancers is different than securing traffic through external load balancers in previous steps. This process ensures HTTP traffic is encrypted even when the traffic is localized to private GCP VPCs. The same procedure can be followed for both the automation controller and automation hub load balancers.
				</p></div></div><p class="Role ARG Spec Role ARG Spec">
				To modify both the automation controller and automation hub load balancers, which have the name format <code class="literal Role ARG Spec">&lt;DEPLOYMENT_NAME&gt;-aap-&lt;cntrlr/hub&gt;-int-lb</code>.
			</p><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem"><p class="simpara">
						Generate the automation controller or automation hub certificate with the following command:
					</p><pre class="literallayout Role ARG Spec">$ openssl req -x509 -nodes -newkey rsa:2048 -keyout key.pem -out cert.pem -sha256 -days 365</pre></li><li class="listitem">
						In the GCP console, navigate to the <a class="link mimir-link-warn" href="https://console.cloud.google.com/net-services/loadbalancing/list/loadBalancers" title="Mimir does not include content from: console.cloud.google.com"><span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Load Balancing</span></strong></span></a> page.
					</li><li class="listitem">
						In the search bar, enter the name of your deployment to filter down to your load balancers.
					</li><li class="listitem">
						Click <code class="literal Role ARG Spec">&lt;DEPLOYMENT_NAME&gt;-aap-&lt;cntrlr/hub&gt;-int-lb</code>.
					</li><li class="listitem">
						Click <span class="guibutton">Edit</span>.
					</li><li class="listitem">
						Click <span class="guibutton">Frontend configuration</span>.
					</li><li class="listitem"><p class="simpara">
						Click <span class="guibutton">ADD FRONTEND IP AND PORT</span>. Use the following values:
					</p><div class="orderedlist Role ARG Spec"><ol class="orderedlist Role ARG Spec" type="a"><li class="listitem">
								<span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Protocol</span></strong></span>: HTTPS (includes HTTP/2).
							</li><li class="listitem">
								<span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Subnetwork</span></strong></span>: Select the available aap-subnet.
							</li><li class="listitem">
								<span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Port</span></strong></span>: 443
							</li><li class="listitem">
								<span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">IP Address</span></strong></span>: <code class="literal Role ARG Spec">&lt;DEPLOYMENT_NAME&gt;-aap&lt;cntrlr/hub&gt;-intl-lb-ip</code>
							</li></ol></div></li><li class="listitem"><p class="simpara">
						If you have already added your certificate, select it.
					</p><div class="orderedlist Role ARG Spec"><ol class="orderedlist Role ARG Spec" type="a"><li class="listitem">
								If you have not added your certificate, click <span class="guibutton">CREATE A NEW CERTIFICATE</span>.
							</li><li class="listitem">
								Provide a name for your certificate.
							</li><li class="listitem">
								Using your previously generated certificate, copy <code class="literal Role ARG Spec">cert.pem</code> contents and paste it under <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Certificate</span></strong></span>.
							</li><li class="listitem">
								Using your previously generated certificate key, copy <code class="literal Role ARG Spec">key.pem</code> contents and paste it under <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Private Key</span></strong></span>.
							</li><li class="listitem">
								Click <span class="guibutton">Create</span>.
							</li></ol></div></li><li class="listitem">
						Click <span class="guibutton">Done</span>.
					</li><li class="listitem"><p class="simpara">
						Optional: To delete the HTTP Frontend configuration.
					</p><div class="orderedlist Role ARG Spec"><ol class="orderedlist Role ARG Spec" type="a"><li class="listitem">
								Open the Load balancer instance.
							</li><li class="listitem">
								Click <span class="guibutton">Frontend Configuration</span> The configurations appear on the left side of the UI.
							</li><li class="listitem">
								Scroll to the configuration you want to delete.
							</li><li class="listitem">
								Click the trashcan icon to delete the configuration.
							</li></ol></div></li><li class="listitem">
						Click <span class="guibutton">Update</span>, and confirm the update.
					</li></ol></div></section><section class="section Role ARG Spec" id="ref-gcp-security-considerations"><div class="titlepage"><div><div><h2 class="title">6.4. Security considerations</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				To configure Red Hat Single Sign-On with an identity provider that can enable <span class="emphasis"><em><span class="Role ARG Spec Role ARG Spec">Multi factor Authentication</span></em></span> (MFA), follow the steps <a class="link mimir-link-warn" href="https://docs.ansible.com/automation-controller/latest/html/administration/ent_auth.html" title="Mimir does not include content from: docs.ansible.com">here</a> for connecting enterprise authentication to Ansible Automation Platform.
			</p><p class="Role ARG Spec Role ARG Spec">
				Securing infrastructure services is an important step in any cloud deployment. Follow the implementation and security suggestions from <a class="link mimir-link-warn" href="https://cloud.google.com/docs" title="Mimir does not include content from: cloud.google.com">GCP documentation</a> for services used as part of an Ansible Automation Platform from GCP Marketplace deployment.
			</p></section></section><section class="chapter Role ARG Spec" id="ap-command-generator"><div class="titlepage"><div><div><h1 class="title">Chapter 7. The command generator</h1></div></div></div><p class="Role ARG Spec Role ARG Spec">
			The Command Generator is used to generate commands for launching operational playbooks provided by the Ansible-on-clouds operational playbook collection.
		</p><p class="Role ARG Spec Role ARG Spec">
			The process involves five steps:
		</p><div class="orderedlist Role ARG Spec"><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem">
					Pull the <code class="literal Role ARG Spec">ansible-on-clouds-ops</code> container image.
				</li><li class="listitem">
					List the available playbooks.
				</li><li class="listitem">
					Use a command generator to generate a data file and the next command to run. <code class="literal Role ARG Spec">command_generator_vars</code> and the command_generator are implemented using a docker container and are run using the docker command line interface.
				</li><li class="listitem"><p class="simpara">
					Populate the data file and run the previous generated command. This generates the final command with all parameters.
				</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
						When this step is complete, you can save the generated command and run the playbook when it is required.
					</p></div></div></li><li class="listitem">
					Run the final command.
				</li></ol></div><div class="itemizedlist Role ARG Spec"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
					Docker
				</li><li class="listitem">
					A GCP credentials file
				</li><li class="listitem">
					An internet connection to Google Cloud
				</li></ul></div><section class="section Role ARG Spec" id="proc-aap-pull-command-container-image"><div class="titlepage"><div><div><h2 class="title">7.1. Pulling the ansible-on-clouds-ops container image</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				Pull the Docker image for the Ansible on Clouds operational container with the same tag version as your deployment. If you are unsure of the version you have deployed, see <a class="link" href="#ref-aap-using-playbooks" title="7.6. Using the playbooks">Command Generator</a> and playbook <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">gcp_get_aoc_version</span></strong></span> for more information on finding the currention of Ansible on Clouds deployment.
			</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
					Before Pulling the docker image, ensure you are logged in to registry.redhat.io using docker. Use the following command to login to registry.redhat.io.
				</p><pre class="literallayout Role ARG Spec">$ docker login registry.redhat.io</pre><p class="Role ARG Spec Role ARG Spec">
					For more information about registry login, see <a class="link mimir-link-warn" href="https://access.redhat.com/RegistryAuthentication" title="This content is not included in Mimir.">Registry Authentication</a>
				</p></div></div><p class="Role ARG Spec Role ARG Spec">
				For example, if your foundation deployment version is 2.4.20240215-00, you must pull the operational image with tag 2.4.20240215.
			</p><p class="Role ARG Spec Role ARG Spec">
				Use the following commands:
			</p><pre class="literallayout Role ARG Spec">$ export IMAGE=registry.redhat.io/ansible-on-clouds/ansible-on-clouds-ops-rhel9:2.4.20240215
$ docker pull $IMAGE --platform=linux/amd64</pre><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
					If your foundation deployment version is not 2.4.20240215-00, refer to the tables on the <a class="link" href="/documentation/en-us/ansible_on_clouds/2.x/html-single/red_hat_ansible_automation_platform_from_gcp_release_notes/index/#assembly-gcp-release-notes-24">Released versions</a> page for a matching deployment version, in the column <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Ansible on Clouds version</span></strong></span>, and find the corresponding operational image to use, in the column <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Ansible-on-clouds-ops container image</span></strong></span>, for the IMAGE environment variable.
				</p></div></div></section><section class="section Role ARG Spec" id="proc-aap-list-available-playbooks"><div class="titlepage"><div><div><h2 class="title">7.2. Listing the available playbooks</h2></div></div></div><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem"><p class="simpara">
						For the list of available playbooks without details, use the following command.
					</p><pre class="literallayout Role ARG Spec">$ docker run --rm $IMAGE command_generator_vars | grep Playbook

The current version of the operational playbooks collection contains the following playbooks:

Playbook: gcp_aap_health_check
Playbook: gcp_add_extension_nodes
Playbook: gcp_add_labels
Playbook: gcp_backup_delete
Playbook: gcp_backup_deployment
Playbook: gcp_backup_list
Playbook: gcp_backups_delete
Playbook: gcp_check_aoc_version
Playbook: gcp_deployment_inventory
Playbook: gcp_get_aoc_version
Playbook: gcp_health_check
Playbook: gcp_list_deployments
Playbook: gcp_nodes_health_check
Playbook: gcp_remove_extension_nodes
Playbook: gcp_remove_labels
Playbook: gcp_restore_deployment
Playbook: gcp_setup_logging_monitoring
Playbook: gcp_upgrade</pre></li><li class="listitem"><p class="simpara">
						To provide a list of all available playbooks, and to use the command generator, use the following command.
					</p><pre class="literallayout Role ARG Spec">$ docker run --rm $IMAGE command_generator_vars</pre><p class="Role ARG Spec Role ARG Spec">
						This provides a list of playbooks and a command similar to the following:
					</p><pre class="literallayout Role ARG Spec">===============================================
Playbook: gcp_upgrade
Description: Performs the upgrade of the Ansible Automation Platform from GCP Marketplace components to the latest version.
-----------------------------------------------
Performs the upgrade of the Ansible Automation Platform from GCP Marketplace components to the latest version.

-----------------------------------------------
Command generator template:

docker run --rm $IMAGE command_generator gcp_upgrade [--ansible-config ansible_config_path&gt;] \
-d &lt;deployment_name&gt; -c &lt;cloud_credentials_path&gt; --extra-vars 'gcp_compute_region=&lt;gcp_compute_region&gt; gcp_compute_zone=&lt;gcp_compute_zone&gt; gcp_backup_taken=&lt;true|false&gt;'
===============================================</pre></li></ol></div></section><section class="section Role ARG Spec" id="proc-aap-generate-command-data-file"><div class="titlepage"><div><div><h2 class="title">7.3. Generating the data file</h2></div></div></div><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem"><p class="simpara">
						Run the command generator.
					</p><pre class="literallayout Role ARG Spec">$ docker run --rm -v &lt;local_directory_data_file&gt;:/data $IMAGE command_generator_vars &lt;playbook_name&gt; --output-data-file /data/&lt;data-file&gt;.yml</pre><p class="Role ARG Spec Role ARG Spec">
						The outputs of this command are the command to run and the data file template. The data file is also saved in your <code class="literal Role ARG Spec">&lt;local_data_file_directory&gt;</code>. This is the template which you populate with your data.
					</p><p class="Role ARG Spec Role ARG Spec">
						The following example uses the <code class="literal Role ARG Spec">gcp_backup_deployment</code> playbook.
					</p><pre class="literallayout Role ARG Spec">$ docker run --rm -v &lt;local_data_file_directory&gt;:/data $IMAGE command_generator_vars gcp_backup_deployment \
--output-data-file /data/backup.yml</pre></li><li class="listitem"><p class="simpara">
						Producing the following output.
					</p><pre class="literallayout Role ARG Spec">===============================================
Playbook: gcp_backup_deployment
Description: This playbook is used to backup the AoC Self-managed GCP environment.
-----------------------------------------------
This playbook is used to backup the AoC Self-managed GCP environment.
For more information regarding backup and restore, visit our official documentation -

-----------------------------------------------
Command generator template:

docker run --rm -v /tmp:/data $IMAGE command_generator gcp_backup_deployment --data-file /data/backup.yml

Data template:

gcp_backup_deployment:
  cloud_credentials_path:
  deployment_name:
  extra_vars:
    gcp_bucket_backup_name:
    gcp_compute_region:
    gcp_compute_zone:

===============================================</pre></li></ol></div></section><section class="section Role ARG Spec" id="proc-aap-populate-command-data-file"><div class="titlepage"><div><div><h2 class="title">7.4. Populating the data file</h2></div></div></div><div class="itemizedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem"><p class="simpara">
						Edit the data-file generated in <a class="link" href="#proc-aap-generate-command-data-file" title="7.3. Generating the data file">Generating the data file</a>.
					</p><p class="Role ARG Spec Role ARG Spec">
						Any attribute that represents a path must be an absolute path. The <code class="literal Role ARG Spec">command_generator</code> automatically mounts a volume for it in the final command.
					</p><p class="Role ARG Spec Role ARG Spec">
						For example, in the case of the <code class="literal Role ARG Spec">gcp_backup_deployment</code> playbook, the file becomes:
					</p><pre class="literallayout Role ARG Spec">gcp_backup_deployment
  cloud_credentials_path: /path/to/credentials
  deployment_name: my-deployment
  extra_vars:
    cp_bucket_backup_name: my-bucket
    gcp_compute_region: us-east1
    gcp_compute_zone: us-east1-b</pre></li></ul></div></section><section class="section Role ARG Spec" id="proc-aap-run-generated-command"><div class="titlepage"><div><div><h2 class="title">7.5. Running the generated command</h2></div></div></div><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem"><p class="simpara">
						Ensure that the mounted volume points to the directory where the data file is.
					</p><p class="Role ARG Spec Role ARG Spec">
						For the <code class="literal Role ARG Spec">gcp_backup_deployment</code> playbook example, this is:
					</p><pre class="literallayout Role ARG Spec">$ docker run --rm -v /tmp:/data $IMAGE command_generator gcp_backup_deployment --data-file /data/backup.yml</pre><p class="Role ARG Spec Role ARG Spec">
						Which generates the following output:
					</p><pre class="literallayout Role ARG Spec">Command to run playbook:

$ docker run --rm --env PLATFORM=GCP -v /path/to/credentials:/home/runner/.gcp/credentials:ro \
--env ANSIBLE_CONFIG=../gcp-ansible.cfg  $IMAGE\ redhat.ansible_on_clouds.gcp_backup_deployment \
-e 'gcp_service_account_credentials_json_path=/home/runner/.gcp/credentials  \
gcp_deployment_name=my-deployment gcp_compute_region=us-east1 gcp_compute_zone=us-east1-b'</pre><p class="Role ARG Spec Role ARG Spec">
						This new command has the required parameters, environment variables and mounted volumes to run the playbook.
					</p></li><li class="listitem">
						Run the generated command. You can save this command to rerun it later if required.
					</li></ol></div></section><section class="section Role ARG Spec" id="ref-aap-using-playbooks"><div class="titlepage"><div><div><h2 class="title">7.6. Using the playbooks</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				Some, but not all of the playbooks are described in this document. Here, those which are used either to retrieve information from the Ansible on Clouds deployment or to check it are described. These playbooks do not modify the deployment.
			</p><h4 id="gcp_aap_health_check">gcp_aap_health_check</h4><p class="Role ARG Spec Role ARG Spec">
				This playbook checks if the Ansible application is healthy.
			</p><pre class="literallayout Role ARG Spec">$ docker run --rm $IMAGE command_generator_vars gcp_aap_health_check</pre><p class="Role ARG Spec Role ARG Spec">
				Which generates the following output:
			</p><pre class="literallayout Role ARG Spec">===============================================
Playbook: gcp_aap_health_check
Description: This playbook checks if the deployment is healthy using the Ansible health service.
-----------------------------------------------
The health check consists of checking the Ansible Automation Platform from GCP Marketplace environemnt to verify it is healthy.

-----------------------------------------------
Command generator template:

docker run --rm $IMAGE command_generator gcp_aap_health_check [--ansible-config ansible_config_path&gt;] -d &lt;deployment_name&gt; -c &lt;cloud_credentials_path&gt; --extra-vars 'gcp_compute_region=&lt;gcp_compute_region&gt; gcp_compute_zone=&lt;gcp_compute_zone&gt;'
===============================================</pre><p class="Role ARG Spec Role ARG Spec">
				Launching this command by replacing the parameters generates a new command to launch and outputs:
			</p><pre class="literallayout Role ARG Spec">...
PLAY RECAP *********************************************************************
localhost                  : ok=29   changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</pre><p class="Role ARG Spec Role ARG Spec">
				A <span class="emphasis"><em><span class="Role ARG Spec Role ARG Spec">failed</span></em></span> not equal zero indicates an issue with Ansible on Cloud deployment.
			</p><h4 id="gcp_add_labels">gcp_add_labels</h4><p class="Role ARG Spec Role ARG Spec">
				This playbook adds labels to the deployment.
			</p><pre class="literallayout Role ARG Spec">$ docker run --rm $IMAGE command_generator_vars gcp_add_labels</pre><p class="Role ARG Spec Role ARG Spec">
				Which generates the following output:
			</p><pre class="literallayout Role ARG Spec">===============================================
Playbook: gcp_add_labels
Description: This playbook adds labels to the deployment
-----------------------------------------------
Add labels to the Ansible Automation Platform from GCP Marketplace deployment

-----------------------------------------------
Command generator template:

docker run --rm $IMAGE command_generator gcp_add_labels -d &lt;deployment_name&gt; -c &lt;cloud_credentials_path&gt; --extra-vars 'gcp_compute_region=&lt;gcp_compute_region&gt; gcp_compute_zone=&lt;gcp_compute_zone&gt; gcp_labels=&lt;gcp_labels&gt;'
===============================================</pre><p class="Role ARG Spec Role ARG Spec">
				The parameter <code class="literal Role ARG Spec">gcp_labels</code> is a comma separated list of <code class="literal Role ARG Spec">key=value</code> pairs to add or update. For example: key1=value1,key2=value2
			</p><p class="Role ARG Spec Role ARG Spec">
				Launching this command by replacing the parameters generates a new command to launch and outputs:
			</p><pre class="literallayout Role ARG Spec">...
PLAY RECAP *********************************************************************
localhost                  : ok=22   changed=2    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0</pre><h4 id="gcp_remove_labels">gcp_remove_labels</h4><p class="Role ARG Spec Role ARG Spec">
				This playbook removes labels from the deployment.
			</p><pre class="literallayout Role ARG Spec">$ docker run --rm $IMAGE command_generator_vars gcp_remove_labels</pre><p class="Role ARG Spec Role ARG Spec">
				Which generates the following output:
			</p><pre class="literallayout Role ARG Spec">===============================================
Playbook: gcp_remove_labels
Description: This playbook removes labels from the deployment.
-----------------------------------------------
Remove labels from the Ansible Automation Platform from GCP Marketplace deployment.

-----------------------------------------------
Command generator template:
docker run --rm $IMAGE command_generator gcp_remove_labels -d &lt;deployment_name&gt; -c &lt;cloud_credentials_path&gt; --extra-vars 'gcp_compute_region=&lt;gcp_compute_region&gt; gcp_compute_zone=&lt;gcp_compute_zone&gt; gcp_labels=&lt;gcp_labels&gt;'
===============================================</pre><p class="Role ARG Spec Role ARG Spec">
				The parameter <code class="literal Role ARG Spec">gcp_labels</code> is a comma separated list of keys to remove. For example: key1,key2
			</p><p class="Role ARG Spec Role ARG Spec">
				Launching this command by replacing the parameters generates a new command to launch and outputs:
			</p><pre class="literallayout Role ARG Spec">...
PLAY RECAP *********************************************************************
localhost                  : ok=22   changed=2    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0</pre><h4 id="gcp_check_aoc_version">gcp_check_aoc_version</h4><p class="Role ARG Spec Role ARG Spec">
				This playbook checks if the Ansible on Cloud version is the same as the command generator container. The check is done each time a playbook is called.
			</p><pre class="literallayout Role ARG Spec">$ docker run --rm $IMAGE command_generator_vars gcp_check_aoc_version</pre><p class="Role ARG Spec Role ARG Spec">
				Which generates the following output:
			</p><pre class="literallayout Role ARG Spec">===============================================
Playbook: gcp_check_aoc_version
Description: Check the operational container version matches the Ansible on Clouds version.
-----------------------------------------------
Check the operational container version matches the Ansible on Clouds version.

-----------------------------------------------
Command generator template:

docker run --rm $IMAGE command_generator gcp_check_aoc_version [--ansible-config ansible_config_path&gt;] -c &lt;cloud_credentials_path&gt; -d &lt;deployment_name&gt;
===============================================</pre><p class="Role ARG Spec Role ARG Spec">
				Launching this command by replacing the parameters generates a new command to launch and outputs:
			</p><pre class="literallayout Role ARG Spec">...
TASK [redhat.ansible_on_clouds.standalone_check_aoc_version : Verify operational playbook and Ansible on Clouds deployment versions] ***
ok: [localhost] =&gt; {
    "changed": false,
    "msg": "This operation playbook version and the Ansible on Clouds deployment version are identical: 2.4.20230606-00"
}

PLAY RECAP *********************************************************************
localhost                  : ok=8    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</pre><p class="Role ARG Spec Role ARG Spec">
				A <span class="emphasis"><em><span class="Role ARG Spec Role ARG Spec">failed</span></em></span> not equal zero means the Ansible on Clouds deployment version does not match the <code class="literal Role ARG Spec">command_generator</code> container and a different version is required for the command generator to manage that deployment.
			</p><h4 id="gcp_get_aoc_version">gcp_get_aoc_version</h4><p class="Role ARG Spec Role ARG Spec">
				This playbook retrieves the version of the Ansible on Clouds deployment.
			</p><pre class="literallayout Role ARG Spec">$ docker run --rm $IMAGE command_generator_vars gcp_get_aoc_version</pre><p class="Role ARG Spec Role ARG Spec">
				Which generates the following output:
			</p><pre class="literallayout Role ARG Spec">===============================================
Playbook: gcp_get_aoc_version
Description: Get the current Ansible on Clouds version.
-----------------------------------------------
Get the current Ansible on Clouds version.

-----------------------------------------------
Command generator template:

docker run --rm $IMAGE command_generator gcp_get_aoc_version [--ansible-config ansible_config_path&gt;] -c &lt;cloud_credentials_path&gt; -d &lt;deployment_name&gt;
===============================================</pre><p class="Role ARG Spec Role ARG Spec">
				Launching this command by replacing the parameters generates a new command to launch and outputs:
			</p><pre class="literallayout Role ARG Spec">...
TASK [Print version] ***********************************************************
ok: [localhost] =&gt; {
    "msg": "The AOC version is 2.4.20230606-00"
}

PLAY RECAP *********************************************************************
localhost                  : ok=5    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</pre><h4 id="gcp_health_check">gcp_health_check</h4><p class="Role ARG Spec Role ARG Spec">
				This playbook checks if the nodes and Ansible application are healthy.
			</p><pre class="literallayout Role ARG Spec">$ docker run --rm $IMAGE command_generator_vars gcp_health_check</pre><p class="Role ARG Spec Role ARG Spec">
				Which generates the following output:
			</p><pre class="literallayout Role ARG Spec">===============================================
Playbook: gcp_health_check
Description: This playbook checks if the Ansible Automation Platform from GCP Marketplace deployment is healthy.
-----------------------------------------------
The health check consists of checking the Ansible Automation Platform from GCP Marketplace heatlh checks
and the health of the monitoring exporter.

-----------------------------------------------
Command generator template:

docker run --rm $IMAGE command_generator gcp_health_check [--ansible-config ansible_config_path&gt;] -c &lt;cloud_credentials_path&gt; -d &lt;deployment_name&gt; --extra-vars 'gcp_compute_region=&lt;gcp_compute_region&gt; gcp_compute_zone=&lt;gcp_compute_zone&gt;'
===============================================</pre><p class="Role ARG Spec Role ARG Spec">
				Launching this command by replacing the parameters will generate a new command to launch and will output:
			</p><pre class="literallayout Role ARG Spec">...
PLAY RECAP *********************************************************************
localhost                  : ok=47   changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</pre><p class="Role ARG Spec Role ARG Spec">
				A <span class="emphasis"><em><span class="Role ARG Spec Role ARG Spec">failed</span></em></span> not equal zero indicates an issue with nodes or the Ansible on Cloud deployment.
			</p><h4 id="gcp_list_deployments">gcp_list_deployments</h4><p class="Role ARG Spec Role ARG Spec">
				This playbook list the deployments, the region and zone are optional.
			</p><pre class="literallayout Role ARG Spec">$ docker run --rm $IMAGE command_generator_vars gcp_list_deployments</pre><p class="Role ARG Spec Role ARG Spec">
				Which generates the following output:
			</p><pre class="literallayout Role ARG Spec">===============================================
Playbook: gcp_list_deployments
Description: This playbook generates a list of available Ansible Automation Platform from GCP Marketplace deployments.
-----------------------------------------------
This playbook is used to generate a list of available Ansible Automation Platform from GCP Marketplace deployments.

-----------------------------------------------
Command generator template:

docker run --rm $IMAGE command_generator gcp_list_deployments -c &lt;cloud_credentials_path&gt; --extra-vars '[gcp_compute_region=&lt;gcp_compute_region&gt;] [gcp_compute_zone=&lt;gcp_compute_zone&gt;]'
===============================================</pre><p class="Role ARG Spec Role ARG Spec">
				Launching this command by replacing the parameters generates a new command to launch and outputs:
			</p><pre class="literallayout Role ARG Spec">...
TASK [Show deployment list] ****************************************************
ok: [localhost] =&gt; {
    "msg": [
        "Deployment list: ['dep1', 'dep2', 'dep3']"
    ]
}

PLAY RECAP *********************************************************************
localhost                  : ok=7    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</pre><h4 id="gcp_nodes_health_check">gcp_nodes_health_check</h4><p class="Role ARG Spec Role ARG Spec">
				This playbook checks if the nodes are healthy.
			</p><pre class="literallayout Role ARG Spec">$ docker run --rm $IMAGE command_generator_vars gcp_nodes_health_check</pre><p class="Role ARG Spec Role ARG Spec">
				Which generates the following output:
			</p><pre class="literallayout Role ARG Spec">===============================================
Playbook: gcp_nodes_health_check
Description: This role runs a health check on a group of nodes in the Ansible Automation Platform from GCP Marketplace deployment
-----------------------------------------------
The playbook checks if the Ansible Automation Platform from GCP Marketplace monitoring exporter is up and running.

-----------------------------------------------
Command generator template:

docker run --rm $IMAGE command_generator gcp_nodes_health_check [--ansible-config ansible_config_path&gt;] -d &lt;deployment_name&gt; -c &lt;cloud_credentials_path&gt; --extra-vars 'check_monitoring=True'
===============================================</pre><p class="Role ARG Spec Role ARG Spec">
				Launching this command by replacing the parameters generates a new command to launch and outputs:
			</p><pre class="literallayout Role ARG Spec">...
PLAY RECAP *********************************************************************
localhost                  : ok=47   changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</pre><p class="Role ARG Spec Role ARG Spec">
				A <span class="emphasis"><em><span class="Role ARG Spec Role ARG Spec">failed</span></em></span> not equal zero indicates an issue with nodes in the deployment.
			</p></section></section><section class="chapter Role ARG Spec" id="assembly-gcp-automation-workloads"><div class="titlepage"><div><div><h1 class="title">Chapter 8. Automation workloads</h1></div></div></div><p class="Role ARG Spec Role ARG Spec">
			The default Ansible Automation Platform from GCP Marketplace is designed and licensed to automate 100 managed nodes.
		</p><section class="section Role ARG Spec" id="ref-gcp-automation-performance"><div class="titlepage"><div><div><h2 class="title">8.1. Automation performance</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				Automating against your licensed managed node allocation in the offer is provided with the following operational expectations. Automating outside of the boundaries of these criteria is not supported, but can still function depending on your automation.
			</p><div class="informaltable"><table class="lt-4-cols lt-7-rows Role ARG Spec"><colgroup><col style="width: 50%; " class="col_1"><!--Empty--></col><col style="width: 50%; " class="col_2"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139690692000080" scope="col">Metric</th><th align="left" valign="top" id="idm139690691998992" scope="col">Threshold</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139690692000080"> <p>
								Concurrent Jobs
							</p>
							 </td><td align="left" valign="top" headers="idm139690691998992"> <p>
								10
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139690692000080"> <p>
								Forks per job
							</p>
							 </td><td align="left" valign="top" headers="idm139690691998992"> <p>
								10
							</p>
							 </td></tr></tbody></table></div><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
					Ansible Automation Platform from GCP Marketplace is driven using three n2-standard-2 instances, two of which run automation controller and one which runs automation hub. The automation controller instances collectively support a standard workload for 100 managed active nodes. Red Hat has tested this and proved that there is support for up to 10 forks each. This operating criteria has been set and tested using output-intensive, “chatty” workloads that produce 2 messages 7 seconds apart on both automation controller nodes. Workloads that are more I/O intensive might not work inside the boundaries of these conditions and can require the use of extension nodes to scale the deployment to support such automation.
				</p></div></div></section><section class="section Role ARG Spec" id="ref-gcp-deployment-scaling"><div class="titlepage"><div><div><h2 class="title">8.2. Deployment scaling</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				If you want to scale your deployment beyond the initial number of supported managed nodes, Ansible Automation Platform from GCP Marketplace can be manually scaled using separately sold extension nodes.
			</p><p class="Role ARG Spec Role ARG Spec">
				Extension nodes are additional compute instances that can be deployed to scale-up or scale-out depending on the immediate scaling requirements. If your requirements are for higher parallel automation operations you can select compute shapes that scale-up, while if you have a requirement to automate more nodes over time you can select compute shapes that scale out.
			</p><p class="Role ARG Spec Role ARG Spec">
				Extension nodes are the supported way of extending the capabilities of Ansible Automation Platform from GCP Marketplace.
			</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
					Red Hat does not support environments that are extended through customer design and implementation.
				</p></div></div></section></section><section class="chapter Role ARG Spec" id="assembly-gcp-monitoring-logging"><div class="titlepage"><div><div><h1 class="title">Chapter 9. Monitoring and logging</h1></div></div></div><p class="Role ARG Spec Role ARG Spec">
			You can send metrics to the Google Cloud Platform monitoring system to be visualized in the Google Cloud Platform UI. Ansible Automation Platform from GCP Marketplace metrics and logging are disabled by default as there is a cost to send these metrics to GCP. Refer to <a class="link mimir-link-warn" href="https://cloud.google.com/stackdriver/pricing#monitoring-costs" title="Mimir does not include content from: cloud.google.com">Cloud Monitoring</a> and <a class="link mimir-link-warn" href="https://cloud.google.com/stackdriver/pricing" title="Mimir does not include content from: cloud.google.com">Cloud Logging</a> respectively for more information.
		</p><p class="Role ARG Spec Role ARG Spec">
			You can set up GCP monitoring and logging either:
		</p><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
					At deployment time, read <a class="link" href="#con-gcp-setup-at-deployment-time" title="2.5. Setting up monitoring and logging at deployment time">Setting up monitoring and logging at deployment time</a>, or
				</li><li class="listitem">
					After the deployment
				</li></ul></div><section class="section Role ARG Spec" id="con-gcp-setup-after-deployment"><div class="titlepage"><div><div><h2 class="title">9.1. Setting up monitoring and logging after deployment</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				You can start or stop the logging and monitoring after the deployment by using the <code class="literal Role ARG Spec">gcp_setup_logging_monitoring</code> playbook available from registry.redhat.com.
			</p><section class="section Role ARG Spec" id="ref-gcp-iam-logging-monitoring-minimum-permissions"><div class="titlepage"><div><div><h3 class="title">9.1.1. Required permissions</h3></div></div></div><p class="Role ARG Spec Role ARG Spec">
					You must have the following GCP IAM permissions to set up logging and monitoring:
				</p><pre class="literallayout Role ARG Spec">required-roles:

Service Account User
Compute Instance Admin (v1)

required-permissions:

cloudsql.instances.connect
cloudsql.instances.get
cloudsql.instances.login
cloudsql.users.update
compute.addresses.get
compute.addresses.list
compute.instances.delete
compute.instances.get
compute.instances.list
compute.instances.setLabels
compute.zoneOperations.get
deploymentmanager.deployments.list
deploymentmanager.manifests.get
deploymentmanager.manifests.list
file.instances.get
file.instances.list
file.instances.update
file.operations.get
iap.tunnelInstances.accessViaIAP
logging.logEntries.create
monitoring.timeSeries.create
resourcemanager.projects.get
runtimeconfig.variables.create
runtimeconfig.variables.get
runtimeconfig.variables.list
runtimeconfig.variables.update
secretmanager.secrets.create
secretmanager.secrets.delete
secretmanager.secrets.get
secretmanager.versions.add
secretmanager.versions.get
secretmanager.versions.list
servicenetworking.operations.get
servicenetworking.services.addPeering
serviceusage.services.list</pre></section><section class="section Role ARG Spec" id="con-gcp-use-container-image"><div class="titlepage"><div><div><h3 class="title">9.1.2. Pulling the ansible-on-clouds-ops container image</h3></div></div></div><p class="Role ARG Spec Role ARG Spec">
					Pull the Docker image for the Ansible on Clouds operational container which aligns with the version of your foundation deployment. If you are unsure of the version you have deployed, see <a class="link" href="#ref-aap-using-playbooks" title="7.6. Using the playbooks">Command Generator</a> and playbook <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">gcp_get_aoc_version</span></strong></span> for more information on finding the current version of Ansible on Clouds deployment.
				</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
						Before pulling the docker image, ensure you are logged in to registry.redhat.io using docker. Use the following command to login to registry.redhat.io.
					</p><pre class="literallayout Role ARG Spec">$ docker login registry.redhat.io</pre><p class="Role ARG Spec Role ARG Spec">
						For more information about registry login, see <a class="link mimir-link-warn" href="https://access.redhat.com/RegistryAuthentication" title="This content is not included in Mimir.">Registry Authentication</a>
					</p></div></div><p class="Role ARG Spec Role ARG Spec">
					For example, if your foundation deployment version is 2.4.20240215-00, you must pull the operational image with tag 2.4.20240215.
				</p><p class="Role ARG Spec Role ARG Spec">
					Use the following commands:
				</p><pre class="literallayout Role ARG Spec">$ export IMAGE=registry.redhat.io/ansible-on-clouds/ansible-on-clouds-ops-rhel9:2.4.20240215
$ docker pull $IMAGE --platform=linux/amd64</pre><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
						If your foundation deployment version is not 2.4.20240215-00, refer to the tables on the <a class="link" href="/documentation/en-us/ansible_on_clouds/2.x/html-single/red_hat_ansible_automation_platform_from_gcp_release_notes/index/#assembly-gcp-release-notes-24">Released versions</a> page for a matching deployment version, in the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Ansible on Clouds version</span></strong></span> column. Find the corresponding operational image to use, in the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Ansible-on-clouds-ops container image</span></strong></span> column, for the IMAGE environment variable.
					</p></div></div></section><section class="section Role ARG Spec" id="proc-gcp-generate-variables"><div class="titlepage"><div><div><h3 class="title">9.1.3. Generating data files by running the ansible-on-clouds-ops container</h3></div></div></div><p class="Role ARG Spec Role ARG Spec">
					The following commands generate the required data file. These commands create a directory, and an empty data template that, when populated, is used to generate the playbook.
				</p><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem"><p class="simpara">
							Create a folder to hold the configuration files.
						</p><pre class="screen Role ARG Spec Role ARG Spec">$ mkdir command_generator_data</pre></li><li class="listitem"><p class="simpara">
							Populate the <code class="literal Role ARG Spec">command_generator_data</code> folder with the configuration file template.
						</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
								On Linux, any file or directory created by the command generator is owned by <code class="literal Role ARG Spec">root:root</code> by default. To change the ownership of the files and directories, you can run the <code class="literal Role ARG Spec">sudo chmod</code> command after the files are created. For more information, read <a class="link" href="#con-tech-note-linux-files-owned-by-root" title="13.2. Command generator - Linux files owned by root">Command generator - Linux files owned by root</a>.
							</p></div></div><pre class="screen Role ARG Spec Role ARG Spec">$ docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE \
command_generator_vars gcp_setup_logging_monitoring \
--output-data-file /data/logging-monitoring.yml</pre></li><li class="listitem"><p class="simpara">
							When you have run these commands, a <code class="literal Role ARG Spec">command_generator_data/logging-monitoring.yml</code> template file is created.
						</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
								In the following example file, <code class="literal Role ARG Spec">ansible_config_path</code> is optional.
							</p></div></div><p class="Role ARG Spec Role ARG Spec">
							This template file resembles the following:-
						</p><pre class="literallayout Role ARG Spec">gcp_setup_logging_monitoring:
  ansible_config_path:
  cloud_credentials_path:
  deployment_name:
  extra_vars:
    components:
    default_collector_interval:
    logging_enabled:
    monitoring_enabled:</pre></li></ol></div></section><section class="section Role ARG Spec" id="proc-gcp-set-monitoring-logging-yml"><div class="titlepage"><div><div><h3 class="title">9.1.4. Updating the data file</h3></div></div></div><p class="Role ARG Spec Role ARG Spec">
					If you do not require a parameter, remove that parameter from the configuration file.
				</p><div class="itemizedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
							Edit the <code class="literal Role ARG Spec">command_generator_data/logging-monitoring.yml</code> file and set the following parameters:
						</li><li class="listitem">
							<code class="literal Role ARG Spec">ansible_config_path</code> is used by default as the standard configuration for the <code class="literal Role ARG Spec">ansible-on-cloud offering</code> but if you have extra requirements in your environment you can specify your own.
						</li><li class="listitem">
							<code class="literal Role ARG Spec">cloud_credentials_path</code> is the absolute path toward your credentials. This must be an absolute path.
						</li><li class="listitem">
							<code class="literal Role ARG Spec">deployment_name</code> is the name of the deployment.
						</li><li class="listitem">
							<code class="literal Role ARG Spec">components</code> (Optional) the type of component on which you want to carry out the setup. The default is [ “controller”, “hub” ] which means that the logging monitoring will be enabled on both automation controller and automation hub.
						</li><li class="listitem">
							<code class="literal Role ARG Spec">monitoring_enabled</code> (Optional) is set to <code class="literal Role ARG Spec">true</code> to enable the monitoring, <code class="literal Role ARG Spec">false</code> otherwise. Default = <code class="literal Role ARG Spec">false</code>.
						</li><li class="listitem">
							<code class="literal Role ARG Spec">logging_enabled</code> (Optional) is set to <code class="literal Role ARG Spec">true</code> to enable the logging, <code class="literal Role ARG Spec">false</code> otherwise. Default = <code class="literal Role ARG Spec">false</code>.
						</li><li class="listitem"><p class="simpara">
							<code class="literal Role ARG Spec">default_collector_interval</code> (Optional) is the frequency at which the monitoring data must be sent to Google Cloud. Default = 59s.
						</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
								The Google cost of this service depends on that periodicity and so the higher the value of the collector interval, the less it will cost.
							</p></div></div><p class="Role ARG Spec Role ARG Spec">
							Do not set values less than 59 seconds.
						</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
								If monitoring and logging is disabled, the value of 'default_collector_interval' is automatically set to <code class="literal Role ARG Spec">0</code>.
							</p></div></div></li></ul></div><p class="Role ARG Spec Role ARG Spec">
					After populating the data file, it should resemble the following.
				</p><p class="Role ARG Spec Role ARG Spec">
					The following values are provided as examples:
				</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
						The optional parameters described in the section are ommitted in the data file example below. The playbook uses the default value for any optional parameter that is ommitted from the data file. If you want to override a default value for an optional parameter, then it must be included in the data file and assigned a value.
					</p></div></div><pre class="literallayout Role ARG Spec">gcp_setup_logging_monitoring:
  cloud_credentials_path: ~/secrets/GCP-secrets.json
  deployment_name: AnsibleAutomationPlatform
  extra_vars:</pre></section><section class="section Role ARG Spec" id="proc-gcp-generate-playbook"><div class="titlepage"><div><div><h3 class="title">9.1.5. Generating the playbook</h3></div></div></div><p class="Role ARG Spec Role ARG Spec">
					To generate the playbook, run the command generator to generate the CLI command.
				</p><pre class="literallayout Role ARG Spec">docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE command_generator gcp_setup_logging_monitoring \
--data-file /data/logging-monitoring.yml</pre><p class="Role ARG Spec Role ARG Spec">
					Provides the following command:
				</p><pre class="literallayout Role ARG Spec">docker run --rm --env PLATFORM=GCP -v &lt;/path/to/gcp/service-account.json&gt;:/home/runner/.gcp/credentials:ro \
--env ANSIBLE_CONFIG=../gcp-ansible.cfg --env DEPLOYMENT_NAME=&lt;deployment_name&gt; --env GENERATE_INVENTORY=true  \
$IMAGE redhat.ansible_on_clouds.gcp_setup_logging_monitoring -e 'gcp_deployment_name=&lt;deployment_name&gt; \
gcp_service_account_credentials_json_path=/home/runner/.gcp/credentials  monitoring_enabled=&lt;monitoring_enabled&gt; \
logging_enabled=&lt;logging_enabled&gt; default_collector_interval=&lt;interval&gt;'</pre><p class="Role ARG Spec Role ARG Spec">
					Run the supplied command to run the playbook.
				</p><pre class="literallayout Role ARG Spec">$ docker run --rm --env PLATFORM=GCP -v /path/to/credentials:/home/runner/.gcp/credentials:ro \
--env ANSIBLE_CONFIG=../gcp-ansible.cfg --env DEPLOYMENT_NAME=mu-deployment \
--env GENERATE_INVENTORY=true  $IMAGE redhat.ansible_on_clouds.gcp_setup_logging_monitoring \
-e 'gcp_deployment_name=mu-deployment \
gcp_service_account_credentials_json_path=/home/runner/.gcp/credentials  components=["hubs","controllers"]\
monitoring_enabled=True logging_enabled=True default_collector_interval=60s'</pre><p class="Role ARG Spec Role ARG Spec">
					The process may take some time, and provides output similar to the following:
				</p><pre class="literallayout Role ARG Spec">TASK [redhat.ansible_on_clouds.setup_logging_monitoring : Update runtime variable logging_enabled] ***
changed: [&lt;user_name&gt; -&gt; localhost]

TASK [redhat.ansible_on_clouds.setup_logging_monitoring : Update runtime variable monitoring_enabled] ***
changed: [&lt;user_name&gt; -&gt; localhost]

PLAY RECAP *********************************************************************
&lt;user_name&gt;     : ok=20   changed=6    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0</pre></section></section><section class="section Role ARG Spec" id="con-gcp-customize-monitoring-logging"><div class="titlepage"><div><div><h2 class="title">9.2. Customizing monitoring and logging</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				Metrics are provided by <a class="link mimir-link-warn" href="https://docs.ansible.com/automation-controller/latest/html/administration/metrics.html" title="Mimir does not include content from: docs.ansible.com">Ansible</a>, <a class="link mimir-link-warn" href="https://github.com/containers/prometheus-podman-exporter" title="Mimir does not include content from: github.com">Podman</a> and <a class="link mimir-link-warn" href="https://cloud.google.com/stackdriver/docs/solutions/agents/ops-agent" title="Mimir does not include content from: cloud.google.com">Google Ops Agent</a>. The Google Ops Agent and Podman are installed on automation controller and automation hub VM instances, however Ansible metrics are only installed on automation hub instances.
			</p><p class="Role ARG Spec Role ARG Spec">
				A configurable process (collector) runs on each automation controller VM instance and automation hub VM instance to export the collected Ansible and Podman metrics to Google Cloud Platform Monitoring. As the Google Ops Agent is part of the Google Cloud solution, it has its own configuration file.
			</p><p class="Role ARG Spec Role ARG Spec">
				The Google Ops Agent is also responsible for the logging configuration.
			</p><p class="Role ARG Spec Role ARG Spec">
				The service APIs <code class="literal Role ARG Spec">monitoring.googleapis.com</code> and <code class="literal Role ARG Spec">logging.googleapis.com</code> must be respectively enabled for the monitoring and logging capabilities.
			</p><div class="Role ARG Spec Role ARG Spec"><p class="title"><strong>Configuration</strong></p><p>
					Configuration files are located on a disk shared by each automation controller and automation hub. Modify the file <code class="literal Role ARG Spec">/aap/bootstrap/config_file_templates/&lt;controller|hub&gt;/monitoring.yml</code> to configure all exporters and agents.
				</p></div><section class="section Role ARG Spec" id="ref-gcp-ansible-podman-config"><div class="titlepage"><div><div><h3 class="title">9.2.1. Ansible and podman configuration</h3></div></div></div><p class="Role ARG Spec Role ARG Spec">
					The file <code class="literal Role ARG Spec">/aap/bootstrap/config_file_templates/&lt;controller|hub&gt;/monitoring.yaml</code> on automation controller or automation hub contains the configuration for collecting and sending Ansible and podman metrics to GCP.
				</p><p class="Role ARG Spec Role ARG Spec">
					The default configuration for automation controller looks like this:
				</p><pre class="literallayout Role ARG Spec"># This value will be set at deployment time.
# Set to zero if monitoringEnabled is false otherwise 59s
# The collection interval for each collector will be the minimum
# between the defaultCollectorInterval and all send Interval
# of a given collector
# NB: The awx exported should not run on controllers as
# it duplicates the number of records sent to GCP Monitoring

defaultCollectorInterval: $DEFAULT_COLLECTOR_INTERVAL
collectors:
- name: podman
 endpoint: http://localhost:9882/podman/metrics
 enabled: true

# list of metrics to exclude
# excludedMetrics:
# - podman_container_created_seconds

 metrics:
 - name: podman_container_exit_code
   # interval on which the metric must be pushed to gcp
   sendInterval: 59s</pre><p class="Role ARG Spec Role ARG Spec">
					The default configuration for automation hub looks like:
				</p><pre class="literallayout Role ARG Spec"># This value will be set at deployment time.
# Set to zero if monitoringEnabled is false otherwise 59s
# The collection interval for each collector will be the minimum
# between the defaultCollectorInterval and all sendInterval
# of a given collector
# NB: The awx exporter should not run on controllers as
# it duplicates the number of records sent to GCP Monitoring

defaultCollectorInterval: 59s
collectors:
- name: awx
 userName: admin
 endpoint: http://&lt;Controller_LB_IP&gt;/api/v2/metrics/
 enabled: true
 metrics:
 - name: awx_inventories_total
   # interval on which the metric must be pushed to gcp
   sendInterval: 59s
- name: podman
 endpoint: http://localhost:9882/podman/metrics
 enabled: true

# list of metrics to exclude
#  excludedMetrics:
#  - podman_container_created_seconds

 metrics:
 - name: podman_container_exit_code
   # interval on which the metric must be pushed to gcp
   sendInterval: 59s</pre><p class="Role ARG Spec Role ARG Spec">
					where <code class="literal Role ARG Spec">collectors</code> is a configuration array with one item per collector, that is, <code class="literal Role ARG Spec">awx</code> and podman.
				</p><p class="Role ARG Spec Role ARG Spec">
					The awx collector requires authentication and so <code class="literal Role ARG Spec">userName</code> must be set to <code class="literal Role ARG Spec">admin</code>. The password is retrieved from the secret-manager.
				</p><p class="Role ARG Spec Role ARG Spec">
					The endpoint should not be changed.
				</p><p class="Role ARG Spec Role ARG Spec">
					<code class="literal Role ARG Spec">defaultCollectorInterval</code> specifies the default interval at which the exporter collects the information from the metric end-point and sends it to Google Cloud Platform Monitoring.
				</p><p class="Role ARG Spec Role ARG Spec">
					Setting this value to <code class="literal Role ARG Spec">0</code> or omitting this attribute disables all collectors.
				</p><p class="Role ARG Spec Role ARG Spec">
					Each collector can be enabled or disabled separately by setting <code class="literal Role ARG Spec">enabled</code> to <code class="literal Role ARG Spec">true</code> or <code class="literal Role ARG Spec">false</code>.
				</p><p class="Role ARG Spec Role ARG Spec">
					A collector returns all available metrics grouped by families, but you can exclude the families that should not be sent to Google Cloud Platform Monitoring by adding their name in the array <code class="literal Role ARG Spec">excludedMetrics</code>.
				</p><p class="Role ARG Spec Role ARG Spec">
					For all other family metrics, you can specify the interval at which you want to collect and send them to the Google Cloud Platform Monitoring. The collector interval is the minimum between all family metrics interval and the <code class="literal Role ARG Spec">defaultCollectorInterval</code>. This to ensure that a collection is made for each set of metrics sent to Google Cloud Platform Monitoring.
				</p></section><section class="section Role ARG Spec" id="ref-gcp-configure-google-cloud-ops-agent"><div class="titlepage"><div><div><h3 class="title">9.2.2. Google cloud ops agent configuration</h3></div></div></div><p class="Role ARG Spec Role ARG Spec">
					The configuration file details can be found <a class="link mimir-link-warn" href="https://cloud.google.com/stackdriver/docs/solutions/agents/ops-agent/configuration" title="Mimir does not include content from: cloud.google.com">here</a>.
				</p><p class="Role ARG Spec Role ARG Spec">
					The configuration file is located in <code class="literal Role ARG Spec">/etc/google-cloud-ops-agent/config.yml</code>.
				</p><p class="Role ARG Spec Role ARG Spec">
					This is a symbolic link to the shared disk <code class="literal Role ARG Spec">/aap/bootstrap/config_file_templates/controller/gcp-ops-agent-config.yml</code> or <code class="literal Role ARG Spec">/aap/bootstrap/config_file_templates/hub/gcp-ops-agent-config.yml</code> depending on the component type.
				</p><p class="Role ARG Spec Role ARG Spec">
					The configuration file contains a number of receivers specifying what should be collected by the ops agent.
				</p><p class="Role ARG Spec Role ARG Spec">
					Your selection of <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Connect Logging</span></strong></span> and <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Connect Metrics</span></strong></span> during deployment determines which pipelines are included in the file and therefore which logs and metrics are collected and sent to GCP.
				</p><p class="Role ARG Spec Role ARG Spec">
					If you need to add more pipelines post-deployment, you can insert them in <code class="literal Role ARG Spec">/aap/bootstrap/config_file_templates/hub|controller/gcp-ops-agent-config.yml</code>.
				</p><p class="Role ARG Spec Role ARG Spec">
					A crontab job restarts the agent if <code class="literal Role ARG Spec">gcp-ops-agent-config.yml</code> changed in the last 10 minutes. The agent rereads its configuration after a restart.
				</p></section></section></section><section class="chapter Role ARG Spec" id="assembly-aap-gcp-backup-and-recovery"><div class="titlepage"><div><div><h1 class="title">Chapter 10. Backup and Restore</h1></div></div></div><div class="admonition important Role ARG Spec"><div class="admonition_header">Important</div><div><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
						You must restore with the same operational image version as the backup.
					</li><li class="listitem">
						To backup and restore your Ansible Automation Platform deployment, it is vital to have your existing Ansible Automation Platform administration secret name and value recorded somewhere safe.
					</li><li class="listitem">
						It is also important to take regular manual backups of the Cloud SQL database instance and filestore backups, to ensure a deployment can be restored as close as possible to its previous working state.
					</li></ul></div></div></div><p class="Role ARG Spec Role ARG Spec">
			The playbooks backup and restore provides backup and restore support for the Ansible Automation Platform from GCP Marketplace foundation deployment.
		</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
				The restore process deploys a new Ansible Automation Platform with the filestore and SQL database instance being restored to the specified backup.
			</p></div></div><section class="section Role ARG Spec" id="con-gcp-backup-process"><div class="titlepage"><div><div><h2 class="title">10.1. The Backup Process</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				A backup enables you to backup your environment by saving the database and the shared file system. A new environment is created during the restore using the saved shared file system. When the new environment is in place, the process restores the database.
			</p><p class="Role ARG Spec Role ARG Spec">
				The backup and restore process must use the same version. If you performed the backup with an earlier version, you must use the restore process of that version. Then, if required, you can run an upgrade.
			</p><p class="Role ARG Spec Role ARG Spec">
				You must also make a backup before an upgrade. For further information, read <a class="link" href="#assembly-gcp-upgrade" title="Chapter 11. Upgrading">Upgrading your deployment</a>
			</p><p class="Role ARG Spec Role ARG Spec">
				The backup process involves taking a backup of the Cloud SQL database and filestore instances at a given point in time. The backup playbook requires an active Ansible Automation Platform from GCP Marketplace foundation deployment to be running.
			</p><p class="Role ARG Spec Role ARG Spec">
				A bucket needs to be created in your project as restore information will be stored in that bucket.
			</p><p class="Role ARG Spec Role ARG Spec">
				The bucket can contain multiple backups from the same deployment or different ones. A backup will generate a directory named &lt;prefix&gt;-&lt;deployment_name&gt;-&lt;timestamp&gt; and a file named &lt;prefix&gt;-&lt;deployment_name&gt;-&lt;timestamp&gt;.json. The directory contains the awx and pulp databases backup, the deployment configuration and the secrets. The json file contains information for the restore procedure.
			</p><p class="Role ARG Spec Role ARG Spec">
				Playbooks are provided through the CLI to list and delete backups.
			</p><p class="Role ARG Spec Role ARG Spec">
				The following procedures describe how to backup the Ansible Automation Platform from GCP Marketplace deployment.
			</p><section class="section Role ARG Spec" id="pulling_the_ansible_on_clouds_ops_container_image"><div class="titlepage"><div><div><h3 class="title">10.1.1. Pulling the ansible-on-clouds-ops container image</h3></div></div></div><div class="itemizedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem"><p class="simpara">
							Pull the docker image for the <code class="literal Role ARG Spec">ansible-on-clouds-ops</code> container with the same tag as the foundation deployment. If you are unsure of the version you have deployed, see <a class="link" href="#ref-aap-using-playbooks" title="7.6. Using the playbooks">Command Generator</a> and playbook <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">gcp_get_aoc_version</span></strong></span> for more information on finding the current version of Ansible on Clouds deployment.
						</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
								Before pulling the docker image, ensure you are logged in to registry.redhat.io using docker. Use the following command to login to registry.redhat.io.
							</p><pre class="literallayout Role ARG Spec">$ docker login registry.redhat.io</pre><p class="Role ARG Spec Role ARG Spec">
								For more information about registry login, see <a class="link mimir-link-warn" href="https://access.redhat.com/RegistryAuthentication" title="This content is not included in Mimir.">Registry Authentication</a>
							</p></div></div><pre class="literallayout Role ARG Spec">$ export IMAGE=registry.redhat.io/ansible-on-clouds/ansible-on-clouds-ops-rhel9:2.4.20240215
$ docker pull $IMAGE --platform=linux/amd64</pre></li></ul></div><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
						If your foundation deployment version is not 2.4.20240215-00, refer to the tables on the <a class="link" href="/documentation/en-us/ansible_on_clouds/2.x/html-single/red_hat_ansible_automation_platform_from_gcp_release_notes/index/#assembly-gcp-release-notes-24">Released versions</a> page for a matching deployment version, in the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Ansible on Clouds version</span></strong></span> column. Find the corresponding operational image to use, in the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Ansible-on-clouds-ops container image</span></strong></span> column, for the IMAGE environment variable.
					</p></div></div></section><section class="section Role ARG Spec" id="ref-gcp-iam-backup-minimum-permissions"><div class="titlepage"><div><div><h3 class="title">10.1.2. Required permissions</h3></div></div></div><p class="Role ARG Spec Role ARG Spec">
					You must have the following GCP IAM permissions to backup the stack:
				</p><pre class="literallayout Role ARG Spec">required-roles:

Service Account User
Compute Instance Admin (v1)
required-permissions:

compute.instances.list
deploymentmanager.deployments.get
deploymentmanager.manifests.get
deploymentmanager.manifests.list
deploymentmanager.resources.list
file.backups.create
file.operations.get
iap.tunnelInstances.accessViaIAP
storage.objects.create
storage.objects.list</pre></section><section class="section Role ARG Spec" id="proc-gcp-setup-environment_backup"><div class="titlepage"><div><div><h3 class="title">10.1.3. Setting up the environment</h3></div></div></div><div class="itemizedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem"><p class="simpara">
							Create a folder to hold the configuration files.
						</p><pre class="literallayout Role ARG Spec">$ mkdir command_generator_data</pre></li></ul></div></section><section class="section Role ARG Spec" id="proc-gcp-backup-requirements"><div class="titlepage"><div><div><h3 class="title">10.1.4. Backup requirements</h3></div></div></div><p class="Role ARG Spec Role ARG Spec">
					You must create a bucket to store the Ansible on Clouds deployment backup. The bucket contains the backup information, the secrets and the databases backups.
				</p><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem">
							In the Google Cloud console, navigate to <span class="guimenu">Cloud Storage</span> → <span class="guimenuitem">Buckets</span>
						</li><li class="listitem">
							Choose the project.
						</li><li class="listitem">
							Click <span class="guibutton">Create</span>.
						</li><li class="listitem">
							Enter a name.
						</li><li class="listitem">
							Enter the data location that fits the most your requirements. Multi and Dual regions enable you to run a restore to another region.
						</li><li class="listitem">
							Enter the storage class that fits the most your requirements.
						</li><li class="listitem">
							Enter the control access that fits the most your requirements.
						</li><li class="listitem">
							Enter the data protection that fits the most your requirements.
						</li><li class="listitem">
							Click <span class="guibutton">Create</span>
						</li></ol></div><div class="Role ARG Spec Role ARG Spec"><p class="title"><strong>Troubleshooting</strong></p><p>
						An error is raised if the bucket name is already used in another project.
					</p></div></section><section class="section Role ARG Spec" id="proc-gcp-create-data-file"><div class="titlepage"><div><div><h3 class="title">10.1.5. Creating the backup data file</h3></div></div></div><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem"><p class="simpara">
							Run the command generator <code class="literal Role ARG Spec">command_generator_vars</code> to generate the <code class="literal Role ARG Spec">backup.yml</code>.
						</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
								On Linux, any file or directory created by the command generator is owned by <code class="literal Role ARG Spec">root:root</code> by default. To change the ownership of the files and directories, you can run the <code class="literal Role ARG Spec">sudo chmod</code> command after the files are created. For more information, read <a class="link" href="#con-tech-note-linux-files-owned-by-root" title="13.2. Command generator - Linux files owned by root">Command generator - Linux files owned by root</a>.
							</p></div></div><pre class="literallayout Role ARG Spec">docker run --rm -v $(pwd)/command_generator_data/:/data $IMAGE command_generator_vars gcp_backup_deployment --output-data-file /data/backup.yml</pre></li><li class="listitem"><p class="simpara">
							After running the command, a <code class="literal Role ARG Spec">$(pwd)/command_generator_data/backup.yml</code> template file is created. This template file resembles the following:
						</p><pre class="literallayout Role ARG Spec">gcp_backup_deployment:
  cloud_credentials_path:
  deployment_name:
  extra_vars:
    backup_prefix: aoc-backup
    gcp_bucket_backup_name:
    gcp_compute_region:
    gcp_compute_zone:</pre></li></ol></div></section><section class="section Role ARG Spec" id="ref-gcp-populate-backup-file"><div class="titlepage"><div><div><h3 class="title">10.1.6. Parameters in the backup.yml file</h3></div></div></div><p class="Role ARG Spec Role ARG Spec">
					You must populate the data file before triggering the backup. The following variables are parameters listed in the data file.
				</p><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
							<code class="literal Role ARG Spec">cloud_credentials_path</code> is the path for your Google Cloud service account credentials file. This must be an absolute path.
						</li><li class="listitem">
							<code class="literal Role ARG Spec">deployment_name</code> is the name of the AAP deployment manager deployment you want to back up.
						</li><li class="listitem">
							<code class="literal Role ARG Spec">backup_prefix</code> is a prefix you would like to add to the backup name (default: aoc-backup)
						</li><li class="listitem">
							<code class="literal Role ARG Spec">gcp_bucket_backup_name</code> is the bucket that was previously created to use for the backup.
						</li><li class="listitem">
							<code class="literal Role ARG Spec">gcp_compute_region</code> is GCP region where the foundation deployment is deployed. This can be retrieved by checking the Deployments config in Deployment Manager.
						</li><li class="listitem">
							<code class="literal Role ARG Spec">gcp_compute_zone</code> is the GCP zone where the foundation deployment is deployed. This can be retrieved by checking the Deployments config in Deployment Manager.
						</li></ul></div></section><section class="section Role ARG Spec" id="proc-gcp-run-backup-playbook"><div class="titlepage"><div><div><h3 class="title">10.1.7. Running the backup playbook</h3></div></div></div><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem"><p class="simpara">
							To run the backup, run the command generator to generate the backup command.
						</p><pre class="literallayout Role ARG Spec">docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE command_generator gcp_backup_deployment --data-file /data/backup.yml</pre><p class="Role ARG Spec Role ARG Spec">
							Resulting in the following ouput:
						</p><pre class="literallayout Role ARG Spec">-----------------------------------------------
Command to run playbook:

docker run --rm --env PLATFORM=GCP -v  &lt;/path/to/gcp/service-account.json&gt;:/home/runner/.gcp/credentials:ro \
--env ANSIBLE_CONFIG=../gcp-ansible.cfg --env DEPLOYMENT_NAME=&lt;deployment_name --env GENERATE_INVENTORY=true  \
$IMAGE redhat.ansible_on_clouds.gcp_backup_deployment \
-e 'gcp_service_account_credentials_json_path=/home/runner/.gcp/credentials  \
gcp_deployment_name=&lt;deployment_name&gt; gcp_compute_region=&lt;region&gt; gcp_compute_zone=&lt;zone&gt; \
gcp_bucket_backup_name=&lt;bucket&gt; backup_prefix=aoc-backup'</pre></li><li class="listitem"><p class="simpara">
							Run the supplied backup command to trigger the backup.
						</p><pre class="literallayout Role ARG Spec">$ docker run --rm --env PLATFORM=GCP -v  &lt;/path/to/gcp/service-account.json&gt;:/home/runner/.gcp/credentials:ro \
--env ANSIBLE_CONFIG=../gcp-ansible.cfg --env DEPLOYMENT_NAME=&lt;deployment_name --env GENERATE_INVENTORY=true  \
$IMAGE redhat.ansible_on_clouds.gcp_backup_deployment \
-e 'gcp_service_account_credentials_json_path=/home/runner/.gcp/credentials  \
gcp_deployment_name=&lt;deployment_name&gt; gcp_compute_region=&lt;region&gt; gcp_compute_zone=&lt;zone&gt; \
gcp_bucket_backup_name=&lt;bucket&gt; backup_prefix=aoc-backup'</pre></li><li class="listitem"><p class="simpara">
							When the playbook has finished running, the output resembles the following:
						</p><pre class="literallayout Role ARG Spec">TASK [redhat.ansible_on_clouds.standalone_gcp_backup : [backup_deployment] Print the variable required to restore deployment my-deployment] ***
ok: [localhost] =&gt; {
    "msg": [
        "AAP on GCP Backup successful. Please note below the bucket name and backup name which are required for restore process.",
        "gcp_bucket_backup_name: my-bucket",
        "backup_name: aoc-backup-my-deployment-20230616T134002"
    ]
}

PLAY RECAP *********************************************************************
localhost                  : ok=38   changed=6    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0</pre></li></ol></div></section><section class="section Role ARG Spec" id="proc-gcp-listing-backups-playbook"><div class="titlepage"><div><div><h3 class="title">10.1.8. List backups</h3></div></div></div><p class="Role ARG Spec Role ARG Spec">
					This playbook enables you to list the existing backups in a specific bucket.
				</p><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem"><p class="simpara">
							Populate the <code class="literal Role ARG Spec">command_generator_data</code> directory with the configuration file template.
						</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
								On Linux, any file or directory created by the command generator is owned by <code class="literal Role ARG Spec">root:root</code> by default. To change the ownership of the files and directories, you can run the <code class="literal Role ARG Spec">sudo chmod</code> command after the files are created. For more information, read <a class="link" href="#con-tech-note-linux-files-owned-by-root" title="13.2. Command generator - Linux files owned by root">technical notes</a>.
							</p></div></div><pre class="literallayout Role ARG Spec">docker run --rm -v $(pwd)/command_generator_data/:/data $IMAGE command_generator_vars gcp_backup_list --output-data-file /data/backups_list.yml</pre></li><li class="listitem"><p class="simpara">
							After running the command, a <code class="literal Role ARG Spec">$(pwd)/command_generator_data/backups_list.yml</code> template file is created. This template file resembles the following:
						</p><pre class="literallayout Role ARG Spec">gcp_backup_list:
  cloud_credentials_path:
  extra_vars:
    gcp_bucket_backup_name:</pre></li><li class="listitem"><p class="simpara">
							To run the backup, run the command generator to generate the backup command.
						</p><pre class="literallayout Role ARG Spec">docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE command_generator gcp_backup_list --data-file /data/backups_list.yml</pre><p class="Role ARG Spec Role ARG Spec">
							Resulting in the following ouput:
						</p><pre class="literallayout Role ARG Spec">-----------------------------------------------
Command to run playbook:

docker run --rm --env PLATFORM=GCP -v &lt;/path/to/gcp/service-account.json&gt;:/home/runner/.gcp/credentials:ro \
--env ANSIBLE_CONFIG=../gcp-ansible.cfg  $IMAGE redhat.ansible_on_clouds.gcp_backup_list \
-e 'gcp_service_account_credentials_json_path=/home/runner/.gcp/credentials  gcp_bucket_backup_name=&lt;bucket&gt;'</pre></li><li class="listitem">
							Run the supplied backup command to trigger the list of backups.
						</li><li class="listitem"><p class="simpara">
							When the playbook has finished running, the output resembles the following:
						</p><pre class="literallayout Role ARG Spec">TASK [redhat.ansible_on_clouds.standalone_gcp_backup_list : [list_backup] Display list of backups] ***
ok: [localhost] =&gt; {
    "msg": [
        "aoc-backup-deployment1-20230614T203926",
        "aoc-backup-deployment1-20230616T114134",
        "aoc-backup-deployment1-20230616T134002",
        "aoc-backup-deployment2-20230613T124127"
    ]
}

PLAY RECAP *********************************************************************
localhost                  : ok=11   changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</pre></li></ol></div></section><section class="section Role ARG Spec" id="proc-gcp-deleting-backups-playbook"><div class="titlepage"><div><div><h3 class="title">10.1.9. Delete backups</h3></div></div></div><p class="Role ARG Spec Role ARG Spec">
					There are two playbooks to delete backups:
				</p><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
							Use the <code class="literal Role ARG Spec">gcp_backup_delete</code> playbook which deletes a single backup.
						</li><li class="listitem">
							Use the <code class="literal Role ARG Spec">gcp_backups_delete</code> playbook which deletes multiple backups at once.
						</li></ul></div><p class="Role ARG Spec Role ARG Spec">
					<code class="literal Role ARG Spec">gcp_backups_delete</code> takes a array of strings ["backup1","backup2",…​], while <code class="literal Role ARG Spec">gcp_backup_delete</code> takes only one string, that being the name of a specific backup, "backup1".
				</p><p class="Role ARG Spec Role ARG Spec">
					The use of <code class="literal Role ARG Spec">gcp_backups_delete</code> is described in this section.
				</p><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem"><p class="simpara">
							Populate the <code class="literal Role ARG Spec">command_generator_data</code> directory with the configuration file template.
						</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
								On Linux, any file or directory created by the command generator is owned by <code class="literal Role ARG Spec">root:root</code> by default. To change the ownership of the files and directories, you can run the <code class="literal Role ARG Spec">sudo chmod</code> command after the files are created. For more information, read <a class="link" href="#con-tech-note-linux-files-owned-by-root" title="13.2. Command generator - Linux files owned by root">Command generator - Linux files owned by root</a>.
							</p></div></div><pre class="literallayout Role ARG Spec">docker run --rm -v $(pwd)/command_generator_data/:/data $IMAGE command_generator_vars gcp_backups_delete --output-data-file /data/backups_delete.yml</pre></li><li class="listitem"><p class="simpara">
							After running the command, a <code class="literal Role ARG Spec">$(pwd)/command_generator_data/backups_delete.yml</code> template file is created. This template file resembles the following:
						</p><pre class="literallayout Role ARG Spec">gcp_backups_delete:
  cloud_credentials_path:
  extra_vars:
    backup_names:
    delete:
    gcp_bucket_backup_name:</pre></li></ol></div><p class="Role ARG Spec Role ARG Spec">
					The <code class="literal Role ARG Spec">backup_names</code> parameter must specify an array of strings, for example, <code class="literal Role ARG Spec">["backup1","backup2"]</code>. The <code class="literal Role ARG Spec">delete</code> parameter must be set to <code class="literal Role ARG Spec">true</code> to successfully delete.
				</p><div class="orderedlist Role ARG Spec"><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem"><p class="simpara">
							To delete the backups, run the command generator to generate the <code class="literal Role ARG Spec">gcp_backups_delete`</code> command.
						</p><pre class="literallayout Role ARG Spec">docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE command_generator gcp_backups_delete --data-file /data/backups_delete.yml</pre><p class="Role ARG Spec Role ARG Spec">
							Resulting in the following ouput:
						</p><pre class="literallayout Role ARG Spec">-----------------------------------------------
Command to run playbook:

docker run --rm --env PLATFORM=GCP -v &lt;/path/to/gcp/service-account.json&gt;:/home/runner/.gcp/credentials:ro \
--env ANSIBLE_CONFIG=../gcp-ansible.cfg  $IMAGE redhat.ansible_on_clouds.gcp_backups_delete \
-e 'gcp_service_account_credentials_json_path=/home/runner/.gcp/credentials  gcp_bucket_backup_name=&lt;bucket&gt; \
backup_names=&lt;backup_names&gt; delete=True'</pre></li><li class="listitem">
							Run the supplied backup command to delete the backups.
						</li><li class="listitem"><p class="simpara">
							When the playbook has finished running, the output resembles the following:
						</p><pre class="literallayout Role ARG Spec">TASK [redhat.ansible_on_clouds.standalone_gcp_backup_delete : [delete_backup] Dry-run message] ***
skipping: [localhost]

PLAY RECAP *********************************************************************
localhost                  : ok=23   changed=2    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0</pre></li></ol></div></section><section class="section Role ARG Spec" id="proc-gcp-deleting-backups-troubleshooting-playbook"><div class="titlepage"><div><div><h3 class="title">10.1.10. Fixing a failed backup deletion</h3></div></div></div><p class="Role ARG Spec Role ARG Spec">
					If the deletion of a backup failed, take the following actions:
				</p><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem">
							Navigate to the bucket containing the backup.
						</li><li class="listitem">
							Locate the directory that has the name of the backup.
						</li><li class="listitem">
							Open the backup directory.
						</li><li class="listitem">
							Delete the directory with the name of the backup.
						</li><li class="listitem">
							Delete the file with the backup name with <code class="literal Role ARG Spec">.json</code> as extension.
						</li><li class="listitem">
							Navigate to <span class="guimenu">Filestore</span> → <span class="guimenuitem">Backup</span>.
						</li><li class="listitem">
							Delete the Filestore backup with the same name as the backup.
						</li></ol></div></section></section><section class="section Role ARG Spec" id="con-gcp-restore-process"><div class="titlepage"><div><div><h2 class="title">10.2. Restore Process</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				The restore process creates a new deployment, and restores the filestore and SQL database instance to the specified backup.
			</p><div class="admonition important Role ARG Spec"><div class="admonition_header">Important</div><div><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
							You must restore with the same operational image version which was used for the backup.
						</li></ul></div></div></div><p class="Role ARG Spec Role ARG Spec">
				The following procedures describe how to restore the Ansible Automation Platform from GCP Marketplace deployment.
			</p><section class="section Role ARG Spec" id="proc-gcp-restore-pull-container-image_restore"><div class="titlepage"><div><div><h3 class="title">10.2.1. Pulling the ansible-on-clouds-ops container image</h3></div></div></div><div class="itemizedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem"><p class="simpara">
							Pull the docker image for the <code class="literal Role ARG Spec">ansible-on-clouds-ops</code> container with the same tag as the backup was created with. If you are unsure of the version backed up, you can look in the backup json file for the key <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">restore_properties.aoc_version</span></strong></span>.
						</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
								Before pulling the docker image, ensure you are logged in to registry.redhat.io using docker. Use the following command to login to registry.redhat.io.
							</p><pre class="literallayout Role ARG Spec">$ docker login registry.redhat.io</pre><p class="Role ARG Spec Role ARG Spec">
								For more information about registry login, see <a class="link mimir-link-warn" href="https://access.redhat.com/RegistryAuthentication" title="This content is not included in Mimir.">Registry Authentication</a>
							</p></div></div><pre class="literallayout Role ARG Spec">$ export IMAGE=registry.redhat.io/ansible-on-clouds/ansible-on-clouds-ops-rhel9:2.4.20240215
$ docker pull $IMAGE --platform=linux/amd64</pre></li></ul></div><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
						If your backup version is not 2.4.20240215-00, refer to the tables on the <a class="link" href="/documentation/en-us/ansible_on_clouds/2.x/html-single/red_hat_ansible_automation_platform_from_gcp_release_notes/index/#assembly-gcp-release-notes-24">Released versions</a> page to for a matching version, in the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Ansible on Clouds version</span></strong></span> column. Find the corresponding operational image to use, in the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Ansible-on-clouds-ops container image</span></strong></span> column, for the IMAGE environment variable.
					</p></div></div></section><section class="section Role ARG Spec" id="proc-gcp-setup-environment_restore"><div class="titlepage"><div><div><h3 class="title">10.2.2. Setting up the environment</h3></div></div></div><div class="itemizedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem"><p class="simpara">
							Create a folder to hold the configuration files.
						</p><pre class="literallayout Role ARG Spec">$ mkdir command_generator_data</pre></li></ul></div></section><section class="section Role ARG Spec" id="ref-aws-iam-restore-minimum-permissions"><div class="titlepage"><div><div><h3 class="title">10.2.3. Required permissions</h3></div></div></div><p class="Role ARG Spec Role ARG Spec">
					You must have the following GCP IAM permissions to restore the stack:
				</p><pre class="literallayout Role ARG Spec">required-roles:

Cloud SQL Client
Cloud SQL Instance User
Compute Instance Admin (v1)
Compute Network Admin
Editor
Logs Writer
Secret Manager Secret Accessor
Service Account User
required-permissions:

compute.instances.list
compute.networks.create
deploymentmanager.deployments.create
deploymentmanager.deployments.get
deploymentmanager.operations.get
file.instances.create
file.operations.get
iap.tunnelInstances.accessViaIAP
secretmanager.secrets.create
secretmanager.secrets.delete
secretmanager.secrets.get
secretmanager.secrets.update
secretmanager.versions.add
secretmanager.versions.list
storage.objects.get
storage.objects.list</pre></section><section class="section Role ARG Spec" id="proc-gcp-generate-restore-yml-file"><div class="titlepage"><div><div><h3 class="title">10.2.4. Generating the restore.yml file</h3></div></div></div><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem"><p class="simpara">
							Run the command generator <code class="literal Role ARG Spec">command_generator_vars</code> to generate <code class="literal Role ARG Spec">restore.yml</code>.
						</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
								On Linux, any file or directory created by the command generator is owned by <code class="literal Role ARG Spec">root:root</code> by default. To change the ownership of the files and directories, you can run the <code class="literal Role ARG Spec">sudo chmod</code> command after the files are created. For more information, read <a class="link" href="#con-tech-note-linux-files-owned-by-root" title="13.2. Command generator - Linux files owned by root">technical notes</a>.
							</p></div></div><pre class="literallayout Role ARG Spec">docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE command_generator_vars gcp_restore_deployment --output-data-file /data/restore.yml</pre></li><li class="listitem"><p class="simpara">
							After running the command, a <code class="literal Role ARG Spec">$(pwd)/command_generator_data/restore.yml</code> template file is created. This template file resembles the following:
						</p><pre class="literallayout Role ARG Spec">===============================================
Playbook: gcp_restore_deployment
Description: This playbook is used to restore the Ansible Automation Platform from GCP Marketplace environment from a backup.
-----------------------------------------------
This playbook is used to restore the Ansible Automation Platform from GCP Marketplace environment from a backup.
For more information regarding backup and restore, visit our official documentation -
https://docs.redhat.com/en/documentation/ansible_on_clouds/2.x/html/red_hat_ansible_automation_platform_from_gcp_marketplace_guide/index

-----------------------------------------------
Command generator template:

docker run --rm -v &lt;local_data_file_directory&gt;:/data $IMAGE command_generator gcp_restore_deployment --data-file /data/restore.yml</pre><p class="Role ARG Spec Role ARG Spec">
							The template resembles the following:
						</p><pre class="literallayout Role ARG Spec">gcp_restore_deployment:
  cloud_credentials_path:
  deployment_name:
  extra_vars:
    backup_name:
    gcp_bucket_backup_name:
    gcp_cloud_sql_peering_network:
    gcp_compute_region:
    gcp_compute_zone:
    gcp_controller_internal_ip_address:
    gcp_existing_vpc:
    gcp_filestore_ip_range:
    gcp_hub_internal_ip_address:</pre></li></ol></div></section><section class="section Role ARG Spec" id="ref-gcp-populate-restore-file"><div class="titlepage"><div><div><h3 class="title">10.2.5. Parameters of the restore.yml file</h3></div></div></div><p class="Role ARG Spec Role ARG Spec">
					You can only restore into a new VPC network.
				</p><div class="Role ARG Spec Role ARG Spec"><p class="title"><strong>For a new VPC</strong></p><p>
						If you want to restore using a new VPC set the following parameters:
					</p></div><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
							<code class="literal Role ARG Spec">gcp_existing_vpc</code> must be set to <code class="literal Role ARG Spec">false</code>.
						</li></ul></div><p class="Role ARG Spec Role ARG Spec">
					The following parameters must be removed:
				</p><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
							<code class="literal Role ARG Spec">gcp_filestore_ip_range</code>
						</li><li class="listitem">
							<code class="literal Role ARG Spec">gcp_cloud_sql_peering_network</code>
						</li><li class="listitem">
							<code class="literal Role ARG Spec">gcp_controller_internal_ip_address</code>
						</li><li class="listitem">
							<code class="literal Role ARG Spec">gcp_hub_internal_ip_address</code>
						</li></ul></div><p class="Role ARG Spec Role ARG Spec">
					Provide values for the following parameters:
				</p><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
							<code class="literal Role ARG Spec">gcp_existing_vpc</code> must be set to <code class="literal Role ARG Spec">false</code>.
						</li><li class="listitem">
							<code class="literal Role ARG Spec">cloud_credentials_path</code> is the path for your Google Cloud service account credentials file.
						</li><li class="listitem">
							<code class="literal Role ARG Spec">deployment_name</code> is the name under which the deployment must be restored. A new deployment will be created with this name. A deployment must not already exist with this name.
						</li><li class="listitem">
							<code class="literal Role ARG Spec">backup_name</code> is the name of the backup in the bucket. This name is displayed while using the <code class="literal Role ARG Spec">gcp_backup_deployment</code> or <code class="literal Role ARG Spec">gcp_backup_list</code> commands.
						</li><li class="listitem">
							<code class="literal Role ARG Spec">gcp_bucket_backup_name</code> is the bucket name you used for the backup.
						</li><li class="listitem">
							<code class="literal Role ARG Spec">gcp_compute_region</code> is the region where the backup was taken. This can be retrieved by checking the Deployments config in Deployment Manager.
						</li><li class="listitem">
							<code class="literal Role ARG Spec">gcp_compute_zone</code> is the zone where the backup was taken. This can be retrieved by checking the Deployments config in Deployment Manager.
						</li></ul></div><div class="Role ARG Spec Role ARG Spec"><p class="title"><strong>For an existing VPC</strong></p><p>
						If you want to restore using an existing VPC, you must set the parameters shown above.
					</p></div><p class="Role ARG Spec Role ARG Spec">
					You must also set the following additional parameters:
				</p><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
							<code class="literal Role ARG Spec">gcp_existing_vpc</code> is set to <code class="literal Role ARG Spec">true</code>.
						</li><li class="listitem">
							<code class="literal Role ARG Spec">gcp_filestore_ip_range</code> must be set to a free ip/29 range of your VPC. For example: 192.168.245.0/29. You must not use 192.168.243.0/29 as this the default used when deploying Ansible Automation Platform from GCP Marketplace.
						</li><li class="listitem">
							<code class="literal Role ARG Spec">gcp_cloud_sql_peering_network</code> must be set to a free <code class="literal Role ARG Spec">/24</code> subnet. You must not use 192.168.241.0/24 as this is used during the original deployment.
						</li><li class="listitem">
							<code class="literal Role ARG Spec">gcp_controller_internal_ip_address</code> must be set to a free IP in your VPC network.
						</li><li class="listitem">
							<code class="literal Role ARG Spec">gcp_hub_internal_ip_address</code> must set to a free IP in your VPC network.
						</li></ul></div></section><section class="section Role ARG Spec" id="ref-gcp-run-restore-command"><div class="titlepage"><div><div><h3 class="title">10.2.6. Running the restore command</h3></div></div></div><p class="Role ARG Spec Role ARG Spec">
					When <code class="literal Role ARG Spec">$(pwd)/command_generator_data/restore.yml</code> is populated, you can use the command generator to create the restore command.
				</p><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem"><p class="simpara">
							Run the command generator.
						</p><pre class="literallayout Role ARG Spec">$ docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE command_generator gcp_restore_deployment --data-file /data/restore.yml</pre><p class="Role ARG Spec Role ARG Spec">
							This generates a new command containing all needed volumes, environment variables and parameters.
						</p><p class="Role ARG Spec Role ARG Spec">
							The generated command resembles the following:
						</p><pre class="literallayout Role ARG Spec">docker run --rm --env PLATFORM=GCP -v &lt;local_credential_file&gt;:/home/runner/.gcp/credentials:ro \
--env ANSIBLE_CONFIG=../gcp-ansible.cfg --env DEPLOYMENT_NAME=&lt;deployment_name&gt; --env GENERATE_INVENTORY=true -\
-env CHECK_GENERATED_INVENTORY=false  $IMAGE redhat.ansible_on_clouds.gcp_restore_deployment \
-e 'gcp_service_account_credentials_json_path=/home/runner/.gcp/credentials  \
gcp_deployment_name=&lt;deployment_name&gt; gcp_compute_region=&lt;region&gt; gcp_compute_zone=&lt;zone&gt; \
gcp_bucket_backup_name=&lt;bucket&gt; backup_name=&lt;backup_name&gt; gcp_existing_vpc=&lt;existing_vpc&gt;'</pre></li><li class="listitem"><p class="simpara">
							Run the generated command.
						</p><pre class="literallayout Role ARG Spec">$ docker run --rm --env PLATFORM=GCP -v &lt;local_credential_file&gt;:/home/runner/.gcp/credentials:ro \
--env ANSIBLE_CONFIG=../gcp-ansible.cfg  $IMAGE redhat.ansible_on_clouds.gcp_restore_deployment \
-e 'gcp_service_account_credentials_json_path=/home/runner/.gcp/credentials  \
gcp_deployment_name=&lt;former_deployment_name&gt; gcp_restored_deployment_name=&lt;new_deployment_name&gt; \
gcp_compute_region=&lt;region&gt; gcp_compute_zone=&lt;zone&gt; gcp_bucket_backup_name=&lt;bucket&gt; gcp_existing_vpc=False'</pre></li><li class="listitem"><p class="simpara">
							When the playbook has completed, the output resembles the following:
						</p><pre class="literallayout Role ARG Spec">TASK [redhat.ansible_on_clouds.standalone_gcp_restore : Display internal IP addresses] ***
ok: [localhost] =&gt;
  msg:
  - 'Hub        internal IP: 192.168.240.21'
  - 'Controller internal IP: 192.168.240.20'

PLAY RECAP *********************************************************************
localhost                  : ok=33   changed=8    unreachable=0    failed=0    skipped=6    rescued=0    ignored=2</pre></li></ol></div></section><section class="section Role ARG Spec" id="ref-failed-to-restore"><div class="titlepage"><div><div><h3 class="title">10.2.7. Failure to restore</h3></div></div></div><p class="Role ARG Spec Role ARG Spec">
					If a message similar to the following appears during the restore, you must contact support as the restore must be done manually.
				</p><pre class="literallayout Role ARG Spec">TASK [redhat.ansible_on_clouds.standalone_gcp_restore : [restore_deployment] Restore awx db] <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">*</span></strong></span>
fatal: [localhost -&gt; dvernier-restore1-aap-cntrlr-x2c6]: FAILED!</pre></section></section></section><section class="chapter Role ARG Spec" id="assembly-gcp-upgrade"><div class="titlepage"><div><div><h1 class="title">Chapter 11. Upgrading</h1></div></div></div><p class="Role ARG Spec Role ARG Spec">
			You can upgrade your existing Ansible Automation Platform deployment to the newer version. The upgrade process covers upgrading the automation hub, automation controller, and extension nodes. The upgrade process takes roughly the same amount of time as a Ansible Automation Platform deployment install. You are required to create a backup before running the upgrade.
		</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
				Ansible Automation Platform from GCP Marketplace supports sequential upgrades. All upgrades should be no more than one major version behind the version you are currently upgrading to. For example, to upgrade Ansible Automation Platform to 2.4.20240215, you must be on version 2.4.20231024.
			</p><p class="Role ARG Spec Role ARG Spec">
				Logging and monitoring must be disabled before running the upgrade. Follow these <a class="link" href="/documentation/en-us/ansible_on_clouds/2.3/html-single/red_hat_ansible_automation_platform_from_gcp_marketplace_guide/index/#con-gcp-setup-after-deployment">instructions</a> to toggle off monitoring and logging for your current version before beginning the upgrade.
			</p><p class="Role ARG Spec Role ARG Spec">
				When the upgrade has completed, logging and monitoring can be reenabled by following these <a class="link" href="#con-gcp-setup-after-deployment" title="9.1. Setting up monitoring and logging after deployment">instructions</a>.
			</p></div></div><div class="itemizedlist Role ARG Spec"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
					Docker must be installed to run the upgrade playbook.
				</li><li class="listitem">
					A Linux or macOS system, where the <code class="literal Role ARG Spec">ansible-on-clouds-ops</code> container image will run.
				</li><li class="listitem">
					The upgrade process requires several volumes to be mounted. Prepare a fresh directory to be used for this process.
				</li></ul></div><p class="Role ARG Spec Role ARG Spec">
			The following procedures form the upgrade process:
		</p><div class="orderedlist Role ARG Spec"><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem"><p class="simpara">
					Backup your Ansible Automation Platform stack.
				</p><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
							Follow the <a class="link" href="#con-gcp-backup-process" title="10.1. The Backup Process">Ansible on Clouds backup instructions</a>.
						</li></ul></div></li><li class="listitem"><p class="simpara">
					Upgrade Ansible Automation Platform
				</p><div class="orderedlist Role ARG Spec"><ol class="orderedlist Role ARG Spec" type="a"><li class="listitem">
							Pull the next sequential ansible-on-clouds-ops version container image
						</li><li class="listitem">
							Ensure minimum required permissions are met
						</li><li class="listitem">
							Generate the data file
						</li><li class="listitem">
							Update the data file
						</li><li class="listitem">
							Begin upgrading Ansible Automation Platform by running the operational container
						</li></ol></div></li><li class="listitem"><p class="simpara">
					(Optional) Restore the stack from a backup.
				</p><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
							Follow the <a class="link" href="#con-gcp-restore-process" title="10.2. Restore Process">Ansible on Clouds restore instructions</a>.
						</li></ul></div></li></ol></div><section class="section Role ARG Spec" id="con-gcp-upgrade-backup-process"><div class="titlepage"><div><div><h2 class="title">11.1. Backup before upgrade</h2></div></div></div><div class="admonition important Role ARG Spec"><div class="admonition_header">Important</div><div><p class="Role ARG Spec Role ARG Spec">
					Before starting the upgrade of your Ansible Automation Platform environment, you must first take a backup of your environment at its current version.
				</p><p class="Role ARG Spec Role ARG Spec">
					To backup your Ansible Automation Platform environment at the earlier version, follow the <a class="link" href="#con-gcp-backup-process" title="10.1. The Backup Process">Ansible on Clouds backup instructions</a>.
				</p></div></div></section><section class="section Role ARG Spec" id="con-gcp-upgrade-upgrading"><div class="titlepage"><div><div><h2 class="title">11.2. Upgrade Ansible Automation Platform</h2></div></div></div><section class="section Role ARG Spec" id="proc-gcp-upgrade-pull-container-image"><div class="titlepage"><div><div><h3 class="title">11.2.1. Pulling the ansible-on-clouds-ops container image</h3></div></div></div><div class="itemizedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem"><p class="simpara">
							Pull the Docker image for Ansible on Clouds operational container with the tag based on the version you want to upgrade to. If you are unsure of the version you have deployed and the one you need to upgrade to, see <a class="link" href="#ref-aap-using-playbooks" title="7.6. Using the playbooks">Command Generator</a> and playbook <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">gcp_get_aoc_version</span></strong></span> for more information on finding the current version of Ansible on Clouds deployment and the version to upgrade to.
						</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
								Before pulling the docker image, ensure you are logged in to registry.redhat.io using docker. Use the following command to login to registry.redhat.io.
							</p><pre class="literallayout Role ARG Spec">$ docker login registry.redhat.io</pre><p class="Role ARG Spec Role ARG Spec">
								For more information about registry login, see <a class="link mimir-link-warn" href="https://access.redhat.com/RegistryAuthentication" title="This content is not included in Mimir.">Registry Authentication</a>
							</p></div></div><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
								The Ansible on Clouds operational image tag must match the version that you want to upgrade to. For example, if your foundation deployment version is 2.4.20231024, pull the operational image with tag 2.4.20240215 to upgrade to version 2.4.20240215.
							</p></div></div><pre class="literallayout Role ARG Spec">$ export IMAGE=registry.redhat.io/ansible-on-clouds/ansible-on-clouds-ops-rhel9:2.4.20240215
$ docker pull $IMAGE --platform=linux/amd64</pre></li></ul></div><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
						If your foundation deployment version is not 2.4.20240215-00, refer to the tables on the <a class="link" href="/documentation/en-us/ansible_on_clouds/2.x/html-single/red_hat_ansible_automation_platform_from_gcp_release_notes/index/#assembly-gcp-release-notes-24">Released versions</a> page for a matching deployment version, in the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Upgrade from version</span></strong></span> column. Find the corresponding operational image to use, in the <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Ansible-on-clouds-ops container image</span></strong></span> column, for the IMAGE environment variable.
					</p></div></div></section><section class="section Role ARG Spec" id="ref-aws-iam-upgrade-minimum-permissions"><div class="titlepage"><div><div><h3 class="title">11.2.2. Required permissions</h3></div></div></div><p class="Role ARG Spec Role ARG Spec">
					You must have the following GCP IAM permissions to upgrade the stack:
				</p><pre class="literallayout Role ARG Spec">required-roles:
  - Service Account User
  - Compute Instance Admin (v1)
required-permissions:
  - compute.healthChecks.update
  - compute.healthChecks.use
  - compute.healthChecks.useReadOnly
  - compute.regionBackendServices.update
  - iap.tunnelInstances.accessViaIAP
  - runtimeconfig.variables.get
  - secretmanager.locations.get
  - secretmanager.locations.list
  - secretmanager.secrets.create
  - secretmanager.secrets.delete
  - secretmanager.secrets.get
  - secretmanager.secrets.list
  - secretmanager.secrets.update
  - secretmanager.versions.access
  - secretmanager.versions.add
  - secretmanager.versions.disable
  - secretmanager.versions.enable
  - secretmanager.versions.get
  - secretmanager.versions.list</pre></section><section class="section Role ARG Spec" id="proc-gcp-generate-upgrade-data-file"><div class="titlepage"><div><div><h3 class="title">11.2.3. Generating the data file</h3></div></div></div><p class="Role ARG Spec Role ARG Spec">
					The commands in this section create a directory and populate it with an empty data template that, when populated, is used during the upgrade.
				</p><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem"><p class="simpara">
							Run the following commands to generate the required data file.
						</p><pre class="literallayout Role ARG Spec"># Create a folder to hold the configuration files
$ mkdir command_generator_data</pre></li><li class="listitem"><p class="simpara">
							Populate the <code class="literal Role ARG Spec">command_generator_data</code> folder with the configuration file template.
						</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
								On Linux, any file or directory created by the command generator is owned by <code class="literal Role ARG Spec">root:root</code> by default. To change the ownership of the files and directories, you can run the <code class="literal Role ARG Spec">sudo chmod</code> command after the files are created. For more information, read <a class="link" href="#con-tech-note-linux-files-owned-by-root" title="13.2. Command generator - Linux files owned by root">Command generator - Linux files owned by root</a>.
							</p></div></div><pre class="literallayout Role ARG Spec">$ docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE \
command_generator_vars gcp_upgrade \
--output-data-file /data/extra_vars.yml</pre></li><li class="listitem"><p class="simpara">
							After running these commands, a <code class="literal Role ARG Spec">command_generator_data/extra_vars.yml</code> template file is created. This template file resembles the following:
						</p><pre class="literallayout Role ARG Spec">gcp_upgrade:
  ansible_config_path:
  cloud_credentials_path:
  deployment_name:
  extra_vars:
    gcp_backup_taken:
    gcp_compute_region:
    gcp_compute_zone:</pre></li></ol></div></section><section class="section Role ARG Spec" id="ref-gcp-update-upgrade-data-file"><div class="titlepage"><div><div><h3 class="title">11.2.4. Updating the data file</h3></div></div></div><p class="Role ARG Spec Role ARG Spec">
					You must populate the data file before triggering the upgrade. Each parameter is required unless it is noted as optional. If the parameter is noted as optional, both its key and value can be removed from the data file.
				</p><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
							<code class="literal Role ARG Spec">ansible_config_path</code> (Optional) Only use if overriding with a custom <code class="literal Role ARG Spec">ansible_config</code>.
						</li><li class="listitem">
							<code class="literal Role ARG Spec">cloud_credentials_path</code> is the path to your GCP credentials file.
						</li><li class="listitem"><p class="simpara">
							<code class="literal Role ARG Spec">deployment_name</code> is the name of the foundation deployment.
						</p><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="circle"><li class="listitem">
									This is the same name you used when you deployed the foundation.
								</li></ul></div></li><li class="listitem">
							<code class="literal Role ARG Spec">gcp_backup_taken</code> is the verification that a manual backup of the current deployment was recently created prior to running this upgrade. Use <code class="literal Role ARG Spec">true</code> here to verify a recent backup was created.
						</li><li class="listitem">
							<code class="literal Role ARG Spec">gcp_compute_region</code> is the GCP region that you provided when deploying foundation deployment. If you have not provided a region when deploying the foundation, use the default region <code class="literal Role ARG Spec">us-east1</code> here.
						</li><li class="listitem">
							<code class="literal Role ARG Spec">gcp_compute_zone</code> is the GCP zone that you provided when deploying foundation deployment. If you have not provided a zone when deploying the foundation, use the default <code class="literal Role ARG Spec">us-east1-b</code> here.
						</li></ul></div><p class="Role ARG Spec Role ARG Spec">
					After populating the data file, it should resemble the following.
				</p><p class="Role ARG Spec Role ARG Spec">
					The following values are provided as examples:
				</p><pre class="literallayout Role ARG Spec">gcp_upgrade:
  ansible_config_path:
  cloud_credentials_path: ~/secrets/GCP-secrets.json
  deployment_name: AnsibleAutomationPlatform
  extra_vars:
    gcp_backup_taken: true
    gcp_compute_region: us-east1
    gcp_compute_zone: us-east1-b</pre></section><section class="section Role ARG Spec" id="proc-gcp-running-upgrade"><div class="titlepage"><div><div><h3 class="title">11.2.5. Running the upgrade playbook</h3></div></div></div><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
						Ansible Automation Platform upgrade to 2.4.20240215 updates the protocol of its internal load balancers. If additional networking configurations were added after installation, they can also require updating to ensure connectivity. For more information, read the <a class="link" href="#tech-note-gcp-upgrade" title="13.3. Upgrade note">Upgrade note</a>.
					</p></div></div><div class="orderedlist Role ARG Spec"><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem"><p class="simpara">
							To run the upgrade, run the command generator to generate the upgrade CLI command:
						</p><pre class="literallayout Role ARG Spec">$ docker run --rm -v $(pwd)/command_generator_data:/data $IMAGE command_generator --data-file /data/extra_vars.yml</pre><p class="Role ARG Spec Role ARG Spec">
							This generates the following command:
						</p><pre class="literallayout Role ARG Spec">-----------------------------------------------
docker run --rm --env PLATFORM=GCP -v ~/secrets/GCP-secrets.json:/home/runner/.gcp/credentials:ro
--env ANSIBLE_CONFIG=../gcp-ansible.cfg
--env DEPLOYMENT_NAME=AnsibleAutomationPlatform
--env GENERATE_INVENTORY=true  $IMAGE redhat.ansible_on_clouds.gcp_upgrade \
-e 'gcp_deployment_name=AnsibleAutomationPlatform \
gcp_service_account_credentials_json_path=/home/runner/.gcp/credentials \
gcp_compute_region=us-east1 gcp_compute_zone=us-east1-b gcp_backup_taken=True'
===============================================</pre></li><li class="listitem"><p class="simpara">
							Run the given upgrade command to trigger the upgrade.
						</p><pre class="literallayout Role ARG Spec">$ docker run --rm --env PLATFORM=GCP -v ~/secrets/GCP-secrets.json:/home/runner/.gcp/credentials:ro \
--env ANSIBLE_CONFIG=../gcp-ansible.cfg \
--env DEPLOYMENT_NAME=AnsibleAutomationPlatform \
--env GENERATE_INVENTORY=true  $IMAGE redhat.ansible_on_clouds.gcp_upgrade \
-e 'gcp_deployment_name=AnsibleAutomationPlatform \
gcp_service_account_credentials_json_path=/home/runner/.gcp/credentials \
gcp_compute_region=us-east1 gcp_compute_zone=us-east1-b gcp_backup_taken=True'</pre></li><li class="listitem"><p class="simpara">
							The upgrade can take some time to complete, but can take longer depending on the number of extension nodes on the system. A successful upgrade is marked by the log below.
						</p><pre class="literallayout Role ARG Spec">TASK [redhat.ansible_on_clouds.standalone_gcp_upgrade : [upgrade] Show GCP current version] ***
ok: [localhost] =&gt; {
    "msg": "gcp_current_version: 2.4.20231024-00"
}</pre></li><li class="listitem">
							Your Ansible Automation Platform from GCP Marketplace deployment is now upgraded to a newer version and you can log in to Red Hat Ansible Automation Platform automation controller and automation hub using your deployment credentials.
						</li></ol></div></section></section><section class="section Role ARG Spec" id="con-gcp-upgrade-restore-from-stack"><div class="titlepage"><div><div><h2 class="title">11.3. Restore from backup</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				If you would like to restore the earlier version of your Ansible Automation Platform environment to the state it was in before the upgrade, follow the <a class="link" href="/documentation/en-us/ansible_on_clouds/2.3/html-single/red_hat_ansible_automation_platform_from_gcp_marketplace_guide/index/#con-gcp-restore-process">Ansible on Clouds 2.3 restore instructions</a>.
			</p></section></section><section class="chapter Role ARG Spec" id="assembly-gcp-uninstall"><div class="titlepage"><div><div><h1 class="title">Chapter 12. Uninstalling</h1></div></div></div><p class="Role ARG Spec Role ARG Spec">
			This chapter explains how to uninstall Ansible Automation Platform.
		</p><section class="section Role ARG Spec" id="proc-gcp-delete-extension-nodes"><div class="titlepage"><div><div><h2 class="title">12.1. Removing extension nodes</h2></div></div></div><div class="admonition important Role ARG Spec"><div class="admonition_header">Important</div><div><p class="Role ARG Spec Role ARG Spec">
					This action cannot be reversed.
				</p></div></div><p class="Role ARG Spec Role ARG Spec">
				Extension nodes are created as deployments in GCP Deployment Mananger. As such, the process to delete an Ansible Automation Platform extension node is the same as the process to delete the main Ansible Automation Platform deployment.
			</p><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem">
						Select the main menu.
					</li><li class="listitem">
						Select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Deployment Manager</span></strong></span>. If you do not see <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Deployment Manager</span></strong></span>, select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">View All Products</span></strong></span>.
					</li><li class="listitem"><p class="simpara">
						Check the checkbox for the extension node you want to delete.
					</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
							Extension nodes and the main deployment are both found in <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Deployment Manager</span></strong></span>. Ensure that you select the extension node and not the main deployment. The name of the extension node was chosen by the person that created it.
						</p></div></div></li><li class="listitem">
						Click <span class="guibutton">Delete</span> in the top bar. This action cannot be reversed.
					</li></ol></div><p class="Role ARG Spec Role ARG Spec">
				The extension node is deleted.
			</p></section><section class="section Role ARG Spec" id="proc-gcp-uninstall-application-uninstall"><div class="titlepage"><div><div><h2 class="title">12.2. Uninstalling Ansible Automation Platform</h2></div></div></div><div class="admonition important Role ARG Spec"><div class="admonition_header">Important</div><div><p class="Role ARG Spec Role ARG Spec">
					This action cannot be reversed.
				</p><p class="Role ARG Spec Role ARG Spec">
					If an external Load Balancer was added for the deployment, it must be deleted before uninstalling the deployment. For more information, see <a class="link mimir-link-warn" href="https://cloud.google.com/load-balancing/docs/https" title="Mimir does not include content from: cloud.google.com">Load Balancers</a>.
				</p><p class="Role ARG Spec Role ARG Spec">
					If extension nodes were added to the deployment, they must also be deleted before uninstalling the deployment. Follow the instructions in <a class="link" href="#proc-gcp-delete-extension-nodes" title="12.1. Removing extension nodes">Removing extension nodes</a>
				</p></div></div><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem">
						Select the main menu from the top left.
					</li><li class="listitem">
						Select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Deployment Manager</span></strong></span>. If you do not see <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Deployment Manager</span></strong></span>, select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">View All Products</span></strong></span>.
					</li><li class="listitem">
						Tick the checkbox in front of the deployment to be deleted.
					</li><li class="listitem">
						Click <span class="guibutton">Delete</span> in the top bar. This action cannot be reversed.
					</li></ol></div><p class="Role ARG Spec Role ARG Spec">
				It can take some time to complete the deletion.
			</p></section><section class="section Role ARG Spec" id="con-gcp-uninstall-postupgrade"><div class="titlepage"><div><div><h2 class="title">12.3. Removing upgrade resources</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				The following procedures describes how to delete any resources left behind after an upgrade.
			</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
					These actions cannot be reversed.
				</p><p class="Role ARG Spec Role ARG Spec">
					You must only perform these actions if your deployment has been deleted.
				</p></div></div><section class="section Role ARG Spec" id="proc-gcp-delete-upgrade-secrets"><div class="titlepage"><div><div><h3 class="title">12.3.1. Removing the secrets</h3></div></div></div><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
						This action cannot be reversed.
					</p><p class="Role ARG Spec Role ARG Spec">
						Only perform this action if your deployment is deleted.
					</p></div></div><p class="Role ARG Spec Role ARG Spec">
					There are several possible secret names you can find, depending on the procedures you have completed:
				</p><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
							<span class="emphasis"><em><span class="Role ARG Spec Role ARG Spec">&lt;deployment_name&gt;</span></em></span>-aap-secret-key
						</li><li class="listitem">
							<span class="emphasis"><em><span class="Role ARG Spec Role ARG Spec">&lt;deployment_name&gt;</span></em></span>-aap-admin
						</li><li class="listitem">
							<span class="emphasis"><em><span class="Role ARG Spec Role ARG Spec">&lt;deployment_name&gt;</span></em></span>-container_auth_private_key_pem
						</li><li class="listitem">
							<span class="emphasis"><em><span class="Role ARG Spec Role ARG Spec">&lt;deployment_name&gt;</span></em></span>-container_auth_public_key_pem
						</li><li class="listitem">
							<span class="emphasis"><em><span class="Role ARG Spec Role ARG Spec">&lt;deployment_name&gt;</span></em></span>-database_fields_symmetric_key
						</li><li class="listitem">
							<span class="emphasis"><em><span class="Role ARG Spec Role ARG Spec">&lt;deployment_name&gt;</span></em></span>-pulp_cert
						</li><li class="listitem">
							<span class="emphasis"><em><span class="Role ARG Spec Role ARG Spec">&lt;deployment_name&gt;</span></em></span>-pulp_key
						</li></ul></div><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem">
							Select the main menu from the top left.
						</li><li class="listitem">
							Select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Security</span></strong></span>. If you do not see <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Security</span></strong></span>, select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">View All Products</span></strong></span>.
						</li><li class="listitem">
							Select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Secret Manager</span></strong></span>.
						</li><li class="listitem">
							Search your deployment name, looking for the names in the list above.
						</li><li class="listitem">
							Click the <span class="guibutton">More Actions</span> icon <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">⋮</span></strong></span> on the line of the deployment.
						</li><li class="listitem">
							Select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Delete</span></strong></span>. The administration password is displayed.
						</li><li class="listitem">
							Enter the name of the secret.
						</li><li class="listitem">
							Click <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Delete Secret</span></strong></span>.
						</li></ol></div></section></section><section class="section Role ARG Spec" id="con-aws-uninstall-postbackups"><div class="titlepage"><div><div><h2 class="title">12.4. Removing backup resources</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				The following procedures describe how to delete any resources left behind when uninstalling your Ansible Automation Platform deployment, after having run a backup on it.
			</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
					These actions cannot be reversed.
				</p><p class="Role ARG Spec Role ARG Spec">
					You must only perform these actions if your deployment has been deleted.
				</p></div></div><section class="section Role ARG Spec" id="proc-gcp-delete-backup-leftovers"><div class="titlepage"><div><div><h3 class="title">12.4.1. Removing the filestore</h3></div></div></div><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
						This action cannot be reversed.
					</p></div></div><div class="orderedlist Role ARG Spec"><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem">
							Procedure
						</li><li class="listitem">
							Select the main menu from the top left.
						</li><li class="listitem">
							Select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Filestore</span></strong></span>. If you do not see <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Filestore</span></strong></span>, select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">View All Products</span></strong></span>.
						</li><li class="listitem">
							Select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Backups</span></strong></span>.
						</li><li class="listitem">
							The format of the backup name is <code class="literal Role ARG Spec">&lt;DeploymentName&gt;-filestore-&lt;RandomSufix&gt;</code>. Filter using this name.
						</li><li class="listitem">
							Click the <span class="guibutton">More Actions</span> icon <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">⋮</span></strong></span> on the line of the deployment.
						</li><li class="listitem">
							Select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Delete</span></strong></span>.
						</li><li class="listitem">
							The administration password is displayed.
						</li><li class="listitem">
							Enter the name of the secret.
						</li><li class="listitem">
							Click <span class="guibutton">Delete Backup</span>.
						</li></ol></div></section><section class="section Role ARG Spec" id="proc-gcp-delete-object-storage"><div class="titlepage"><div><div><h3 class="title">12.4.2. Removing the storage bucket</h3></div></div></div><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem">
							Select the main menu from the top left.
						</li><li class="listitem">
							Select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Cloud Storage</span></strong></span>. If you do not see <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Cloud Storage</span></strong></span>, select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">View All Products</span></strong></span>.
						</li><li class="listitem">
							Select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Buckets</span></strong></span>.
						</li><li class="listitem">
							Search for your deployment name.
						</li><li class="listitem">
							Click the <span class="guibutton">More Actions</span> icon <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">⋮</span></strong></span> on the line of the deployment.
						</li><li class="listitem">
							Select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Delete</span></strong></span>.
						</li><li class="listitem">
							The administration password is displayed.
						</li><li class="listitem">
							Enter the name of the secret.
						</li><li class="listitem">
							Click <span class="guibutton">Delete Secret</span>.
						</li></ol></div></section></section><section class="section Role ARG Spec" id="con-aws-uninstall-other"><div class="titlepage"><div><div><h2 class="title">12.5. Removing remaining resources</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				The following procedures describes how to delete any resources left behind when uninstalling your Ansible Automation Platform deployment.
			</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
					These actions cannot be reversed.
				</p><p class="Role ARG Spec Role ARG Spec">
					You must only perform these actions if your deployment has been deleted.
				</p></div></div><section class="section Role ARG Spec" id="proc-gcp-delete-service-account"><div class="titlepage"><div><div><h3 class="title">12.5.1. Removing the service account</h3></div></div></div><div class="admonition important Role ARG Spec"><div class="admonition_header">Important</div><div><p class="Role ARG Spec Role ARG Spec">
						If a new service account was created for the deployment and if it is not used anywhere else, it can be deleted
					</p></div></div><div class="orderedlist Role ARG Spec"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist Role ARG Spec" type="1"><li class="listitem">
							Select the main menu from the top left.
						</li><li class="listitem">
							Select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">IAM &amp; Admin</span></strong></span>. If you do not see <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">IAM &amp; Admin</span></strong></span>, select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">View All Products</span></strong></span>.
						</li><li class="listitem">
							Select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Service Accounts</span></strong></span>.
						</li><li class="listitem">
							Filter with the name of the service account.
						</li><li class="listitem">
							Click the <span class="guibutton">More Actions</span> icon <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">⋮</span></strong></span> on the line of the service account.
						</li><li class="listitem">
							Select <span class="strong strong"><strong><span class="Role ARG Spec Role ARG Spec">Delete</span></strong></span>.
						</li><li class="listitem">
							The administration password is displayed.
						</li><li class="listitem">
							Click <span class="guibutton">Delete</span>.
						</li></ol></div></section></section></section><section class="chapter Role ARG Spec" id="assembly-gcp-tech-notes"><div class="titlepage"><div><div><h1 class="title">Chapter 13. Technical Notes</h1></div></div></div><p class="Role ARG Spec Role ARG Spec">
			Ansible Automation Platform from GCP Marketplace is a self-managed deployment. The following are technical notes regarding the Ansible Automation Platform from GCP Marketplace deployment.
		</p><section class="section Role ARG Spec" id="tech-note-gcp-upgrade-logging-and-monitoring"><div class="titlepage"><div><div><h2 class="title">13.1. Upgrade - logging and monitoring</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				To ensure a successful upgrade, logging and monitoring must be disabled before running the upgrade. Follow these <a class="link" href="/documentation/en-us/ansible_on_clouds/2.x/html-single/red_hat_ansible_automation_platform_from_gcp_marketplace_guide/index/#con-gcp-setup-after-deployment">instructions</a> to toggle off monitoring and logging for your current version before beginning the upgrade. when the upgrade has completed, logging and monitoring can be reenabled by following these <a class="link" href="#con-gcp-setup-after-deployment" title="9.1. Setting up monitoring and logging after deployment">instructions</a>.
			</p></section><section class="section Role ARG Spec" id="con-tech-note-linux-files-owned-by-root"><div class="titlepage"><div><div><h2 class="title">13.2. Command generator - Linux files owned by root</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				On Linux, any file or directory created by the command generator is owned by <code class="literal Role ARG Spec">root:root</code> by default. To change the ownership of the files and directories, you can run the <code class="literal Role ARG Spec">sudo chmod</code> command after the files are created:
			</p><pre class="literallayout Role ARG Spec"># Change the owner of the command_generator_data directory recursively
$ sudo chown -R $USER:$USER command_generator_data/

# Check the permissions
$ ls -la command_generator_data/</pre><p class="Role ARG Spec Role ARG Spec">
				The command generator currently expects to use the Docker CLI in the <a class="link mimir-link-warn" href="https://docs.docker.com/config/daemon/" title="Mimir does not include content from: docs.docker.com">daemon mode</a>. The default Docker installation does not have User namespace mapping for Discretionary access control (DAC). So, for any file created by <code class="literal Role ARG Spec">root</code> from the container will also be owned by <code class="literal Role ARG Spec">root</code> on the host if the file is located in a shared volume.
			</p><p class="Role ARG Spec Role ARG Spec">
				You can learn more about the Linux namespaces, including the User namespace at the article <a class="link mimir-link-warn" href="https://www.redhat.com/sysadmin/7-linux-namespaces" title="Mimir does not include content from: www.redhat.com">The 7 most used Linux namespaces</a>.
			</p></section><section class="section Role ARG Spec" id="tech-note-gcp-upgrade"><div class="titlepage"><div><div><h2 class="title">13.3. Upgrade note</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				Upgrading Ansible Automation Platform to 2.4.20240215 updates the protocol of its internal load balancers from HTTP to HTTPs. If additional networking configurations were added, they can also be updated to ensure connectivity. When the upgrade has succeeded, you must revalidate any additional added networking configurations.
			</p></section><section class="section Role ARG Spec" id="tech-note-gcp-controller-api"><div class="titlepage"><div><div><h2 class="title">13.4. Ansible Automation Platform Controller API</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				API endpoints for Controller must contain a trailing slash in order for requests to go through. Automatic trailing slash redirects are not supported in this current offering of Ansible Automation Platform from GCP Marketplace. For example a request such as <code class="literal Role ARG Spec">&lt;controller_base_url&gt;/api/v2/metrics</code> times out while <code class="literal Role ARG Spec">&lt;controller_base_url&gt;/api/v2/metrics/</code> goes through.
			</p></section><section class="section Role ARG Spec" id="tech-note-gcp-remove-extension-node"><div class="titlepage"><div><div><h2 class="title">13.5. Remove extension node note</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				When removing extension node using the Ansible-on-Clouds ops playbook, ensure you have provided correct instance group name and instance template name. Incorrect instance group name and instance template name results in some orphan resources.
			</p></section><section class="section Role ARG Spec" id="tech-note-gcp-secrets-update"><div class="titlepage"><div><div><h2 class="title">13.6. Secrets Update</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				When you update any secrets in the GCP secret manager, ensure that the latest secret version is enabled. For example, if you have two secret versions for a <code class="literal Role ARG Spec">&lt;deployment-name&gt;-aap-admin</code> secret, secret version 2 must be enabled, where <code class="literal Role ARG Spec">&lt;deployment-name&gt;</code> is the name of your foundation deployment.
			</p></section></section><section class="chapter Role ARG Spec" id="assembly-gcp-support"><div class="titlepage"><div><div><h1 class="title">Chapter 14. Support</h1></div></div></div><p class="Role ARG Spec Role ARG Spec">
			Ansible Automation Platform from GCP Marketplace is a self-managed deployment. When the application is deployed into your GCP infrastructure, customers are responsible for the maintenance of the GCP infrastructure, OS patching, and Ansible Automation Platform patching.
		</p><p class="Role ARG Spec Role ARG Spec">
			Red Hat does not support changes to the infrastructure resources deployed as part of the solution unless there is documentation by Red Hat describing the process, such as in route table configuration for networking or documented upgrade processes. Adding additional compute resources outside of extension nodes voids Red Hat support for Ansible Automation Platform from GCP Marketplace deployment.
		</p><p class="Role ARG Spec Role ARG Spec">
			Upgrades to Ansible Automation Platform from GCP Marketplace are performed differently from self-installed Ansible Automation Platform. Upgrading individual packages on virtual machines using <code class="literal Role ARG Spec">dnf</code> or other means is also not supported. Instructions will be provided in the upgrade section of this documentation with relevant content for each version, as they become available.
		</p><section class="section Role ARG Spec" id="ref-gcp-supported-changes"><div class="titlepage"><div><div><h2 class="title">14.1. Supported infrastructure configuration changes</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				Red Hat supports changes to the following options:
			</p><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
						VPC Route Configuration
					</li><li class="listitem">
						VPC Firewall Configuration
					</li><li class="listitem">
						VPC Load Balancer Configuration
					</li><li class="listitem">
						Block Storage Expansion
					</li><li class="listitem">
						DNS and <code class="literal Role ARG Spec">resolv.conf</code> files
					</li></ul></div><div class="Role ARG Spec Role ARG Spec"><p class="title"><strong>Red Hat Responsibilities</strong></p><p>
					Red Hat has the following responsibilities:
				</p></div><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
						Premium support for Ansible Automation Platform
					</li><li class="listitem">
						Directions and how-to processes for upgrading Ansible Automation Platform from GCP Marketplace.
					</li><li class="listitem">
						Red Hat supports the current version of Ansible Automation Platform. Bug fixes and CVE patches require an upgrade to the latest version
					</li></ul></div><div class="Role ARG Spec Role ARG Spec"><p class="title"><strong>Customer Responsibilities</strong></p><p>
					You have the following responsibilities:
				</p></div><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
						GCP infrastructure uptime
					</li><li class="listitem">
						GCP infrastructure changes, for example, increasing block storage sizes
					</li><li class="listitem">
						GCP network peering and configuration
					</li><li class="listitem"><p class="simpara">
						Application of Ansible Automation Platform upgrades
					</p><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="circle"><li class="listitem">
								Operating system upgrades are included
							</li></ul></div></li><li class="listitem">
						Backing up GCP resources
					</li></ul></div></section><section class="section Role ARG Spec" id="ref-gcp-vm-image-packages"><div class="titlepage"><div><div><h2 class="title">14.2. VM Image packages</h2></div></div></div><p class="Role ARG Spec Role ARG Spec">
				Ansible Automation Platform from GCP Marketplace is delivered through virtual machines that are based on a VM image produced by the Red Hat Ansible team. This image contains packages from Red Hat and Google in order to properly function on Google Cloud Platform and run Red Hat Ansible Automation Platform. The image contains the following Google packages and containers:
			</p><div class="informaltable"><table class="lt-4-cols lt-7-rows Role ARG Spec"><colgroup><col style="width: 43%; " class="col_1"><!--Empty--></col><col style="width: 57%; " class="col_2"><!--Empty--></col></colgroup><thead><tr><th align="left" valign="top" id="idm139690693561072" scope="col">Package Name</th><th align="left" valign="top" id="idm139690693559984" scope="col">Description</th></tr></thead><tbody><tr><td align="left" valign="top" headers="idm139690693561072"> <p>
								<code class="literal Role ARG Spec">google-osconfig-agent</code>
							</p>
							 </td><td align="left" valign="top" headers="idm139690693559984"> <p>
								The Google OS Configuration Agent uses the management service to deploy, query, and maintain consistent configurations, that is, the desired state and software for your VM instance.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139690693561072"> <p>
								<code class="literal Role ARG Spec">google-cloud-ops-agent</code>
							</p>
							 </td><td align="left" valign="top" headers="idm139690693559984"> <p>
								The Ops Agent is the primary agent for collecting telemetry from your Compute Engine instances. Combining logging and metrics into a single agent, the Ops Agent uses Fluent Bit for logs, which supports high-throughput logging, and the OpenTelemetry Collector for metrics.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139690693561072"> <p>
								<code class="literal Role ARG Spec">gce-proxy</code>
							</p>
							 </td><td align="left" valign="top" headers="idm139690693559984"> <p>
								The Cloud SQL Authorization proxy is used to connect Ansible Automation Platform components with the Cloud SQL database using the virtual machine service account.
							</p>
							 </td></tr><tr><td align="left" valign="top" headers="idm139690693561072"> <p>
								<code class="literal Role ARG Spec">gcloud CLI</code>
							</p>
							 </td><td align="left" valign="top" headers="idm139690693559984"> <p>
								The gcloud command line interface is used to configure the Ansible Automation Platform installation.
							</p>
							 </td></tr></tbody></table></div></section></section><section class="appendix Role ARG Spec" id="assembly-appendix-aap-release-notes"><div class="titlepage"><div><div><h1 class="title">Appendix A. Release notes for Ansible on Clouds 2.4</h1></div></div></div><p class="Role ARG Spec Role ARG Spec">
			This release includes a number of enhancements, additions, and fixes that have been implemented for Ansible Automation Platform from GCP Marketplace.
		</p><div class="admonition note Role ARG Spec"><div class="admonition_header">Note</div><div><p class="Role ARG Spec Role ARG Spec">
				Automation Mesh and Event Driven Automation are not yet supported by the self-managed Ansible on Cloud offerings at this time.
			</p></div></div><h3 id="enhancements">Enhancements</h3><p class="Role ARG Spec Role ARG Spec">
			The release version 2.4.20240215 of Ansible Automation Platform from GCP Marketplace includes the following enhancements:
		</p><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
					Various CVE fixes
				</li></ul></div><h3 id="deprecated_and_removed_features">Deprecated and removed features</h3><p class="Role ARG Spec Role ARG Spec">
			Some features available in previous releases have been deprecated or removed. Deprecated functionality is still included in Ansible Automation Platform and continues to be supported; however, it will be removed in a future release of this product and is not recommended for new deployments. The following is a list of major functionality deprecated and removed within Ansible Automation Platform 2.4:
		</p><div class="itemizedlist Role ARG Spec"><ul class="itemizedlist Role ARG Spec" type="disc"><li class="listitem">
					On-premise component Automation Services Catalog is now removed from Ansible Automation Platform 2.4 onwards.
				</li><li class="listitem">
					With the Ansible Automation Platform 2.4 release, the Execution Environment container image for Ansible 2.9 (ee-29-rhel-8) is no longer loaded into the Automation Controller configuration by default.
				</li><li class="listitem"><p class="simpara">
					The process of deploying the application using a new VPC has been deprecated, and the functionality will be removed from Ansible Automation Platform from GCP Marketplace in a future release.
				</p><h3 id="additional_release_notes_related_to_ansible_automation_platform">Additional Release Notes related to Ansible Automation Platform</h3></li><li class="listitem">
					Check out latest features in <a class="link mimir-link-warn" href="https://access.redhat.com/login?redirectTo=https%3A%2F%2Faccess.redhat.com%2Fdocumentation%2Fen-us%2Fred_hat_enterprise_linux%2F9" title="This content is not included in Mimir.">Red Hat Enterprise Linux 9</a>
				</li><li class="listitem">
					Read more about latest <a class="link mimir-link-warn" href="https://access.redhat.com/documentation/en-us/red_hat_ansible_automation_platform/2.4/html/red_hat_ansible_automation_platform_release_notes/index?extIdCarryOver=true&amp;intcmp=7013a0000026H45AAE&amp;sc_cid=7013a000003SeN0AAK" title="This content is not included in Mimir.">Ansible Automation Platform features</a>
				</li></ul></div></section><div><div xml:lang="en-US" class="legalnotice" id="idm139690691414528"><h1 class="legalnotice">Legal Notice</h1><div class="para">
		Copyright <span class="trademark"><!--Empty--></span>© 2024 Red Hat, Inc.
	</div><div class="para">
		The text of and illustrations in this document are licensed by Red Hat under a Creative Commons Attribution–Share Alike 3.0 Unported license ("CC-BY-SA"). An explanation of CC-BY-SA is available at <a class="uri mimir-link-warn" href="http://creativecommons.org/licenses/by-sa/3.0/" title="Mimir does not include content from: creativecommons.org">http://creativecommons.org/licenses/by-sa/3.0/</a>. In accordance with CC-BY-SA, if you distribute this document or an adaptation of it, you must provide the URL for the original version.
	</div><div class="para">
		Red Hat, as the licensor of this document, waives the right to enforce, and agrees not to assert, Section 4d of CC-BY-SA to the fullest extent permitted by applicable law.
	</div><div class="para">
		Red Hat, Red Hat Enterprise Linux, the Shadowman logo, the Red Hat logo, JBoss, OpenShift, Fedora, the Infinity logo, and RHCE are trademarks of Red Hat, Inc., registered in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Linux</span>® is the registered trademark of Linus Torvalds in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Java</span>® is a registered trademark of Oracle and/or its affiliates.
	</div><div class="para">
		<span class="trademark">XFS</span>® is a trademark of Silicon Graphics International Corp. or its subsidiaries in the United States and/or other countries.
	</div><div class="para">
		<span class="trademark">MySQL</span>® is a registered trademark of MySQL AB in the United States, the European Union and other countries.
	</div><div class="para">
		<span class="trademark">Node.js</span>® is an official trademark of Joyent. Red Hat is not formally related to or endorsed by the official Joyent Node.js open source or commercial project.
	</div><div class="para">
		The <span class="trademark">OpenStack</span>® Word Mark and OpenStack logo are either registered trademarks/service marks or trademarks/service marks of the OpenStack Foundation, in the United States and other countries and are used with the OpenStack Foundation's permission. We are not affiliated with, endorsed or sponsored by the OpenStack Foundation, or the OpenStack community.
	</div><div class="para">
		All other trademarks are the property of their respective owners.
	</div></div></div></div></body>

        
        
    </div>
    

</div> 


                            </bdo>
                        </main>
                    </div>
                </main>
            </div>
        
            <!--#include virtual="/includes/footer/index.html" -->
        </div>
    </body>
</html>
